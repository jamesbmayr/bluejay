/* phrase library */
	window.PHRASE_LIBRARY = {
		// casual responses
			"thank you": 						"receive gratitude",
			"thanks": 							"receive gratitude",
			"i appreciate": 					"receive gratitude",
			"well thank you": 					"receive gratitude",
			"well thanks": 						"receive gratitude",
			"good job": 						"receive gratitude",
			"excellent": 						"receive gratitude",
			"excellent work": 					"receive gratitude",
			"job well done": 					"receive gratitude",
			"well done": 						"receive gratitude",

			"im sorry": 						"receive apology",
			"sorry": 							"receive apology",
			"i am sorry": 						"receive apology",
			"i apologize": 						"receive apology",
			"my apologies": 					"receive apology",
			"apologies": 						"receive apology",
			"can you forgive": 					"receive apology",
			"do you forgive": 					"receive apology",
			"would you forgive": 				"receive apology",

			"who is a good": 					"receive affirmation",
			"whos a good": 						"receive affirmation",
			"whose a good": 					"receive affirmation",
			"who is my good": 					"receive affirmation",
			"whos my good": 					"receive affirmation",
			"whose my good": 					"receive affirmation",
			"youre an excellent": 				"receive affirmation",
			"you are an excellent": 			"receive affirmation",
			"youre a good": 					"receive affirmation",
			"you are a good": 					"receive affirmation",
			"youre great": 						"receive affirmation",
			"you are great": 					"receive affirmation",
			"youre wonderful": 					"receive affirmation",
			"you are wonderful": 				"receive affirmation",
			"youre awesome": 					"receive affirmation",
			"you are awesome": 					"receive affirmation",
			"youre wonderful": 					"receive affirmation",
			"you are wonderful": 				"receive affirmation",
			"youre amazing": 					"receive affirmation",
			"you are amazing": 					"receive affirmation",

			"happy": 							"receive greeting",
			"good": 							"receive greeting",
			"merry": 							"receive greeting",
			"i hope you have a happy": 			"receive greeting",
			"i hope you have a good": 			"receive greeting",
			"i hope you have a great": 			"receive greeting",
			"i hope you have a merry": 			"receive greeting",
			"i hope youre enjoying": 			"receive greeting",
			"i hope youre enjoying your": 		"receive greeting",
			"i hope youre enjoying this": 		"receive greeting",
			"i hope you are enjoying": 			"receive greeting",
			"i hope you are enjoying your": 	"receive greeting",
			"i hope you are enjoying this": 	"receive greeting",

		// meta
			"help": 							"list actions",
			"get help": 						"list actions",
			"what are your functions": 			"list actions",
			"what can you do": 					"list actions",
			"i need help": 						"list actions",
			"what are your functions": 			"list actions",
			"what can you do": 					"list actions",
			"i need some help": 				"list actions",
			"what can i say": 					"list actions",
			"list functions": 					"list actions",
			"list actions": 					"list actions",
			"list commands": 					"list actions",

			"repeat after me": 					"repeat this",
			"repeat this": 						"repeat this",
			"say what i say": 					"repeat this",
			"say exactly what i say": 			"repeat this",
			"say this back": 					"repeat this",
			"jot this down": 					"repeat this",
			"copy this down": 					"repeat this",
			"write this down": 					"repeat this",

			"repeat that": 						"repeat that",
			"repeat what you said": 			"repeat that",
			"say what you said": 				"repeat that",
			"say what you said again": 			"repeat that",
			"say that again": 					"repeat that",
			"run that by me again": 			"repeat that",
			"can you repeat that": 				"repeat that",
			"i didnt catch that": 				"repeat that",

		// settings
			"stop listening": 					"stop listening",
			"stop listening to me": 			"stop listening",
			"quit listening": 					"stop listening",
			"quit listening to me": 			"stop listening",
			"cease listening": 					"stop listening",
			"cease listening to me": 			"stop listening",

			"change voice": 					"change voice",
			"change voice to": 					"change voice",
			"change the voice to": 				"change voice",
			"set voice to": 					"change voice",
			"set the voice to": 				"change voice",
			"set new voice": 					"change voice",
			"switch voice to": 					"change voice",
			"switch the voice to": 				"change voice",

			"change volume": 					"change volume",
			"change volume to": 				"change volume",
			"change the volume to": 			"change volume",
			"set volume to": 					"change volume",
			"set the volume to": 				"change volume",
			"set new volume": 					"change volume",
			"set new volume at": 				"change volume",

			"change listening duration": 		"change listening duration",
			"change listening duration to": 	"change listening duration",
			"change the listening duration to": "change listening duration",
			"set listening duration to": 		"change listening duration",
			"set the listening duration to": 	"change listening duration",
			"set new listening duration": 		"change listening duration",
			"set new listening duration at": 	"change listening duration",
			"change recognition duration": 		"change listening duration",
			"change recognition duration to": 	"change listening duration",
			"change the recognition duration to": "change listening duration",
			"set recognition duration to": 		"change listening duration",
			"set the recognition duration to": 	"change listening duration",
			"set new recognition duration": 	"change listening duration",
			"set new recognition duration at": 	"change listening duration",

			"change configuration": 			"change configuration",
			"edit configuration": 				"change configuration",
			"edit configuration for": 			"change configuration",
			"set configuration": 				"change configuration",
			"set a configuration": 				"change configuration",
			"set this configuration": 			"change configuration",
			"set configuration for": 			"change configuration",
			"set a configuration for": 			"change configuration",
			"set the configuration for": 		"change configuration",
			"set my configuration for": 		"change configuration",
			"set new configuration": 			"change configuration",
			"set new configuration for": 		"change configuration",
			"set a new configuration": 			"change configuration",
			"set a new configuration for": 		"change configuration",
			"change a configuration": 			"change configuration",
			"change my configuration": 			"change configuration",
			"change my configuration for": 		"change configuration",
			"add to my profile": 				"change configuration",
			"add this to my profile": 			"change configuration",
			"edit my profile": 					"change configuration",
			"save my": 							"change configuration",
			"set my saved": 					"change configuration",
			"change my saved": 					"change configuration",
			"update my saved": 					"change configuration",
			"configure my": 					"change configuration",
			"configure": 						"change configuration",

			"authorize": 						"authorize platform",
			"create authorization": 			"authorize platform",
			"get authorization link": 			"authorize platform",
			"activate": 						"authorize platform",
			"create activation": 				"authorize platform",
			"get activation link": 				"authorize platform",
			"authorize a platform": 			"authorize platform",
			"authorize platform": 				"authorize platform",

		// time
			"get the time": 					"get the time",
			"what time is it": 					"get the time",
			"what is the time": 				"get the time",
			"whats the time": 					"get the time",
			"tell me the time": 				"get the time",

			"get the day": 						"get the day",
			"what day is it": 					"get the day",
			"what day is today": 				"get the day",
			"whats the day": 					"get the day",
			"whats today": 						"get the day",
			"tell me the day": 					"get the day",

			"get the month": 					"get the month",
			"what month is it": 				"get the month",
			"what is the month": 				"get the month",
			"whats the month": 					"get the month",
			"tell me the month": 				"get the month",

			"get the date": 					"get the date",
			"what date is it": 					"get the date",
			"whats todays date": 				"get the date",
			"what is the date": 				"get the date",
			"what is todays date": 				"get the date",
			"whats the date": 					"get the date",
			"tell me the date": 				"get the date",

		// alarms
			"set a timer": 						"set alarm",
			"set timer": 						"set alarm",
			"set an alarm": 					"set alarm",
			"set alarm": 						"set alarm",
			"wake me up": 						"set alarm",
			"alert me": 						"set alarm",

			"cancel alarm": 					"cancel alarm",
			"turn off alarm": 					"cancel alarm",
			"deactivate alarm": 				"cancel alarm",
			"unset alarm": 						"cancel alarm",
			"stop alarm": 						"cancel alarm",
			"cancel my alarm": 					"cancel alarm",
			"turn off my alarm": 				"cancel alarm",
			"deactivate my alarm": 				"cancel alarm",
			"unset my alarm": 					"cancel alarm",
			"stop my alarm": 					"cancel alarm",
			"cancel timer": 					"cancel alarm",
			"turn off timer": 					"cancel alarm",
			"deactivate timer": 				"cancel alarm",
			"unset timer": 						"cancel alarm",
			"stop timer": 						"cancel alarm",
			"cancel my timer": 					"cancel alarm",
			"turn off my timer": 				"cancel alarm",
			"deactivate my timer": 				"cancel alarm",
			"unset my timer": 					"cancel alarm",
			"stop my timer": 					"cancel alarm",

			"cancel all alarms": 				"cancel all alarms",
			"turn off all alarms": 				"cancel all alarms",
			"deactivate all alarms": 			"cancel all alarms",
			"unset all alarms": 				"cancel all alarms",
			"stop all alarms": 					"cancel all alarms",
			"cancel all my alarms": 			"cancel all alarms",
			"turn off all my alarms": 			"cancel all alarms",
			"deactivate all my alarms": 		"cancel all alarms",
			"unset all my alarms": 				"cancel all alarms",
			"stop all my alarms": 				"cancel all alarms",
			"cancel all of my alarms": 			"cancel all alarms",
			"turn off all of my alarms": 		"cancel all alarms",
			"deactivate all of my alarms": 		"cancel all alarms",
			"unset all of my alarms": 			"cancel all alarms",
			"stop all of my alarms": 			"cancel all alarms",
			"cancel all timers": 				"cancel all alarms",
			"turn off all timers": 				"cancel all alarms",
			"deactivate all timers": 			"cancel all alarms",
			"unset all timers": 				"cancel all alarms",
			"stop all timers": 					"cancel all alarms",
			"cancel all my timers": 			"cancel all alarms",
			"turn off all my timers": 			"cancel all alarms",
			"deactivate all my timers": 		"cancel all alarms",
			"unset all my timers": 				"cancel all alarms",
			"stop all my timers": 				"cancel all alarms",
			"cancel all of my timers": 			"cancel all alarms",
			"turn off all of my timers": 		"cancel all alarms",
			"deactivate all of my timers": 		"cancel all alarms",
			"unset all of my timers": 			"cancel all alarms",
			"stop all of my timers": 			"cancel all alarms",

		// rng
			"roll": 							"roll dice",
			"roll me": 							"roll dice",
			"roll me some": 					"roll dice",
			"roll some": 						"roll dice",

			"flip a coin": 						"flip a coin",
			"heads or tails": 					"flip a coin",

			"consult the magic 8 ball": 		"consult the magic 8 ball",
			"consult a magic 8 ball": 			"consult the magic 8 ball",
			"shake the magic 8 ball": 			"consult the magic 8 ball",
			"ask the magic 8 ball": 			"consult the magic 8 ball",
			"magic 8 ball": 					"consult the magic 8 ball",
			"consult the magic 8-ball": 		"consult the magic 8 ball",
			"consult a magic 8-ball": 			"consult the magic 8 ball",
			"shake the magic 8-ball": 			"consult the magic 8 ball",
			"ask the magic 8-ball": 			"consult the magic 8 ball",
			"magic 8-ball": 					"consult the magic 8 ball",
			"magic conch": 						"consult the magic 8 ball",
			"read my future": 					"consult the magic 8 ball",

		// math
			"calculate": 						"calculate",
			"lets do some math": 				"calculate",
			"do some math for me": 				"calculate",
			"add": 								"calculate",
			"subtract": 						"calculate",
			"multiply": 						"calculate",
			"divide": 							"calculate",
			
			"double": 							"double",
			"triple": 							"triple",

			"average": 							"average",
			"find the average of": 				"average",
			"what is the average of": 			"average",
			"whats the average of": 			"average",

			"start counting": 					"count",
			"count": 							"count",
			"can you count": 					"count",
			"lets count": 						"count",
			"give me a count": 					"count",

		// words
			"spell word": 						"spell word",
			"spell": 							"spell word",
			"spell a word": 					"spell word",
			"spell the word": 					"spell word",
			"how do you spell": 				"spell word",
			"how do you spell the word": 		"spell word",
			"can you spell": 					"spell word",
			"can you spell the word": 			"spell word",
			"what is the spelling of": 			"spell word",
			"whats the spelling of": 			"spell word",
			"tell me how to spell": 			"spell word",
			"tell me how to spell the word": 	"spell word",
			"tell me the spelling of": 			"spell word",
			"tell me the spelling for": 		"spell word",
			"tell me the spelling of the word": "spell word",
			"tell me the spelling for the word": "spell word",

			"find rhymes": 						"find rhymes",
			"what rhymes with": 				"find rhymes",
			"find a rhyme for": 				"find rhymes",
			"find rhymes for": 					"find rhymes",
			"get a rhyme for": 					"find rhymes",
			"get rhymes for": 					"find rhymes",
			"rhymes with": 						"find rhymes",
			"something that rhymes with": 		"find rhymes",

			"find synonyms": 					"find synonyms",
			"what is a synonym for": 			"find synonyms",
			"find a synonym for": 				"find synonyms",
			"find synonyms for": 				"find synonyms",
			"get a synonym for": 				"find synonyms",
			"get synonyms for": 				"find synonyms",
			"synonym of": 						"find synonyms",
			"what has the same meaning as": 	"find synonyms",

			"find definition": 					"find definition",
			"find a definition for": 			"find definition",
			"find definition for": 				"find definition",
			"find the meaning of": 				"find definition",
			"define": 							"find definition",
			"define the word": 					"find definition",
			"look up the word": 				"find definition",
			"provide a definition for": 		"find definition",
			"what is the meaning of": 			"find definition",
			"whats the meaning of": 			"find definition",

		// content API fetches
			"get a joke": 						"get a joke",
			"tell me a joke": 					"get a joke",
			"know any jokes": 					"get a joke",
			"do you know any jokes": 			"get a joke",
			"say something funny": 				"get a joke",
			"be funny": 						"get a joke",
			"i could use a joke": 				"get a joke",
			"tell a joke": 						"get a joke",
			"tell us a joke": 					"get a joke",
			"make me laugh": 					"get a joke",
			"fetch a joke": 					"get a joke",
			"fetch me a joke": 					"get a joke",
			"tell me something funny": 			"get a joke",

			"get a quote": 						"get a quote",
			"get me a quote": 					"get a quote",
			"give me a quote": 					"get a quote",
			"get a random quote": 				"get a quote",
			"get me a random quote": 			"get a quote",
			"give me a random quote": 			"get a quote",
			"random quote": 					"get a quote",
			"famous quote": 					"get a quote",
			"inspire me": 						"get a quote",
			"tell me a random quote": 			"get a quote",
			"tell me a quote": 					"get a quote",
			"fetch a quote": 					"get a quote",
			"fetch me a quote": 				"get a quote",

			"get a fortune": 					"get a fortune",
			"get me a fortune": 				"get a fortune",
			"give me a fortune": 				"get a fortune",
			"get a random fortune": 			"get a fortune",
			"get me a random fortune": 			"get a fortune",
			"give me a random fortune": 		"get a fortune",
			"random fortune": 					"get a fortune",
			"tell my fortune": 					"get a fortune",
			"tell me my fortune": 				"get a fortune",
			"read my fortune": 					"get a fortune",
			"tell me a random fortune": 		"get a fortune",
			"tell me a fortune": 				"get a fortune",
			"fetch a fortune": 					"get a fortune",
			"fetch me a fortune": 				"get a fortune",
			"what is my fortune": 				"get a fortune",
			"whats my fortune": 				"get a fortune",

			"get an insult": 					"get an insult",
			"insult me": 						"get an insult",
			"disrespect me": 					"get an insult",
			"dis me": 							"get an insult",
			"diss me": 							"get an insult",
			"your mother": 						"get an insult",
			"your mothers": 					"get an insult",
			"youre mother": 					"get an insult",
			"youre mothers": 					"get an insult",
			"your mom": 						"get an insult",
			"your moms": 						"get an insult",
			"youre mom": 						"get an insult",
			"youre moms": 						"get an insult",
			"your mama": 						"get an insult",
			"your mamas": 						"get an insult",
			"youre mama": 						"get an insult",
			"youre mamas": 						"get an insult",
			"yo mama": 							"get an insult",
			"yo mamas": 						"get an insult",
			"yo momma": 						"get an insult",
			"yo mommas": 						"get an insult",

			"get a wikipedia entry": 			"get a wikipedia entry",
			"on wikipedia, look up": 			"get a wikipedia entry",
			"tell me about": 					"get a wikipedia entry",
			"on wikipedia tell me about": 		"get a wikipedia entry",
			"look this up on wikipedia": 		"get a wikipedia entry",
			"search wikipedia for": 			"get a wikipedia entry",
			"get the wikipedia entry about": 	"get a wikipedia entry",
			"get the wikipedia entry for": 		"get a wikipedia entry",
			"on wikipedia find": 				"get a wikipedia entry",
			"on wikipedia look up": 			"get a wikipedia entry",
			"read the wikipedia page about": 	"get a wikipedia entry",
			"read me the wikipedia page about": "get a wikipedia entry",
			"read the wikipedia entry for": 	"get a wikipedia entry",
			"read me the wikipedia entry for": 	"get a wikipedia entry",
			"get the wikipedia page for": 		"get a wikipedia entry",
			"give me the wikipedia page for": 	"get a wikipedia entry",
			"get me the wikipedia page for": 	"get a wikipedia entry",
			"do a wikipedia search for": 		"get a wikipedia entry",
			"get the wikipedia article for": 	"get a wikipedia entry",
			"get the wikipedia article about": 	"get a wikipedia entry",

			"get this day in history": 			"get this day in history",
			"what happened today in history": 	"get this day in history",
			"get today in history": 			"get this day in history",
			"tell me about today in history": 	"get this day in history",
			"what went down in history today": 	"get this day in history",
			"what happened on this date": 		"get this day in history",

			"get the headlines": 				"get the headlines",
			"get todays headlines": 			"get the headlines",
			"whats happening in the world": 	"get the headlines",
			"what is happening in the world": 	"get the headlines",
			"get the top stories": 				"get the headlines",
			"get the news": 					"get the headlines",
			"get me the news": 					"get the headlines",
			"give me the news": 				"get the headlines",
			"fetch the news": 					"get the headlines",
			"what is the news": 				"get the headlines",
			"whats the news": 					"get the headlines",
			"whats the latest news": 			"get the headlines",
			"what is the latest news": 			"get the headlines",
			"whats happening in the news": 		"get the headlines",
			"what is happening in the news": 	"get the headlines",
			"read the headlines": 				"get the headlines",
			"read me the headlines": 			"get the headlines",

			"get the weather": 					"get the weather",
			"get the weather": 					"get the weather",
			"whats the weather": 				"get the weather",
			"what is the weather": 				"get the weather",
			"what will the be": 				"get the weather",
			"hows the weather": 				"get the weather",
			"how is the weather": 				"get the weather",
			"is it going to rain": 				"get the weather",
			"will it rain": 					"get the weather",
			"is it going to snow": 				"get the weather",
			"will it snow": 					"get the weather",

			"get nutrition facts": 				"get nutrition facts",
			"get nutrition facts about": 		"get nutrition facts",
			"get nutrition facts for": 			"get nutrition facts",
			"get the nutrition facts": 			"get nutrition facts",
			"get the nutrition facts about": 	"get nutrition facts",
			"get the nutrition facts for": 		"get nutrition facts",
			"give me the nutrition facts": 		"get nutrition facts",
			"give me the nutrition facts about": "get nutrition facts",
			"give me the nutrition facts for": 	"get nutrition facts",
			"tell me about the dish": 			"get nutrition facts",
			"tell me about the dish called": 	"get nutrition facts",
			"tell me about a dish": 			"get nutrition facts",
			"tell me about a dish called": 		"get nutrition facts",
			"look up the dish": 				"get nutrition facts",
			"look up the dish called": 			"get nutrition facts",
			"look up a dish": 					"get nutrition facts",
			"look up a dish called": 			"get nutrition facts",
			"tell me about the meal": 			"get nutrition facts",
			"tell me about the meal called": 	"get nutrition facts",
			"tell me about a meal": 			"get nutrition facts",
			"tell me about a meal called": 		"get nutrition facts",
			"look up the meal": 				"get nutrition facts",
			"look up the meal called": 			"get nutrition facts",
			"look up a meal": 					"get nutrition facts",
			"look up a meal called": 			"get nutrition facts",
			"tell me about the food": 			"get nutrition facts",
			"tell me about the food called": 	"get nutrition facts",
			"tell me about a food": 			"get nutrition facts",
			"tell me about a food called": 		"get nutrition facts",
			"look up the food": 				"get nutrition facts",
			"look up the food called": 			"get nutrition facts",
			"look up a food": 					"get nutrition facts",
			"look up a food called": 			"get nutrition facts",

			"get nutrition answer": 			"get nutrition answer",
			"get nutrition answer about": 		"get nutrition answer",
			"get nutrition answer for": 		"get nutrition answer",
			"get a nutrition answer": 			"get nutrition answer",
			"get a nutrition answer about": 	"get nutrition answer",
			"get a nutrition answer for": 		"get nutrition answer",
			"do a nutrition search": 			"get nutrition answer",
			"do a nutrition search for": 		"get nutrition answer",
			"do a nutrition search about": 		"get nutrition answer",
			"i have a nutrition question": 		"get nutrition answer",
			"let me ask a nutrition question": 	"get nutrition answer",
			"heres a nutrition question": 		"get nutrition answer",

		// Google Apps Script
			"add to wish list": 				"edit wish list",
			"add to my wish list": 				"edit wish list",
			"add this to my wish list": 		"edit wish list",
			"include on my wish list": 			"edit wish list",
			"edit my wish list to include": 	"edit wish list",

			"what is my account balance for": 	"get balance",
			"whats my account balance for": 	"get balance",
			"check my account balance for": 	"get balance",
			"how much money do i have in": 		"get balance",
			"how much do i have in": 			"get balance",
			"how much money do i have in my": 	"get balance",
			"how much do i have in my": 		"get balance",
			"what is the balance in my": 		"get balance",
			"whats the balance in my": 			"get balance",
			"what is the balance on my": 		"get balance",
			"whats the balance on my": 			"get balance",
			"how much money is left in my": 	"get balance",
			"how much money is in my": 			"get balance",
			"how much is in my": 				"get balance",

			"i just bought": 					"log purchase",
			"i bought": 						"log purchase",
			"add a purchase": 					"log purchase",
			"add a purchase of": 				"log purchase",
			"add my purchase": 					"log purchase",
			"add my purchase of": 				"log purchase",
			"record a purchase": 				"log purchase",
			"record my purchase": 				"log purchase",
			"record a purchase of": 			"log purchase",
			"record my purchase of": 			"log purchase",
			"log a purchase": 					"log purchase",
			"log my purchase": 					"log purchase",
			"log a purchase of": 				"log purchase",
			"log my purchase of": 				"log purchase",

			"fetch events": 					"fetch calendar",
			"fetch my events": 					"fetch calendar",
			"fetch upcoming events": 			"fetch calendar",
			"fetch my upcoming events": 		"fetch calendar",
			"fetch my calendar": 				"fetch calendar",
			"what is on my calendar": 			"fetch calendar",
			"whats on my calendar": 			"fetch calendar",
			"what is on the calendar": 			"fetch calendar",
			"whats on the calendar": 			"fetch calendar",
			"what is happening": 				"fetch calendar",
			"whats happening": 					"fetch calendar",

			"get a list": 						"get a list",
			"get my list": 						"get a list",
			"get the list": 					"get a list",
			"get a list named": 				"get a list",
			"get my list named": 				"get a list",
			"get the list named": 				"get a list",
			"get a list called": 				"get a list",
			"get my list called": 				"get a list",
			"get the list called": 				"get a list",
			"fetch a list": 					"get a list",
			"fetch my list": 					"get a list",
			"fetch the list": 					"get a list",
			"fetch a list named": 				"get a list",
			"fetch my list named": 				"get a list",
			"fetch the list named": 			"get a list",
			"fetch a list called": 				"get a list",
			"fetch my list called": 			"get a list",
			"fetch the list called": 			"get a list",

			"add an item to a list": 			"add an item to a list",
			"add an item to the": 				"add an item to a list",
			"add an item to my": 				"add an item to a list",
			"add an item to": 					"add an item to a list",
			"add a task to a list": 			"add an item to a list",
			"add a task to the": 				"add an item to a list",
			"add a task to my": 				"add an item to a list",
			"add a task to": 					"add an item to a list",
			"add this to": 						"add an item to a list",
			"add this to the": 					"add an item to a list",
			"add this to my": 					"add an item to a list",
			"add to my": 						"add an item to a list",
			"add to": 							"add an item to a list",
			"add something to": 				"add an item to a list",
			"add something to the": 			"add an item to a list",
			"add something to my": 				"add an item to a list",
			"uncheck this on the": 				"add an item to a list",
			"uncheck this on my": 				"add an item to a list",
			"uncheck this on": 					"add an item to a list",
			"uncheck this from the": 			"add an item to a list",
			"uncheck this from my": 			"add an item to a list",
			"uncheck this from": 				"add an item to a list",
			"uncheck an item on the": 			"add an item to a list",
			"uncheck an item on my": 			"add an item to a list",
			"uncheck an item on": 				"add an item to a list",
			"uncheck a task on the": 			"add an item to a list",
			"uncheck a task on my": 			"add an item to a list",
			"uncheck a task on": 				"add an item to a list",
			"uncheck something from a list": 	"add an item to a list",
			"log an item on": 					"add an item to a list",
			"log an item on the": 				"add an item to a list",
			"log a task on my": 				"add an item to a list",
			"log a task on": 					"add an item to a list",
			"log a task on the": 				"add an item to a list",
			"log a task on my": 				"add an item to a list",

			"get contacts": 					"get contacts",
			"get contacts named": 				"get contacts",
			"get contacts with the name": 		"get contacts",
			"get contacts by the name": 		"get contacts",
			"get a contact": 					"get contacts",
			"get a named": 						"get contacts",
			"get all contacts named": 			"get contacts",
			"get all contacts with the name": 	"get contacts",
			"search for contacts named": 		"get contacts",
			"search for contacts with the name": "get contacts",
			"search for contacts by the name": 	"get contacts",
			"search for contacts called": 		"get contacts",
			"look up a contact named": 			"get contacts",
			"look up a contact with the name": 	"get contacts",
			"look up contacts named": 			"get contacts",
			"look up contacts with the name": 	"get contacts",
			"look up contacts by the name": 	"get contacts",
			"look up contacts containing": 		"get contacts",
			"look up contacts whose names include": "get contacts",
			"find contacts whose names include": "get contacts",
			"find a contact": 					"get contacts",
			"find a contact named": 			"get contacts",
			"find a contact with the name": 	"get contacts",
			"find contacts named": 				"get contacts",
			"find contacts with the name": 		"get contacts",

			"get birthday": 					"get birthday",
			"get birthday for": 				"get birthday",
			"get birthday of": 					"get birthday",
			"get the birthday": 				"get birthday",
			"get the birthday for": 			"get birthday",
			"get the birthday of": 				"get birthday",
			"look up the birthday": 			"get birthday",
			"look up the birthday for": 		"get birthday",
			"look up the birthday of": 			"get birthday",
			"when is the birthday": 			"get birthday",
			"when is the birthday for": 		"get birthday",
			"when is the birthday of": 			"get birthday",

			"get phone number": 				"get phone number",
			"get phone number for": 			"get phone number",
			"get phone number of": 				"get phone number",
			"get the phone number": 			"get phone number",
			"get the phone number for": 		"get phone number",
			"get the phone number of": 			"get phone number",
			"look up the phone number": 		"get phone number",
			"look up the phone number for": 	"get phone number",
			"look up the phone number of": 		"get phone number",
			"when is the phone number": 		"get phone number",
			"when is the phone number for": 	"get phone number",
			"when is the phone number of": 		"get phone number",

			"get email": 						"get email",
			"get email for": 					"get email",
			"get email of": 					"get email",
			"get the email": 					"get email",
			"get the email for": 				"get email",
			"get the email of": 				"get email",
			"look up the email": 				"get email",
			"look up the email for": 			"get email",
			"look up the email of": 			"get email",
			"when is the email": 				"get email",
			"when is the email for": 			"get email",
			"when is the email of": 			"get email",
			"get email address": 				"get email",
			"get email address for": 			"get email",
			"get email address of": 			"get email",
			"get the email address": 			"get email",
			"get the email address for": 		"get email",
			"get the email address of": 		"get email",
			"look up the email address": 		"get email",
			"look up the email address for": 	"get email",
			"look up the email address of": 	"get email",
			"when is the email address": 		"get email",
			"when is the email address for": 	"get email",
			"when is the email address of": 	"get email",

			"get address": 						"get address",
			"get address for": 					"get address",
			"get address of": 					"get address",
			"get the address": 					"get address",
			"get the address for": 				"get address",
			"get the address of": 				"get address",
			"look up the address": 				"get address",
			"look up the address for": 			"get address",
			"look up the address of": 			"get address",
			"when is the address": 				"get address",
			"when is the address for": 			"get address",
			"when is the address of": 			"get address",

			"log gratitude": 					"log gratitude",
			"i feel grateful for": 				"log gratitude",
			"i am grateful for": 				"log gratitude",
			"i am feeling grateful for": 		"log gratitude",
			"im grateful for": 					"log gratitude",
			"im feeling grateful for": 			"log gratitude",
			"today i feel grateful for": 		"log gratitude",
			"today i am grateful for": 			"log gratitude",
			"today i am feeling grateful for": 	"log gratitude",
			"today im grateful for": 			"log gratitude",
			"today im feeling grateful for": 	"log gratitude",
			"i feel thankful for": 				"log gratitude",
			"i am thankful for": 				"log gratitude",
			"i am feeling thankful for": 		"log gratitude",
			"im thankful for": 					"log gratitude",
			"im feeling thankful for": 			"log gratitude",
			"today i feel thankful for": 		"log gratitude",
			"today i am thankful for": 			"log gratitude",
			"today i am feeling thankful for": 	"log gratitude",
			"today im thankful for": 			"log gratitude",
			"today im feeling thankful for": 	"log gratitude",

		// Google APIs
			"search google": 					"search google",
			"look this up on google": 			"search google",
			"do a google search": 				"search google",
			"do a google search for": 			"search google",
			"google": 							"search google",
			"do a search for": 					"search google",
			"do a search": 						"search google",
			"search": 							"search google",
			"i wonder if": 						"search google",
			"i wonder": 						"search google",
			"i am curious": 					"search google",
			"im curious": 						"search google",

			"search google directions": 		"search google directions",
			"how do i get": 					"search google directions",
			"how do i go": 						"search google directions",
			"tell me how to get": 				"search google directions",
			"tell me how to go": 				"search google directions",
			"get me directions": 				"search google directions",
			"get directions": 					"search google directions",
			"look up directions": 				"search google directions",
			"look up how to get": 				"search google directions",
			"look up how to go": 				"search google directions",
			"get a route": 						"search google directions",
			"route me": 						"search google directions",

			"search google places for": 		"search google places",
			"find a place": 					"search google places",
			"find a place called": 				"search google places",
			"find a place named": 				"search google places",
			"find a place by the name": 		"search google places",
			"find me a place": 					"search google places",
			"find me a place called": 			"search google places",
			"find me a place named": 			"search google places",
			"find me a place by the name": 		"search google places",
			"look up a place": 					"search google places",
			"look up a place called": 			"search google places",
			"look up a place named": 			"search google places",
			"look up a place by the name": 		"search google places",
			"look for a place": 				"search google places",
			"look for a place called": 			"search google places",
			"look for a place named": 			"search google places",
			"look for a place by the name": 	"search google places",
			"what are the business hours at": 	"search google places",
			"what are the hours at": 			"search google places",
			"what are the business hours of": 	"search google places",
			"what are the hours of": 			"search google places",
			"get the business hours for": 		"search google places",
			"get the hours for": 				"search google places",
			"get the business hours of": 		"search google places",
			"get the hours of": 				"search google places",

			"search youtube for": 				"search youtube",
			"find on youtube": 					"search youtube",
			"on youtube find": 					"search youtube",
			"on youtube look for": 				"search youtube",
			"on youtube play": 					"search youtube",
			"on youtube try": 					"search youtube",
			"play on youtube": 					"search youtube",
			"play this on youtube": 			"search youtube",
			"lets watch": 						"search youtube",
			"lets listen to": 					"search youtube",
			"on youtube put on": 				"search youtube",
			"on youtube open up": 				"search youtube",
			"on youtube open": 					"search youtube",

		// games
			"lets play more or less": 			"play more or less",
			"lets play the more or less game": 	"play more or less",
			"think of a number": 				"play more or less",
			"pick a number": 					"play more or less",
			"i want to guess a number": 		"play more or less",
			"play more or less": 				"play more or less",
			"lets play more or less": 			"play more or less",

			"quiz me": 							"play true or false",
			"tell me a fact": 					"play true or false",
			"tell me a fun fact": 				"play true or false",
			"give me a fact": 					"play true or false",
			"give me a fun fact": 				"play true or false",
			"lets do trivia": 					"play true or false",
			"lets do some trivia": 				"play true or false",
			"lets play trivia": 				"play true or false",
			"lets play some trivia": 			"play true or false",
			"play true or false": 				"play true or false",
			"lets play true or false": 			"play true or false",

		// SONOS

		// Wink
			"get wink devices": 				"get wink devices",
			"get all wink devices": 			"get wink devices",
			"get my wink devices": 				"get wink devices",
			"on wink get devices": 				"get wink devices",
			"on wink get my devices": 			"get wink devices",
			"on wink get all devices": 			"get wink devices",
			"on wink get the devices": 			"get wink devices",
			"on wink get all the devices": 		"get wink devices",
			"on wink get all of the devices": 	"get wink devices",
			"on wink get status": 				"get wink devices",
			"on wink whats the situation": 		"get wink devices",
			"on wink what is the situation": 	"get wink devices",
			"on wink give me a status report": 	"get wink devices",
			"on wink what is the temperature": 	"get wink devices",
			"on wink whats the temperature": 	"get wink devices",
			"on wink tell me the temperature": 	"get wink devices",
			"on wink report": 					"get wink devices",
			"on wink tell me the situation": 	"get wink devices",

			"on wink set": 						"set wink devices",
			"on wink update": 					"set wink devices",
			"on wink turn": 					"set wink devices",
			"on wink change": 					"set wink devices",
			"on wink alter": 					"set wink devices",
			"on wink make": 					"set wink devices",

			"on wink turn off": 				"turn off wink device",
			"on wink switch off": 				"turn off wink device",
			"on wink turn off": 				"turn off wink device",
			"on wink deactivate": 				"turn off wink device",

			"on wink turn on": 					"turn on wink device",
			"on wink switch on": 				"turn on wink device",
			"on wink flip on": 					"turn on wink device",
			"on wink activate": 				"turn on wink device",

		// Reddit
			"ask reddit": 						"ask reddit",
			"ask a question": 					"ask reddit",
			"ask me a question": 				"ask reddit",
			"ask us a question": 				"ask reddit",
			"ask me something": 				"ask reddit",
			"ask us something": 				"ask reddit",
			"ask something": 					"ask reddit",
			"change the subject": 				"ask reddit",
			"change the topic": 				"ask reddit",
			"change topic": 					"ask reddit",
			"change subject": 					"ask reddit",

			"get a reddit writing prompt": 		"get a reddit writing prompt",
			"get a writing prompt": 			"get a reddit writing prompt",
			"give me a writing prompt": 		"get a reddit writing prompt",
			"fetch a writing prompt": 			"get a reddit writing prompt",

		// custom APIs
			"convert": 							"convert",
			"do a conversion": 					"convert",
			"can you convert": 					"convert",
			"lets convert": 					"convert",

			"find factors": 					"find factors",
			"find factors of": 					"find factors",
			"find the factors of": 				"find factors",
			"find factors for": 				"find factors",
			"what are the factors of": 			"find factors",
			"tell me about the number": 		"find factors",
			"is this number prime": 			"find factors",
			"is this number composite": 		"find factors",
			"what are the prime factors of": 	"find factors",
			"what numbers go into": 			"find factors",
			"what are the divisors of": 		"find factors",
			"get the factors of": 				"find factors",

			"analyze chord": 					"analyze chord",
			"tell me about the notes": 			"analyze chord",
			"analyze the chord": 				"analyze chord",
			"analyze this chord": 				"analyze chord",
			"what chord are the notes": 		"analyze chord",
			"make a chord from the notes": 		"analyze chord",
			"make a chord from": 				"analyze chord",

			"shuffle word": 					"shuffle word",
			"shuffle the word": 				"shuffle word",
			"shuffle this word": 				"shuffle word",
			"what words can you make from": 	"shuffle word",
			"what are some anagrams for": 		"shuffle word",
			"make new words from": 				"shuffle word",
			"find anagrams for": 				"shuffle word",
			"find anagrams of": 				"shuffle word",
	}

/* action library */
	window.ACTION_LIBRARY = {
		// casual responses
			"receive gratitude": function(remainder, callback) {
				try {
					var icon = "&#x1f426;"

					var messages = ["You're welcome.", "Glad I could help.", "Any time.", "Don't mention it.", "No problem."]
					var message = window.FUNCTION_LIBRARY.chooseRandom(messages)
					callback({icon: icon, message: message, html: message, followup: false})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"receive apology": function(remainder, callback) {
				try {
					var icon = "&#x1f426;"

					var messages = ["Don't worry about it.", "I forgive you.", "It's all right.", "No worries.", "Everything will be okay."]
					var message = window.FUNCTION_LIBRARY.chooseRandom(messages)
					callback({icon: icon, message: message, html: message, followup: false})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"receive affirmation": function(remainder, callback) {
				try {
					var icon = "&#x1f426;"

					var messages = ["I am a good bird.", "Thank you. I try my hardest.", "That's kind of you to say.", "I'm glad you think so.", "I appreciate that."]
					var message = window.FUNCTION_LIBRARY.chooseRandom(messages)
					callback({icon: icon, message: message, html: message, followup: false})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"receive greeting": function(remainder, callback) {
				try {
					var icon = "&#x1f44b;"

					// clean up remainder
						remainder = remainder.toLowerCase().replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").trim()
						var words = remainder.split(/\s/gi)
						var message = ""

					// time of day
						if (words.includes("morning")) {
							message = "Good morning to you too!"
						}
						else if (words.includes("day")) {
							message = "I hope you have a great day too!"
						}
						else if (words.includes("afternoon") ) {
							message = "Good afternoon to you too!"
						}
						else if (words.includes("evening")) {
							message = "Good evening to you too!"
						}
						else if (words.includes("night")) {
							message = "I hope you have a good night too!"
						}

					// holidays
						else if (words.includes("christmas")) {
							message = "Merry Christmas to you too!"
						}
						else {
							message = "Happy " + remainder + " to you too!"
						}

					// response
						callback({icon: icon, message: message, html: "<h2>" + message + "</h2>"})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// meta
			"list actions": function(remainder, callback) {
				try {
					var icon = "&#x1f426;"

					var keys = Object.keys(window.ACTION_LIBRARY)
					
					var list = "<b>Here are all my actions:</b><ul>"
					for (var i in keys) {
						list += ("<li>" + keys[i] + "</li>")
					}
					list += "</ul>"
					
					callback({icon: icon, message: "Here are all of the actions I know.", html: list})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"repeat this": function(remainder, callback) {
				try {
					var icon = "&#x1f426;"

					callback({icon: icon, message: remainder, html: remainder})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"repeat that": function(remainder, callback) {
				try {
					var icon = "&#x1f426;"

					callback({icon: icon, message: window.CONTEXT_LIBRARY.lastResponseMessage || "No previous response.", html: window.CONTEXT_LIBRARY.lastResponseHTML || "No previous response."})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// settings
			"stop listening": function(remainder, callback) {
				try {
					var icon = "&#x1f507;"

					// force whistling off
						window.FUNCTION_LIBRARY.changeWhistleOn({forceOff: true})
						var restartTime = null

					// split into array
						var words = remainder.split(/\s/gi) || []

					// timer
						if ((/second|minute|hour|day|for/gi).test(remainder)) {
							var units = {
								"second": 1000,
								"minute": 1000 * 60,
								"hour": 1000 * 60 * 60,
								"day": 1000 * 60 * 60 * 24
							}

							var amounts = []
							for (var i = 0; i < words.length; i++) {
								words[i] = window.FUNCTION_LIBRARY.getDigits(words[i])

								if (!isNaN(words[i])) {
									if (words[i + 1] && units[words[i + 1].replace(/s$/gi,"").toLowerCase()]) {
										amounts.push({
											number: Number(words[i]),
											unit: words[i + 1].replace(/s$/gi,"")
										})
									}
									else {
										amounts.push({
											number: Number(words[i]),
											unit: "minute"
										})
									}
								}
							}

							var duration = 0
							for (var i in amounts) {
								duration += (amounts[i].number * units[amounts[i].unit])
							}

							if (duration) {
								restartTime = new Date().getTime() + duration
							}
						}

					// alarm
						else if ((/until|till|til/gi).test(remainder)) {
							var timePhrase = remainder.replace(/until|till|til/gi,"").toLowerCase().trim()
								timePhrase = timePhrase.replace("p.m.", "PM").replace("pm", "PM").replace("a.m.", "AM").replace("am", "AM")
							restartTime = new Date(timePhrase).getTime() || new Date(new Date().toDateString() + " " + timePhrase).getTime()
							
							if (!isNaN(restartTime)) {
								if (!timePhrase.includes("PM") && !timePhrase.includes("AM") && new Date().getTime() < restartTime + (1000 * 60 * 60 * 12)) {
									restartTime = restartTime + (1000 * 60 * 60 * 12)
								}
								else if (new Date().getTime() < restartTime + (1000 * 60 * 60 * 24)) {
									restartTime = restartTime + (1000 * 60 * 60 * 24)
								}
							}
						}

					// restartTime?
						if (restartTime && !isNaN(restartTime)) {
							window.CONTEXT_LIBRARY.startListening = restartTime
						}
						else {
							window.CONTEXT_LIBRARY.startListening = null
						}

					// get message
						if (restartTime) {
							var responseHTML = "Whistle detection turned off until <b>" + new Date(restartTime).toLocaleString() + "</b>."
						}
						else {
							var responseHTML = "Whistle detection turned off."
						}
						
					// response
						callback({icon: icon, message: "", html: responseHTML, followup: false})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"change voice": function(remainder, callback) {
				try {
					var icon = "&#x1f50a;"

					// change voice
						var name = remainder.toLowerCase().replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").trim()
						var voice = window.FUNCTION_LIBRARY.changeVoice({name: name})

					// failure
						if (voice === false) {
							callback({icon: icon, error: true, message: "I don't recognize that voice.", html: "<h2>Error: voice not found:</h2>" + remainder})
						}

					// success
						else {
							callback({icon: icon, message: "Voice set to " + voice, html: "voice: " + voice})
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"change volume": function(remainder, callback) {
				try {
					var icon = "&#x1f50a;"

					// change volume
						var volume = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").trim()
							volume = window.FUNCTION_LIBRARY.getDigits(volume)
						var newVolume = window.FUNCTION_LIBRARY.changeVoiceVolume({volume: volume})

					// failure
						if (newVolume === false) {
							callback({icon: icon, error: true, message: "I don't know that number.", html: "<h2>Error: invalid volume:</h2>" + remainder})
						}

					// success
						else {
							callback({icon: icon, message: "Volume set to " + newVolume + " percent", html: "volume: " + newVolume + "%"})
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"change listening duration": function(remainder, callback) {
				try {
					var icon = "&#x1f399;"

					// get duration
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").trim()
						var words = remainder.split(/\s/gi)
						var duration = null
						for (var i in words) {
							words[i] = window.FUNCTION_LIBRARY.getDigits(words[i])
							if (!isNaN(words[i])) {
								duration = Number(words[i])
								break
							}
						}

					// no duration
						if (duration === null) {
							callback({icon: icon, error: true, message: "I don't know that number.", html: "<h2>Error: invalid duration:</h2>" + remainder})
						}

					// some duration
						else {
							// change duration
								var newDuration = window.FUNCTION_LIBRARY.changeRecognitionDuration({duration: duration})

							// failure
								if (newDuration === false) {
									callback({icon: icon, error: true, message: "I don't know that number.", html: "<h2>Error: invalid duration:</h2>" + remainder})
								}

							// success
								else {
									callback({icon: icon, message: "Listening duration set to " + newDuration + (newDuration == 1 ? " second" : " seconds"), html: "listening duration: " + newDuration + (newDuration == 1 ? " second" : " seconds")})
								}
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"change configuration": function(remainder, callback) {
				try {
					var icon = "&#x2699;"

					// get key and value
						var pair = remainder.split(/ equal to | equals | to | is | as /gi)
						if (pair[0] === undefined || pair[0] === null || pair[1] === undefined || pair[1] === null) {
							callback({icon: icon, error: true, message: "I'm missing a key or value.", html: "<h2>Error: invalid key or value</h2>"})
							return
						}
						else {
							var key = String(pair[0]).toLowerCase()
							var value = String(pair[1])
						}

					// try converting to number
						if (!isNaN(Number(value))) {
							value = Number(value)
						}

					// save and respond
						var success = window.FUNCTION_LIBRARY.changeConfiguration({key: key, value: value})
						if (!success) {
							callback({icon: icon, error: true, message: "I couldn't set that configuration.", html: "<h2>Error: invalid or missing key and value</h2>"})
						}
						else {
							callback({icon: icon, message: key + " is now " + value, html: key + " = " + value})
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"authorize platform": function(remainder, callback) {
				try {
					var icon = "&#x1f510;"

					// get credentials
						var credentials = remainder.split(/\s/gi)
						var name = credentials[0].toLowerCase() || ""

					// no platform?
						var platforms = {
							"sonos": {
								host: "api.sonos.com",
								authPath: "/login/v3/oauth?response_type=code&scope=playback-control-all",
								reauthPath: "/login/v3/oauth/access",
								stateSecret: function(key, secret) { return btoa(key + ":" + secret) }
							},
							"wink": {
								host: "api.wink.com",
								authPath: "/oauth2/authorize?response_type=code",
								reauthPath: "/oauth2/token",
								stateSecret: function(key, secret) { return secret }
							},
							"reddit": {
								host: "www.reddit.com",
								authPath: "/api/v1/authorize/?response_type=code&duration=permanent&scope=read",
								reauthPath: "/api/v1/access_token",
								stateSecret: function(key, secret) { return btoa(key + ":" + secret) }
							}
						}

						if (!name || !Object.keys(platforms).includes(name)) {
							callback({icon: icon, error: true, message: "I couldn't identify that platform.", html: "<h2>Error: unable to authorize:</h2>" + remainder})
						}

					// credentials?
						else {
							// host
								var host = platforms[name].host

							// fresh
								if (!window.CONFIGURATION_LIBRARY[host] || !window.CONFIGURATION_LIBRARY[host].refresh_token) {
									var key = credentials[1] || window.CONFIGURATION_LIBRARY[name + " key"] || ""
									var secret = credentials[2] || window.CONFIGURATION_LIBRARY[name + " secret"] || ""
									var redirect = credentials[2] || window.CONFIGURATION_LIBRARY[name + " redirect"] || ""

									if (!key || !secret || !redirect) {
										callback({icon: icon, error: true, message: "I need a key, a secret, and a redirect to connect to " + name + ".", html: "<h2>Error: missing configurations:</h2>" + remainder + "<br><ul><li>" + name + " key</li><li>" + name + " secret</li><li>" + name + " redirect</li></ul>"})
									}
									else {
										var state = encodeURIComponent((window.location.origin + window.location.pathname) + ";;;" + platforms[name].stateSecret(key, secret))
										var url = "https://" + host + platforms[name].authPath + "&client_id=" + key + "&state=" + state + "&redirect_uri=" + encodeURIComponent(redirect)
										var popup = window.open(url, null, "height=500,width=500,status=yes,toolbar=no,menubar=no,location=no")

										callback({icon: icon, message: "Complete the authorization flow for " + host, html: "activating <b>" + host + "</b> in external popup"})

										window.FUNCTION_LIBRARY.fetchPeriodically("getAuthorization", host, function(data) {
											var value = window.CONFIGURATION_LIBRARY[host] || {}
												value.access_token = data.access_token
												value.refresh_token = data.refresh_token
												value.expiration = new Date().getTime() + (data.expires_in * 1000)
											window.FUNCTION_LIBRARY.changeConfiguration({key: host, value: value})
											callback({icon: icon, message: host + " is now authorized", html: "<b>" + host + "</b> is authorized until " + new Date(CONFIGURATION_LIBRARY[host].expiration).toLocaleString()})
										})
									}

									// THE BLUEJAY-OAUTH FLOW
										// 1: parse the user response or look in the CONFIGURATION_LIBRARY for the platform's key, secret, and redirect
										// 2: create a popup to the platform's auth screen; the "state" query param includes bluejay url and platform API key and/or secret
										// 3: user goes through and completes the auth flow
										// 4: external platform redirects the popup based the redirect param (currently a Google Apps Script); auth code is a param of this page
										// 5: Google Apps Script logs this and uses the "state" param and the new auth code to generate a bluejay link to /authorization
										// 6: the page auto-redirects to the /authorization url, with an embeddedPost parameter
										// 7: bluejay server interprets this param and sends an API request to external platform with the auth code
										// 8: platform responds with the actual access token (and refresh token)
										// 9: bluejay server saves the results of this to the db, specifically under the user's session id
										// 10: the main window had been requesting this data the whole time, and now it gets a success response
										// 11: bluejay saves these values to CONFIGURATION_LIBRARY and localStorage
										// 12: subsequent Sonos API calls can include the access_token
								}

							// expired
								else if (window.CONFIGURATION_LIBRARY[host] && (!window.CONFIGURATION_LIBRARY[host].expiration || isNaN(window.CONFIGURATION_LIBRARY[host].expiration) || window.CONFIGURATION_LIBRARY[host].expiration < new Date().getTime())) {
									var key = credentials[1] || window.CONFIGURATION_LIBRARY[name + " key"] || ""
									var secret = credentials[2] || window.CONFIGURATION_LIBRARY[name + " secret"] || ""
									var refresh_token = window.CONFIGURATION_LIBRARY[host].refresh_token || ""

									if (!key || !secret || !refresh_token) {
										callback({icon: icon, error: true, message: "I need a key, a secret, and a refresh token to reconnect to " + name + ".", html: "<h2>Error: unable to reauthorize:</h2>" + remainder + "<br><br><b>required configurations:</b><ul><li>" + name + " key</li><li>" + name + " secret</li><li>" + name + " refresh_token</li></ul>"})
									}
									else {
										var url = "https://" + host + platforms[name].reauthPath + "?grant_type=refresh_token&refresh_token=" + refresh_token
										var options = {
											method: "post",
											url: url,
											"Authorization": "Basic " + platforms[name].stateSecret(key, secret),
      										"Content-Type": "application/x-www-form-urlencoded;charset=utf-8"
										}

										window.FUNCTION_LIBRARY.proxyRequest(options, function(data) {
											try {
												if (data.access_token) {
													var value = window.CONFIGURATION_LIBRARY[host]
														value.access_token = data.access_token
														value.refresh_token = data.refresh_token
														value.expiration = new Date().getTime() + (data.expires_in * 1000)
													window.FUNCTION_LIBRARY.changeConfiguration({key: host, value: value})
													callback({icon: icon, message: host + " is now reauthorized", html: "<b>" + host + "</b> is authorized until " + new Date(CONFIGURATION_LIBRARY[host].expiration).toLocaleString()})
												}
												else {
													callback({icon: icon, error: true, message: "I couldn't reauthorize " + host, html: "<h2>Error: unable to reauthorize:</h2>" + host})
												}
											}
											catch (error) {
												callback({icon: icon, error: true, message: "I couldn't reauthorize " + host, html: "<h2>Error: unable to reauthorize:</h2>" + host})
											}
										})
									}
								}

							// already authorized
								else {
									callback({icon: icon, message: host + " is already authorized", html: "<b>" + host + "</b> is authorized until " + new Date(CONFIGURATION_LIBRARY[host].expiration).toLocaleString()})
								}
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// time
			"get the time": function(remainder, callback) {
				try {
					var icon = "&#x1f553;"

					var response = new Date().toLocaleTimeString()
					callback({icon: icon, message: response, html: "The time is " + response + "."})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get the day": function(remainder, callback) {
				try {
					var icon = "&#x1f4c5;"

					var response = (["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][new Date().getDay()])
					callback({icon: icon, message: response, html: "Today is " + response + "."})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get the month": function(remainder, callback) {
				try {
					var icon = "&#x1f4c5;"

					var response = (["January","February","March","April","May","June","July","August","September","October","November","December"][new Date().getMonth()])
					callback({icon: icon, message: response, html: "The month is " + response + "."})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get the date": function(remainder, callback) {
				try {
					var icon = "&#x1f4c5;"

					var response = (["January","February","March","April","May","June","July","August","September","October","November","December"][new Date().getMonth()] + " " + new Date().getDate())
					callback({icon: icon, message: response, html: "The date is " + response + "."})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// alarms
			"set alarm": function(remainder, callback) {
				try {
					var icon = "&#x23f0;"

					// split into array
						var words = remainder.split(/\s/gi) || []

					// timer
						if ((/second|minute|hour|day|in/gi).test(remainder)) {
							var units = {
								"second": 1000,
								"minute": 1000 * 60,
								"hour": 1000 * 60 * 60,
								"day": 1000 * 60 * 60 * 24
							}

							var amounts = []
							for (var i = 0; i < words.length; i++) {
								words[i] = window.FUNCTION_LIBRARY.getDigits(words[i])

								if (!isNaN(words[i])) {
									if (words[i + 1] && units[words[i + 1].replace(/s$/gi,"").toLowerCase()]) {
										amounts.push({
											number: Number(words[i]),
											unit: words[i + 1].replace(/s$/gi,"")
										})
									}
									else {
										amounts.push({
											number: Number(words[i]),
											unit: "minute"
										})
									}
								}
							}

							var duration = 0
							for (var i in amounts) {
								duration += (amounts[i].number * units[amounts[i].unit])
							}

							if (!duration) {
								callback({icon: icon, error: true, message: "I was unable to set that timer.", html: "<h2>Error: unable to set timer:</h2>" + response})
							}
							else {
								var endTime = new Date().getTime() + duration
								window.CONTEXT_LIBRARY.alarms.push(endTime)
								callback({icon: icon, message: "Alarm #" + window.CONTEXT_LIBRARY.alarms.length + " set for " + new Date(endTime).toLocaleTimeString(), html: "Alarm #" + window.CONTEXT_LIBRARY.alarms.length + " set for <b>" + new Date(endTime).toLocaleString() + "</b>"})
							}
						}

					// alarm
						else {
							var timePhrase = remainder.replace(/in|at|for|after|before|around/gi,"").toLowerCase().trim()
								timePhrase = timePhrase.replace("p.m.", "PM").replace("pm", "PM").replace("a.m.", "AM").replace("am", "AM")
							var endTime = new Date(timePhrase).getTime() || new Date(new Date().toDateString() + " " + timePhrase).getTime()
							
							if (isNaN(endTime)) {
								callback({icon: icon, error: true, message: "I was unable to set that alarm.", html: "<h2>Error: unable to set alarm:</h2>" + remainder})
							}
							else {
								if (!timePhrase.includes("PM") && !timePhrase.includes("AM") && new Date().getTime() < endTime + (1000 * 60 * 60 * 12)) {
									endTime = endTime + (1000 * 60 * 60 * 12)
								}
								else if (new Date().getTime() < endTime + (1000 * 60 * 60 * 24)) {
									endTime = endTime + (1000 * 60 * 60 * 24)
								}

								window.CONTEXT_LIBRARY.alarms.push(endTime)
								callback({icon: icon, message: "Alarm #" + window.CONTEXT_LIBRARY.alarms.length + " set for " + new Date(endTime).toLocaleTimeString(), html: "Alarm #" + window.CONTEXT_LIBRARY.alarms.length + " set for <b>" + new Date(endTime).toLocaleString() + "</b>"})
							}
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"cancel alarm": function(remainder, callback) {
				try {
					var icon = "&#x23f0;"

					// split into array
						var words = remainder.split(/\s/gi) || []

					// index
						var index = null
						for (var i in words) {
							words[i] = window.FUNCTION_LIBRARY.getDigits(words[i])
							if (!isNaN(words[i])) {
								index = Number(words[i])
								break
							}
						}

					// no index?
						if (index === null) {
							callback({icon: icon, error: true, message: "I was unable to find that alarm.", html: "<h2>Error: unable to cancel alarm:</h2>" + remainder})
						}

					// valid index
						else {
							var time = new Date(window.CONTEXT_LIBRARY.alarms[index - 1]).toLocaleString()
							callback({icon: icon, message: "I cancelled alarm #" + index + ", which was set for " + time + ".", html: "Cancelled alarm #" + index + ": <b>" + time + "</b>."})
							window.CONTEXT_LIBRARY.alarms[index - 1] = null
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"cancel all alarms": function(remainder, callback) {
				try {
					var icon = "&#x23f0;"

					// empty alarms array
						window.CONTEXT_LIBRARY.alarms = []

					// response
						callback({icon: icon, message: "I turned off all alarms.", html: "All alarms cancelled.", followup: false})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// rng
			"roll dice": function(remainder, callback) {
				try {
					var icon = "&#x1f3b2;"

					// defaults
						var count = 1
						var sides = 6
						remainder = " " + remainder

					// X dice with Y sides format
						if (remainder.includes("side") || remainder.includes("face")) {
							var count = Number(window.FUNCTION_LIBRARY.getDigits(remainder.split(/ dice with | die with | dice having /gi)[0])) || 1
							var sides = Number(window.FUNCTION_LIBRARY.getDigits((remainder.split(/ dice with | die with | dice having /gi)[1] || "").replace(/sides/gi,"").replace(/faces/gi,"").replace(/side/gi,"").replace(/face/gi,"")))
						}

					// XdY format
						else {
							var count = Number(window.FUNCTION_LIBRARY.getDigits(remainder.split(/d/gi)[0])) || 1
							var sides = Number(remainder.split(/d/gi)[1])
						}

					// roll dice
						var sum = 0
						for (var i = 0; i < count; i++) {
							sum += Math.floor(Math.random() * sides) + 1
						}

					// no sum?
						if (!sum || isNaN(sum)) {
							callback({icon: icon, error: true, message: "I couldn't roll those dice.", html: "<h2>Error: invalid dice:</h2>" + remainder})
						}

					// return sum
						else {
							callback({icon: icon, message: sum, html: count + "d" + sides + ": " + sum})
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"flip a coin": function(remainder, callback) {
				try {
					var icon = "&#x1f3b2;"

					var response = window.FUNCTION_LIBRARY.chooseRandom(["heads","tails"])
					callback({icon: icon, message: response, html: "coin: " + response})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"consult the magic 8 ball": function(remainder, callback) {
				try {
					var icon = "&#x1f3b1;"

					var options = ["It is certain", "It is decidedly so", "Without a doubt", "Yes - definitely", "You may rely on it", "As I see it, yes", "Most likely", "Outlook good", "Yes", "Signs point to yes", "Don't count on it", "My reply is no", "My sources say no", "Outlook not so good", "Very doubtful", "Reply hazy, try again", "Ask again later", "Better not tell you now", "Cannot predict now", "Concentrate and ask again"]
					var response = window.FUNCTION_LIBRARY.chooseRandom(options)
					callback({icon: icon, message: response, html: remainder + "<h2>" + response + "</h2>"})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
		
		// math
			"calculate": function(remainder, callback) {
				try {
					var icon = "&#x00b1;"

					// loop through and identify terms
						var terms = remainder.split(/\s/gi)
						for (var i = 0; i < terms.length; i++) {
							if (isNaN(terms[i])) {
								terms[i] = terms[i].toLowerCase()
									 if (terms[i] == "that") 	{ terms[i] = Number(window.CONTEXT_LIBRARY.lastResponseNumber) || 0 }
								else if (terms[i] == "by")      { terms[i] = "" }
								else if (terms[i] == "of")      { terms[i] = "" }
								else if (terms[i] == "plus")    { terms[i] = "+" }
								else if (terms[i] == "minus")   { terms[i] = "-" }
								else if (terms[i] == "times")   { terms[i] = "*" }
								else if (terms[i] == "divided") { terms[i] = "/" }
								else if (terms[i] == "squared") { terms[i] = "** 2" }
								else if (terms[i] == "cubed")   { terms[i] = "** 3" }
								else if (terms[i] == "halved")  { terms[i] = "/ 2" }
								else if (terms[i] == "power")   { terms[i] = "**" }
								else if (terms[i] == "root")    { terms[i] = "** (1/"; terms.splice(i + 2, 0, ")")}
								else if (terms[i] == "percent") { terms[i] = "/ 100 *"}
								else if (terms[i] == "(" || terms[i] == ")") {}
								else {
									terms[i] = window.FUNCTION_LIBRARY.getDigits(terms[i])
									if (isNaN(terms[i])) {
										terms[i] = "'" + terms[i] + "'"
									}
								}
							}
							else {
								terms[i] = Number(terms[i])
							}
						}

					// evaluate and return result
						var result = eval(terms.join(" "))
						if (isNaN(result)) {
							callback({icon: icon, error: true, message: "I couldn't perform that calculation.", html: "<h2>Error: invalid calculation:</h2>" + remainder})
						}
						else {
							window.CONTEXT_LIBRARY.lastResponseNumber = Number(result)
							callback({icon: icon, message: Number(result), html: terms.join(" ") + " = <b>" + result + "</b>"})
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"double": function(remainder, callback) {
				try {
					var icon = "&#x00b1;"

					var term = remainder.replace(/[?!,:;'"_\/\(\)\$\%]/gi,"")
						term = window.FUNCTION_LIBRARY.getDigits(term.toLowerCase().trim())
					if (term == "that") {
						term = Number(window.CONTEXT_LIBRARY.lastResponseNumber)
					}

					var result = 2 * Number(term)
					if (isNaN(result)) {
						callback({icon: icon, error: true, message: "I couldn't double that number.", html: "<h2>Error: invalid multiplier</h2>"})
					}
					else {
						window.CONTEXT_LIBRARY.lastResponseNumber = Number(result)
						callback({icon: icon, message: Number(result), html: "2 * " + term + " = <b>" + result + "</b>"})
					}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"triple": function(remainder, callback) {
				try {
					var icon = "&#x00b1;"

					var term = remainder.replace(/[?!,:;'"_\/\(\)\$\%]/gi,"")
						term = window.FUNCTION_LIBRARY.getDigits(term.toLowerCase().trim())
					if (term == "that") {
						term = Number(window.CONTEXT_LIBRARY.lastResponseNumber)
					}

					var result = 3 * Number(term)
					if (isNaN(result)) {
						callback({icon: icon, error: true, message: "I couldn't triple that number.", html: "<h2>Error: invalid multiplier</h2>"})
					}
					else {
						window.CONTEXT_LIBRARY.lastResponseNumber = Number(result)
						callback({icon: icon, message: Number(result), html: "3 * " + term + " = <b>" + result + "</b>"})
					}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"average": function(remainder, callback) {
				try {
					var icon = "&#x00b1;"

					// loop through and aggregate terms
						var terms = remainder.replace(/[?!,:;'"_\/\(\)\$\%]/gi,"").split(/\s/gi)
						var numbers = []
						for (var i = 0; i < terms.length; i++) {
							terms[i] = window.FUNCTION_LIBRARY.getDigits(terms[i].toLowerCase().trim())

							if (terms[i] == "that") {
								terms[i] = Number(window.CONTEXT_LIBRARY.lastResponseNumber)
							}

							if (!isNaN(terms[i])) {
								numbers.push(Number(terms[i]))
							}
						}

						var result = numbers.reduce(function(total, term) {
							return (total + term)
						}) / (numbers.length || 1)

					// return result
						if (isNaN(result)) {
							callback({icon: icon, error: true, message: "I couldn't find the average.", html: "<h2>Error: invalid calculation</h2>"})
						}
						else {
							window.CONTEXT_LIBRARY.lastResponseNumber = Number(result)
							callback({icon: icon, message: Number(result), html: numbers.join(" + ") + " / " + numbers.length + " = <b>" + result + "</b>"})
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"count": function(remainder, callback) {
				try {
					var icon = "&#x2673;"

					// numbers
						var startNumber = (" " + remainder.replace(/[?!,;'"_\(\)\$\%]/gi,"")).split(/ up from | down from | from | starting at | start at | between | for /gi)
							startNumber = (startNumber[1] || startNumber[0]).split(/ and go to | and go until | up to | down to | to | until | ending at | end at | and | through /gi)[0].toLowerCase().trim()
							startNumber = window.FUNCTION_LIBRARY.getDigits(startNumber)
						if (startNumber == "that") { startNumber = Number(window.CONTEXT_LIBRARY.lastResponseNumber) }
						if (!startNumber || isNaN(startNumber)) { startNumber = 1 }

						var endNumber = (" " + remainder.replace(/[?!,;'"_\(\)\$\%]/gi,"")).split(/ and go to | and go until | up to | down to | to | until | ending at | end at | and | through /gi)
							endNumber = (endNumber[1] || endNumber[0]).split(/ up from | down from | starting at | start at | between | for /gi)[0].toLowerCase().trim()
							endNumber = window.FUNCTION_LIBRARY.getDigits(endNumber)
						if (endNumber == "that") { endNumber = Number(window.CONTEXT_LIBRARY.lastResponseNumber) }
						if (!endNumber || isNaN(endNumber)) { endNumber = 100 }

					// up or down
						var list = []
						if (startNumber <= endNumber) {
							for (var i = startNumber; i <= endNumber; i++) {
								list.push(i)
							}
						}
						else {
							for (var i = startNumber; i >= endNumber; i--) {
								list.push(i)
							}
						}

					// message
						callback({icon: icon, message: list.join("... "), html: "Counting from <b>" + String(startNumber) + "</b> to <b>" + String(endNumber) + "</b>."})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// words
			"spell word": function(remainder, callback) {
				try {
					var icon = "&#x1f4dd;"

					var word = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").trim().toUpperCase()
					var letters = word.split("")
					callback({icon: icon, message: word + "... " + letters.join(", "), html: "<h2>" + letters.join(" - ") + "</h2>"})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},			
			"find rhymes": function(remainder, callback) {
				try {
					var icon = "&#x1f4da;"

					// options
						var options = {
							url: "https://api.datamuse.com/words?rel_rhy=" + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// construct response list
									var list = response || []
									var listItems = []
									for (var i in list) {
										list[i] = list[i].word
										listItems[i] = "<li>" + list[i] + "</li>"
									}

								// message, link, list
									var message = "I found " + list.length + " rhyme" + (list.length == 1 ? "" : "s") + " for " + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").trim() + "."
									var link = "<a target='_blank' href='https://rhymezone.com/r/rhyme.cgi?typeofrhyme=perfect&Word=" + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim() + "'>" + message + "</a>"
									callback({icon: icon, message: message + " " + list.join(","), html: link + "<ul>" + listItems.join("") + "</ul>"})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I couldn't rhyme that.", html: "<h2>Error: unable to access rhymes</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"find synonyms": function(remainder, callback) {
				try {
					var icon = "&#x1f4da;"

					// options
						var options = {
							url: "https://api.datamuse.com/words?rel_syn=" + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// construct response list
									var list = response || []
									var listItems = []
									for (var i in list) {
										list[i] = list[i].word
										listItems[i] = "<li>" + list[i] + "</li>"
									}

								// message, link, list
									var message = "I found " + list.length + " synonym" + (list.length == 1 ? "" : "s") + " for " + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").trim() + "."
									var link = "<a target='_blank' href='https://rhymezone.com/r/rhyme.cgi?typeofrhyme=syn&Word=" + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim() + "'>" + message + "</a>"
									callback({icon: icon, message: message + " " + list.join(","), html: link + "<ul>" + listItems.join("") + "</ul>"})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I don't know any synonyms for that.", html: "<h2>Error: unable to access synonyms</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"find definition": function(remainder, callback) {
				try {
					var icon = "&#x1f4da;"

					// options
						var options = {
							url: "https://api.datamuse.com/words?md=d&sp=" + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// construct response list
									var word = response[0]
									var list = []
									var listItems = []
									for (var i in word.defs) {
										word.defs[i] = "[" + word.defs[i].replace(/\t/,"] ")
										word.defs[i] = word.defs[i].replace("[n]", "[noun]").replace("[v]", "[verb]").replace("[adj]", "[adjective]").replace("[adv]", "[adverb]").replace("[u]", "[other]")
										list[i] = word.defs[i]
										listItems[i] = "<li>" + word.defs[i] + "</li>"
									}

								// message, link, list
									var message = "I found " + list.length + " definition" + (list.length == 1 ? "" : "s") + " for " + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").trim() + "."
									var link = "<a target='_blank' href='http://wordnetweb.princeton.edu/perl/webwn?s=" + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim() + "'>" + message + "</a>"
									callback({icon: icon, message: message + " " + list.join(","), html: link + "<ul>" + listItems.join("") + "</ul>"})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I couldn't define that.", html: "<h2>Error: unable to access definitions</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// content API fetches
			"get a joke": function(remainder, callback) {
				try {
					var icon = "&#x1f0cf;"

					// options
						var options = {
							url: "https://icanhazdadjoke.com/slack"
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// construct response link
									var jokeLink = "https://icanhazdadjoke.com"
									var jokeText = response.attachments[0].text
									callback({icon: icon, message: jokeText, html: "<a target='_blank' href='" + jokeLink + "'><h2>" + jokeText + "</h2></a>"})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I don't know any jokes.", html: "<h2>Error: unable to access jokes</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get a quote": function(remainder, callback) {
				try {
					var icon = "&#x1f399;"

					// options
						var options = {
							url: "http://api.forismatic.com/api/1.0/?method=getQuote&format=json&lang=en"
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// construct response link
									if (response.quoteText && response.quoteAuthor) {
										var quoteLink   = response.quoteLink
										var quoteText   = response.quoteText
										var quoteAuthor = response.quoteAuthor
										callback({icon: icon, message: quoteAuthor + " said... " + quoteText, html: "<a target='_blank' href='" + quoteLink + "'><h2>\"" + quoteText + "\" - " + quoteAuthor + "</h2></a>"})
									}
									else {
										callback({icon: icon, error: true, message: "I was unable to get any quotes.", html: "<h2>Error: unable to access quotes</h2>"})
									}
							}
							catch (error) {
								callback({icon: icon, message: "I don't know any quotes.", html: "unable to access quotes"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get a fortune": function(remainder, callback) {
				try {
					var icon = "&#x1f4dc;"

					// options
						var options = {
							url: "https://fortunecookieapi.herokuapp.com/v1/fortunes?limit=1000&skip=0&page=1"
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// fortunes
									var fortune = window.FUNCTION_LIBRARY.chooseRandom(response)

								// construct response link
									var fortuneLink = "https://fortunecookieapi.herokuapp.com/"
									var fortuneText = fortune.message
									callback({icon: icon, message: fortuneText, html: "<a target='_blank' href='" + fortuneLink + "'><h2>" + fortuneText + "</h2></a>"})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I don't know any fortunes.", html: "<h2>Error: unable to access fortunes</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get an insult": function(remainder, callback) {
				try {
					var icon = "&#128293;"

					// options
						var options = {
							url: "https://jokes.guyliangilsing.me/retrieveJokes.php?type=yomama"
						}

					// proxy request
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								callback({icon: icon, message: response.joke, html: "<h2>" + response.joke + "</h2>"})
							}
							catch (error) {
								callback({icon, icon, error: true, message: "I don't know any insults.", html: "<h2>Error: unable to access insults</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get a wikipedia entry": function(remainder, callback) {
				try {
					var icon = "&#x1f310;"

					// attempt counter
						if (!window.CONTEXT_LIBRARY["wikipedia attempt counter"]) {
							window.CONTEXT_LIBRARY["wikipedia attempt counter"] = 1
						}

					// options
						var options = {
							url: "https://en.wikipedia.org/w/api.php?action=query&format=json&list=search&utf8=1&srsearch=" + remainder.replace(/[?!.,:;'"\/\(\)\$\%]/gi,"").trim()
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							if (!response || !response.query || !response.query.search || !response.query.search[0]) {
								if (response.error && response.error.code == "cirrussearch-too-busy-error" && window.CONTEXT_LIBRARY["wikipedia attempt counter"] < 5) {
									callback({icon: icon, message: "Wikipedia was too busy. Trying again.", html: "attempt #" + window.CONTEXT_LIBRARY["wikipedia attempt counter"] + " <b>" + remainder + "</b> on Wikipedia<br><br>Wikipedia was too busy. Trying again."})

									window.CONTEXT_LIBRARY["wikipedia attempt counter"]++
									window.ACTION_LIBRARY["get a wikipedia entry"](remainder, callback)
								}
								else {
									callback({icon: icon, error: true, message: "I couldn't find " + remainder + " on Wikipedia.", html: "<h2>Error: unable to access Wikipedia</h2>"})
								}
							}
							else {
								// options
									var options = {
										url: "https://en.wikipedia.org/w/api.php?action=parse&format=json&utf8=1&page=" + response.query.search[0].title
									}

								// proxy to server
									window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
										try {
											if (response.error && response.error.code == "cirrussearch-too-busy-error" && window.CONTEXT_LIBRARY["wikipedia attempt counter"] < 5) {
												callback({icon: icon, message: "Wikipedia was too busy. Trying again.", html: "attempt #" + window.CONTEXT_LIBRARY["wikipedia attempt counter"] + " <b>" + remainder + "</b> on Wikipedia<br><br>Wikipedia was too busy. Trying again."})

												window.CONTEXT_LIBRARY["wikipedia attempt counter"]++
												window.ACTION_LIBRARY["get a wikipedia entry"](remainder, callback)
											}
											else {
												// get text
													var htmlContent = response.parse.text["*"]
														htmlContent = htmlContent.split('id="References">References')[0]
														htmlContent = htmlContent.split('id="See_also">See also')[0]
														htmlContent = htmlContent.replace(/\<a href='\//gi, "<a target='_blank' href='https://en.wikipedia.org/")
														htmlContent = htmlContent.replace(/\<a href="\//gi, '<a target="_blank" href="https://en.wikipedia.org/')

													var textNode = document.createElement("div")
														textNode.innerHTML = htmlContent.replace(/<table[\s\S]*?>[\s\S]*?<\/table>/gi,"")
													var text = textNode.innerText
														text = text.replace(/\[[0-9]+\]/gi, "")
														text = text.replace(/\[edit\]/gi,"")
													
												// message
													var link = "<a target='_blank' href='https://en.wikipedia.org/?curid=" + response.parse.pageid + "'>" + response.parse.title + "</a>"
													callback({icon: icon, message: text, html: "<h2>" + link + "</h2><br>" + htmlContent})

												// reset counter
													window.CONTEXT_LIBRARY["wikipedia attempt counter"] = 0
											}
										}
										catch (error) {
											callback({icon: icon, error: true, message: "I couldn't find " + remainder + " on Wikipedia.", html: "<h2>Error: unable to access Wikipedia</h2>"})
										}
									})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get this day in history": function(remainder, callback) {
				try {
					var today = ["January","February","March","April","May","June","July","August","September","October","November","December"][new Date().getMonth()] + "_" + new Date().getDate()
					window.ACTION_LIBRARY["get a wikipedia entry"](today, callback)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get the headlines": function(remainder, callback) {
				try {
					var icon = "&#x1f4f0;"

					// options
						var options = {
							url: "https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml"
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// construct response list
									var list = response.rss.channel.item
									var stories = []
									var storyItems = []
									for (var i = 0; i < list.length - 1; i++) {
										stories.push(list[i].title + " " + list[i].description)
										storyItems.push("<li><a target='_blank' href='" + list[i].link + "'><b>" + list[i].title + "</b></a><p>" + list[i].description + "</p></li>")
									}

								// message, link, list
									var message = "I found " + stories.length + " stor" + (list.length == 1 ? "y" : "ies") + " on the New York Times."
									callback({icon: icon, message: message + " " + stories.join("... "), html: message + "<ul>" + storyItems.join("") + "</ul>"})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I can't get the news.", html: "<h2>Error: unable to access the New York Times</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get the weather": function(remainder, callback) {
				try {
					var icon = "&#x26c8;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["open weather api"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for open weather api.", html: "<h2>Error: missing configuration:</h2><li>open weather api</li>"})
							return
						}

					// locale
						if (remainder) {
							var locale = (" " + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"")).toLowerCase().replace(/ in | at | for | inside /gi,"").trim() || window.CONFIGURATION_LIBRARY["city"] || window.CONFIGURATION_LIBRARY["zip code"] || null
						}
						else {
							var locale = window.CONFIGURATION_LIBRARY["city"] || window.CONFIGURATION_LIBRARY["zip code"] || null
						}

					// no locale
						if (!locale) {
							window.CONTEXT_LIBRARY.flow = "get the weather"
							window.CONTEXT_LIBRARY["get the weather"] = {
								locale: null
							}

							callback({icon: icon, message: "What city should I get the weather for?", html: "What <b>city</b> should I get the weather for?"})
						}

					// yes locale
						else {
							// options
								var options = {
									url: "https://api.openweathermap.org/data/2.5/forecast?appid=" + window.CONFIGURATION_LIBRARY["open weather api"] + (isNaN(locale) ? ("&q=" + locale) : "&zip=" + locale) + ",us&mode=json&units=imperial"
								}

							// proxy to server
								window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
									try {
										// invalid response
											if (!response || !response.city || !response.list) {
												callback({icon: icon, error: true, message: "I was unable to get the weather.", html: "<h2>Error: unable to access weather</h2>"})
											}

										// valid response
											else {
												// days of the week
													var allDays = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]

												// axes
													var dayColumns = []
													var timeRows = []
													for (var l in response.list) {
														var segment = response.list[l]
														var date = new Date(response.list[l].dt_txt + " UTC")
														
														segment.day = allDays[new Date(date).getDay()]
														if (dayColumns[dayColumns.length - 1] !== segment.day) {
															dayColumns.push(segment.day)
														}
														
														segment.time = date.toLocaleTimeString()
														if (!timeRows.includes(segment.time)) {
															timeRows.push(segment.time)
														}

														segment.cell = "<td>" + segment.main.temp + "°F<br><br>" + (segment.weather ? segment.weather[0].description : "clear") + "</td>"
													}

												// sort times
													timeRows.sort(function(a,b) {
														a = a.replace(/\:/g,"")
														b = b.replace(/\:/g,"")
														if (a.toLowerCase().includes("pm")) { a = Number(a.replace(/pm/gi,"")) % 120000 + 120000 } else { a = Number(a.replace(/am/gi, "")) % 120000 }
														if (b.toLowerCase().includes("pm")) { b = Number(b.replace(/pm/gi,"")) % 120000 + 120000 } else { b = Number(b.replace(/am/gi,"")) % 120000 }
														return a - b
													})

												// grid
													var grid = {}
													for (var t in timeRows) {
														grid[timeRows[t]] = {}
														grid[timeRows[t]].time = "<td>" + timeRows[t] + "</td>"
														for (var d in dayColumns) {
															grid[timeRows[t]][dayColumns[d]] = "<td> - </td>"
														}
													}

													for (var l in response.list) {
														var data = response.list[l]
														grid[data.time][data.day] = data.cell
													}

												// draw table
													var heading = "<tr><th>&#128339;</th>"
													for (var d in dayColumns) {
														heading += ("<th>" + dayColumns[d] + "</th>")
													}
													heading += "</tr>"

													var table = "<table><tbody>" + heading
													for (var y in grid) {
														var row = "<tr>"
														for (var x in grid[y]) {
															row += grid[y][x]
														}
														row += "</tr>"
														table += row
													}
													table += "</tbody></table>"

												// current weather
													var currentTemperature = "unknown"
													var currentWeather = "unknown"

												// send response
													var locale = response.city.name + ", " + response.city.country
													var conditions = "Right now it's " + response.list[0].main.temp + " degrees and " + (response.list[0].weather ? response.list[0].weather[0].description : "clear")
													var message = "Here's the weather for " + locale + "."
													var link = "<b><a target='_blank' href='https://openweathermap.org/find?q=" + locale + "'>" + message + "</a></b>"
													callback({icon: icon, message: message + " ... " + conditions, html: link + "<br>" + table})
											}
									}
									catch (error) {
										callback({icon: icon, error: true, message: "I was unable to get the weather for " + remainder, html: "<h2>Error: unable to access the weather for that location:</h2>" + remainder})
									}
								})
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get nutrition facts": function(remainder, callback) {
				try {
					var icon = "&#x1f34e;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["spoonacular api"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for spoonacular api.", html: "<h2>Error: missing configuration:</h2><li>spoonacular api</li>"})
							return
						}

					// options
						remainder = remainder.toLowerCase().replace(/[?!,;'"_\(\)\$\%]/gi,"").trim()
						var options = {
							url: "https://api.spoonacular.com/recipes/guessNutrition?apiKey=" + window.CONFIGURATION_LIBRARY["spoonacular api"] + "&title=" + remainder
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								if (!response.calories) {
									callback({icon: icon, error: true, message: "I was unable to get nutrition facts for " + remainder, html: "<h2>Error: unable to get nutrition facts:</h2>" + remainder})
								}
								else {
									var calories 	= response.calories.value 	+ " " + response.calories.unit
									var carbs 		= response.carbs.value 		+ " " + response.carbs.unit
									var fat 		= response.fat.value 		+ " " + response.fat.unit
									var protein 	= response.protein.value 	+ " " + response.protein.unit

									var message = "Here's what I found for " + remainder + "... " + calories + "; " + carbs + " of carbs; " + fat + " of fat; " + protein + " of protein"
									var responseHTML = "<h2>" + remainder + "</h2>" + "<li><b>calories:</b> " + calories + "</li>" + "<li><b>carbs:</b> " + carbs + "</li>" + "<li><b>fat:</b> " + fat + "</li>" + "<li><b>protein:</b> " + protein + "</li>"

									callback({icon: icon, message: message, html: responseHTML})
								}
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get nutrition facts for " + remainder, html: "<h2>Error: unable to get nutrition facts:" + remainder})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get nutrition answer": function(remainder, callback) {
				try {
					var icon = "&#x1f34e;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["spoonacular api"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for spoonacular api.", html: "<h2>Error: missing configuration:</h2><li>spoonacular api</li>"})
							return
						}

					// options
						remainder = remainder.toLowerCase().replace(/[?!,;'"_\(\)\$\%]/gi,"").trim()
						var options = {
							url: "https://api.spoonacular.com/recipes/quickAnswer?apiKey=" + window.CONFIGURATION_LIBRARY["spoonacular api"] + "&q=" + remainder
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								if (!response.answer) {
									callback({icon: icon, error: true, message: "I was unable to get a nutrition answer about " + remainder, html: "<h2>Error: unable to get a nutrition answer:</h2>" + remainder})
								}
								else {
									callback({icon: icon, message: response.answer, html: "<h2>" + remainder + "</h2>" + response.answer})
								}
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get a nutrition answer about " + remainder, html: "<h2>Error: unable to get a nutrition answer:</h2>" + remainder})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// Google Apps Script
			"edit wish list": function(remainder, callback) {
				try {
					var icon = "&#x1f4dd;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// split at keywords
						remainder = " " + remainder
						var cost = remainder.split(/ for | costing | that costs | which costs /gi)
							cost = (cost[1] || cost[0]).split(/ called | named | by the name | which is a | which is an | which is the /gi)[0].trim()

						var item = remainder.split(/ called | named | by the name /gi)
							item = (item[1] || item[0]).split(/ for | costing | that costs | which costs | which is a | which is an | which is the /gi)[0].trim()

						var type = remainder.split(/ which is a | which is an | which is the /gi)
							type = (type[1] || type[0]).split(/ for | costing | that costs | which costs | called | named | by the name /gi)[0].trim()

					// build options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=listWish&item=" + item + "&cost=" + cost + "&type=" + type
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							var responseHTML = "<ul><li><b>item: </b>" + response.item + "</li><li><b>cost: </b>" + response.cost + "</li><li><b>type: </b>" + response.type + "</li></ul>" 
							callback({icon: icon, message: response.message, html: responseHTML})
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get balance": function(remainder, callback) {
				try {
					var icon = "&#x1f4b5;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// build options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=getBalance&account=" + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							var responseHTML = "<ul><li><b>account: </b>" + response.account + "</li><li><b>amount: </b>" + response.amount + "</li></ul>" 
							callback({icon: icon, message: response.message, html: responseHTML})
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"log purchase": function(remainder, callback) {
				try {
					var icon = "&#x1f4b5;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// split at keywords
						remainder = " " + remainder
						var amount = remainder.split(/ for | costing | that cost | that costs | which cost | which costs /gi)
							amount = (amount[1] || amount[0]).split(/ called | named | by the name | item | which is a | which is an | which is the | which is type | which is category | which is | type | category /gi)[0].trim()
							amount = amount.replace("$","")

						var description = remainder.split(/ called | named | by the name | item /gi)
							description = (description[1] || description[0]).split(/ for | costing | that cost | that costs | which cost | which costs | which is a | which is an | which is the | which is type | which is category | which is | type | category /gi)[0].trim()

						var category = remainder.split(/ which is a | which is an | which is the | which is type | which is category | which is | type | category /gi)
							category = (category[1] || category[0]).split(/ for | costing | that cost | that costs | which cost | which costs | called | named | by the name | item /gi)[0].trim()

					// build options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=logPurchase&category=" + category + "&description=" + description + "&amount=" + amount
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							var responseHTML = "<ul><li><b>description: </b>" + response.description + "</li><li><b>amount: </b>" + response.amount + "</li><li><b>category: </b>" + response.category + "</li></ul>" 
							callback({icon: icon, message: response.message, html: responseHTML})
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"fetch calendar": function(remainder, callback) {
				try {
					var icon = "&#x1f4c5;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// split at keywords
						remainder = " " + remainder
						var startDate = remainder.replace(/[?!,;'"_\(\)\$\%]/gi,"").split(/ from | starting at | start date | start time | between | for /gi)
							startDate = (startDate[1] || startDate[0]).split(/ to | until | ending at | end date | end time | and | through /gi)[0].toLowerCase().trim()
							if (startDate == "today")     { startDate = new Date().toLocaleDateString() }
							if (startDate == "yesterday") { startDate = new Date(new Date().getTime() - (1000 * 60 * 60 * 24)).toLocaleDateString() }
							if (startDate == "tomorrow")  { startDate = new Date(new Date().getTime() + (1000 * 60 * 60 * 24)).toLocaleDateString() }

						var endDate = remainder.replace(/[?!,;'"_\(\)\$\%]/gi,"").split(/ to | until | ending at | end date | end time | and | through /gi)
							endDate = (endDate[1] || endDate[0]).split(/ from | starting at | start date | start time | between | for /gi)[0].toLowerCase().trim()
							if (endDate == "today")     { endDate = new Date().toLocaleDateString() }
							if (endDate == "yesterday") { endDate = new Date(new Date().getTime() - (1000 * 60 * 60 * 24)).toLocaleDateString() }
							if (endDate == "tomorrow")  { endDate = new Date(new Date().getTime() + (1000 * 60 * 60 * 24)).toLocaleDateString() }

					// build options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=fetchEvents" + (startDate ? "&startDate=" + startDate : "") + (endDate ? "&endDate=" + endDate : "")
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							// create list
								var eventList = []
								var eventItems = []
								if (response.events) {
									for (var i = 0; i < response.events.length; i++) {
										var event = response.events[i]
										var startTime = new Date(event.startTime).toLocaleString()
										var endTime = new Date(event.endTime).toLocaleString()

										eventList.push(event.title + " from " + startTime + " until " + endTime + " at " + (event.location || "unknown location"))
										eventItems.push("<li><b>" + event.title + "</b><p>" + startTime + " - " + endTime + "<br><a target='_blank' href='https://www.google.com/maps/?q=" + event.location + "'>" + event.location + "</a><br>" + event.description + "</p></li>")
									}
								}

							// send response
								var responseLink = "https://calendar.google.com"
								var responseText = response.message
								callback({icon: icon, message: response.message + " " + eventList.join(" ... "),html: "<a target='_blank' href='" + responseLink + "'>" + responseText + "</a><ul>" + eventItems.join("") + "</ul>"})
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get a list": function(remainder, callback) {
				try {
					var icon = "&#x1f4dd;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// build options
						var list = remainder.replace(/[?!,;'"_\(\)\$\%]/gi,"").toLowerCase().trim() || null
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=getList" + (list ? ("&list=" + list) : "")
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							// not successful?
								if (!response.success) {
									callback({icon: icon, error: true, message: "I was unable to get " + (list ? list : " your list"), html: "<h2>Error: unable to get list:</h2>" + remainder})
									return
								}

							// create structured list
								var structuredItems = {}
								if (response.list) {
									var i = 0
									while (response.list.length) {
										if (i == response.list.length) {
											i = 0
										}

										var item = response.list[i]
										if (!item.parent) {
											structuredItems[item.id] = item
											response.list.splice(i, 1)
											i--
										}
										else if (structuredItems[item.parent]) {
											if (!structuredItems[item.parent].children) {
												structuredItems[item.parent].children = {}
											}
											structuredItems[item.parent].children[item.id] = item
											response.list.splice(i, 1)
											i--
										}
										else if (!response.list.find(function(x) { return x.id == item.parent })) {
											structuredItems[item.id] = item
											response.list.splice(i, 1)
											i--
										}
										i++
									}
								}

							// create 2-level html list
								var structuredItemKeys = Object.keys(structuredItems)
								structuredItemKeys = structuredItemKeys.sort(function(a, b) {
									return Number(structuredItems[a].position) - Number(structuredItems[b].position)
								})

								var message = ""
								var responseHTML = "<ul>"
								for (var i in structuredItemKeys) {
									var item = structuredItems[structuredItemKeys[i]]

									responseHTML += "<li><b>" + item.title + "</b>"
									message += item.title + " ... "

									if (item.due) {
										responseHTML += "<br>" + new Date(new Date(item.due).getTime() + (1000 * 60 * 60 * 5)).toLocaleDateString()
										message += new Date(new Date(item.due).getTime() + (1000 * 60 * 60 * 5)).toLocaleDateString() + " ... "
									}
									if (item.notes) {
										responseHTML += "<br>" + item.notes
										message += item.notes + " ... "
									}

									if (item.children) {
										responseHTML += "<ul>"
										for (var j in item.children) {
											responseHTML += "<li><b>" + item.children[j].title + "</b>"
											message += item.children[j].title + " ... "

											if (item.children[j].due) {
												responseHTML += "<br>" + new Date(new Date(item.children[j].due).getTime() + (1000 * 60 * 60 * 5)).toLocaleDateString()
												message += new Date(new Date(item.children[j].due).getTime() + (1000 * 60 * 60 * 5)).toLocaleDateString() + " ... "
											}
											if (item.children[j].notes) {
												responseHTML += "<br>" + item.children[j].notes
												message += item.children[j].notes + " ... "
											}
											responseHTML += "</li>"
										}
										responseHTML += "</ul>"
									}

									responseHTML += "</li>"
								}
								responseHTML += "<ul>"

							// send response
								callback({icon: icon, message: response.listName + " ... " + message, html: "<h2>" + response.listName + "</h2>" + responseHTML})
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"add an item to a list": function(remainder, callback) {
				try {
					var icon = "&#x1f4dd;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// split at keywords
						remainder = " " + remainder
						var components = remainder.replace(/[?!,;'"_\(\)\$\%]/gi,"").split(/ list | list\: /gi)
						var list = components[0].toLowerCase().trim() || ""
						var task = components[1] ? components[1] : components[0]

					// no task?
						if (!task) {
							callback({icon: icon, error: true, message: "I couldn't identify that item.", html: "<h2>Error: missing or invalid item:</h2>" + remainder})
							return
						}

					// build options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=addTask" + (list ? "&list=" + list : "") + "&task=" + task
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							// not successful?
								if (!response.success) {
									callback({icon: icon, error: true, message: "I was unable to add " + task + " to " + (list ? list : " your list"), html: "<h2>Error: unable to add item to list:</h2>" + remainder})
									return
								}

							// create structured list
								var structuredItems = {}
								if (response.list) {
									var i = 0
									while (response.list.length) {
										if (i == response.list.length) {
											i = 0
										}

										var item = response.list[i]
										if (!item.parent) {
											structuredItems[item.id] = item
											response.list.splice(i, 1)
											i--
										}
										else if (structuredItems[item.parent]) {
											if (!structuredItems[item.parent].children) {
												structuredItems[item.parent].children = {}
											}
											structuredItems[item.parent].children[item.id] = item
											response.list.splice(i, 1)
											i--
										}
										else if (!response.list.find(function(x) { return x.id == item.parent })) {
											structuredItems[item.id] = item
											response.list.splice(i, 1)
											i--
										}
										i++
									}
								}

							// create 2-level html list
								var structuredItemKeys = Object.keys(structuredItems)
								structuredItemKeys = structuredItemKeys.sort(function(a, b) {
									return Number(structuredItems[a].position) - Number(structuredItems[b].position)
								})

								var responseHTML = "<ul>"
								for (var i in structuredItemKeys) {
									var item = structuredItems[structuredItemKeys[i]]

									responseHTML += "<li><b>" + item.title + "</b>"
									if (item.due) {
										responseHTML += "<br>" + new Date(new Date(item.due).getTime() + (1000 * 60 * 60 * 5)).toLocaleDateString()
									}
									if (item.notes) {
										responseHTML += "<br>" + item.notes
									}

									if (item.children) {
										responseHTML += "<ul>"
										for (var j in item.children) {
											responseHTML += "<li><b>" + item.children[j].title + "</b>"
											if (item.children[j].due) {
												responseHTML += "<br>" + new Date(new Date(item.children[j].due).getTime() + (1000 * 60 * 60 * 5)).toLocaleDateString()
											}
											if (item.children[j].notes) {
												responseHTML += "<br>" + item.children[j].notes
											}
											responseHTML += "</li>"
										}
										responseHTML += "</ul>"
									}

									responseHTML += "</li>"
								}
								responseHTML += "<ul>"

							// send response
								callback({icon: icon, message: "I added " + task + " to " + response.listName, html: "<h2>" + response.listName + "</h2>" + responseHTML})
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get contacts": function(remainder, callback) {
				try {
					var icon = "&#x1f464;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// no remainder?
						remainder = remainder.replace(/[?!,;'"_\(\)\$\%]/gi,"").trim()
						if (!remainder) {
							callback({icon: icon, error: true, message: "I need a name to search for.", html: "<h2>Error: missing or invalid name:</h2>" + remainder})
							return	
						}

					// build options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=getContacts&name=" + remainder
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							// not successful?
								if (!response.success) {
									callback({icon: icon, error: true, message: "I was unable to find " + remainder, html: "<h2>Error: unable to find contact:</h2>" + remainder})
									return
								}

							// possibilities
								var message = ""
								var responseHTML = "<ul>"
								for (var i in response.list) {
									var contact = response.list[i]
									var name = (contact.firstName ? contact.firstName + " " : "") + (contact.middleName ? contact.middleName + " " : "") + (contact.lastName ? contact.lastName : "")
									message += name + " ... "

									responseHTML += "<li><b>" + name + "</b>"
									
									if (contact.emails && Array.isArray(contact.emails) && contact.emails.length) {
										responseHTML += "<ul>"
										for (var j in contact.emails) {
											responseHTML += "<li><a target='_blank' href='mailto:" + contact.emails[j].value + "'>" + (contact.emails[j].label ? contact.emails[j].label.toLowerCase().replace(/\_/g, " ") + ": " : "") + contact.emails[j].value + "</a></li>"
										}
										responseHTML += "</ul>"
									}

									if (contact.phoneNumbers && Array.isArray(contact.phoneNumbers) && contact.phoneNumbers.length) {
										responseHTML += "<ul>"
										for (var j in contact.phoneNumbers) {
											responseHTML += "<li><a target='_blank' href='tel:" + contact.phoneNumbers[j].value + "'>" + (contact.phoneNumbers[j].label ? contact.phoneNumbers[j].label.toLowerCase().replace(/\_/g, " ") + ": " : "") + contact.phoneNumbers[j].value + "</a></li>"
										}
										responseHTML += "</ul>"
									}

									if (contact.addresses && Array.isArray(contact.addresses) && contact.addresses.length) {
										responseHTML += "<ul>"
										for (var j in contact.addresses) {
											responseHTML += "<li><a target='_blank' href='https://maps.google.com?q=" + contact.addresses[j].value + "'>" + (contact.addresses[j].label ? contact.addresses[j].label.toLowerCase().replace(/\_/g, " ") + ": " : "") + contact.addresses[j].value + "</a></li>"
										}
										responseHTML += "</ul>"
									}

									if (contact.dates && Array.isArray(contact.dates) && contact.dates.length) {
										responseHTML += "<ul>"
										for (var j in contact.dates) {
											responseHTML += "<li>" + (contact.dates[j].label ? contact.dates[j].label.toLowerCase().replace(/\_/g, " ") + ": " : "") + contact.dates[j].value + "</li>"
										}
										responseHTML += "</ul>"
									}

									if (contact.urls && Array.isArray(contact.urls) && contact.urls.length) {
										responseHTML += "<ul>"
										for (var j in contact.urls) {
											responseHTML += "<li><a target='_blank' href='" + contact.urls[j].value + "'>" + (contact.urls[j].label ? contact.urls[j].label.toLowerCase().replace(/\_/g, " ") + ": " : "") + contact.urls[j].value + "</a></li>"
										}
										responseHTML += "</ul>"
									}
									
									responseHTML += "</li>"
								}
								responseHTML += "</ul>"

							// send response
								callback({icon: icon, message: "I found " + response.list.length + (response.list.length == 1 ? "person" : "people") + ": " + message, html: "<h2>" + remainder + "</h2>" + responseHTML})
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get birthday": function(remainder, callback) {
				try {
					var icon = "&#x1f464;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// no remainder?
						remainder = remainder.replace(/[?!,;'"_\(\)\$\%]/gi,"").trim()
						if (!remainder) {
							callback({icon: icon, error: true, message: "I need a name to search for.", html: "<h2>Error: missing or invalid name:</h2>" + remainder})
							return	
						}

					// build options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=getContacts&name=" + remainder
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							// not successful?
								if (!response.success) {
									callback({icon: icon, error: true, message: "I was unable to find " + remainder, html: "<h2>Error: unable to find contact:</h2>" + remainder})
									return
								}

							// extract birthdays
								var people = []
								for (var i in response.list) {
									var contact = response.list[i]
									people[i] = {
										name: (contact.firstName ? contact.firstName + " " : "") + (contact.middleName ? contact.middleName + " " : "") + (contact.lastName ? contact.lastName : ""),
										birthday: "unknown"
									}
									if (contact.dates && Array.isArray(contact.dates) && contact.dates.length) {
										for (var j in contact.dates) {
											if (contact.dates[j].label.toLowerCase() == "birthday") {
												people[i].birthday = contact.dates[j].value
											}
										}
									}
								}

							// message
								var message = ""
								var responseHTML = "<ul>"
								for (var i in people) {
									message += people[i].name + "'s birthday is " + people[i].birthday + " ... "
									responseHTML += "<li><b>" + people[i].name + "</b><br>birthday: " + people[i].birthday + "</li>"
								}
								responseHTML += "</ul>"

							// send response
								callback({icon: icon, message: "I found " + people.length + (people.length == 1 ? "person" : "people") + ": " + message, html: "<h2>" + remainder + " birthdays</h2>" + responseHTML})
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get phone number": function(remainder, callback) {
				try {
					var icon = "&#x1f464;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// no remainder?
						remainder = remainder.replace(/[?!,;'"_\(\)\$\%]/gi,"").trim()
						if (!remainder) {
							callback({icon: icon, error: true, message: "I need a name to search for.", html: "<h2>Error: missing or invalid name:</h2>" + remainder})
							return	
						}

					// build options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=getContacts&name=" + remainder
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							// not successful?
								if (!response.success) {
									callback({icon: icon, error: true, message: "I was unable to find " + remainder, html: "<h2>Error: unable to find contact:</h2>" + remainder})
									return
								}

							// extract birthdays
								var people = []
								for (var i in response.list) {
									var contact = response.list[i]
									people[i] = {
										name: (contact.firstName ? contact.firstName + " " : "") + (contact.middleName ? contact.middleName + " " : "") + (contact.lastName ? contact.lastName : ""),
										phoneNumbers: []
									}
									if (contact.phoneNumbers && Array.isArray(contact.phoneNumbers) && contact.phoneNumbers.length) {
										for (var j in contact.phoneNumbers) {
											people[i].phoneNumbers[j] = {
												value: contact.phoneNumbers[j].value,
												label: contact.phoneNumbers[j].label ? contact.phoneNumbers[j].label.toLowerCase().replace(/\_/g, " ") : null
											}
										}
									}
								}

							// message
								var message = ""
								var responseHTML = "<ul>"
								for (var i in people) {
									responseHTML += "<li><b>" + people[i].name + "</b><br>"
									if (people[i].phoneNumbers.length) {
										responseHTML += "<ul>"
										for (var j in people[i].phoneNumbers) {
											message += people[i].name + "'s " + (people[i].phoneNumbers[j].label ? people[i].phoneNumbers[j].label : "phone number") + " is " + people[i].phoneNumbers[j].value + " ... "
											responseHTML += "<li><a target='_blank' href='tel:" + people[i].phoneNumbers[j].value + "'>" + (people[i].phoneNumbers[j].label ? (people[i].phoneNumbers[j].label + ": ") : "") + people[i].phoneNumbers[j].value + "</a></li>"
										}
										responseHTML += "</ul>"
									}
									responseHTML += "</li>"
								}
								responseHTML += "</ul>"

							// send response
								callback({icon: icon, message: "I found " + people.length + (people.length == 1 ? "person" : "people") + ": " + message, html: "<h2>" + remainder + " phone numbers</h2>" + responseHTML})
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get email": function(remainder, callback) {
				try {
					var icon = "&#x1f464;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// no remainder?
						remainder = remainder.replace(/[?!,;'"_\(\)\$\%]/gi,"").trim()
						if (!remainder) {
							callback({icon: icon, error: true, message: "I need a name to search for.", html: "<h2>Error: missing or invalid name:</h2>" + remainder})
							return	
						}

					// build options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=getContacts&name=" + remainder
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							// not successful?
								if (!response.success) {
									callback({icon: icon, error: true, message: "I was unable to find " + remainder, html: "<h2>Error: unable to find contact:</h2>" + remainder})
									return
								}

							// extract birthdays
								var people = []
								for (var i in response.list) {
									var contact = response.list[i]
									people[i] = {
										name: (contact.firstName ? contact.firstName + " " : "") + (contact.middleName ? contact.middleName + " " : "") + (contact.lastName ? contact.lastName : ""),
										emails: []
									}
									if (contact.emails && Array.isArray(contact.emails) && contact.emails.length) {
										for (var j in contact.emails) {
											people[i].emails[j] = {
												value: contact.emails[j].value,
												label: contact.emails[j].label ? contact.emails[j].label.toLowerCase().replace(/\_/g, " ") : null
											}
										}
									}
								}

							// message
								var message = ""
								var responseHTML = "<ul>"
								for (var i in people) {
									responseHTML += "<li><b>" + people[i].name + "</b><br>"
									if (people[i].emails.length) {
										responseHTML += "<ul>"
										for (var j in people[i].emails) {
											message += people[i].name + "'s " + (people[i].emails[j].label ? people[i].emails[j].label : "email") + " is " + people[i].emails[j].value + " ... "
											responseHTML += "<li><a target='_blank' href='mailto:" + people[i].emails[j].value + "'>" + (people[i].emails[j].label ? (people[i].emails[j].label + ": ") : "") + people[i].emails[j].value + "</a></li>"
										}
										responseHTML += "</ul>"
									}
									responseHTML += "</li>"
								}
								responseHTML += "</ul>"

							// send response
								callback({icon: icon, message: "I found " + people.length + (people.length == 1 ? "person" : "people") + ": " + message, html: "<h2>" + remainder + " emails</h2>" + responseHTML})
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get address": function(remainder, callback) {
				try {
					var icon = "&#x1f464;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// no remainder?
						remainder = remainder.replace(/[?!,;'"_\(\)\$\%]/gi,"").trim()
						if (!remainder) {
							callback({icon: icon, error: true, message: "I need a name to search for.", html: "<h2>Error: missing or invalid name:</h2>" + remainder})
							return	
						}

					// build options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=getContacts&name=" + remainder
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							// not successful?
								if (!response.success) {
									callback({icon: icon, error: true, message: "I was unable to find " + remainder, html: "<h2>Error: unable to find contact:</h2>" + remainder})
									return
								}

							// extract birthdays
								var people = []
								for (var i in response.list) {
									var contact = response.list[i]
									people[i] = {
										name: (contact.firstName ? contact.firstName + " " : "") + (contact.middleName ? contact.middleName + " " : "") + (contact.lastName ? contact.lastName : ""),
										addresses: []
									}
									if (contact.addresses && Array.isArray(contact.addresses) && contact.addresses.length) {
										for (var j in contact.addresses) {
											people[i].addresses[j] = {
												value: contact.addresses[j].value,
												label: contact.addresses[j].label ? contact.addresses[j].label.toLowerCase().replace(/\_/g, " ") : null
											}
										}
									}
								}

							// message
								var message = ""
								var responseHTML = "<ul>"
								for (var i in people) {
									responseHTML += "<li><b>" + people[i].name + "</b><br>"
									if (people[i].addresses.length) {
										responseHTML += "<ul>"
										for (var j in people[i].addresses) {
											message += people[i].name + "'s " + (people[i].addresses[j].label ? people[i].addresses[j].label : "address") + " is " + people[i].addresses[j].value + " ... "
											responseHTML += "<li><a target='_blank' href='https://maps.google.com/?q=" + people[i].addresses[j].value + "'>" + (people[i].addresses[j].label ? (people[i].addresses[j].label + ": ") : "") + people[i].addresses[j].value + "</a></li>"
										}
										responseHTML += "</ul>"
									}
									responseHTML += "</li>"
								}
								responseHTML += "</ul>"

							// send response
								callback({icon: icon, message: "I found " + people.length + (people.length == 1 ? "person" : "people") + ": " + message, html: "<h2>" + remainder + " addresses</h2>" + responseHTML})
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"log gratitude": function(remainder, callback) {
				try {
					var icon = "&#x1f33b;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script 2"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script 2.", html: "<h2>Error: missing configuration:</h2><li>google apps script 2</li>"})
							return
						}

					// build options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script 2"] + "&text=" + remainder.trim()
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							callback({icon: icon, message: response.message, html: response.message})
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// Google APIs
			"search google": function(remainder, callback) {
				try {
					var icon = "&#x1f50d;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google custom search"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google custom search.", html: "<h2>Error: missing configuration:</h2><li>google custom search</li>"})
							return
						}
						else if (!window.CONFIGURATION_LIBRARY["google api key"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google api key.", html: "<h2>Error: missing configuration:</h2></li>google api key</li>"})
							return
						}

					// options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google custom search"] + "&key=" + window.CONFIGURATION_LIBRARY["google api key"] + "&q=" + remainder
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							// no results?
								if (!response.items || !response.items.length) {
									var responseLink = "https://www.google.com?q=" + remainder
									var responseText = "No results found."
									var topResultText = ""
									var topResult = ""
								}

							// 1+ results
								else {
									var responseLink = "https://www.google.com?q=" + remainder
									var responseText = "Top result:"
									var topResultText = response.items[0].title + " " + response.items[0].snippet
									var topResult = "<p><a target='_blank' href='" + response.items[0].link + "'><b>" + response.items[0].title + "</b></a><br>" + response.items[0].snippet + "</p>"
								}

							// send response								
								callback({icon: icon, message: responseText + " " + topResultText, html: "<a target='_blank' href='" + responseLink + "'>" + responseText + "</a>" + topResult})
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"search google directions": function(remainder, callback) {
				try {
					var icon = "&#x1f5fa;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google api key"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google api key.", html: "<h2>Error: missing configuration:</h2><li>google api key</li>"})
							return
						}

					// split at keywords
						remainder = " " + remainder
						var origin = remainder.replace(/[?!,;'"_\(\)\$\%]/gi,"").split(/ leaving from | from | starting at | start at | etween | originating at | origin /gi)
							origin = (origin[1] || origin[0]).split(/ going to | go to | ending at | end at | to | and | arriving at | destination | for /gi)[0].toLowerCase().trim()

						var destination = remainder.replace(/[?!,;'"_\(\)\$\%]/gi,"").split(/ going to | go to | ending at | end at | to | and | arriving at | destination | for /gi)
							destination = (destination[1] || destination[0]).split(/ leaving from | from | starting at | start at | between | originating at | origin /gi)[0].toLowerCase().trim()

					// options
						var options = {
							url: "https://maps.googleapis.com/maps/api/directions/json?key=" + window.CONFIGURATION_LIBRARY["google api key"] + "&origin=" + origin + "&destination=" + destination
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							// no results?
								if (!response || !response.routes || !response.routes[0] || !response.routes[0].legs || !response.routes[0].legs[0]) {
									callback({icon: icon, error: true, message: "I couldn't find a route.", html: "<h2>Error: unable to find a route:</h2><li>from: " + origin + "</li><li>to: " + destination + "</li>"})
								}

							// format response
								else {
									var distance = response.routes[0].legs[0].distance.text
									var duration = response.routes[0].legs[0].duration.text
									var steps = response.routes[0].legs[0].steps.map(function(step) {
										return "<li><b>" + step.distance.text + " (" + step.duration.text + ")" + "</b><br>" + step.html_instructions + "</li>"
									}) || []

									var message = origin + " to " + destination + " is " + distance + " for " + duration + "."
									var link = "<a target='_blank' href='https://www.google.com/maps/dir/" + origin + "/" + destination + "'>" + message + "</a>"
									callback({icon: icon, message: message, html: link + "<ol>" + steps.join("") + "</ol>"})
								}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"search google places": function(remainder, callback) {
				try {
					var icon = "&#x1f5fa;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google api key"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google api key.", html: "<h2>Error: missing configuration:</h2><li>google api key</li>"})
							return
						}

					// options
						var options = {
							url: "https://maps.googleapis.com/maps/api/place/findplacefromtext/json?key=" + window.CONFIGURATION_LIBRARY["google api key"] + "&inputtype=textquery&fields=place_id&input=" + remainder
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							// no results?
								if (!response || !response.candidates || !response.candidates[0] || !response.candidates[0].place_id) {
									callback({icon: icon, error: true, message: "I couldn't find that place.", html: "<h2>Error: unable to find place:</h2>" + remainder})
								}

							// second trip, with place_id
								else {
									var place_id = response.candidates[0].place_id
									var options = {
										url: "https://maps.googleapis.com/maps/api/place/details/json?key=" + window.CONFIGURATION_LIBRARY["google api key"] + "&inputtype=textquery&fields=name,photo,url,website,formatted_phone_number,formatted_address,geometry,opening_hours&place_id=" + place_id
									}

									window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
										// no results?
											if (!response || !response.result) {
												callback({icon: icon, error: true, message: "I couldn't find that place.", html: "<h2>Error: unable to find place:</h2>" + remainder})
											}

										// format response
											else {
												var place = response.result
												if (place.opening_hours) {
													var openNow = "It's currently " + (place.opening_hours.open_now ? " open." : "closed.")
													var openHours = "<br><ul><li>" + place.opening_hours.weekday_text.join("</li><li>") + "</li></ul>"
												}
												else {
													var openNow = ""
													var openHours = ""
												}

												var message = "I found " + place.name + " at " + (place.formatted_address || "an unknown address") + ". " + openNow
												var infoBlock = "<b>" + place.name + "</b><ul><li><a target='_blank' href='" + place.url + "'>" + (place.formatted_address || "<i>no address found</i>") + "</a></li><li>" + (place.formatted_phone_number || "<i>no phone number found</i>") + "</li><li>" + (place.website ? ("<a target='_blank' href='" + place.website + "'>" + place.website + "</a>") : "<i>no website found</i>") + "<li>hours: " + (openHours || "<i>no hours found</i>") + "</li>" + "</ul>"
												callback({icon: icon, message: message, html: infoBlock})
											}
									})
								}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"search youtube": function(remainder, callback) {
				try {
					var icon = "&#x1f4fa;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google api key"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google api key.", html: "<h2>Error: missing configuration:</h2><li>google api key</li>"})
							return
						}

					// options
						var options = {
							url: "https://www.googleapis.com/youtube/v3/search?key=" + window.CONFIGURATION_LIBRARY["google api key"] + "&part=snippet&type=video&videoEmbeddable=true&maxResults=5&order=viewCount&q=" + remainder
						}

					// proxy request
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							if (!response || !response.items || !response.items.length || !response.items[0].id || !response.items[0].id.videoId) {
								callback({icon: icon, error: true, message: "I couldn't find " + remainder + " on Youtube.", html: "<h2>Error: unable to find Youtube video:</h2>" + remainder})
							}
							else {
								// turn off whistle-on
									window.FUNCTION_LIBRARY.changeWhistleOn({forceOff: true})

								// response
									var responseHTML = '<iframe width="560" height="315" src="https://www.youtube.com/embed/' + response.items[0].id.videoId + '?autoplay=1" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'
									callback({icon: icon, message: "Now playing " + remainder, html: responseHTML, followup: false})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// games
			"play more or less": function(remainder, callback) {
				try {
					var icon = "&#x265e;"

					// pick a number
						if (window.CONTEXT_LIBRARY.flow !== "play more or less") {
							window.CONTEXT_LIBRARY.flow = "play more or less"
							window.CONTEXT_LIBRARY["play more or less"] = {
								number: Math.floor(Math.random() * 100) + 1,
								guesses: 0
							}

							callback({icon: icon, message: "Okay, I'm thinking of a number between 1 and 100.", html: "<b>I'm thinking of a number between 1 and 100.</b><br>Make a guess. I'll tell you if my number is more or less."})
						}

					// interpret guess
						else {
							var guess = Number(window.FUNCTION_LIBRARY.getDigits(remainder))
							if (isNaN(guess)) {
								callback({icon: icon, error: true, message: "I don't know that number.", html: "<h2>Error: invalid number:</h2>" + remainder})
							}
							else {
								// increase guess count
									window.CONTEXT_LIBRARY["play more or less"].guesses++

								// correct
									if (guess == window.CONTEXT_LIBRARY["play more or less"].number) {
										var message = "You took " + window.CONTEXT_LIBRARY["play more or less"].guesses + " guess" + (window.CONTEXT_LIBRARY["play more or less"].guesses == 1 ? "" : "es") + " to find my number: " + window.CONTEXT_LIBRARY["play more or less"].number + "."
										var messageBlock = "You took <b>" + window.CONTEXT_LIBRARY["play more or less"].guesses + "</b> guess" + (window.CONTEXT_LIBRARY["play more or less"].guesses == 1 ? "" : "es") + " to find my number: <b>" + window.CONTEXT_LIBRARY["play more or less"].number + "</b>."
										callback({icon: icon, message: message, html: messageBlock})

										window.CONTEXT_LIBRARY.flow = null
										delete window.CONTEXT_LIBRARY["play more or less"]
									}

								// more
									else if (window.CONTEXT_LIBRARY["play more or less"].number > guess) {
										var message = "More than " + guess + "."
										callback({icon: icon, message: message, html: "&uarr; " + message + " &uarr;"})
									}

								// less
									else if (window.CONTEXT_LIBRARY["play more or less"].number < guess) {
										var message = "Less than " + guess + "."
										callback({icon: icon, message: message, html: "&darr; " + message + " &darr;"})
									}
							}
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"play true or false": function(remainder, callback) {
				try {
					var icon = "&#x265e;"

					// pick a number
						if (window.CONTEXT_LIBRARY.flow !== "play true or false") {
							// options
								var options = {
									url: "https://opentdb.com/api.php?amount=10&type=boolean"
								}

							// proxy to server
								window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
									try {
										// enter flow
											window.CONTEXT_LIBRARY.flow = "play true or false"
											window.CONTEXT_LIBRARY["play true or false"] = {
												score: 0,
												index: 0,
												questions: response.results
											}

										// first question
											var question = window.CONTEXT_LIBRARY["play true or false"].questions[window.CONTEXT_LIBRARY["play true or false"].index].question
												question = question.replace(/(&#039;)/gi,"\'")
											var questionNumber = window.CONTEXT_LIBRARY["play true or false"].index + 1
											callback({icon: icon, message: "True or False: " + question, html: "<b>True or False #" + questionNumber + "</b><br>" + question})
									}
									catch (error) {
										window.CONTEXT_LIBRARY.flow = null
										callback({icon: icon, error: true, message: "I don't know any fun facts.", html: "<h2>Error: unable to access trivia</h2>"})
									}
								})
						}

					// interpret guess
						else {
							// validate
								var guess = remainder.toLowerCase().replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").trim()
								if (guess.includes("true")) {
									guess = "True"
								}
								else if (guess.includes("false")) {
									guess = "False"
								}
								else {
									callback({icon: icon, error: true, message: "I only understand True and False.", html: "<h2>Error: invalid guess:</h2>" + remainder})
									return
								}

							// correct
								var correctAnswer = window.CONTEXT_LIBRARY["play true or false"].questions[window.CONTEXT_LIBRARY["play true or false"].index].correct_answer
								if (guess == correctAnswer) {
									window.CONTEXT_LIBRARY["play true or false"].score++
									var message = guess.toUpperCase() + " is correct!"
								}

							// incorrect
								else {
									var message = "Sorry, this is actually " + correctAnswer.toUpperCase() + "."
								}

							// advance
								if (window.CONTEXT_LIBRARY["play true or false"].index + 1 < window.CONTEXT_LIBRARY["play true or false"].questions.length) {
									window.CONTEXT_LIBRARY["play true or false"].index++

									var nextQuestion = window.CONTEXT_LIBRARY["play true or false"].questions[window.CONTEXT_LIBRARY["play true or false"].index].question
									var nextQuestionNumber = window.CONTEXT_LIBRARY["play true or false"].index + 1

									callback({icon: icon, message: message + " ... " + "Question " + nextQuestionNumber + ": True or False: " + nextQuestion, html: message + "<br><br><b>True or False #" + nextQuestionNumber + "</b><br>" + nextQuestion})
								}

							// done
								else {
									var finalScore = window.CONTEXT_LIBRARY["play true or false"].score || 0

									window.CONTEXT_LIBRARY.flow = null
									delete window.CONTEXT_LIBRARY["play true or false"]

									callback({icon: icon, message: message + " ... " + "You got " + finalScore + " questions correct.", html: message + "<br><br><b>Final score: " + finalScore + "</b>"})
								}
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
	
		// SONOS

		// Wink
			"get wink devices": function(remainder, callback) {
				try {
					var icon = "&#x1f4a1;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["api.wink.com"] || !window.CONFIGURATION_LIBRARY["api.wink.com"].access_token || !window.CONFIGURATION_LIBRARY["api.wink.com"].expiration || window.CONFIGURATION_LIBRARY["api.wink.com"].expiration < new Date().getTime()) {
							window.ACTION_LIBRARY["authorize platform"]("wink", function(response) {
								callback(response)
								
								if (window.CONFIGURATION_LIBRARY["api.wink.com"] && window.CONFIGURATION_LIBRARY["api.wink.com"].access_token && window.CONFIGURATION_LIBRARY["api.wink.com"].expiration && window.CONFIGURATION_LIBRARY["api.wink.com"].expiration >= new Date().getTime()) {
									window.ACTION_LIBRARY["get wink devices"](remainder, callback)
								}
							})
							return
						}

					// build options
						var options = {
							url: "https://api.wink.com/users/me/wink_devices?client_id=" + window.CONFIGURATION_LIBRARY["wink key"] + "&client_secret=" + window.CONFIGURATION_LIBRARY["wink secret"],
							Authorization: "Bearer " + window.CONFIGURATION_LIBRARY["api.wink.com"].access_token
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							// devices
								var devices = {}
								for (var i in response.data) {
									var device = {
										uuid: response.data[i].uuid,
										name: response.data[i].name,
										model_name: response.data[i].model_name,
										current_state: null,
										type: null
									}
									devices[device.uuid] = device

									if (response.data[i].light_bulb_id) {
										device.type = "light_bulb"
										device.current_state = response.data[i].last_reading.connection ? (response.data[i].last_reading.powered ? "on" : "off") : "disconnected"
									}
									else if (response.data[i].smoke_detector_id) {
										device.type = "smoke_detector"
										device.current_state = response.data[i].last_reading.connection ? (response.data[i].last_reading.co_detected ? "CO!" : "no CO") + " & " + (response.data[i].last_reading.smoke_detected ? "smoke!" : "no smoke") : "disconnected"
									}
									else if (response.data[i].air_conditioner_id) {
										device.type = "air_conditioner"
										device.current_state = response.data[i].last_reading.connection ? ((response.data[i].last_reading.temperature * 9 / 5) + 32 + "°F") : "disconnected"
									}
									else if (response.data[i].thermostat_id) {
										device.type = "thermostat"
										device.current_state = response.data[i].last_reading.connection ? ((response.data[i].last_reading.temperature * 9 / 5) + 32 + "°F") : "disconnected"
									}
									else if (response.data[i].outlets) {
										device.type = "powerstrip"
										device.current_state = response.data[i].last_reading.connection ? "connected" : "disconnected"

										for (var j in response.data[i].outlets) {
											var subdevice = {
												uuid: response.data[i].outlets[j].uuid,
												name: response.data[i].outlets[j].name,
												model_name: device.model_name + " (outlet)",
												type: "outlet",
												current_state: response.data[i].last_reading.connection ? (response.data[i].outlets[j].last_reading.powered ? "on" : "off") : "disconnected"
											}
											devices[subdevice.uuid] = subdevice
										}
									}
									else {
										device.type = "hub"
										device.current_state = response.data[i].last_reading.connection ? "connected" : "disconnected"
									}
								}
								
								var value = window.CONFIGURATION_LIBRARY["api.wink.com"]
									value.devices = devices
								window.FUNCTION_LIBRARY.changeConfiguration({key: "api.wink.com", value: value})

							// response
								var lightsOn = 0
								var temperature = 0
								var smoke = 0

								var responseHTML = "Here are your Wink devices: <ul>"
								for (var i in devices) {
									responseHTML += "<li><b>" + devices[i].name + "</b> - [" + (devices[i].current_state || "") + "]<br>" + devices[i].model_name + "</li>"
									if (devices[i].type == "light_bulb" && devices[i].current_state == "on") {
										lightsOn++
									}
									else if (devices[i].type == "thermostat" && devices[i].current_state !== "disconnected") {
										temperature = devices[i].current_state.replace("°F", "")
									}
									else if (devices[i].type == "smoke_detector" && devices[i].current_state !== "disconnected") {
										if (devices[i].current_state.includes("smoke!") || devices[i].current_state.includes("CO!")) {
											smoke = 1
										}
									}
								}
								responseHTML += "</ul>"

								var message = (smoke ? "The smoke detector has detected a threat. " : "") +
									"I detected " + Object.keys(devices).length + " devices on Wink. " +
									"The temperature is " + temperature + " degrees. " +
									"There are " + lightsOn + " lights on."

								callback({icon: icon, message: message, html: responseHTML})
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"set wink devices": function(remainder, callback) {
				try {
					var icon = "&#x1f4a1;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["api.wink.com"] || !window.CONFIGURATION_LIBRARY["api.wink.com"].access_token || !window.CONFIGURATION_LIBRARY["api.wink.com"].expiration || window.CONFIGURATION_LIBRARY["api.wink.com"].expiration < new Date().getTime()) {
							window.ACTION_LIBRARY["authorize platform"]("wink", function(response) {
								callback(response)
								
								if (window.CONFIGURATION_LIBRARY["api.wink.com"] && window.CONFIGURATION_LIBRARY["api.wink.com"].access_token && window.CONFIGURATION_LIBRARY["api.wink.com"].expiration && window.CONFIGURATION_LIBRARY["api.wink.com"].expiration >= new Date().getTime()) {
									window.ACTION_LIBRARY["set wink devices"](remainder, callback)
								}
							})
							return
						}
						else if (!window.CONFIGURATION_LIBRARY["api.wink.com"].devices || !Object.keys(window.CONFIGURATION_LIBRARY["api.wink.com"].devices).length) {
							window.ACTION_LIBRARY["get wink devices"](null, function(response) {
								callback(response)
								
								if (window.CONFIGURATION_LIBRARY["api.wink.com"].devices && Object.keys(window.CONFIGURATION_LIBRARY["api.wink.com"].devices).length) {
									window.ACTION_LIBRARY["set wink devices"](remainder, callback)
								}
							})
							return
						}

					// split remainder
						var components = remainder.split(/\sto\s|\sbecome\s|\sinto\s|\sat\s/gi)
						var deviceName = components[0].toLowerCase().trim().replace(/the /gi,"")
						var desiredState = window.FUNCTION_LIBRARY.getDigits(components[1].toLowerCase().trim())

					// replace number words with numbers
						deviceName = deviceName.split(/\s/gi)
						for (var word in deviceName) {
							deviceName[word] = window.FUNCTION_LIBRARY.getDigits(deviceName[word])
						}
						deviceName = deviceName.join(" ")

					// groups
						var group = null
						if (["all lights"].includes(deviceName)) {
							group = "lights"
						}
						else if (["temperature", "thermostat", "heat", "air conditioner", "air conditioning", "fan"].includes(deviceName)) {
							group = "temperature"
						}

					// identify devices
						var deviceIds = []
						if (group == "lights") {
							deviceIds = Object.keys(window.CONFIGURATION_LIBRARY["api.wink.com"].devices).filter(function(d) {
								return window.CONFIGURATION_LIBRARY["api.wink.com"].devices[d].type == "light_bulb"
							}) || []
						}
						else if (group == "temperature") {
							deviceIds = Object.keys(window.CONFIGURATION_LIBRARY["api.wink.com"].devices).filter(function(d) {
								return ["air_conditioner", "thermostat"].includes(window.CONFIGURATION_LIBRARY["api.wink.com"].devices[d].type)
							}) || []
						}
						else {
							deviceNames = deviceName.split(" and ")
							for (var i in deviceNames) {
								var deviceId = Object.keys(window.CONFIGURATION_LIBRARY["api.wink.com"].devices).find(function(d) {
									return window.CONFIGURATION_LIBRARY["api.wink.com"].devices[d].name.toLowerCase() == deviceNames[i]
								}) || null
								if (deviceId) {
									deviceIds.push(deviceId)
								}
							}
						}

						if (!deviceIds.length) {
							callback({icon: icon, error: true, message: "I couldn't identify that device.", html: "<h2>Error: unable to identify device:</h2>" + deviceName})
							return
						}

					// identify state
						if (desiredState == "on" || desiredState == "active" || desiredState == "powered") {
							desiredState = {powered: true}
						}
						else if (desiredState == "off" || desiredState == "inactive" || desiredState == "unpowered") {
							desiredState = {powered: false}
						}
						else if (!isNaN(desiredState) && group == "temperature") {
							var farenheit = Number(desiredState) + " degrees"
							var celsius = (desiredState - 32) * 5 / 9
							desiredState = {max_set_point: celsius, min_set_point: celsius}
						}
						else {
							callback({icon: icon, error: true, message: "I couldn't understand that desired state.", html: "<h2>Error: unable to set state:</h2>" + desiredState})
							return
						}

					// output response
						var responseHTML = "Wink devices updated: <ul>"
						for (var i in deviceIds) {
							responseHTML += "<li>" + window.CONFIGURATION_LIBRARY["api.wink.com"].devices[deviceIds[i]].name + ": " + JSON.stringify(desiredState) + "</li>"
						}
						responseHTML += "</ul>"
						var messageState = (desiredState.powered === true) ? "on" : (desiredState.powered === false) ? "off" : (desiredState.max_set_point || desiredState.min_set_point) ? farenheit : "unknown"
						callback({icon: icon, message: "Okay, I set " + deviceName + " to " + messageState, html: responseHTML})

					// loop through ids
						for (var i in deviceIds) {
							// build options
								var options = {
									method: "put",
									url: "https://api.wink.com/" + window.CONFIGURATION_LIBRARY["api.wink.com"].devices[deviceIds[i]].type + "s/" + deviceIds[i] + "/desired_state?client_id=" + window.CONFIGURATION_LIBRARY["wink key"] + "&client_secret=" + window.CONFIGURATION_LIBRARY["wink secret"],
									Authorization: "Bearer " + window.CONFIGURATION_LIBRARY["api.wink.com"].access_token,
									body: {
										"desired_state": desiredState
									}
								}

							// proxy
								window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
									if (response.errors && response.errors.length) {
										callback({icon: icon, error: true, message: "I was unable to update a device.", html: "<h2>Error: Wink responded with these errors:</h2><li>" + response.errors.join("</li><li>") + "</li>"})
									}
								})
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"turn off wink device": function(remainder, callback) {
				try {
					window.ACTION_LIBRARY["set wink devices"](remainder + " to off", callback)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"turn on wink device": function(remainder, callback) {
				try {
					window.ACTION_LIBRARY["set wink devices"](remainder + " to on", callback)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// Reddit
			"ask reddit": function(remainder, callback) {
				try {
					var icon = "&#x1f4bb;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["www.reddit.com"] || !window.CONFIGURATION_LIBRARY["www.reddit.com"].access_token || !window.CONFIGURATION_LIBRARY["www.reddit.com"].expiration || window.CONFIGURATION_LIBRARY["www.reddit.com"].expiration < new Date().getTime()) {
							window.ACTION_LIBRARY["authorize platform"]("reddit", function(response) {
								callback(response)
								
								if (window.CONFIGURATION_LIBRARY["www.reddit.com"] && window.CONFIGURATION_LIBRARY["www.reddit.com"].access_token && window.CONFIGURATION_LIBRARY["www.reddit.com"].expiration && window.CONFIGURATION_LIBRARY["www.reddit.com"].expiration >= new Date().getTime()) {
									window.ACTION_LIBRARY["ask reddit"](remainder, callback)
								}
							})
							return
						}

					// options
						var options = {
							"User-Agent": "web:bluejay:v1 (by /u/quargy)",
							Authorization: "Bearer " + window.CONFIGURATION_LIBRARY["www.reddit.com"].access_token,
							url: "https://oauth.reddit.com/r/askreddit/"
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// select random question
									var question = window.FUNCTION_LIBRARY.chooseRandom(response.data.children)

								// construct response link
									var redditLink = question.data.url
									var redditText = question.data.title
									callback({icon: icon, message: redditText, html: "<a target='_blank' href='" + redditLink + "'><h2>" + redditText + "<h2></a>"})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I don't have any questions.", html: "<h2>Error: unable to access reddit</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get a reddit writing prompt": function(remainder, callback) {
				try {
					var icon = "&#x1f4bb;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["www.reddit.com"] || !window.CONFIGURATION_LIBRARY["www.reddit.com"].access_token || !window.CONFIGURATION_LIBRARY["www.reddit.com"].expiration || window.CONFIGURATION_LIBRARY["www.reddit.com"].expiration < new Date().getTime()) {
							window.ACTION_LIBRARY["authorize platform"]("reddit", function(response) {
								callback(response)
								
								if (window.CONFIGURATION_LIBRARY["www.reddit.com"] && window.CONFIGURATION_LIBRARY["www.reddit.com"].access_token && window.CONFIGURATION_LIBRARY["www.reddit.com"].expiration && window.CONFIGURATION_LIBRARY["www.reddit.com"].expiration >= new Date().getTime()) {
									window.ACTION_LIBRARY["get a reddit writing prompt"](remainder, callback)
								}
							})
							return
						}

					// options
						var options = {
							"User-Agent": "web:bluejay:v1 (by /u/quargy)",
							Authorization: "Bearer " + window.CONFIGURATION_LIBRARY["www.reddit.com"].access_token,
							url: "https://oauth.reddit.com/r/writingprompts/"
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// select random question
									var question = window.FUNCTION_LIBRARY.chooseRandom(response.data.children)

								// construct response link
									var redditLink = question.data.url
									var redditText = question.data.title
									callback({icon: icon, message: redditText, html: "<a target='_blank' href='" + redditLink + "'><h2>" + redditText + "</h2></a>"})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I don't have any writing prompts.", html: "<h2>Error: unable to access reddit</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// custom APIs
			"convert": function(remainder, callback) {
				try {
					var icon = "&#9878;"

					// parameters
						remainder = " " + remainder

						var toUnit = remainder.split(/ into | to /gi)
							toUnit = (toUnit[1] || toUnit[0]).split(/ from /gi)[0].trim()

						var fromUnit = remainder.split(/ from /gi)
							fromUnit = (fromUnit[1] || fromUnit[0]).split(/ into | to /gi)[0].trim()
						
						var words = fromUnit.split(/\s/gi)
							for (var i in words) {
								words[i] = window.FUNCTION_LIBRARY.getDigits(words[i].trim())
							}
							words = words.join(" ")
							fromUnit = words.replace(/[0-9]/gi,"").trim()
						
						var quantity = Number(words.replace(/[^0-9]/gi,"")) || 1

					// options
						var options = {
							url: "https://us-central1-projects-3bd0e.cloudfunctions.net/unitconverter?quantity=" + quantity + "&from=" + fromUnit + "&to=" + toUnit
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							if (!response.success) {
								callback({icon: icon, error: true, message: "I was unable to convert from " + fromUnit + "to" + toUnit, html: "<h2>Error: unable to convert:</h2>" + response.message + "<br></br>" + quantity + " " + fromUnit + " = <b>???</b> " + toUnit})
							}
							else {
								var outputQuantity = Number(response.output).toLocaleString("fullwide", {useGrouping: true, maximumSignificantDigits: 21})
								var outputFromUnit = (response.parameters.from.prefix !== "_" ? response.parameters.from.prefix : "") + response.parameters.from.unit
								var outputToUnit   = (response.parameters.to.prefix   !== "_" ? response.parameters.to.prefix   : "") + response.parameters.to.unit
								callback({icon: icon, message: outputQuantity + " " + outputToUnit, html: response.parameters.quantity + " " + outputFromUnit + " = <b>" + outputQuantity + "</b> " + outputToUnit})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"find factors": function(remainder, callback) {
				try {
					var icon = "&#x2a37;"

					// parameters
						var input = window.FUNCTION_LIBRARY.getDigits(remainder.toLowerCase().replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").trim())

					// options
						var options = {
							url: "https://us-central1-projects-3bd0e.cloudfunctions.net/factorfinder?number=" + input
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							if (!response.success) {
								callback({icon: icon, error: true, message: "I was unable to find the factors of " + remainder, html: "<h2>Error: unable to find factors:</h2>" + response.message})
							}
							else {
								var message = response.qualities.map(function(q) {
									return q.replace("<li>","").replace("</li>","").replace(/\<\/?br\>/gi," ")
								}) || []
									message[0] = message[0].replace(/x/gi, "times")
									message = message.join("... ")
								callback({icon: icon, message: "Here's what I found for " + input + ": " + message, html: "<h2>" + input + "</h2>" + response.html})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"analyze chord": function(remainder, callback) {
				try {
					var icon = "&#x1f3b5;"

					// parameters
						var input = remainder.replace(/[?!.:;'"_\-\/\(\)\$\%]/gi,"").trim().replace(/and/gi,"")
							input = input.split(/,\s|,|\s/gi)
						for (var i in input) {
							input[i] = input[i].slice(0,1).toUpperCase() + input[i].slice(1,input[i].length)
						}
							input = input.join(",")

					// options
						var options = {
							url: "https://us-central1-projects-3bd0e.cloudfunctions.net/chordanalyzer?notes=" + encodeURIComponent(input)
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							if (!response.success) {
								callback({icon: icon, error: true, message: "I was unable to do a chordal analysis of " + remainder, html: "<h2>Error: unable to analyze chord:</h2>" + response.message})
							}
							else {
								callback({icon: icon, message: response.smallOutput.replace(/\#/gi," sharp").replace(/b/g, " flat"), html: response.chord.join(" - ") + "<h2>" + response.bigOutput + "</h2>" + response.smallOutput})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"shuffle word": function(remainder, callback) {
				try {
					var icon = "&#x1f500;"

					// parameters
						var input = remainder.toLowerCase().replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").trim()

					// options
						var options = {
							url: "https://us-central1-projects-3bd0e.cloudfunctions.net/wordshuffler?word=" + input
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							if (!response.success) {
								callback({icon: icon, error: true, message: "I was unable to shuffle the word " + remainder, html: "<h2>Error: unable to shuffle word:</h2>" + response.message})
							}
							else {
								var wordList = []
								for (var i in response.results) {
									for (var j in response.results[i]) {
										wordList.push(response.results[i][j])
									}
								}
								callback({icon: icon, message: "I found " + wordList.length + " words within " + input + ": " + wordList.join(", "), html: "<h2>" + input + "</h2>" + response.html})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
	}
