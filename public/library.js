/* phrase library */
	window.PHRASE_LIBRARY = {
		// casual responses
			"thank you": 						"receive gratitude",
			"thanks": 							"receive gratitude",
			"i appreciate": 					"receive gratitude",
			"well thank you": 					"receive gratitude",
			"well thanks": 						"receive gratitude",
			"good job": 						"receive gratitude",
			"excellent": 						"receive gratitude",
			"excellent work": 					"receive gratitude",
			"job well done": 					"receive gratitude",
			"well done": 						"receive gratitude",

			"im sorry": 						"receive apology",
			"sorry": 							"receive apology",
			"i am sorry": 						"receive apology",
			"i apologize": 						"receive apology",
			"my apologies": 					"receive apology",
			"apologies": 						"receive apology",
			"can you forgive": 					"receive apology",
			"do you forgive": 					"receive apology",
			"would you forgive": 				"receive apology",

			"who is a good": 					"receive affirmation",
			"whos a good": 						"receive affirmation",
			"whose a good": 					"receive affirmation",
			"who is my good": 					"receive affirmation",
			"whos my good": 					"receive affirmation",
			"whose my good": 					"receive affirmation",
			"youre an excellent": 				"receive affirmation",
			"you are an excellent": 			"receive affirmation",
			"youre a good": 					"receive affirmation",
			"you are a good": 					"receive affirmation",
			"youre great": 						"receive affirmation",
			"you are great": 					"receive affirmation",
			"youre wonderful": 					"receive affirmation",
			"you are wonderful": 				"receive affirmation",
			"youre awesome": 					"receive affirmation",
			"you are awesome": 					"receive affirmation",
			"youre wonderful": 					"receive affirmation",
			"you are wonderful": 				"receive affirmation",
			"youre amazing": 					"receive affirmation",
			"you are amazing": 					"receive affirmation",

			"happy": 							"receive greeting",
			"good": 							"receive greeting",
			"merry": 							"receive greeting",
			"i hope you have a happy": 			"receive greeting",
			"i hope you have a good": 			"receive greeting",
			"i hope you have a great": 			"receive greeting",
			"i hope you have a merry": 			"receive greeting",
			"i hope youre enjoying": 			"receive greeting",
			"i hope youre enjoying your": 		"receive greeting",
			"i hope youre enjoying this": 		"receive greeting",
			"i hope you are enjoying": 			"receive greeting",
			"i hope you are enjoying your": 	"receive greeting",
			"i hope you are enjoying this": 	"receive greeting",
			"have a happy": 					"receive greeting",
			"have a good": 						"receive greeting",
			"have a great": 					"receive greeting",
			"have a merry": 					"receive greeting",

		// meta
			"help": 							"list actions",
			"get help": 						"list actions",
			"what are your functions": 			"list actions",
			"what can you do": 					"list actions",
			"i need help": 						"list actions",
			"what are your functions": 			"list actions",
			"what can you do": 					"list actions",
			"i need some help": 				"list actions",
			"what can i say": 					"list actions",
			"list functions": 					"list actions",
			"list actions": 					"list actions",
			"list commands": 					"list actions",

			"repeat after me": 					"repeat this",
			"repeat this": 						"repeat this",
			"say what i say": 					"repeat this",
			"say exactly what i say": 			"repeat this",
			"say this back": 					"repeat this",
			"jot this down": 					"repeat this",
			"copy this down": 					"repeat this",
			"write this down": 					"repeat this",

			"repeat that": 						"repeat that",
			"repeat what you said": 			"repeat that",
			"say what you said": 				"repeat that",
			"say what you said again": 			"repeat that",
			"say that again": 					"repeat that",
			"run that by me again": 			"repeat that",
			"can you repeat that": 				"repeat that",
			"i didnt catch that": 				"repeat that",
			"come again": 						"repeat that",

			"do that again": 					"do that again",
			"one more time": 					"do that again",
			"do that action again": 			"do that again",
			"try that again": 					"do that again",
			"try that action again": 			"do that again",
			"do that one more time": 			"do that again",
			"can you do that again": 			"do that again",

			"get next result": 					"get next result",
			"get the next result": 				"get next result",
			"get next results": 				"get next result",
			"get the next results": 			"get next result",
			"get the next one": 				"get next result",
			"display next result": 				"get next result",
			"display the next result": 			"get next result",
			"display next results": 			"get next result",
			"display the next results": 		"get next result",
			"display the next one": 			"get next result",
			"show next result": 				"get next result",
			"show the next result": 			"get next result",
			"show next results": 				"get next result",
			"show the next results": 			"get next result",
			"show the next one": 				"get next result",
			"play next result": 				"get next result",
			"play the next result": 			"get next result",
			"play next results": 				"get next result",
			"play the next results": 			"get next result",
			"play the next one": 				"get next result",
			"read next result": 				"get next result",
			"read the next result": 			"get next result",
			"read next results": 				"get next result",
			"read the next results": 			"get next result",
			"read the next one": 				"get next result",
			"tell me next result": 				"get next result",
			"tell me another": 					"get next result",
			"tell me the next result": 			"get next result",
			"tell me next results": 			"get next result",
			"tell me the next results": 		"get next result",
			"next result": 						"get next result",
			"next results": 					"get next result",
			"give me another": 					"get next result",
			"give me the next result": 			"get next result",
			"give me the next one": 			"get next result",
			"give me the next results": 		"get next result",
			"get me another": 					"get next result",
			"get me the next result": 			"get next result",
			"get me the next one": 				"get next result",
			"get me the next results": 			"get next result",
			"next": 							"get next result",
			"another": 							"get next result",

			"stop last video": 					"stop last video",
			"stop the last video": 				"stop last video",
			"stop that video": 					"stop last video",
			"stop the video": 					"stop last video",
			"pause last video": 				"stop last video",
			"pause the last video": 			"stop last video",
			"pause that video": 				"stop last video",
			"pause the video": 					"stop last video",

			"restart last video": 				"restart last video",
			"restart the last video": 			"restart last video",
			"restart that video": 				"restart last video",
			"restart the video": 				"restart last video",
			"play last video": 					"restart last video",
			"play the last video": 				"restart last video",
			"play that video": 					"restart last video",
			"play the video": 					"restart last video",

		// settings
			"stop listening": 					"stop listening",
			"stop listening to me": 			"stop listening",
			"quit listening": 					"stop listening",
			"quit listening to me": 			"stop listening",
			"cease listening": 					"stop listening",
			"cease listening to me": 			"stop listening",

			"change voice": 					"change voice",
			"change voice to": 					"change voice",
			"change the voice to": 				"change voice",
			"set voice to": 					"change voice",
			"set the voice to": 				"change voice",
			"set new voice": 					"change voice",
			"switch voice to": 					"change voice",
			"switch the voice to": 				"change voice",

			"change volume": 					"change volume",
			"change volume to": 				"change volume",
			"change the volume to": 			"change volume",
			"set volume to": 					"change volume",
			"set the volume to": 				"change volume",
			"set new volume": 					"change volume",
			"set new volume at": 				"change volume",

			"change listening duration": 		"change listening duration",
			"change listening duration to": 	"change listening duration",
			"change the listening duration to": "change listening duration",
			"set listening duration to": 		"change listening duration",
			"set the listening duration to": 	"change listening duration",
			"set new listening duration": 		"change listening duration",
			"set new listening duration at": 	"change listening duration",
			"change recognition duration": 		"change listening duration",
			"change recognition duration to": 	"change listening duration",
			"change the recognition duration to": "change listening duration",
			"set recognition duration to": 		"change listening duration",
			"set the recognition duration to": 	"change listening duration",
			"set new recognition duration": 	"change listening duration",
			"set new recognition duration at": 	"change listening duration",

			"change configuration": 			"change configuration",
			"change configuration for": 		"change configuration",
			"edit configuration": 				"change configuration",
			"edit configuration for": 			"change configuration",
			"set configuration": 				"change configuration",
			"set a configuration": 				"change configuration",
			"set this configuration": 			"change configuration",
			"set configuration for": 			"change configuration",
			"set a configuration for": 			"change configuration",
			"set the configuration for": 		"change configuration",
			"set my configuration for": 		"change configuration",
			"set new configuration": 			"change configuration",
			"set new configuration for": 		"change configuration",
			"set a new configuration": 			"change configuration",
			"set a new configuration for": 		"change configuration",
			"change a configuration": 			"change configuration",
			"change my configuration": 			"change configuration",
			"change my configuration for": 		"change configuration",
			"add to my profile": 				"change configuration",
			"add this to my profile": 			"change configuration",
			"edit my profile": 					"change configuration",
			"save my": 							"change configuration",
			"set my saved": 					"change configuration",
			"change my saved": 					"change configuration",
			"update my saved": 					"change configuration",
			"configure my": 					"change configuration",
			"configure": 						"change configuration",

			"authorize": 						"authorize platform",
			"create authorization": 			"authorize platform",
			"get authorization link": 			"authorize platform",
			"activate": 						"authorize platform",
			"create activation": 				"authorize platform",
			"get activation link": 				"authorize platform",
			"authorize a platform": 			"authorize platform",
			"authorize platform": 				"authorize platform",

		// time
			"get the time": 					"get the time",
			"what time is it": 					"get the time",
			"what is the time": 				"get the time",
			"whats the time": 					"get the time",
			"tell me the time": 				"get the time",

			"get the day": 						"get the day",
			"what day is it": 					"get the day",
			"what day is today": 				"get the day",
			"whats the day": 					"get the day",
			"whats today": 						"get the day",
			"tell me the day": 					"get the day",

			"get the month": 					"get the month",
			"what month is it": 				"get the month",
			"what is the month": 				"get the month",
			"whats the month": 					"get the month",
			"tell me the month": 				"get the month",

			"get the date": 					"get the date",
			"what date is it": 					"get the date",
			"whats todays date": 				"get the date",
			"what is the date": 				"get the date",
			"what is todays date": 				"get the date",
			"whats the date": 					"get the date",
			"tell me the date": 				"get the date",

		// alarms
			"set a timer": 						"set alarm",
			"set timer": 						"set alarm",
			"set an alarm": 					"set alarm",
			"set alarm": 						"set alarm",
			"wake me up": 						"set alarm",
			"alert me": 						"set alarm",

			"cancel alarm": 					"cancel alarm",
			"turn off alarm": 					"cancel alarm",
			"deactivate alarm": 				"cancel alarm",
			"unset alarm": 						"cancel alarm",
			"stop alarm": 						"cancel alarm",
			"cancel my alarm": 					"cancel alarm",
			"turn off my alarm": 				"cancel alarm",
			"deactivate my alarm": 				"cancel alarm",
			"unset my alarm": 					"cancel alarm",
			"stop my alarm": 					"cancel alarm",
			"cancel timer": 					"cancel alarm",
			"turn off timer": 					"cancel alarm",
			"deactivate timer": 				"cancel alarm",
			"unset timer": 						"cancel alarm",
			"stop timer": 						"cancel alarm",
			"cancel my timer": 					"cancel alarm",
			"turn off my timer": 				"cancel alarm",
			"deactivate my timer": 				"cancel alarm",
			"unset my timer": 					"cancel alarm",
			"stop my timer": 					"cancel alarm",

			"cancel all alarms": 				"cancel all alarms",
			"turn off all alarms": 				"cancel all alarms",
			"deactivate all alarms": 			"cancel all alarms",
			"unset all alarms": 				"cancel all alarms",
			"stop all alarms": 					"cancel all alarms",
			"cancel all my alarms": 			"cancel all alarms",
			"turn off all my alarms": 			"cancel all alarms",
			"deactivate all my alarms": 		"cancel all alarms",
			"unset all my alarms": 				"cancel all alarms",
			"stop all my alarms": 				"cancel all alarms",
			"cancel all of my alarms": 			"cancel all alarms",
			"turn off all of my alarms": 		"cancel all alarms",
			"deactivate all of my alarms": 		"cancel all alarms",
			"unset all of my alarms": 			"cancel all alarms",
			"stop all of my alarms": 			"cancel all alarms",
			"cancel all timers": 				"cancel all alarms",
			"turn off all timers": 				"cancel all alarms",
			"deactivate all timers": 			"cancel all alarms",
			"unset all timers": 				"cancel all alarms",
			"stop all timers": 					"cancel all alarms",
			"cancel all my timers": 			"cancel all alarms",
			"turn off all my timers": 			"cancel all alarms",
			"deactivate all my timers": 		"cancel all alarms",
			"unset all my timers": 				"cancel all alarms",
			"stop all my timers": 				"cancel all alarms",
			"cancel all of my timers": 			"cancel all alarms",
			"turn off all of my timers": 		"cancel all alarms",
			"deactivate all of my timers": 		"cancel all alarms",
			"unset all of my timers": 			"cancel all alarms",
			"stop all of my timers": 			"cancel all alarms",

		// rng
			"roll": 							"roll dice",
			"roll me": 							"roll dice",
			"roll me some": 					"roll dice",
			"roll some": 						"roll dice",

			"flip a coin": 						"flip a coin",
			"heads or tails": 					"flip a coin",

			"consult the magic 8 ball": 		"consult the magic 8 ball",
			"consult a magic 8 ball": 			"consult the magic 8 ball",
			"shake the magic 8 ball": 			"consult the magic 8 ball",
			"ask the magic 8 ball": 			"consult the magic 8 ball",
			"magic 8 ball": 					"consult the magic 8 ball",
			"consult the magic 8-ball": 		"consult the magic 8 ball",
			"consult a magic 8-ball": 			"consult the magic 8 ball",
			"shake the magic 8-ball": 			"consult the magic 8 ball",
			"ask the magic 8-ball": 			"consult the magic 8 ball",
			"magic 8-ball": 					"consult the magic 8 ball",
			"magic conch": 						"consult the magic 8 ball",
			"read my future": 					"consult the magic 8 ball",

		// math
			"calculate": 						"calculate",
			"lets do some math": 				"calculate",
			"do some math for me": 				"calculate",
			"add": 								"calculate",
			"subtract": 						"calculate",
			"multiply": 						"calculate",
			"divide": 							"calculate",
			
			"double": 							"double",
			"triple": 							"triple",

			"average": 							"average",
			"find the average of": 				"average",
			"what is the average of": 			"average",
			"whats the average of": 			"average",

			"start counting": 					"count",
			"count": 							"count",
			"can you count": 					"count",
			"lets count": 						"count",
			"give me a count": 					"count",

		// words
			"spell word": 						"spell word",
			"spell": 							"spell word",
			"spell a word": 					"spell word",
			"spell the word": 					"spell word",
			"how do you spell": 				"spell word",
			"how do you spell the word": 		"spell word",
			"can you spell": 					"spell word",
			"can you spell the word": 			"spell word",
			"what is the spelling of": 			"spell word",
			"whats the spelling of": 			"spell word",
			"tell me how to spell": 			"spell word",
			"tell me how to spell the word": 	"spell word",
			"tell me the spelling of": 			"spell word",
			"tell me the spelling for": 		"spell word",
			"tell me the spelling of the word": "spell word",
			"tell me the spelling for the word": "spell word",

			"find rhymes": 						"find rhymes",
			"what rhymes with": 				"find rhymes",
			"find a rhyme for": 				"find rhymes",
			"find rhymes for": 					"find rhymes",
			"get a rhyme for": 					"find rhymes",
			"get rhymes for": 					"find rhymes",
			"rhymes with": 						"find rhymes",
			"something that rhymes with": 		"find rhymes",

			"find synonyms": 					"find synonyms",
			"what is a synonym for": 			"find synonyms",
			"find a synonym for": 				"find synonyms",
			"find synonyms for": 				"find synonyms",
			"get a synonym for": 				"find synonyms",
			"get synonyms for": 				"find synonyms",
			"synonym of": 						"find synonyms",
			"what has the same meaning as": 	"find synonyms",

			"find definition": 					"find definition",
			"find a definition for": 			"find definition",
			"find definition for": 				"find definition",
			"find the meaning of": 				"find definition",
			"define": 							"find definition",
			"define the word": 					"find definition",
			"look up the word": 				"find definition",
			"provide a definition for": 		"find definition",
			"what is the meaning of": 			"find definition",
			"whats the meaning of": 			"find definition",
			"get definition": 					"find definition",
			"get definition for": 				"find definition",
			"get definition of": 				"find definition",
			"get a definition for": 			"find definition",
			"get the definition of": 			"find definition",
			"get definition for": 				"find definition",
			"get the meaning of": 				"find definition",

			"find etymology": 					"find etymology",
			"find the etymology": 				"find etymology",
			"find etymology of": 				"find etymology",
			"find the etymology of": 			"find etymology",
			"find etymology of the word": 		"find etymology",
			"find the etymology of the word": 	"find etymology",
			"get etymology of": 				"find etymology",
			"get the etymology of": 			"find etymology",
			"get etymology of the word": 		"find etymology",
			"get the etymology of the word": 	"find etymology",
			"what is etymology of": 			"find etymology",
			"what is the etymology of": 		"find etymology",
			"what is etymology of the word": 	"find etymology",
			"what is the etymology of the word": "find etymology",
			"whats etymology of": 				"find etymology",
			"whats the etymology of": 			"find etymology",
			"whats etymology of the word": 		"find etymology",
			"whats the etymology of the word": 	"find etymology",

		// content API fetches
			"get a joke": 						"get a joke",
			"tell me a joke": 					"get a joke",
			"know any jokes": 					"get a joke",
			"do you know any jokes": 			"get a joke",
			"say something funny": 				"get a joke",
			"be funny": 						"get a joke",
			"i could use a joke": 				"get a joke",
			"tell a joke": 						"get a joke",
			"tell us a joke": 					"get a joke",
			"make me laugh": 					"get a joke",
			"fetch a joke": 					"get a joke",
			"fetch me a joke": 					"get a joke",
			"tell me something funny": 			"get a joke",

			"get a quote": 						"get a quote",
			"get me a quote": 					"get a quote",
			"give me a quote": 					"get a quote",
			"get a random quote": 				"get a quote",
			"get me a random quote": 			"get a quote",
			"give me a random quote": 			"get a quote",
			"random quote": 					"get a quote",
			"famous quote": 					"get a quote",
			"inspire me": 						"get a quote",
			"tell me a random quote": 			"get a quote",
			"tell me a quote": 					"get a quote",
			"fetch a quote": 					"get a quote",
			"fetch me a quote": 				"get a quote",

			"get a fortune": 					"get a fortune",
			"get me a fortune": 				"get a fortune",
			"give me a fortune": 				"get a fortune",
			"get a random fortune": 			"get a fortune",
			"get me a random fortune": 			"get a fortune",
			"give me a random fortune": 		"get a fortune",
			"random fortune": 					"get a fortune",
			"tell my fortune": 					"get a fortune",
			"tell me my fortune": 				"get a fortune",
			"read my fortune": 					"get a fortune",
			"tell me a random fortune": 		"get a fortune",
			"tell me a fortune": 				"get a fortune",
			"fetch a fortune": 					"get a fortune",
			"fetch me a fortune": 				"get a fortune",
			"what is my fortune": 				"get a fortune",
			"whats my fortune": 				"get a fortune",

			"get an insult": 					"get an insult",
			"insult me": 						"get an insult",
			"disrespect me": 					"get an insult",
			"dis me": 							"get an insult",
			"diss me": 							"get an insult",
			"your mother": 						"get an insult",
			"your mothers": 					"get an insult",
			"youre mother": 					"get an insult",
			"youre mothers": 					"get an insult",
			"your mom": 						"get an insult",
			"your moms": 						"get an insult",
			"youre mom": 						"get an insult",
			"youre moms": 						"get an insult",
			"your mama": 						"get an insult",
			"your mamas": 						"get an insult",
			"youre mama": 						"get an insult",
			"youre mamas": 						"get an insult",
			"yo mama": 							"get an insult",
			"yo mamas": 						"get an insult",
			"yo momma": 						"get an insult",
			"yo mommas": 						"get an insult",

			"get a wikipedia entry": 			"get a wikipedia entry",
			"on wikipedia, look up": 			"get a wikipedia entry",
			"tell me about": 					"get a wikipedia entry",
			"on wikipedia tell me about": 		"get a wikipedia entry",
			"look this up on wikipedia": 		"get a wikipedia entry",
			"search wikipedia for": 			"get a wikipedia entry",
			"get the wikipedia entry about": 	"get a wikipedia entry",
			"get the wikipedia entry for": 		"get a wikipedia entry",
			"on wikipedia find": 				"get a wikipedia entry",
			"on wikipedia look up": 			"get a wikipedia entry",
			"read the wikipedia page about": 	"get a wikipedia entry",
			"read me the wikipedia page about": "get a wikipedia entry",
			"read the wikipedia entry for": 	"get a wikipedia entry",
			"read me the wikipedia entry for": 	"get a wikipedia entry",
			"get the wikipedia page for": 		"get a wikipedia entry",
			"give me the wikipedia page for": 	"get a wikipedia entry",
			"get me the wikipedia page for": 	"get a wikipedia entry",
			"do a wikipedia search for": 		"get a wikipedia entry",
			"get the wikipedia article for": 	"get a wikipedia entry",
			"get the wikipedia article about": 	"get a wikipedia entry",

			"get this day in history": 			"get this day in history",
			"what happened today in history": 	"get this day in history",
			"get today in history": 			"get this day in history",
			"tell me about today in history": 	"get this day in history",
			"what went down in history today": 	"get this day in history",
			"what happened on this date": 		"get this day in history",

			"get the weather": 					"get the weather",
			"get me the weather": 				"get the weather",
			"look up the weather": 				"get the weather",
			"whats the weather": 				"get the weather",
			"what is the weather": 				"get the weather",
			"what will the weather be": 		"get the weather",
			"whats the weather going to be": 	"get the weather",
			"what is the weather going to be": 	"get the weather",
			"whats the weather gonna be": 		"get the weather",
			"what is the weather gonna be": 	"get the weather",
			"hows the weather": 				"get the weather",
			"how is the weather": 				"get the weather",
			"is it going to rain": 				"get the weather",
			"will it rain": 					"get the weather",
			"is it going to snow": 				"get the weather",
			"will it snow": 					"get the weather",

			"get nutrition facts": 				"get nutrition facts",
			"get nutrition facts about": 		"get nutrition facts",
			"get nutrition facts for": 			"get nutrition facts",
			"get the nutrition facts": 			"get nutrition facts",
			"get the nutrition facts about": 	"get nutrition facts",
			"get the nutrition facts for": 		"get nutrition facts",
			"give me the nutrition facts": 		"get nutrition facts",
			"give me the nutrition facts about": "get nutrition facts",
			"give me the nutrition facts for": 	"get nutrition facts",
			"tell me about the dish": 			"get nutrition facts",
			"tell me about the dish called": 	"get nutrition facts",
			"tell me about a dish": 			"get nutrition facts",
			"tell me about a dish called": 		"get nutrition facts",
			"look up the dish": 				"get nutrition facts",
			"look up the dish called": 			"get nutrition facts",
			"look up a dish": 					"get nutrition facts",
			"look up a dish called": 			"get nutrition facts",
			"tell me about the meal": 			"get nutrition facts",
			"tell me about the meal called": 	"get nutrition facts",
			"tell me about a meal": 			"get nutrition facts",
			"tell me about a meal called": 		"get nutrition facts",
			"look up the meal": 				"get nutrition facts",
			"look up the meal called": 			"get nutrition facts",
			"look up a meal": 					"get nutrition facts",
			"look up a meal called": 			"get nutrition facts",
			"tell me about the food": 			"get nutrition facts",
			"tell me about the food called": 	"get nutrition facts",
			"tell me about a food": 			"get nutrition facts",
			"tell me about a food called": 		"get nutrition facts",
			"look up the food": 				"get nutrition facts",
			"look up the food called": 			"get nutrition facts",
			"look up a food": 					"get nutrition facts",
			"look up a food called": 			"get nutrition facts",

			"get nutrition answer": 			"get nutrition answer",
			"get nutrition answer about": 		"get nutrition answer",
			"get nutrition answer for": 		"get nutrition answer",
			"get a nutrition answer": 			"get nutrition answer",
			"get a nutrition answer about": 	"get nutrition answer",
			"get a nutrition answer for": 		"get nutrition answer",
			"do a nutrition search": 			"get nutrition answer",
			"do a nutrition search for": 		"get nutrition answer",
			"do a nutrition search about": 		"get nutrition answer",
			"i have a nutrition question": 		"get nutrition answer",
			"let me ask a nutrition question": 	"get nutrition answer",
			"heres a nutrition question": 		"get nutrition answer",

			"search goodreads": 				"search goodreads",
			"search goodreads for": 			"search goodreads",
			"on goodreads search": 				"search goodreads",
			"on goodreads search for": 			"search goodreads",
			"get a book": 						"search goodreads",
			"get me a book": 					"search goodreads",
			"find the book": 					"search goodreads",
			"find a book": 						"search goodreads",
			"get the book": 					"search goodreads",
			"i want to read": 					"search goodreads",
			"i want to read a book called": 	"search goodreads",
			"look up the book": 				"search goodreads",
			"look up a book": 					"search goodreads",
			"look for a book": 					"search goodreads",
			"look up a book called": 			"search goodreads",
			"look up this book": 				"search goodreads",
			"tell me about the book": 			"search goodreads",
			"look up a book about": 			"search goodreads",
			"look up books about": 				"search goodreads",
			"find a book about": 				"search goodreads",
			"find books about": 				"search goodreads",
			"find me a book about": 			"search goodreads",
			"find me books about": 				"search goodreads",
			"get a book about": 				"search goodreads",
			"get books about": 					"search goodreads",
			"get me a book about": 				"search goodreads",
			"get me books about": 				"search goodreads",
			"search for a book about": 			"search goodreads",
			"search for books about": 			"search goodreads",
			"get a book by": 					"search goodreads",
			"get books by": 					"search goodreads",
			"get me a book by": 				"search goodreads",
			"get me books by": 					"search goodreads",
			"look up a book by": 				"search goodreads",
			"look up books by": 				"search goodreads",
			"what books were written by": 		"search goodreads",
			"what was written by": 				"search goodreads",
			"find books by": 					"search goodreads",
			"look up a book by the author": 	"search goodreads",
			"look up books by the author": 		"search goodreads",
			"what books were written by the author": "search goodreads",
			"what was written by the author": 	"search goodreads",
			"find books by the author": 		"search goodreads",

		// news & blogs
			"get the latest post": 				"get the latest post",
			"get me the latest post": 			"get the latest post",
			"get the latest post from": 		"get the latest post",
			"get me the latest post from": 		"get the latest post",
			"get the latest post on": 			"get the latest post",
			"get me the latest post on": 		"get the latest post",
			"give me the latest post": 			"get the latest post",
			"give me the latest post from": 	"get the latest post",
			"give me the latest post on": 		"get the latest post",
			"fetch the latest post": 			"get the latest post",
			"fetch the latest post from": 		"get the latest post",
			"fetch the latest post on": 		"get the latest post",
			"read the latest entry": 			"get the latest post",
			"read me the latest entry": 		"get the latest post",
			"read the latest entry from": 		"get the latest post",
			"read me the latest entry from": 	"get the latest post",
			"read the latest entry on": 		"get the latest post",
			"read me the latest entry on": 		"get the latest post",
			"read the latest post": 			"get the latest post",
			"read me the latest post": 			"get the latest post",
			"read the latest post from": 		"get the latest post",
			"read me the latest post from": 	"get the latest post",
			"read the latest post on": 			"get the latest post",
			"read me the latest post on": 		"get the latest post",

			"get a random post": 				"get a random post",
			"get me a random post": 			"get a random post",
			"get a random post from": 			"get a random post",
			"get me a random post from": 		"get a random post",
			"get a random post on": 			"get a random post",
			"get me a random post on": 			"get a random post",
			"give me a random post": 			"get a random post",
			"give me a random post from": 		"get a random post",
			"give me a random post on": 		"get a random post",
			"fetch a random post": 				"get a random post",
			"fetch a random post from": 		"get a random post",
			"fetch a random post on": 			"get a random post",
			"read a random entry": 				"get a random post",
			"read me a random entry": 			"get a random post",
			"read a random entry from": 		"get a random post",
			"read me a random entry from": 		"get a random post",
			"read a random entry on": 			"get a random post",
			"read me a random entry on": 		"get a random post",
			"read a random post": 				"get a random post",
			"read me a random post": 			"get a random post",
			"read a random post from": 			"get a random post",
			"read me a random post from": 		"get a random post",
			"read a random post on": 			"get a random post",
			"read me a random post on": 		"get a random post",

			"get the headlines": 				"get the headlines",
			"get todays headlines": 			"get the headlines",
			"whats happening in the world": 	"get the headlines",
			"what is happening in the world": 	"get the headlines",
			"get the top stories": 				"get the headlines",
			"get the news": 					"get the headlines",
			"get me the news": 					"get the headlines",
			"give me the news": 				"get the headlines",
			"fetch the news": 					"get the headlines",
			"what is the news": 				"get the headlines",
			"whats the news": 					"get the headlines",
			"whats the latest news": 			"get the headlines",
			"what is the latest news": 			"get the headlines",
			"whats happening in the news": 		"get the headlines",
			"what is happening in the news": 	"get the headlines",
			"read the headlines": 				"get the headlines",
			"read me the headlines": 			"get the headlines",

		// Google Apps Script
			"edit wish list": 					"edit wish list",
			"add to wish list": 				"edit wish list",
			"add to my wish list": 				"edit wish list",
			"add this to my wish list": 		"edit wish list",
			"include on my wish list": 			"edit wish list",
			"edit my wish list to include": 	"edit wish list",

			"get balance": 						"get balance",
			"what is my account balance for": 	"get balance",
			"whats my account balance for": 	"get balance",
			"check my account balance for": 	"get balance",
			"how much money do i have in": 		"get balance",
			"how much do i have in": 			"get balance",
			"how much money do i have in my": 	"get balance",
			"how much do i have in my": 		"get balance",
			"what is the balance in my": 		"get balance",
			"whats the balance in my": 			"get balance",
			"what is the balance on my": 		"get balance",
			"whats the balance on my": 			"get balance",
			"how much money is left in my": 	"get balance",
			"how much money is in my": 			"get balance",
			"how much is in my": 				"get balance",

			"log purchase": 					"log purchase",
			"i just bought": 					"log purchase",
			"i bought": 						"log purchase",
			"add a purchase": 					"log purchase",
			"add a purchase of": 				"log purchase",
			"add my purchase": 					"log purchase",
			"add my purchase of": 				"log purchase",
			"record a purchase": 				"log purchase",
			"record my purchase": 				"log purchase",
			"record a purchase of": 			"log purchase",
			"record my purchase of": 			"log purchase",
			"log a purchase": 					"log purchase",
			"log my purchase": 					"log purchase",
			"log a purchase of": 				"log purchase",
			"log my purchase of": 				"log purchase",

			"fetch calendar": 					"fetch calendar",
			"fetch events": 					"fetch calendar",
			"fetch my events": 					"fetch calendar",
			"fetch upcoming events": 			"fetch calendar",
			"fetch my upcoming events": 		"fetch calendar",
			"fetch my calendar": 				"fetch calendar",
			"what is on my calendar": 			"fetch calendar",
			"whats on my calendar": 			"fetch calendar",
			"what is on the calendar": 			"fetch calendar",
			"whats on the calendar": 			"fetch calendar",
			"what is happening": 				"fetch calendar",
			"whats happening": 					"fetch calendar",

			"get a list": 						"get a list",
			"get my list": 						"get a list",
			"get the list": 					"get a list",
			"get a list named": 				"get a list",
			"get my list named": 				"get a list",
			"get the list named": 				"get a list",
			"get a list called": 				"get a list",
			"get my list called": 				"get a list",
			"get the list called": 				"get a list",
			"fetch a list": 					"get a list",
			"fetch my list": 					"get a list",
			"fetch the list": 					"get a list",
			"fetch a list named": 				"get a list",
			"fetch my list named": 				"get a list",
			"fetch the list named": 			"get a list",
			"fetch a list called": 				"get a list",
			"fetch my list called": 			"get a list",
			"fetch the list called": 			"get a list",

			"add an item to a list": 			"add an item to a list",
			"add an item to the": 				"add an item to a list",
			"add an item to my": 				"add an item to a list",
			"add an item to": 					"add an item to a list",
			"add a task to a list": 			"add an item to a list",
			"add a task to the": 				"add an item to a list",
			"add a task to my": 				"add an item to a list",
			"add a task to": 					"add an item to a list",
			"add this to": 						"add an item to a list",
			"add this to the": 					"add an item to a list",
			"add this to my": 					"add an item to a list",
			"add to my": 						"add an item to a list",
			"add to": 							"add an item to a list",
			"add something to": 				"add an item to a list",
			"add something to the": 			"add an item to a list",
			"add something to my": 				"add an item to a list",
			"uncheck this on the": 				"add an item to a list",
			"uncheck this on my": 				"add an item to a list",
			"uncheck this on": 					"add an item to a list",
			"uncheck this from the": 			"add an item to a list",
			"uncheck this from my": 			"add an item to a list",
			"uncheck this from": 				"add an item to a list",
			"uncheck an item on the": 			"add an item to a list",
			"uncheck an item on my": 			"add an item to a list",
			"uncheck an item on": 				"add an item to a list",
			"uncheck a task on the": 			"add an item to a list",
			"uncheck a task on my": 			"add an item to a list",
			"uncheck a task on": 				"add an item to a list",
			"uncheck something from a list": 	"add an item to a list",
			"log an item on": 					"add an item to a list",
			"log an item on the": 				"add an item to a list",
			"log a task on my": 				"add an item to a list",
			"log a task on": 					"add an item to a list",
			"log a task on the": 				"add an item to a list",
			"log a task on my": 				"add an item to a list",

			"get contacts": 					"get contacts",
			"get contacts named": 				"get contacts",
			"get contacts with the name": 		"get contacts",
			"get contacts by the name": 		"get contacts",
			"get a contact": 					"get contacts",
			"get a named": 						"get contacts",
			"get all contacts named": 			"get contacts",
			"get all contacts with the name": 	"get contacts",
			"search for contacts named": 		"get contacts",
			"search for contacts with the name": "get contacts",
			"search for contacts by the name": 	"get contacts",
			"search for contacts called": 		"get contacts",
			"look up a contact named": 			"get contacts",
			"look up a contact with the name": 	"get contacts",
			"look up contacts named": 			"get contacts",
			"look up contacts with the name": 	"get contacts",
			"look up contacts by the name": 	"get contacts",
			"look up contacts containing": 		"get contacts",
			"look up contacts whose names include": "get contacts",
			"find contacts whose names include": "get contacts",
			"find a contact": 					"get contacts",
			"find a contact named": 			"get contacts",
			"find a contact with the name": 	"get contacts",
			"find contacts named": 				"get contacts",
			"find contacts with the name": 		"get contacts",

			"get birthday": 					"get birthday",
			"get birthday for": 				"get birthday",
			"get birthday of": 					"get birthday",
			"get the birthday": 				"get birthday",
			"get the birthday for": 			"get birthday",
			"get the birthday of": 				"get birthday",
			"look up the birthday": 			"get birthday",
			"look up the birthday for": 		"get birthday",
			"look up the birthday of": 			"get birthday",
			"when is the birthday": 			"get birthday",
			"when is the birthday for": 		"get birthday",
			"when is the birthday of": 			"get birthday",

			"get phone number": 				"get phone number",
			"get phone number for": 			"get phone number",
			"get phone number of": 				"get phone number",
			"get the phone number": 			"get phone number",
			"get the phone number for": 		"get phone number",
			"get the phone number of": 			"get phone number",
			"look up the phone number": 		"get phone number",
			"look up the phone number for": 	"get phone number",
			"look up the phone number of": 		"get phone number",
			"when is the phone number": 		"get phone number",
			"when is the phone number for": 	"get phone number",
			"when is the phone number of": 		"get phone number",

			"get email": 						"get email",
			"get email for": 					"get email",
			"get email of": 					"get email",
			"get the email": 					"get email",
			"get the email for": 				"get email",
			"get the email of": 				"get email",
			"look up the email": 				"get email",
			"look up the email for": 			"get email",
			"look up the email of": 			"get email",
			"when is the email": 				"get email",
			"when is the email for": 			"get email",
			"when is the email of": 			"get email",
			"get email address": 				"get email",
			"get email address for": 			"get email",
			"get email address of": 			"get email",
			"get the email address": 			"get email",
			"get the email address for": 		"get email",
			"get the email address of": 		"get email",
			"look up the email address": 		"get email",
			"look up the email address for": 	"get email",
			"look up the email address of": 	"get email",
			"when is the email address": 		"get email",
			"when is the email address for": 	"get email",
			"when is the email address of": 	"get email",

			"get address": 						"get address",
			"get address for": 					"get address",
			"get address of": 					"get address",
			"get the address": 					"get address",
			"get the address for": 				"get address",
			"get the address of": 				"get address",
			"look up the address": 				"get address",
			"look up the address for": 			"get address",
			"look up the address of": 			"get address",
			"when is the address": 				"get address",
			"when is the address for": 			"get address",
			"when is the address of": 			"get address",

			"log gratitude": 					"log gratitude",
			"i feel grateful for": 				"log gratitude",
			"i am grateful for": 				"log gratitude",
			"i am feeling grateful for": 		"log gratitude",
			"im grateful for": 					"log gratitude",
			"im feeling grateful for": 			"log gratitude",
			"today i feel grateful for": 		"log gratitude",
			"today i am grateful for": 			"log gratitude",
			"today i am feeling grateful for": 	"log gratitude",
			"today im grateful for": 			"log gratitude",
			"today im feeling grateful for": 	"log gratitude",
			"i feel thankful for": 				"log gratitude",
			"i am thankful for": 				"log gratitude",
			"i am feeling thankful for": 		"log gratitude",
			"im thankful for": 					"log gratitude",
			"im feeling thankful for": 			"log gratitude",
			"today i feel thankful for": 		"log gratitude",
			"today i am thankful for": 			"log gratitude",
			"today i am feeling thankful for": 	"log gratitude",
			"today im thankful for": 			"log gratitude",
			"today im feeling thankful for": 	"log gratitude",

		// Google APIs
			"search google": 					"search google",
			"look this up on google": 			"search google",
			"do a google search": 				"search google",
			"do a google search for": 			"search google",
			"google": 							"search google",
			"do a search for": 					"search google",
			"do a search": 						"search google",
			"search": 							"search google",
			"i wonder if": 						"search google",
			"i wonder": 						"search google",
			"i am curious": 					"search google",
			"im curious": 						"search google",

			"search google directions": 		"search google directions",
			"how do i get": 					"search google directions",
			"how do i go": 						"search google directions",
			"tell me how to get": 				"search google directions",
			"tell me how to go": 				"search google directions",
			"get me directions": 				"search google directions",
			"get directions": 					"search google directions",
			"look up directions": 				"search google directions",
			"look up how to get": 				"search google directions",
			"look up how to go": 				"search google directions",
			"get a route": 						"search google directions",
			"route me": 						"search google directions",

			"search google places": 			"search google places",
			"search google places for": 		"search google places",
			"find a place": 					"search google places",
			"find a place called": 				"search google places",
			"find a place named": 				"search google places",
			"find a place by the name": 		"search google places",
			"find me a place": 					"search google places",
			"find me a place called": 			"search google places",
			"find me a place named": 			"search google places",
			"find me a place by the name": 		"search google places",
			"look up a place": 					"search google places",
			"look up a place called": 			"search google places",
			"look up a place named": 			"search google places",
			"look up a place by the name": 		"search google places",
			"look for a place": 				"search google places",
			"look for a place called": 			"search google places",
			"look for a place named": 			"search google places",
			"look for a place by the name": 	"search google places",
			"what are the business hours at": 	"search google places",
			"what are the hours at": 			"search google places",
			"what are the business hours of": 	"search google places",
			"what are the hours of": 			"search google places",
			"get the business hours for": 		"search google places",
			"get the hours for": 				"search google places",
			"get the business hours of": 		"search google places",
			"get the hours of": 				"search google places",

			"search youtube": 					"search youtube",
			"search youtube for": 				"search youtube",
			"find on youtube": 					"search youtube",
			"on youtube find": 					"search youtube",
			"on youtube look for": 				"search youtube",
			"on youtube play": 					"search youtube",
			"on youtube try": 					"search youtube",
			"play on youtube": 					"search youtube",
			"play this on youtube": 			"search youtube",
			"lets watch": 						"search youtube",
			"lets listen to": 					"search youtube",
			"on youtube put on": 				"search youtube",
			"on youtube open up": 				"search youtube",
			"on youtube open": 					"search youtube",

			"google translate": 				"google translate",
			"translate": 						"google translate",
			"get a translation": 				"google translate",
			"get me a translation": 			"google translate",
			"give a translation": 				"google translate",
			"give me a translation": 			"google translate",
			"get a translation of": 			"google translate",
			"get me a translation of": 			"google translate",
			"give a translation of": 			"google translate",
			"give me a translation of": 		"google translate",
			"get a translation for": 			"google translate",
			"get me a translation for": 		"google translate",
			"give a translation for": 			"google translate",
			"give me a translation for": 		"google translate",
			"how do you say": 					"google translate",
			"how would you say": 				"google translate",
			"how can you say": 					"google translate",
			"how to say": 						"google translate",

		// games
			"play more or less": 				"play more or less",
			"lets play more or less": 			"play more or less",
			"lets play the more or less game": 	"play more or less",
			"think of a number": 				"play more or less",
			"pick a number": 					"play more or less",
			"i want to guess a number": 		"play more or less",
			"lets play more or less": 			"play more or less",

			"play true or false": 				"play true or false",
			"quiz me": 							"play true or false",
			"tell me a fact": 					"play true or false",
			"tell me a fun fact": 				"play true or false",
			"give me a fact": 					"play true or false",
			"give me a fun fact": 				"play true or false",
			"lets do trivia": 					"play true or false",
			"lets do some trivia": 				"play true or false",
			"lets play trivia": 				"play true or false",
			"lets play some trivia": 			"play true or false",
			"lets play true or false": 			"play true or false",

			"play blackjack": 					"play blackjack",
			"lets play blackjack": 				"play blackjack",
			"play 21": 							"play blackjack",
			"lets play 21": 					"play blackjack",
			"deal me in": 						"play blackjack",
			"deal me cards": 					"play blackjack",
			"deal me some cards": 				"play blackjack",

			"play hangman": 					"play hangman",
			"lets play hangman": 				"play hangman",
			"play guess the word": 				"play hangman",
			"lets play guess the word": 		"play hangman",
			"play guess that word": 			"play hangman",
			"lets play guess that word": 		"play hangman",
			"think of a word": 					"play hangman",
			"think of a random word": 			"play hangman",
			"i want to guess a word": 			"play hangman",
			"i want to guess your word": 		"play hangman",

		// SONOS

		// Wink
			"get wink devices": 				"get wink devices",
			"get all wink devices": 			"get wink devices",
			"get my wink devices": 				"get wink devices",
			"on wink get devices": 				"get wink devices",
			"on wink get my devices": 			"get wink devices",
			"on wink get all devices": 			"get wink devices",
			"on wink get the devices": 			"get wink devices",
			"on wink get all the devices": 		"get wink devices",
			"on wink get all of the devices": 	"get wink devices",
			"on wink get status": 				"get wink devices",
			"on wink whats the situation": 		"get wink devices",
			"on wink what is the situation": 	"get wink devices",
			"on wink give me a status report": 	"get wink devices",
			"on wink what is the temperature": 	"get wink devices",
			"on wink whats the temperature": 	"get wink devices",
			"on wink tell me the temperature": 	"get wink devices",
			"on wink report": 					"get wink devices",
			"on wink tell me the situation": 	"get wink devices",

			"on wink set": 						"set wink devices",
			"on wink update": 					"set wink devices",
			"on wink turn": 					"set wink devices",
			"on wink change": 					"set wink devices",
			"on wink alter": 					"set wink devices",
			"on wink make": 					"set wink devices",

			"on wink turn off": 				"turn off wink device",
			"on wink switch off": 				"turn off wink device",
			"on wink turn off": 				"turn off wink device",
			"on wink deactivate": 				"turn off wink device",

			"on wink turn on": 					"turn on wink device",
			"on wink switch on": 				"turn on wink device",
			"on wink flip on": 					"turn on wink device",
			"on wink activate": 				"turn on wink device",

		// Reddit
			"ask reddit": 						"ask reddit",
			"ask a question": 					"ask reddit",
			"ask me a question": 				"ask reddit",
			"ask us a question": 				"ask reddit",
			"ask me something": 				"ask reddit",
			"ask us something": 				"ask reddit",
			"ask something": 					"ask reddit",
			"change the subject": 				"ask reddit",
			"change the topic": 				"ask reddit",
			"change topic": 					"ask reddit",
			"change subject": 					"ask reddit",

			"get a reddit writing prompt": 		"get a reddit writing prompt",
			"get a writing prompt": 			"get a reddit writing prompt",
			"give me a writing prompt": 		"get a reddit writing prompt",
			"fetch a writing prompt": 			"get a reddit writing prompt",

		// custom APIs
			"convert": 							"convert",
			"do a conversion": 					"convert",
			"can you convert": 					"convert",
			"lets convert": 					"convert",

			"find factors": 					"find factors",
			"find factors of": 					"find factors",
			"find the factors of": 				"find factors",
			"find factors for": 				"find factors",
			"what are the factors of": 			"find factors",
			"tell me about the number": 		"find factors",
			"is this number prime": 			"find factors",
			"is this number composite": 		"find factors",
			"what are the prime factors of": 	"find factors",
			"what numbers go into": 			"find factors",
			"what are the divisors of": 		"find factors",
			"get the factors of": 				"find factors",

			"analyze chord": 					"analyze chord",
			"tell me about the notes": 			"analyze chord",
			"analyze the chord": 				"analyze chord",
			"analyze this chord": 				"analyze chord",
			"what chord are the notes": 		"analyze chord",
			"make a chord from the notes": 		"analyze chord",
			"make a chord from": 				"analyze chord",

			"shuffle word": 					"shuffle word",
			"shuffle the word": 				"shuffle word",
			"shuffle this word": 				"shuffle word",
			"what words can you make from": 	"shuffle word",
			"what are some anagrams for": 		"shuffle word",
			"make new words from": 				"shuffle word",
			"find anagrams for": 				"shuffle word",
			"find anagrams of": 				"shuffle word",
	}

/* action library */
	window.ACTION_LIBRARY = {
		// casual responses
			"receive gratitude": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f426;"

					// possible messages
						var messages = ["You're welcome.", "Glad I could help.", "Any time.", "Don't mention it.", "No problem."]

					// send random message
						var message = window.FUNCTION_LIBRARY.chooseRandom(messages)
						var responseHTML = "<h2>" + message + "</h2>"
						callback({icon: icon, message: message, html: responseHTML, followup: false})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"receive apology": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f426;"

					// possible messages
						var messages = ["Don't worry about it.", "I forgive you.", "It's all right.", "No worries.", "Everything will be okay."]

					// send random message
						var message = window.FUNCTION_LIBRARY.chooseRandom(messages)
						var responseHTML = "<h2>" + message + "</h2>"
						callback({icon: icon, message: message, html: responseHTML, followup: false})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"receive affirmation": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f426;"

					// possible messages
						var messages = ["I am a good bird.", "Thank you. I try my hardest.", "That's kind of you to say.", "I'm glad you think so.", "I appreciate that."]

					// send random message
						var message = window.FUNCTION_LIBRARY.chooseRandom(messages)
						var responseHTML = "<h2>" + message + "</h2>"
						callback({icon: icon, message: message, html: responseHTML, followup: false})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"receive greeting": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f44b;"

					// clean up remainder
						remainder = remainder.toLowerCase().replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").trim()
						var words = remainder.split(/\s/gi)
						var message = ""

					// time of day
						if (words.includes("morning")) {
							message = "Good morning to you too!"
						}
						else if (words.includes("day")) {
							message = "I hope you have a great day too!"
						}
						else if (words.includes("afternoon") ) {
							message = "Good afternoon to you too!"
						}
						else if (words.includes("evening")) {
							message = "Good evening to you too!"
						}
						else if (words.includes("night")) {
							message = "I hope you have a good night too!"
						}

					// holidays
						else if (words.includes("christmas")) {
							message = "Merry Christmas to you too!"
						}
						else {
							message = "Happy " + remainder + " to you too!"
						}

					// response
						var responseHTML = "<h2>" + message + "</h2>"
						callback({icon: icon, message: message, html: responseHTML, followup: false})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// meta
			"list actions": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f426;"

					// get all functions
						var keys = Object.keys(window.ACTION_LIBRARY)
					
					// generate html list
						var responseHTML = "<h2>action library</h2><ul>"
						for (var i in keys) {
							responseHTML += ("<li>" + keys[i] + "</li>")
						}
						responseHTML += "</ul>"
					
					// send response
						var message = "Here are all of the actions I know."
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"repeat this": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f426;"

					// no remainder
						remainder = remainder.replace(/[?!,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I repeat?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// send response
						var message = remainder
						var responseHTML = "<h2>" + remainder + "</h2>"
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"repeat that": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f426;"

					// no history
						if (!window.CONTEXT_LIBRARY.lastAction || !window.ACTION_LIBRARY[window.CONTEXT_LIBRARY.lastAction]) {
							callback({icon: icon, error: true, message: "There's nothing for me to repeat.", html: "<h2>Error: no previous response.</h2>", followup: false})
							return
						}

					// send response
						var message = window.CONTEXT_LIBRARY.lastResponseMessage
						var responseHTML = "<h2>" + window.CONTEXT_LIBRARY.lastResponseHTML + "</h2>"
						callback({icon: window.CONTEXT_LIBRARY.lastResponseIcon || icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"do that again": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f426;"

					// no history
						if (!window.CONTEXT_LIBRARY.lastAction || !window.ACTION_LIBRARY[window.CONTEXT_LIBRARY.lastAction]) {
							callback({icon: icon, error: true, message: "There's nothing for me to do.", html: "<h2>Error: no previous action.</h2>", followup: false})
							return
						}

					// perform action again
						window.ACTION_LIBRARY[window.CONTEXT_LIBRARY.lastAction](window.CONTEXT_LIBRARY.lastRemainder || null, callback)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get next result": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x23ed;"

					// no more results
						if (!window.CONTEXT_LIBRARY.lastResults || !window.CONTEXT_LIBRARY.lastResults.length) {
							// no history at all
								if (!window.CONTEXT_LIBRARY.lastAction || !window.ACTION_LIBRARY[window.CONTEXT_LIBRARY.lastAction]) {
									callback({icon: icon, error: true, message: "I don't have any results.", html: "<h2>No more results.</h2>", followup: false})
									return
								}

							// run the function again
								window.ACTION_LIBRARY[window.CONTEXT_LIBRARY.lastAction](window.CONTEXT_LIBRARY.lastRemainder || null, callback)
								return
						}

					// get first of lastResults
						var nextResult = window.CONTEXT_LIBRARY.lastResults.shift()

					// if video
						if (nextResult.video && window.CONTEXT_LIBRARY.lastResponseVideo) {
							window.FUNCTION_LIBRARY.stopVideo(window.CONTEXT_LIBRARY.lastResponseVideo)
						}

					// send response
						if (nextResult.followup !== undefined) {
							callback({icon: nextResult.icon || icon, message: nextResult.message, html: nextResult.html, followup: nextResult.followup, video: nextResult.video || null})
						}
						else {
							callback({icon: nextResult.icon || icon, message: nextResult.message, html: nextResult.html, video: nextResult.video || null})	
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"stop last video": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f6ab;"

					// no video
						if (!window.CONTEXT_LIBRARY.lastResponseVideo) {
							callback({icon: icon, error: true, message: "I don't have a video to stop.", html: "<h2>No previous video.</h2>", followup: false})
							return
						}

					// stop the video
						var success = window.FUNCTION_LIBRARY.stopVideo(window.CONTEXT_LIBRARY.lastResponseVideo)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"restart last video": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4fa;"

					// no video
						if (!window.CONTEXT_LIBRARY.lastResponseVideo) {
							callback({icon: icon, error: true, message: "I don't have a video to restart.", html: "<h2>No previous video.</h2>", followup: false})
							return
						}

					// restart the video
						var success = window.FUNCTION_LIBRARY.restartVideo(window.CONTEXT_LIBRARY.lastResponseVideo)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// settings
			"stop listening": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f507;"

					// force whistling off
						window.FUNCTION_LIBRARY.changeWhistleOn({forceOff: true})
						var restartTime = null

					// split into array
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						var words = remainder.split(/\s/gi) || []

					// timer
						if ((/second|minute|hour|day|for/gi).test(remainder)) {
							var units = {
								"second": 1000,
								"minute": 1000 * 60,
								"hour": 1000 * 60 * 60,
								"day": 1000 * 60 * 60 * 24
							}

							var amounts = []
							for (var i = 0; i < words.length; i++) {
								words[i] = window.FUNCTION_LIBRARY.getDigits(words[i])

								if (!isNaN(words[i])) {
									if (words[i + 1] && units[words[i + 1].replace(/s$/gi,"").toLowerCase()]) {
										amounts.push({
											number: Number(words[i]),
											unit: words[i + 1].replace(/s$/gi,"")
										})
									}
									else {
										amounts.push({
											number: Number(words[i]),
											unit: "minute"
										})
									}
								}
							}

							var duration = 0
							for (var i in amounts) {
								duration += (amounts[i].number * units[amounts[i].unit])
							}

							if (duration) {
								restartTime = new Date().getTime() + duration
							}
						}

					// alarm
						else if ((/until|till|til/gi).test(remainder)) {
							var timePhrase = remainder.replace(/until|till|til/gi,"").toLowerCase().trim()
								timePhrase = timePhrase.replace("p.m.", "PM").replace("pm", "PM").replace("a.m.", "AM").replace("am", "AM")
							restartTime = new Date(timePhrase).getTime() || new Date(new Date().toDateString() + " " + timePhrase).getTime()
							
							if (!isNaN(restartTime)) {
								if (!timePhrase.includes("PM") && !timePhrase.includes("AM") && new Date().getTime() < restartTime + (1000 * 60 * 60 * 12)) {
									restartTime = restartTime + (1000 * 60 * 60 * 12)
								}
								else if (new Date().getTime() < restartTime + (1000 * 60 * 60 * 24)) {
									restartTime = restartTime + (1000 * 60 * 60 * 24)
								}
							}
						}

					// restartTime?
						if (restartTime && !isNaN(restartTime)) {
							window.CONTEXT_LIBRARY.startListening = restartTime
						}
						else {
							window.CONTEXT_LIBRARY.startListening = null
						}

					// get message
						if (restartTime) {
							var responseHTML = "<h2>whistle detection turned off until <b>" + new Date(restartTime).toLocaleString() + "</b></h2>"
						}
						else {
							var responseHTML = "<h2>whistle detection turned off</h2>"
						}
						
					// response
						callback({icon: icon, message: "", html: responseHTML, followup: false})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"change voice": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f50a;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What voice should I set?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// chang evoice
						var name = remainder
						var voice = window.FUNCTION_LIBRARY.changeVoice({name: name})

					// failure
						if (voice === false) {
							callback({icon: icon, error: true, message: "I don't recognize that voice.", html: "<h2>Error: voice not found:</h2>" + remainder})
							return
						}

					// success
						var message = "Voice set to " + voice
						var responseHTML = "<h2>voice: " + voice + "</h2>"
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"change volume": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f50a;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What volume should I set?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// change volume
						var volume = remainder
							volume = window.FUNCTION_LIBRARY.getDigits(volume)
						var newVolume = window.FUNCTION_LIBRARY.changeVoiceVolume({volume: volume})

					// failure
						if (newVolume === false) {
							callback({icon: icon, error: true, message: "I don't know that number.", html: "<h2>Error: invalid volume:</h2>" + remainder})
							return
						}

					// success
						var message = "Volume set to " + newVolume + " percent"
						var responseHTML = "<h2>volume: " + newVolume + "%</h2>"
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"change listening duration": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f399;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What duration should I set?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// get duration
						var words = remainder.split(/\s/gi)
						var duration = null
						for (var i in words) {
							words[i] = window.FUNCTION_LIBRARY.getDigits(words[i])
							if (!isNaN(words[i])) {
								duration = Number(words[i])
								break
							}
						}

					// no duration
						if (duration === null) {
							callback({icon: icon, error: true, message: "I don't know that number.", html: "<h2>Error: invalid duration:</h2>" + remainder})
							return
						}

					// change duration
						var newDuration = window.FUNCTION_LIBRARY.changeRecognitionDuration({duration: duration})

					// failure
						if (newDuration === false) {
							callback({icon: icon, error: true, message: "I don't know that number.", html: "<h2>Error: invalid duration:</h2>" + remainder})
							return
						}

					// success
						var message =  "Listening duration set to " + newDuration + (newDuration == 1 ? " second" : " seconds")
						var responseHTML = "<h2>listening duration: " + newDuration + (newDuration == 1 ? " second" : " seconds") + "</h2>"
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"change configuration": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x2699;"

					// no remainder
						remainder = remainder.trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What key and value should I set?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// get key and value
						var pair = remainder.split(/ equal to | equals | to | is | as /gi)
						if (pair[0] === undefined || pair[0] === null || pair[1] === undefined || pair[1] === null) {
							callback({icon: icon, error: true, message: "I'm missing a key or value.", html: "<h2>Error: invalid key or value</h2>"})
							return
						}
						
						var key = String(pair[0]).toLowerCase()
						var value = String(pair[1])

					// try converting to number
						if (!isNaN(Number(value))) {
							value = Number(value)
						}

					// save configuration
						var success = window.FUNCTION_LIBRARY.changeConfiguration({key: key, value: value})

					// failure
						if (!success) {
							callback({icon: icon, error: true, message: "I couldn't set that configuration.", html: "<h2>Error: invalid or missing key and value</h2>"})
							return
						}
					
					// success
						var message = key + " is now " + value
						var responseHTML = "<h2>" + key + " = " + value + "</h2>"
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"authorize platform": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f510;"

					// no remainder
						remainder = remainder.trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What platform should I authorize?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// get credentials
						var credentials = remainder.split(/\s/gi)
						var name = credentials[0].toLowerCase() || ""

					// no platform?
						var platforms = {
							"sonos": {
								host: "api.sonos.com",
								authPath: "/login/v3/oauth?response_type=code&scope=playback-control-all",
								reauthPath: "/login/v3/oauth/access",
								stateSecret: function(key, secret) { return btoa(key + ":" + secret) }
							},
							"wink": {
								host: "api.wink.com",
								authPath: "/oauth2/authorize?response_type=code",
								reauthPath: "/oauth2/token",
								stateSecret: function(key, secret) { return secret }
							},
							"reddit": {
								host: "www.reddit.com",
								authPath: "/api/v1/authorize/?response_type=code&duration=permanent&scope=read",
								reauthPath: "/api/v1/access_token",
								stateSecret: function(key, secret) { return btoa(key + ":" + secret) }
							}
						}

					// failure
						if (!name || !Object.keys(platforms).includes(name)) {
							callback({icon: icon, error: true, message: "I couldn't identify that platform.", html: "<h2>Error: unable to authorize:</h2>" + remainder})
							return
						}

					// host
						var host = platforms[name].host

					// fresh
						if (!window.CONFIGURATION_LIBRARY[host] || !window.CONFIGURATION_LIBRARY[host].refresh_token) {
							// key, secret, redirect
								var key = credentials[1] || window.CONFIGURATION_LIBRARY[name + " key"] || ""
								var secret = credentials[2] || window.CONFIGURATION_LIBRARY[name + " secret"] || ""
								var redirect = credentials[2] || window.CONFIGURATION_LIBRARY[name + " redirect"] || ""

							// missing credentials
								if (!key || !secret || !redirect) {
									callback({icon: icon, error: true, message: "I need a key, a secret, and a redirect to connect to " + name + ".", html: "<h2>Error: missing configurations:</h2>" + remainder + "<br><ul><li>" + name + " key</li><li>" + name + " secret</li><li>" + name + " redirect</li></ul>"})
									return
								}
							
							// generate popup
								var state = encodeURIComponent((window.location.origin + window.location.pathname) + ";;;" + platforms[name].stateSecret(key, secret))
								var url = "https://" + host + platforms[name].authPath + "&client_id=" + key + "&state=" + state + "&redirect_uri=" + encodeURIComponent(redirect)
								var popup = window.open(url, null, "height=500,width=500,status=yes,toolbar=no,menubar=no,location=no")

							// response
								var message = "Complete the authorization flow for " + host
								var responseHTML = "<h2>activating <b>" + host + "</b> in external popup</h2>"
								callback({icon: icon, message: message, html: responseHTML})

							// periodically attempt to fetch authorization from the server
								window.FUNCTION_LIBRARY.fetchPeriodically("getAuthorization", host, function(data) {
									try {
										var value = window.CONFIGURATION_LIBRARY[host] || {}
											value.access_token = data.access_token
											value.refresh_token = data.refresh_token
											value.expiration = new Date().getTime() + (data.expires_in * 1000)
										window.FUNCTION_LIBRARY.changeConfiguration({key: host, value: value})
										
										var responseHTML = "<h2>" + host + " authorized</h2>until " + new Date(CONFIGURATION_LIBRARY[host].expiration).toLocaleString()
										callback({icon: icon, message: "", html: responseHTML})
									}
									catch (error) {}
								})

							// THE BLUEJAY-OAUTH FLOW
								// 1: parse the user response or look in the CONFIGURATION_LIBRARY for the platform's key, secret, and redirect
								// 2: create a popup to the platform's auth screen; the "state" query param includes bluejay url and platform API key and/or secret
								// 3: user goes through and completes the auth flow
								// 4: external platform redirects the popup based the redirect param (currently a Google Apps Script); auth code is a param of this page
								// 5: Google Apps Script logs this and uses the "state" param and the new auth code to generate a bluejay link to /authorization
								// 6: the page auto-redirects to the /authorization url, with an embeddedPost parameter
								// 7: bluejay server interprets this param and sends an API request to external platform with the auth code
								// 8: platform responds with the actual access token (and refresh token)
								// 9: bluejay server saves the results of this to the db, specifically under the user's session id
								// 10: the main window had been requesting this data the whole time, and now it gets a success response
								// 11: bluejay saves these values to CONFIGURATION_LIBRARY and localStorage
								// 12: subsequent Sonos API calls can include the access_token
						}

					// expired
						else if (window.CONFIGURATION_LIBRARY[host] && (!window.CONFIGURATION_LIBRARY[host].expiration || isNaN(window.CONFIGURATION_LIBRARY[host].expiration) || window.CONFIGURATION_LIBRARY[host].expiration < new Date().getTime())) {
							// key, secret, redirect
								var key = credentials[1] || window.CONFIGURATION_LIBRARY[name + " key"] || ""
								var secret = credentials[2] || window.CONFIGURATION_LIBRARY[name + " secret"] || ""
								var refresh_token = window.CONFIGURATION_LIBRARY[host].refresh_token || ""

							// missing credentials
								if (!key || !secret || !refresh_token) {
									callback({icon: icon, error: true, message: "I need a key, a secret, and a refresh token to reconnect to " + name + ".", html: "<h2>Error: unable to reauthorize:</h2>" + remainder + "<br><br><b>required configurations:</b><ul><li>" + name + " key</li><li>" + name + " secret</li><li>" + name + " refresh_token</li></ul>"})
									return
								}
							
							// options
								var url = "https://" + host + platforms[name].reauthPath + "?grant_type=refresh_token&refresh_token=" + refresh_token
								var options = {
									method: "post",
									url: url,
									"Authorization": "Basic " + platforms[name].stateSecret(key, secret),
									"Content-Type": "application/x-www-form-urlencoded;charset=utf-8"
								}

							// proxy request
								window.FUNCTION_LIBRARY.proxyRequest(options, function(data) {
									try {
										// invaild response
											if (!data.access_token) {
												callback({icon: icon, error: true, message: "I couldn't reauthorize " + host, html: "<h2>Error: unable to reauthorize:</h2>" + host})
												return
											}

										// authorization successful
											var value = window.CONFIGURATION_LIBRARY[host]
												value.access_token = data.access_token
												value.refresh_token = data.refresh_token
												value.expiration = new Date().getTime() + (data.expires_in * 1000)
											window.FUNCTION_LIBRARY.changeConfiguration({key: host, value: value})

											var responseHTML = "<h2>" + host + " authorized</h2>until " + new Date(CONFIGURATION_LIBRARY[host].expiration).toLocaleString()
											callback({icon: icon, message: "", html: responseHTML})
									}
									catch (error) {
										callback({icon: icon, error: true, message: "I couldn't reauthorize " + host, html: "<h2>Error: unable to reauthorize:</h2>" + host})
									}
								})
						}

					// already authorized
						else {
							var responseHTML = "<h2>" + host + " authorized</h2>until " + new Date(CONFIGURATION_LIBRARY[host].expiration).toLocaleString()
							callback({icon: icon, message: "", html: responseHTML})
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// time
			"get the time": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f553;"

					// response
						var message = new Date().toLocaleTimeString()
						var responseHTML = "The time is <h2>" + message + "</h2>"
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get the day": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4c5;"

					// response
						var message = (["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][new Date().getDay()])
						var responseHTML = "Today is <h2>" + message + "</h2>"
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get the month": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4c5;"

					// response
						var message = (["January","February","March","April","May","June","July","August","September","October","November","December"][new Date().getMonth()])
						var responseHTML = "The month is <h2>" + message + "</h2>"
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get the date": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4c5;"

					// response
						var message = (["January","February","March","April","May","June","July","August","September","October","November","December"][new Date().getMonth()] + " " + new Date().getDate())
						var responseHTML = "The date is <h2>" + message + "</h2>"
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// alarms
			"set alarm": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x23f0;"

					// no remainder
						remainder = remainder.replace(/[?!.,;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What alarm should I set?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// split into array
						var words = remainder.split(/\s/gi) || []

					// timer
						if ((/second|minute|hour|day|in/gi).test(remainder)) {
							// possible units
								var units = {
									"second": 1000,
									"minute": 1000 * 60,
									"hour": 1000 * 60 * 60,
									"day": 1000 * 60 * 60 * 24
								}

							// identify amounts
								var amounts = []
								for (var i = 0; i < words.length; i++) {
									words[i] = window.FUNCTION_LIBRARY.getDigits(words[i])

									if (!isNaN(words[i])) {
										if (words[i + 1] && units[words[i + 1].replace(/s$/gi,"").toLowerCase()]) {
											amounts.push({
												number: Number(words[i]),
												unit: words[i + 1].replace(/s$/gi,"")
											})
										}
										else {
											amounts.push({
												number: Number(words[i]),
												unit: "minute"
											})
										}
									}
								}

							// sum amounts
								var duration = 0
								for (var i in amounts) {
									duration += (amounts[i].number * units[amounts[i].unit])
								}

							// no duration
								if (!duration) {
									callback({icon: icon, error: true, message: "I was unable to set that timer.", html: "<h2>Error: unable to set timer:</h2>" + response})
									return
								}
							
							// create alarm
								var endTime = new Date().getTime() + duration
								window.CONTEXT_LIBRARY.alarms.push(endTime)

							// response
								var message = "Alarm #" + window.CONTEXT_LIBRARY.alarms.length + " set for " + new Date(endTime).toLocaleTimeString()
								var responseHTML = "<h2>alarm #" + window.CONTEXT_LIBRARY.alarms.length + ": <b>" + new Date(endTime).toLocaleString() + "</b></h2>"
								callback({icon: icon, message: message, html: responseHTML})
						}

					// alarm
						else {
							// identify endtime
								var timePhrase = remainder.replace(/in|at|for|after|before|around/gi,"").toLowerCase().trim()
									timePhrase = timePhrase.replace("p.m.", "PM").replace("pm", "PM").replace("a.m.", "AM").replace("am", "AM")
								var endTime = new Date(timePhrase).getTime() || new Date(new Date().toDateString() + " " + timePhrase).getTime()
							
							// invalid endTime
								if (isNaN(endTime)) {
									callback({icon: icon, error: true, message: "I was unable to set that alarm.", html: "<h2>Error: unable to set alarm:</h2>" + remainder})
									return
								}
							
							// in the past? 12 hours ahead
								if (!timePhrase.includes("PM") && !timePhrase.includes("AM") && new Date().getTime() < endTime + (1000 * 60 * 60 * 12)) {
									endTime = endTime + (1000 * 60 * 60 * 12)
								}

							// in the past & am/pm specified? 24 hours ahead
								else if (new Date().getTime() < endTime + (1000 * 60 * 60 * 24)) {
									endTime = endTime + (1000 * 60 * 60 * 24)
								}

							// add alarm
								window.CONTEXT_LIBRARY.alarms.push(endTime)

							// response
								var message = "Alarm #" + window.CONTEXT_LIBRARY.alarms.length + " set for " + new Date(endTime).toLocaleTimeString()
								var responseHTML = "<h2>alarm #" + window.CONTEXT_LIBRARY.alarms.length + ": <b>" + new Date(endTime).toLocaleString() + "</b></h2>"
								callback({icon: icon, message: message, html: responseHTML})
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"cancel alarm": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x23f0;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What alarm should I cancel?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// split into array
						var words = remainder.split(/\s/gi) || []

					// index
						var index = null
						for (var i in words) {
							words[i] = window.FUNCTION_LIBRARY.getDigits(words[i])
							if (!isNaN(words[i])) {
								index = Number(words[i])
								break
							}
						}

					// no index?
						if (index === null) {
							callback({icon: icon, error: true, message: "I was unable to find that alarm.", html: "<h2>Error: unable to cancel alarm:</h2>" + remainder})
							return
						}

					// cancel alarm
						var time = new Date(window.CONTEXT_LIBRARY.alarms[index - 1]).toLocaleString()
						window.CONTEXT_LIBRARY.alarms[index - 1] = null

					// response
						var message = "I cancelled alarm #" + index + ", which was set for " + time + "."
						var responseHTML = "<h2>cancelled alarm #" + index + ": <b>" + time + "</b></h2>"
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"cancel all alarms": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x23f0;"

					// empty alarms array
						window.CONTEXT_LIBRARY.alarms = []

					// response
						var message = "I turned off all alarms."
						var responseHTML = "<h2>all alarms cancelled</h2>"
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// rng
			"roll dice": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f3b2;"

					// defaults
						remainder = " " + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						var count = 1
						var sides = 6

					// X dice with Y sides format
						if (remainder.includes("side") || remainder.includes("face")) {
							var count = Number(window.FUNCTION_LIBRARY.getDigits(remainder.split(/ dice with | die with | dice having /gi)[0])) || 1
							var sides = Number(window.FUNCTION_LIBRARY.getDigits((remainder.split(/ dice with | die with | dice having /gi)[1] || "").replace(/sides/gi,"").replace(/faces/gi,"").replace(/side/gi,"").replace(/face/gi,"")))
						}

					// XdY format
						else {
							var count = Number(window.FUNCTION_LIBRARY.getDigits(remainder.split(/d/gi)[0])) || 1
							var sides = Number(remainder.split(/d/gi)[1])
						}

					// roll dice
						var sum = 0
						for (var i = 0; i < count; i++) {
							sum += Math.floor(Math.random() * sides) + 1
						}

					// no sum?
						if (!sum || isNaN(sum)) {
							callback({icon: icon, error: true, message: "I couldn't roll those dice.", html: "<h2>Error: invalid dice:</h2>" + remainder})
							return
						}

					// return sum
						var message = sum
						var responseHTML = "<h2>" + count + "d" + sides + ": " + sum + "</h2>"
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"flip a coin": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f3b2;"

					// response
						var message = window.FUNCTION_LIBRARY.chooseRandom(["heads","tails"])
						var responseHTML = "<h2>coin: " + message + "</h2>"
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"consult the magic 8 ball": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f3b1;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What are you asking?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// possible options
						var options = ["It is certain", "It is decidedly so", "Without a doubt", "Yes - definitely", "You may rely on it", "As I see it, yes", "Most likely", "Outlook good", "Yes", "Signs point to yes", "Don't count on it", "My reply is no", "My sources say no", "Outlook not so good", "Very doubtful", "Reply hazy, try again", "Ask again later", "Better not tell you now", "Cannot predict now", "Concentrate and ask again"]

					// response
						var message = window.FUNCTION_LIBRARY.chooseRandom(options)
						var responseHTML = remainder + "<h2>" + message + "</h2>"
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
		
		// math
			"calculate": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x00b1;"

					// no remainder
						remainder = remainder.replace(/[?!,:;'"_\$]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I calculate?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// loop through and identify terms
						var terms = remainder.split(/\s/gi)
						for (var i = 0; i < terms.length; i++) {
							if (isNaN(terms[i])) {
								terms[i] = terms[i].toLowerCase()
									 if (terms[i] == "that") 	{ terms[i] = Number(window.CONTEXT_LIBRARY.lastResponseNumber) || 0 }
								else if (terms[i] == "by")      { terms[i] = "" }
								else if (terms[i] == "of")      { terms[i] = "" }
								else if (terms[i] == "plus")    { terms[i] = "+" }
								else if (terms[i] == "minus")   { terms[i] = "-" }
								else if (terms[i] == "times")   { terms[i] = "*" }
								else if (terms[i] == "divided") { terms[i] = "/" }
								else if (terms[i] == "squared") { terms[i] = "** 2" }
								else if (terms[i] == "cubed")   { terms[i] = "** 3" }
								else if (terms[i] == "halved")  { terms[i] = "/ 2" }
								else if (terms[i] == "power")   { terms[i] = "**" }
								else if (terms[i] == "root")    { terms[i] = "** (1/"; terms.splice(i + 2, 0, ")")}
								else if (terms[i] == "%") 		{ terms[i] = "/ 100 *"}
								else if (terms[i] == "percent") { terms[i] = "/ 100 *"}
								else if (["+","-","*","/","(",")","**"].includes(terms[i])) {}
								else {
									terms[i] = window.FUNCTION_LIBRARY.getDigits(terms[i])
									if (isNaN(terms[i])) {
										terms[i] = "'" + terms[i] + "'"
									}
								}
							}
							else {
								terms[i] = Number(terms[i])
							}
						}

					// evaluate
						var result = eval(terms.join(" "))

					// not a number?
						if (isNaN(result)) {
							callback({icon: icon, error: true, message: "I couldn't perform that calculation.", html: "<h2>Error: invalid calculation:</h2>" + remainder})
							return
						}
					
					// response
						var message = Number(result)
						var responseHTML = "<h2>" + terms.join(" ") + " = <b>" + result + "</b></h2>"
						callback({icon: icon, message: message, html: responseHTML, number: Number(result)})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"double": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x00b1;"

					// no remainder
						remainder = remainder.replace(/[?!,:;'"_\$]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I calculate?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// identify multiplier
						var term = window.FUNCTION_LIBRARY.getDigits(remainder)
						if (term == "that") {
							term = Number(window.CONTEXT_LIBRARY.lastResponseNumber)
						}

					// multiply
						var result = 2 * Number(term)

					// not a number?
						if (isNaN(result)) {
							callback({icon: icon, error: true, message: "I couldn't double that number.", html: "<h2>Error: invalid multiplier</h2>"})
							return
						}
					
					// response
						var message = Number(result)
						var responseHTML = "<h2>2 * " + term + " = <b>" + result + "</b></h2>"
						callback({icon: icon, message: message, html: responseHTML, number: Number(result)})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"triple": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x00b1;"

					// no remainder
						remainder = remainder.replace(/[?!,:;'"_\$]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I calculate?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// identify multiplier
						var term = window.FUNCTION_LIBRARY.getDigits(remainder)
						if (term == "that") {
							term = Number(window.CONTEXT_LIBRARY.lastResponseNumber)
						}

					// multiply
						var result = 3 * Number(term)

					// not a number?
						if (isNaN(result)) {
							callback({icon: icon, error: true, message: "I couldn't triple that number.", html: "<h2>Error: invalid multiplier</h2>"})
							return
						}
					
					// response
						var message = Number(result)
						var responseHTML = "<h2>3 * " + term + " = <b>" + result + "</b></h2>"
						callback({icon: icon, message: message, html: responseHTML, number: Number(result)})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"average": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x00b1;"

					// no remainder
						remainder = remainder.replace(/[?!,:;'"_\$]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I calculate?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// loop through to identify terms
						var terms = remainder.split(/\s/gi)
						var numbers = []
						for (var i = 0; i < terms.length; i++) {
							terms[i] = window.FUNCTION_LIBRARY.getDigits(terms[i].toLowerCase().trim())

							if (terms[i] == "that") {
								terms[i] = Number(window.CONTEXT_LIBRARY.lastResponseNumber)
							}

							if (!isNaN(terms[i])) {
								numbers.push(Number(terms[i]))
							}
						}

					// sum terms, then divide
						var result = numbers.reduce(function(total, term) {
							return (total + term)
						}) / (numbers.length || 1)

					// not a number?
						if (isNaN(result)) {
							callback({icon: icon, error: true, message: "I couldn't find the average.", html: "<h2>Error: invalid calculation</h2>"})
							return
						}
					
					// response
						var message = Number(result)
						var responseHTML = "<h2>" + numbers.join(" + ") + " / " + numbers.length + " = <b>" + result + "</b></h2>"
						callback({icon: icon, message: message, html: responseHTML, number: Number(result)})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"count": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x2673;"

					// remainder
						remainder = " " + remainder.replace(/[?!,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()

					// startNumber
						var startNumber = remainder.split(/ up from | down from | from | starting at | start at | between | for /gi)
							startNumber = (startNumber[1] || startNumber[0]).split(/ and go to | and go until | up to | down to | to | until | ending at | end at | and | through /gi)[0].trim()
							startNumber = window.FUNCTION_LIBRARY.getDigits(startNumber)
						if (startNumber == "that") { startNumber = Number(window.CONTEXT_LIBRARY.lastResponseNumber) }
						if (!startNumber || isNaN(startNumber)) { startNumber = 1 }

					// end number
						var endNumber = remainder.split(/ and go to | and go until | up to | down to | to | until | ending at | end at | and | through /gi)
							endNumber = (endNumber[1] || endNumber[0]).split(/ up from | down from | starting at | start at | between | for /gi)[0].trim()
							endNumber = window.FUNCTION_LIBRARY.getDigits(endNumber)
						if (endNumber == "that") { endNumber = Number(window.CONTEXT_LIBRARY.lastResponseNumber) }
						if (!endNumber || isNaN(endNumber)) { endNumber = 100 }

					// up or down
						var list = []
						if (startNumber <= endNumber) {
							for (var i = startNumber; i <= endNumber; i++) {
								list.push(i)
							}
						}
						else {
							for (var i = startNumber; i >= endNumber; i--) {
								list.push(i)
							}
						}

					// message
						var message = list.join("... ")
						var responseHTML = "<h2>counting from <b>" + String(startNumber) + "</b> to <b>" + String(endNumber) + "</b></h2>"
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// words
			"spell word": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4dd;"

					// no remainder
						remainder = remainder.replace(/[?!,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I spell?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// get letters
						var word = remainder.toUpperCase()
						var letters = word.split("")

					// response
						var message = word + "... " + letters.join(", ")
						var responseHTML = "<h2>" + letters.join(" - ") + "</h2>"
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},			
			"find rhymes": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4da;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// options
						var options = {
							url: "https://api.datamuse.com/words?rel_rhy=" + remainder
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// construct response list
									var list = response || []
									var listItems = []
									for (var i in list) {
										list[i] = list[i].word
										listItems[i] = "<li>" + list[i] + "</li>"
									}

								// message & link
									var message = "I found " + list.length + " rhyme" + (list.length == 1 ? "" : "s") + " for " + remainder + ". " + list.join(",")
									var responseHTML = "<a target='_blank' href='https://rhymezone.com/r/rhyme.cgi?typeofrhyme=perfect&Word=" + remainder + "'><h2>" + remainder + "</h2></a>" +
										"<ul>" + listItems.join("") + "</ul>"

								// response
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I couldn't rhyme that.", html: "<h2>Error: unable to access rhymes</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"find synonyms": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4da;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// options
						var options = {
							url: "https://api.datamuse.com/words?rel_syn=" + remainder
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// construct response list
									var list = response || []
									var listItems = []
									for (var i in list) {
										list[i] = list[i].word
										listItems[i] = "<li>" + list[i] + "</li>"
									}

								// message & link
									var message = "I found " + list.length + " synonym" + (list.length == 1 ? "" : "s") + " for " + remainder + ". " + list.join(",")
									var responseHTML = "<a target='_blank' href='https://rhymezone.com/r/rhyme.cgi?typeofrhyme=syn&Word=" + remainder + "'><h2>" + remainder + "</h2></a>" +
										"<ul>" + listItems.join("") + "</ul>"

								// response
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I don't know any synonyms for that.", html: "<h2>Error: unable to access synonyms</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"find definition": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4da;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// options
						var options = {
							url: "https://api.datamuse.com/words?md=d&sp=" + remainder
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// construct response list
									var word = response[0]
									var list = []
									var listItems = []
									for (var i in word.defs) {
										word.defs[i] = "[" + word.defs[i].replace(/\t/,"] ")
										word.defs[i] = word.defs[i].replace("[n]", "[noun]").replace("[v]", "[verb]").replace("[adj]", "[adjective]").replace("[adv]", "[adverb]").replace("[u]", "[other]")
										list[i] = word.defs[i]
										listItems[i] = "<li>" + word.defs[i] + "</li>"
									}

								// message & link
									var message = "I found " + list.length + " definition" + (list.length == 1 ? "" : "s") + " for " + remainder + ". " + list.join(",")
									var responseHTML = "<a target='_blank' href='http://wordnetweb.princeton.edu/perl/webwn?s=" + remainder + "'><h2>" + remainder + "</h2></a>" + 
										"<ul>" + listItems.join("") + "</ul>"

								// response
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I couldn't define that.", html: "<h2>Error: unable to access definitions</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"find etymology": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4da;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// options
						var word = remainder
						var options = {
							asIs: true,
							url: "https://www.etymonline.com/word/" + word
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// put response in a temporary element
									var temporaryElement = document.createElement("div")
										temporaryElement.innerHTML = response

								// get objects
									var words = []
									var objects = Array.from(temporaryElement.querySelectorAll(".word--C9UPa object"))

								// no objects
									if (!objects || !objects.length) {
										callback({icon: icon, error: true, message: "I couldn't find the etymology of " + word, html: "<h2>Error: no etymology found:</h2>" + word})
										return
									}
								
								// loop through objects to extract relevant information
									for (var i in objects) {
										// get title --> word & part of speech
											var objectTitle = objects[i].querySelector(".word__name--TTbAA").innerText.split("(")
											var objectWord = (objectTitle[0] || "").trim()
											var objectPartOfSpeech = objectTitle[1] || ""
											if (objectPartOfSpeech) {
												objectPartOfSpeech = objectPartOfSpeech.split(")")[0] || ""
												objectPartOfSpeech = objectPartOfSpeech.replace("n.", "noun").replace("v.", "verb").replace("adj.", "adjective").replace("adv.", "adverb").replace("prep.", "preposition").replace(/[0-9]/gi, "").trim()
											}
										
										// get paragraphs --> history
											var objectHistory = []
											var objectParagraphs = objects[i].querySelectorAll(".word__defination--2q7ZH p")
											for (var j in objectParagraphs) {
												objectHistory.push(objectParagraphs[j].innerText)
											}

										// package into an object
											words.push({
												word: objectWord,
												partOfSpeech: objectPartOfSpeech,
												history: objectHistory
											})
									}

								// message & list
									var message = "I found " + words.length + (words.length == 1 ? " etymology... " : " etymologies... ") + (words.length ? words.map(function(entry) { return entry.word + ", " + entry.partOfSpeech + "... " + entry.history.join(" ... ") }).join(" ... ... ") : "")
									var responseHTML = "<a target='_blank' href='https://www.etymonline.com/word/" + remainder + "'><h2>" + word + "</h2></a>" +
										(words.length ? ("<ul><li>" + words.map(function(entry) { return "<h3>" + entry.word + (entry.partOfSpeech ? (" (" + entry.partOfSpeech + ")") : "") + "</h3><p>" + entry.history.join("</p><p>") + "</p>" }).join("</li><li>") + "</li></ul>") : "")

								// response
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I couldn't find the etymology of that.", html: "<h2>Error: unable to access etymonline</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// content API fetches
			"get a joke": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f0cf;"

					// options
						var options = {
							url: "https://icanhazdadjoke.com/slack"
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// response
									var message = response.attachments[0].text
									var responseHTML = "<a target='_blank' href='https://icanhazdadjoke.com'><h2>" + response.attachments[0].text + "</h2></a>"
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I don't know any jokes.", html: "<h2>Error: unable to access jokes</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get a quote": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f399;"

					// options
						var options = {
							url: "http://api.forismatic.com/api/1.0/?method=getQuote&format=json&lang=en"
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// missing quote or author
									if (!response.quoteText || !response.quoteAuthor) {
										callback({icon: icon, error: true, message: "I was unable to get any quotes.", html: "<h2>Error: unable to access quotes</h2>"})
										return
									}

								// quote link, text, author
									var quoteLink   = response.quoteLink
									var quoteText   = response.quoteText
									var quoteAuthor = response.quoteAuthor

								// response
									var message = quoteAuthor + " said... " + quoteText
									var responseHTML = "<a target='_blank' href='" + quoteLink + "'><h2>\"" + quoteText + "\" - " + quoteAuthor + "</h2></a>"
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, message: "I don't know any quotes.", html: "unable to access quotes"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get a fortune": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4dc;"

					// options
						var options = {
							url: "https://fortunecookieapi.herokuapp.com/v1/fortunes?limit=1000&skip=0&page=1"
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// fortunes
									var fortunes = window.FUNCTION_LIBRARY.sortRandom(response)

								// all results
									var results = []
									for (var i in fortunes) {
										var message = fortunes[i].message
										var responseHTML = "<a target='_blank' href='https://fortunecookieapi.herokuapp.com/'><h2>" + fortunes[i].message + "</h2></a>"
										results.push({icon: icon, message: message, html: responseHTML})
									}

								// send response
									var firstResult = results.shift()
									callback({icon: icon, message: firstResult.message, html: firstResult.html, results: results})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I don't know any fortunes.", html: "<h2>Error: unable to access fortunes</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get an insult": function(remainder, callback) {
				try {
					// icon
						var icon = "&#128293;"

					// options
						var options = {
							url: "https://jokes.guyliangilsing.me/retrieveJokes.php?type=yomama"
						}

					// proxy request
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// response
									var message = response.joke
									var responseHTML = "<h2>" + response.joke + "</h2>"
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon, icon, error: true, message: "I don't know any insults.", html: "<h2>Error: unable to access insults</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get a wikipedia entry": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f310;"

					// attempt counter
						if (!window.CONTEXT_LIBRARY["wikipedia attempt counter"]) {
							window.CONTEXT_LIBRARY["wikipedia attempt counter"] = 1
						}

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// options
						var options = {
							url: "https://en.wikipedia.org/w/api.php?action=query&format=json&list=search&utf8=1&srsearch=" + remainder
						}

					// proxy to server --> search
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							// invalid response
								if (!response || !response.query || !response.query.search || !response.query.search[0]) {
									// too busy (fewer than 5 attempts)
										if (response.error && response.error.code == "cirrussearch-too-busy-error" && window.CONTEXT_LIBRARY["wikipedia attempt counter"] < 5) {
											callback({icon: icon, message: "Wikipedia was too busy. Trying again.", html: "attempt #" + window.CONTEXT_LIBRARY["wikipedia attempt counter"] + " <b>" + remainder + "</b> on Wikipedia<br><br>Wikipedia was too busy. Trying again."})

											window.CONTEXT_LIBRARY["wikipedia attempt counter"]++
											window.ACTION_LIBRARY["get a wikipedia entry"](remainder, callback)

											return
										}

									// other error
										callback({icon: icon, error: true, message: "I couldn't find " + remainder + " on Wikipedia.", html: "<h2>Error: unable to access Wikipedia</h2>"})
										return
								}
							
							// options
								var options = {
									url: "https://en.wikipedia.org/w/api.php?action=parse&format=json&utf8=1&page=" + response.query.search[0].title
								}

							// proxy to server --> display full page
								window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
									try {
										// too busy (fewer than 5 attempts)
											if (response.error && response.error.code == "cirrussearch-too-busy-error" && window.CONTEXT_LIBRARY["wikipedia attempt counter"] < 5) {
												callback({icon: icon, message: "Wikipedia was too busy. Trying again.", html: "attempt #" + window.CONTEXT_LIBRARY["wikipedia attempt counter"] + " <b>" + remainder + "</b> on Wikipedia<br><br>Wikipedia was too busy. Trying again."})

												window.CONTEXT_LIBRARY["wikipedia attempt counter"]++
												window.ACTION_LIBRARY["get a wikipedia entry"](remainder, callback)

												return
											}
									
										// get text
											var responseHTML = response.parse.text["*"]
												responseHTML = responseHTML.split('id="References">References')[0]
												responseHTML = responseHTML.split('id="See_also">See also')[0]
												responseHTML = responseHTML.replace(/\<a href='\//gi, "<a target='_blank' href='https://en.wikipedia.org/")
												responseHTML = responseHTML.replace(/\<a href="\//gi, '<a target="_blank" href="https://en.wikipedia.org/')

											var messageNode = document.createElement("div")
												messageNode.innerHTML = responseHTML.replace(/<table[\s\S]*?>[\s\S]*?<\/table>/gi,"")
											var message = messageNode.innerText
												message = message.replace(/\[[0-9]+\]/gi, "")
												message = message.replace(/\[edit\]/gi,"")
											
										// response
											responseHTML = "<a target='_blank' href='https://en.wikipedia.org/?curid=" + response.parse.pageid + "'><h2>" + response.parse.title + "</h2></a>" + responseHTML
											callback({icon: icon, message: message, html: responseHTML})

										// reset counter
											window.CONTEXT_LIBRARY["wikipedia attempt counter"] = 0
									}
									catch (error) {
										callback({icon: icon, error: true, message: "I couldn't find " + remainder + " on Wikipedia.", html: "<h2>Error: unable to access Wikipedia</h2>"})
									}
								})
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get this day in history": function(remainder, callback) {
				try {
					// get day
						var today = ["January","February","March","April","May","June","July","August","September","October","November","December"][new Date().getMonth()] + "_" + new Date().getDate()

					// proxy to wikipedia action
						window.ACTION_LIBRARY["get a wikipedia entry"](today, callback)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get the weather": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x26c8;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["open weather api"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for open weather api.", html: "<h2>Error: missing configuration:</h2><li>open weather api</li>"})
							return
						}

					// remainder
						remainder = " " + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()

					// locale
						if (remainder) {
							var locale = remainder.replace(/ in | at | for | inside /gi,"").trim() || window.CONFIGURATION_LIBRARY["city"] || window.CONFIGURATION_LIBRARY["zip code"] || null
						}
						else {
							var locale = window.CONFIGURATION_LIBRARY["city"] || window.CONFIGURATION_LIBRARY["zip code"] || null
						}

					// no locale
						if (!locale) {
							window.CONTEXT_LIBRARY.flow = "get the weather"
							window.CONTEXT_LIBRARY["get the weather"] = {
								locale: null
							}

							callback({icon: icon, error: true, message: "What city should I get the weather for?", html: "What <b>city</b> should I get the weather for?"})
							return
						}
					
					// options
						var options = {
							url: "https://api.openweathermap.org/data/2.5/forecast?appid=" + window.CONFIGURATION_LIBRARY["open weather api"] + (isNaN(locale) ? ("&q=" + locale) : "&zip=" + locale) + ",us&mode=json&units=imperial"
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// invalid response
									if (!response || !response.city || !response.list) {
										callback({icon: icon, error: true, message: "I was unable to get the weather.", html: "<h2>Error: unable to access weather</h2>"})
										return
									}

								// days of the week
									var allDays = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]

								// axes
									var dayColumns = []
									var timeRows = []
									for (var l in response.list) {
										var segment = response.list[l]
										var date = new Date(response.list[l].dt_txt + " UTC")
										
										segment.day = allDays[new Date(date).getDay()]
										if (dayColumns[dayColumns.length - 1] !== segment.day) {
											dayColumns.push(segment.day)
										}
										
										segment.time = date.toLocaleTimeString()
										if (!timeRows.includes(segment.time)) {
											timeRows.push(segment.time)
										}

										segment.cell = "<td>" + segment.main.temp + "°F<br><br>" + (segment.weather ? segment.weather[0].description : "clear") + "</td>"
									}

								// sort times
									timeRows.sort(function(a,b) {
										a = a.replace(/\:/g,"")
										b = b.replace(/\:/g,"")
										if (a.toLowerCase().includes("pm")) { a = Number(a.replace(/pm/gi,"")) % 120000 + 120000 } else { a = Number(a.replace(/am/gi, "")) % 120000 }
										if (b.toLowerCase().includes("pm")) { b = Number(b.replace(/pm/gi,"")) % 120000 + 120000 } else { b = Number(b.replace(/am/gi,"")) % 120000 }
										return a - b
									})

								// grid
									var grid = {}
									for (var t in timeRows) {
										grid[timeRows[t]] = {}
										grid[timeRows[t]].time = "<td>" + timeRows[t] + "</td>"
										for (var d in dayColumns) {
											grid[timeRows[t]][dayColumns[d]] = "<td> - </td>"
										}
									}

									for (var l in response.list) {
										var data = response.list[l]
										grid[data.time][data.day] = data.cell
									}

								// draw table
									var heading = "<tr><th>&#128339;</th>"
									for (var d in dayColumns) {
										heading += ("<th>" + dayColumns[d] + "</th>")
									}
									heading += "</tr>"

									var table = "<table><tbody>" + heading
									for (var y in grid) {
										var row = "<tr>"
										for (var x in grid[y]) {
											row += grid[y][x]
										}
										row += "</tr>"
										table += row
									}
									table += "</tbody></table>"

								// current weather
									var currentTemperature = "unknown"
									var currentWeather = "unknown"

								// get locale, conditions, message, link
									var locale = response.city.name + ", " + response.city.country
									var conditions = "Right now it's " + response.list[0].main.temp + " degrees and " + (response.list[0].weather ? response.list[0].weather[0].description : "clear")
									var message = "Here's the weather for " + locale + "." + conditions
									var responseHTML = "<a target='_blank' href='https://openweathermap.org/find?q=" + locale + "'><h2>weather in <b>" + locale + "</b></h2></a>" + table

								// response
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get the weather for " + remainder, html: "<h2>Error: unable to access the weather for that location:</h2>" + remainder})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get nutrition facts": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f34e;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["spoonacular api"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for spoonacular api.", html: "<h2>Error: missing configuration:</h2><li>spoonacular api</li>"})
							return
						}

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// options
						var options = {
							url: "https://api.spoonacular.com/recipes/guessNutrition?apiKey=" + window.CONFIGURATION_LIBRARY["spoonacular api"] + "&title=" + remainder
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// invalid response
									if (!response.calories) {
										callback({icon: icon, error: true, message: "I was unable to get nutrition facts for " + remainder, html: "<h2>Error: unable to get nutrition facts:</h2>" + remainder})
										return
									}

								// get nutrition info
									var calories 	= response.calories.value 	+ " " + response.calories.unit
									var carbs 		= response.carbs.value 		+ " " + response.carbs.unit
									var fat 		= response.fat.value 		+ " " + response.fat.unit
									var protein 	= response.protein.value 	+ " " + response.protein.unit

								// construct response
									var message = "Here's what I found for " + remainder + "... " + calories + "; " + carbs + " of carbs; " + fat + " of fat; " + protein + " of protein"
									var responseHTML = "<h2>" + remainder + "</h2>" + "<li><b>calories:</b> " + calories + "</li>" + "<li><b>carbs:</b> " + carbs + "</li>" + "<li><b>fat:</b> " + fat + "</li>" + "<li><b>protein:</b> " + protein + "</li>"

								// send response
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get nutrition facts for " + remainder, html: "<h2>Error: unable to get nutrition facts:" + remainder})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get nutrition answer": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f34e;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["spoonacular api"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for spoonacular api.", html: "<h2>Error: missing configuration:</h2><li>spoonacular api</li>"})
							return
						}

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// options
						var options = {
							url: "https://api.spoonacular.com/recipes/quickAnswer?apiKey=" + window.CONFIGURATION_LIBRARY["spoonacular api"] + "&q=" + remainder
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// invalid answer
									if (!response.answer) {
										callback({icon: icon, error: true, message: "I was unable to get a nutrition answer about " + remainder, html: "<h2>Error: unable to get a nutrition answer:</h2>" + remainder})
										return
									}
								
								// respond with answer
									var message = response.answer
									var responseHTML = "<h2>" + response.answer + "</h2>"
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get a nutrition answer about " + remainder, html: "<h2>Error: unable to get a nutrition answer:</h2>" + remainder})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"search goodreads": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4da;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["goodreads api"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for goodreads api.", html: "<h2>Error: missing configuration:</h2><li>goodreads api</li>"})
							return
						}

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// options
						var options = {
							url: "https://www.goodreads.com/search.xml?key=" + window.CONFIGURATION_LIBRARY["goodreads api"] + "&q=" + remainder
						}

					// proxy request - have your people talk to my people
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// get a list of books
									var books = response.GoodreadsResponse.search.results.work

									if (!Array.isArray(books)) {
										books = [books]
									}
								
								// loop through all results
									var results = []
									for (var i in books) {
										// get info
											var coverImage = books[i].best_book.image_url
											var title = books[i].best_book.title.replace(/\&amp\;/gi, "&")
											var author = books[i].best_book.author.name.replace(/\&amp\;/gi, "&")
											var rating = (typeof books[i].average_rating == "number") ? books[i].average_rating : null
											var url = "https://www.goodreads.com/book/show/" + books[i].best_book.id._

										// construct publication date
											if (books[i].original_publication_month._ && books[i].original_publication_day._ && books[i].original_publication_year._) {
												var publicationDate = ["January","February","March","April","May","June","July","August","September","October","November","December"][books[i].original_publication_month._ - 1] + " " + books[i].original_publication_day._ + ", " + books[i].original_publication_year._
											}
											else if (books[i].original_publication_month._ && books[i].original_publication_year._) {
												var publicationDate = ["January","February","March","April","May","June","July","August","September","October","November","December"][books[i].original_publication_month._ - 1] + " " + books[i].original_publication_year._
											}
											else if (books[i].original_publication_year._) {
												var publicationDate = books[i].original_publication_year._
											}
											else {
												var publicationDate = null
											}

										// table
											var responseHTML = "<table>" +
												"<tr><th rowspan='4'><img src='" + coverImage + "'></th><td><a target='_blank' href='" + url + "'><h2>" + title + "</h2></a></td></tr>" + 
												"<tr>" + 								"<td>" + author + "</td></tr>" +
												"<tr>" + 								"<td>" + (publicationDate || "---") + "</td></tr>" +
												"<tr>" + 								"<td>&#x2b50; " + (rating || "???") + "</td></tr>" +
											"</table>"

										// message
											var message = title + " by " + author +
												(publicationDate ? (" was published " + publicationDate) : "") +
												(publicationDate && rating ? " and" : "") +
												(rating ? (" has an average rating of " + rating + " star" + (rating == 1 ? "" : "s")) : "")

										// add to results array
											results.push({
												icon: icon,
												message: message,
												html: responseHTML
											})
									}

								// display first result
									var firstResult = results.shift()
									callback({icon: icon, message: firstResult.message, html: firstResult.html, results: results})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I couldn't find that book.", html: "<h2>Error: unable to access goodreads</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// news & blogs
			"get the latest post": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f5de;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// built-in feeds
						var feeds = {
							"bbc": "http://feeds.bbci.co.uk/news/rss.xml",
							"the bbc": "http://feeds.bbci.co.uk/news/rss.xml",
							"wired": "https://www.wired.com/feed/rss",
							"onion": "https://www.theonion.com/rss",
							"the onion": "https://www.theonion.com/rss",
							"fivethirtyeight": "https://fivethirtyeight.com/all/feed",
							"five thirtyeight": "https://fivethirtyeight.com/all/feed",
							"five thirty eight": "https://fivethirtyeight.com/all/feed",
							"538": "https://fivethirtyeight.com/all/feed",
							"science news": "https://sciencenews.org/feed",
							"anagram times": "https://www.anagramtimes.com/feeds/posts/default",
							"the anagram times": "https://www.anagramtimes.com/feeds/posts/default",
							"the muse": "https://www.themuse.com/feeds/rss",
							"new york times": "https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml",
							"the new york times": "https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml",
							"new york times": "https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml",
							"ny times": "https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml",
							"the ny times": "https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml",
							"nytimes": "https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml",
							"mcsweeneys": "https://www.mcsweeneys.net/rss",
						}

					// missing config?
						if (!feeds[remainder] && !window.CONFIGURATION_LIBRARY[remainder]) {
							callback({icon: icon, error: true, message: "I'm not subscribed to that feed yet.", html: "<h2>Error: missing feed:</h2><li>" + remainder + "</li>"})
							return
						}

					// options
						var options = {
							asIs: true,
							url: feeds[remainder] || window.CONFIGURATION_LIBRARY[remainder]
						}

					// proxy request
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// get list (json)
									try {
										var list = JSON.parse(response)
										var json = true
									}

								// get list (xml)
									catch (error) {
										var rssDoc = new DOMParser().parseFromString(response, "text/xml")
										var list = rssDoc.querySelectorAll("channel item")
										if (!list.length) {
											var list = rssDoc.querySelectorAll("entry")
										}
										var json = false
									}

								// no list
									if (!list) {
										callback({icon: icon, error: true, message: "I couldn't parse that feed.", html: "<h2>Error: unparseable feed:</h2><li>" + remainder + "</li>"})
										return
									}

								// loop through all entries
									var entries = []
									for (var i in list) {
										if (typeof list[i] == "object") {
											// json
												if (json) {
													var url = list[i].url || list[i].link
													var title = list[i].title
													var author = list[i].author || list[i].writer
													var date = list[i].date || list[i].pubDate || list[i].publication
													var text = list[i].text || list[i].content || list[i].description
												}

											// xml
												else {
													var url = (list[i].querySelector("url") ? list[i].querySelector("url").innerHTML.replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, "") : null)
														|| (list[i].querySelector("link[type='text/html']") ? list[i].querySelector("link[type='text/html']").getAttribute("href") : null)
														|| (list[i].querySelector("link") ? list[i].querySelector("link").innerHTML.replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, "") : null)

													var title = (list[i].querySelector("title") ? list[i].querySelector("title").innerHTML.replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, "") : null)

													var author = (list[i].querySelector("author name") ? list[i].querySelector("author name").innerHTML.replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, "") : null)
														|| (list[i].querySelector("author") ? list[i].querySelector("author").innerHTML.replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, "") : null)
														|| (list[i].getElementsByTagNameNS("*", "creator").length ? list[i].getElementsByTagNameNS("*", "creator")[0].innerHTML.replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, "") : null)
														|| (list[i].getElementsByTagNameNS("*", "contributor").length ? list[i].getElementsByTagNameNS("*", "contributor")[0].innerHTML.replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, "") : null)

													var date = (list[i].querySelector("date") ? list[i].querySelector("date").innerHTML.replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, "") : null)
														|| (list[i].querySelector("pubDate") ? list[i].querySelector("pubDate").innerHTML.replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, "") : null)
														|| (list[i].querySelector("published") ? list[i].querySelector("published").innerHTML.replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, "") : null)

													var text = (list[i].querySelector("text") ? list[i].querySelector("text").innerHTML.replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, "") : null)
														|| (list[i].getElementsByTagNameNS("*", "encoded").length ? list[i].getElementsByTagNameNS("*", "encoded")[0].innerHTML .replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, ""): null)
														|| (list[i].querySelector("description") ? list[i].querySelector("description").innerHTML.replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, "") : null)
														|| (list[i].querySelector("content") ? list[i].querySelector("content").innerHTML .replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, ""): null)
												}
											
											// entry
												entries.push({
													url: url || null,
													title: title || "untitled",
													author: author || null,
													date: date ? new Date(date) : null,
													text: text || null
												})
										}
									}
									entries = entries.sort(function(a,b) { return new Date(b.date).getTime() - new Date(a.date).getTime() })

								// loop through all results
									var results = []
									for (var i in entries) {
										if (entries[i].text) {
											// clean up
												entries[i].text = entries[i].text.replace(/&amp;/gi, "&").replace(/&#8217;/gi, "'").replace(/\&lt\;/gi, "<").replace(/\&gt\;/gi, ">").replace(/srcset\=/gi, "data-srcset=").replace(/\<a href\=/gi, "<a target='_blank' href=")

											// message
												var textNode = document.createElement("div")
													textNode.innerHTML = entries[i].text.replace(/\n/gi, " ... ").replace(/\<script[^>]*\>(.*?)script\>/gi, "").replace(/\<style[^>]*\>(.*?)style\>/gi, "")
												var text = textNode.innerText
												var message = entries[i].title + (entries[i].author ? (" by " + entries[i].author) : "") + " ... " + (text || "")

											// html
												var responseHTML = (entries[i].url ? ("<a target='_blank' href='" + entries[i].url + "'><h2>" + entries[i].title + "</h2></a>") : ("<h2>" + entries[i].title + "</h2>")) + 
													(entries[i].author ? ("<i>" + entries[i].author + "</i>") : "") +
													(entries[i].author && entries[i].date ? ", " : "") +
													(entries[i].date ? ("<i>" + new Date(entries[i].date).toLocaleDateString() + "</i>") : "") +
													("<p>" + entries[i].text.replace(/\n/gi, "<br>") + "</p>")

											// add to results
												results.push({icon: icon, message: message, html: responseHTML})
										}
									}

								// display first result
									var firstResult = results.shift()
									callback({icon: icon, message: firstResult.message, html: firstResult.html, results: results})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I couldn't access that feed.", html: "<h2>Error: unable to access feed</h2>" + remainder})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get a random post": function(remainder, callback) {
				try {
					// proxy to get the latest post (ordered list)
						window.ACTION_LIBRARY["get the latest post"](remainder, function(response) {
							// error?
								if (response.error) {
									callback({icon: response.icon, error: true, message: response.message, html: response.html})
									return
								}

							// extract results
								var results = response.results || []
									results.unshift({icon: response.icon, message: response.message, html: response.html})

							// shuffle them 
								results = window.FUNCTION_LIBRARY.sortRandom(results)

							// display first result
								var firstResult = results.shift()
								callback({icon: firstResult.icon, message: firstResult.message, html: firstResult.html, results: results})
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get the headlines": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4f0;"

					// proxy to get the latest post (ordered list)
						window.ACTION_LIBRARY["get the latest post"]("the new york times", function(response) {
							// error?
								if (response.error) {
									callback({icon: icon, error: true, message: response.message, html: response.html})
									return
								}

							// extract results
								var results = response.results || []
									results.unshift({icon: response.icon, message: response.message, html: response.html})

							// display all results
								var message = "I found " + results.length + (results.length == 1 ? " story: " : " stories: ") +
									results.map(function(result) { return result.message }).join(" ... ")
								var responseHTML = "<a target='_blank' href='https://www.nytimes.com/'><h2>Today's Headlines from The New York Times</h2></a>" +
									"<ul>" + results.map(function(result) { return "<li>" + result.html + "</li>"}).join("") + "</ul>"
								callback({icon: icon, message: message, html: responseHTML})
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// Google Apps Script
			"edit wish list": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4dd;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// no remainder
						remainder = " " + remainder.replace(/[?!,:;'"_\/\(\)\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I add?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// split at keywords
						var cost = remainder.split(/ for | costing | that costs | which costs /gi)
							cost = (cost[1] || cost[0]).split(/ called | named | by the name | which is a | which is an | which is the /gi)[0].trim()

						var item = remainder.split(/ called | named | by the name /gi)
							item = (item[1] || item[0]).split(/ for | costing | that costs | which costs | which is a | which is an | which is the /gi)[0].trim()

						var type = remainder.split(/ which is a | which is an | which is the /gi)
							type = (type[1] || type[0]).split(/ for | costing | that costs | which costs | called | named | by the name /gi)[0].trim()

					// build options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=listWish&item=" + item + "&cost=" + cost + "&type=" + type
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// response
									var message = response.message
									var responseHTML = "<h2>" + response.item + "</h2><li><b>cost: </b>" + response.cost + "</li><li><b>type: </b>" + response.type + "</li>"
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to edit your wish list.", html: "<h2>Error: unable to edit wish list:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get balance": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4b5;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// build options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=getBalance&account=" + remainder
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// no account
									if (!response.account) {
										callback({icon: icon, error: true, message: "I couldn't find that account.", html: "<h2>Error: invalid account</h2>"})
										return
									}

								// response
									var message = response.message
									var responseHTML = "<h2><b>" + response.account + ":</b> $" + response.amount + "</h2>"
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get your balance.", html: "<h2>Error: unable to get balance:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"log purchase": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4b5;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// no remainder
						remainder = " " + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I add?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// split at keywords
						var amount = remainder.split(/ for | costing | that cost | that costs | which cost | which costs /gi)
							amount = (amount[1] || amount[0]).split(/ called | named | by the name | item | which is a | which is an | which is the | which is type | which is category | which is | type | category /gi)[0].trim()

						var description = remainder.split(/ called | named | by the name | item /gi)
							description = (description[1] || description[0]).split(/ for | costing | that cost | that costs | which cost | which costs | which is a | which is an | which is the | which is type | which is category | which is | type | category /gi)[0].trim()

						var category = remainder.split(/ which is a | which is an | which is the | which is type | which is category | which is | type | category /gi)
							category = (category[1] || category[0]).split(/ for | costing | that cost | that costs | which cost | which costs | called | named | by the name | item /gi)[0].trim()

					// build options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=logPurchase&category=" + category + "&description=" + description + "&amount=" + amount
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// response
									var message = response.message
									var responseHTML = "<h2>" + response.description + "</h2><li><b>amount: </b>" + response.amount + "</li><li><b>category: </b>" + response.category + "</li>"
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to log your purchase.", html: "<h2>Error: unable to log purchase:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"fetch calendar": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4c5;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// remainder
						remainder = " " + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()

					// split at keywords
						var startDate = remainder.replace(/[?!,;'"_\(\)\$\%]/gi,"").split(/ from | starting at | start date | start time | between | for /gi)
							startDate = (startDate[1] || startDate[0]).split(/ to | until | ending at | end date | end time | and | through /gi)[0].trim()
							if (startDate == "today")     { startDate = new Date().toLocaleDateString() }
							if (startDate == "yesterday") { startDate = new Date(new Date().getTime() - (1000 * 60 * 60 * 24)).toLocaleDateString() }
							if (startDate == "tomorrow")  { startDate = new Date(new Date().getTime() + (1000 * 60 * 60 * 24)).toLocaleDateString() }

						var endDate = remainder.replace(/[?!,;'"_\(\)\$\%]/gi,"").split(/ to | until | ending at | end date | end time | and | through /gi)
							endDate = (endDate[1] || endDate[0]).split(/ from | starting at | start date | start time | between | for /gi)[0].trim()
							if (endDate == "today")     { endDate = new Date().toLocaleDateString() }
							if (endDate == "yesterday") { endDate = new Date(new Date().getTime() - (1000 * 60 * 60 * 24)).toLocaleDateString() }
							if (endDate == "tomorrow")  { endDate = new Date(new Date().getTime() + (1000 * 60 * 60 * 24)).toLocaleDateString() }

					// build options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=fetchEvents" + (startDate ? "&startDate=" + startDate : "") + (endDate ? "&endDate=" + endDate : "")
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// create list
									var eventList = []
									var eventItems = []
									if (response.events) {
										for (var i = 0; i < response.events.length; i++) {
											var event = response.events[i]
											var startTime = new Date(event.startTime).toLocaleString()
											var endTime = new Date(event.endTime).toLocaleString()

											eventList.push(event.title + " from " + startTime + " until " + endTime + " at " + (event.location || "unknown location"))
											eventItems.push("<li><b>" + event.title + "</b><p>" + startTime + " - " + endTime + "<br><a target='_blank' href='https://www.google.com/maps/?q=" + event.location + "'>" + event.location + "</a><br>" + event.description + "</p></li>")
										}
									}

								// response
									var message = response.message + eventList.join(" ... ")
									var responseHTML = "<a target='_blank' href='https://calendar.google.com'><h2>upcoming events</h2></a><ul>" + eventItems.join("") + "</ul>"
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to fetch your calendar.", html: "<h2>Error: unable to fetch calendar:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get a list": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4dd;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// build options
						var list = remainder
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=getList" + (list ? ("&list=" + list) : "")
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// not successful?
									if (!response.success || !response.list) {
										callback({icon: icon, error: true, message: "I was unable to get " + (list ? list : " your list"), html: "<h2>Error: unable to get list:</h2>" + remainder})
										return
									}

								// create structured list
									var structuredItems = {}
									var i = 0

								// loop through response list
									while (response.list.length) {
										// wrap back to the beginning of the list
											if (i == response.list.length) {
												i = 0
											}

										// get the item
											var item = response.list[i]

										// top-level?
											if (!item.parent) {
												structuredItems[item.id] = item
												response.list.splice(i, 1)
												i--
											}

										// subtask?
											else if (structuredItems[item.parent]) {
												if (!structuredItems[item.parent].children) {
													structuredItems[item.parent].children = {}
												}
												structuredItems[item.parent].children[item.id] = item
												response.list.splice(i, 1)
												i--
											}

										// sub-subtask? --> force top-level
											else if (!response.list.find(function(x) { return x.id == item.parent })) {
												structuredItems[item.id] = item
												response.list.splice(i, 1)
												i--
											}

										// increment
											i++
									}

								// sort list item keys by position
									var structuredItemKeys = Object.keys(structuredItems)
									structuredItemKeys = structuredItemKeys.sort(function(a, b) {
										return Number(structuredItems[a].position) - Number(structuredItems[b].position)
									})

								// empty message / html
									var message = ""
									var responseHTML = "<ul>"

								// loop through list item keys
									for (var i in structuredItemKeys) {
										var item = structuredItems[structuredItemKeys[i]]

										responseHTML += "<li><b>" + item.title + "</b>"
										message += item.title + " ... "

										// due date
											if (item.due) {
												responseHTML += "<br>" + new Date(new Date(item.due).getTime() + (1000 * 60 * 60 * 5)).toLocaleDateString()
												message += new Date(new Date(item.due).getTime() + (1000 * 60 * 60 * 5)).toLocaleDateString() + " ... "
											}

										// notes
											if (item.notes) {
												responseHTML += "<br>" + item.notes
												message += item.notes + " ... "
											}

										// subtasks
											if (item.children) {
												responseHTML += "<ul>"
												for (var j in item.children) {
													responseHTML += "<li><b>" + item.children[j].title + "</b>"
													message += item.children[j].title + " ... "

													// due date
														if (item.children[j].due) {
															responseHTML += "<br>" + new Date(new Date(item.children[j].due).getTime() + (1000 * 60 * 60 * 5)).toLocaleDateString()
															message += new Date(new Date(item.children[j].due).getTime() + (1000 * 60 * 60 * 5)).toLocaleDateString() + " ... "
														}

													// notes
														if (item.children[j].notes) {
															responseHTML += "<br>" + item.children[j].notes
															message += item.children[j].notes + " ... "
														}

													responseHTML += "</li>"
												}
												responseHTML += "</ul>"
											}

										responseHTML += "</li>"
									}
									responseHTML += "<ul>"

								// send response
									message = response.listName + " ... " + message
									responseHTML = "<h2>" + response.listName + "</h2>" + responseHTML
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get your list.", html: "<h2>Error: unable to get list:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"add an item to a list": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4dd;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// no remainder
						remainder = " " + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I add?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// split at keywords
						var components = remainder.split(/ list | list\: /gi)
						var list = components[0].trim() || ""
						var task = components[1] ? components[1] : components[0]

					// no task?
						if (!task) {
							callback({icon: icon, error: true, message: "I couldn't identify that item.", html: "<h2>Error: missing or invalid item:</h2>" + remainder})
							return
						}

					// build options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=addTask" + (list ? "&list=" + list : "") + "&task=" + task
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// not successful?
									if (!response.success || !response.list) {
										callback({icon: icon, error: true, message: "I was unable to add " + task + " to " + (list ? list : " your list"), html: "<h2>Error: unable to add item to list:</h2>" + remainder})
										return
									}

								// create structured list
									var structuredItems = {}
									var i = 0

								// loop through response list
									while (response.list.length) {
										// wrap back to the beginning of the list
											if (i == response.list.length) {
												i = 0
											}

										// get the item
											var item = response.list[i]

										// top-level?
											if (!item.parent) {
												structuredItems[item.id] = item
												response.list.splice(i, 1)
												i--
											}

										// subtask?
											else if (structuredItems[item.parent]) {
												if (!structuredItems[item.parent].children) {
													structuredItems[item.parent].children = {}
												}
												structuredItems[item.parent].children[item.id] = item
												response.list.splice(i, 1)
												i--
											}

										// sub-subtask? --> force top-level
											else if (!response.list.find(function(x) { return x.id == item.parent })) {
												structuredItems[item.id] = item
												response.list.splice(i, 1)
												i--
											}

										// increment
											i++
									}

								// sort list item keys by position
									var structuredItemKeys = Object.keys(structuredItems)
									structuredItemKeys = structuredItemKeys.sort(function(a, b) {
										return Number(structuredItems[a].position) - Number(structuredItems[b].position)
									})

								// empty html
									var responseHTML = "<ul>"

								// loop through list item keys
									for (var i in structuredItemKeys) {
										var item = structuredItems[structuredItemKeys[i]]

										responseHTML += "<li><b>" + item.title + "</b>"

										// due date
											if (item.due) {
												responseHTML += "<br>" + new Date(new Date(item.due).getTime() + (1000 * 60 * 60 * 5)).toLocaleDateString()
											}

										// notes
											if (item.notes) {
												responseHTML += "<br>" + item.notes
											}

										// subtasks
											if (item.children) {
												responseHTML += "<ul>"
												for (var j in item.children) {
													responseHTML += "<li><b>" + item.children[j].title + "</b>"

													// due date
														if (item.children[j].due) {
															responseHTML += "<br>" + new Date(new Date(item.children[j].due).getTime() + (1000 * 60 * 60 * 5)).toLocaleDateString()
														}

													// notes
														if (item.children[j].notes) {
															responseHTML += "<br>" + item.children[j].notes
														}

													responseHTML += "</li>"
												}
												responseHTML += "</ul>"
											}

										responseHTML += "</li>"
									}
									responseHTML += "<ul>"

								// send response
									var message = "I added " + task + " to " + response.listName
									responseHTML = "<h2>" + response.listName + "</h2>" + responseHTML
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to add to your list.", html: "<h2>Error: unable to add to list:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get contacts": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f464;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// no remainder
						remainder = remainder.replace(/[?!,:;"_\/\(\)\$\%]/gi,"").trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// build options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=getContacts&name=" + remainder
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// not successful?
									if (!response.success) {
										callback({icon: icon, error: true, message: "I was unable to find " + remainder, html: "<h2>Error: unable to find contact:</h2>" + remainder})
										return
									}

								// possibilities
									var message = ""
									var responseHTML = "<ul>"
									for (var i in response.list) {
										var contact = response.list[i]

										// name
											var name = (contact.firstName ? contact.firstName + " " : "") + (contact.middleName ? contact.middleName + " " : "") + (contact.lastName ? contact.lastName : "")
											message += name + " ... "
											responseHTML += "<li><b>" + name + "</b>"
										
										// emails
											if (contact.emails && Array.isArray(contact.emails) && contact.emails.length) {
												responseHTML += "<ul>"
												for (var j in contact.emails) {
													responseHTML += "<li><a target='_blank' href='mailto:" + contact.emails[j].value + "'>" + (contact.emails[j].label ? contact.emails[j].label.toLowerCase().replace(/\_/g, " ") + ": " : "") + contact.emails[j].value + "</a></li>"
												}
												responseHTML += "</ul>"
											}

										// phone numbers
											if (contact.phoneNumbers && Array.isArray(contact.phoneNumbers) && contact.phoneNumbers.length) {
												responseHTML += "<ul>"
												for (var j in contact.phoneNumbers) {
													responseHTML += "<li><a target='_blank' href='tel:" + contact.phoneNumbers[j].value + "'>" + (contact.phoneNumbers[j].label ? contact.phoneNumbers[j].label.toLowerCase().replace(/\_/g, " ") + ": " : "") + contact.phoneNumbers[j].value + "</a></li>"
												}
												responseHTML += "</ul>"
											}

										// addresses
											if (contact.addresses && Array.isArray(contact.addresses) && contact.addresses.length) {
												responseHTML += "<ul>"
												for (var j in contact.addresses) {
													responseHTML += "<li><a target='_blank' href='https://maps.google.com?q=" + contact.addresses[j].value + "'>" + (contact.addresses[j].label ? contact.addresses[j].label.toLowerCase().replace(/\_/g, " ") + ": " : "") + contact.addresses[j].value + "</a></li>"
												}
												responseHTML += "</ul>"
											}

										// dates
											if (contact.dates && Array.isArray(contact.dates) && contact.dates.length) {
												responseHTML += "<ul>"
												for (var j in contact.dates) {
													responseHTML += "<li>" + (contact.dates[j].label ? contact.dates[j].label.toLowerCase().replace(/\_/g, " ") + ": " : "") + contact.dates[j].value + "</li>"
												}
												responseHTML += "</ul>"
											}

										// urls
											if (contact.urls && Array.isArray(contact.urls) && contact.urls.length) {
												responseHTML += "<ul>"
												for (var j in contact.urls) {
													responseHTML += "<li><a target='_blank' href='" + contact.urls[j].value + "'>" + (contact.urls[j].label ? contact.urls[j].label.toLowerCase().replace(/\_/g, " ") + ": " : "") + contact.urls[j].value + "</a></li>"
												}
												responseHTML += "</ul>"
											}
										
										responseHTML += "</li>"
									}
									responseHTML += "</ul>"

								// send response
									message = "I found " + response.list.length + (response.list.length == 1 ? "person" : "people") + ": " + message
									responseHTML = "<h2>" + remainder + "</h2>" + responseHTML
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get contacts.", html: "<h2>Error: unable to get contacts:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get birthday": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f464;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// no remainder?
						remainder = remainder.replace(/[?!,:;"_\/\(\)\$\%]/gi,"").trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return	
						}

					// build options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=getContacts&name=" + remainder
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// not successful?
									if (!response.success) {
										callback({icon: icon, error: true, message: "I was unable to find " + remainder, html: "<h2>Error: unable to find contact:</h2>" + remainder})
										return
									}

								// extract birthdays
									var people = []
									for (var i in response.list) {
										var contact = response.list[i]
										people[i] = {
											name: (contact.firstName ? contact.firstName + " " : "") + (contact.middleName ? contact.middleName + " " : "") + (contact.lastName ? contact.lastName : ""),
											birthday: "unknown"
										}
										if (contact.dates && Array.isArray(contact.dates) && contact.dates.length) {
											for (var j in contact.dates) {
												if (contact.dates[j].label.toLowerCase() == "birthday") {
													people[i].birthday = contact.dates[j].value
												}
											}
										}
									}

								// message (list people/birthday)
									var message = ""
									var responseHTML = "<ul>"
									for (var i in people) {
										message += people[i].name + "'s birthday is " + people[i].birthday + " ... "
										responseHTML += "<li><b>" + people[i].name + "</b><br>birthday: " + people[i].birthday + "</li>"
									}
									responseHTML += "</ul>"

								// send response
									message = "I found " + people.length + (people.length == 1 ? "person" : "people") + ": " + message
									responseHTML = "<h2>" + remainder + " birthdays</h2>" + responseHTML
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get contacts.", html: "<h2>Error: unable to get contacts:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get phone number": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f464;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// no remainder?
						remainder = remainder.replace(/[?!,:;"_\/\(\)\$\%]/gi,"").trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return	
						}

					// build options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=getContacts&name=" + remainder
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// not successful?
									if (!response.success) {
										callback({icon: icon, error: true, message: "I was unable to find " + remainder, html: "<h2>Error: unable to find contact:</h2>" + remainder})
										return
									}

								// extract phone numbers
									var people = []
									for (var i in response.list) {
										var contact = response.list[i]
										people[i] = {
											name: (contact.firstName ? contact.firstName + " " : "") + (contact.middleName ? contact.middleName + " " : "") + (contact.lastName ? contact.lastName : ""),
											phoneNumbers: []
										}
										if (contact.phoneNumbers && Array.isArray(contact.phoneNumbers) && contact.phoneNumbers.length) {
											for (var j in contact.phoneNumbers) {
												people[i].phoneNumbers[j] = {
													value: contact.phoneNumbers[j].value,
													label: contact.phoneNumbers[j].label ? contact.phoneNumbers[j].label.toLowerCase().replace(/\_/g, " ") : null
												}
											}
										}
									}

								// message (list people > list phone numbers)
									var message = ""
									var responseHTML = "<ul>"
									for (var i in people) {
										responseHTML += "<li><b>" + people[i].name + "</b><br>"
										if (people[i].phoneNumbers.length) {
											responseHTML += "<ul>"
											for (var j in people[i].phoneNumbers) {
												message += people[i].name + "'s " + (people[i].phoneNumbers[j].label ? people[i].phoneNumbers[j].label : "phone number") + " is " + people[i].phoneNumbers[j].value + " ... "
												responseHTML += "<li><a target='_blank' href='tel:" + people[i].phoneNumbers[j].value + "'>" + (people[i].phoneNumbers[j].label ? (people[i].phoneNumbers[j].label + ": ") : "") + people[i].phoneNumbers[j].value + "</a></li>"
											}
											responseHTML += "</ul>"
										}
										responseHTML += "</li>"
									}
									responseHTML += "</ul>"

								// send response
									message = "I found " + people.length + (people.length == 1 ? "person" : "people") + ": " + message
									responseHTML = "<h2>" + remainder + " phone numbers</h2>" + responseHTML
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get contacts.", html: "<h2>Error: unable to get contacts:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get email": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f464;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// no remainder?
						remainder = remainder.replace(/[?!,:;"_\/\(\)\$\%]/gi,"").trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return	
						}

					// build options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=getContacts&name=" + remainder
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// not successful?
									if (!response.success) {
										callback({icon: icon, error: true, message: "I was unable to find " + remainder, html: "<h2>Error: unable to find contact:</h2>" + remainder})
										return
									}

								// extract emails
									var people = []
									for (var i in response.list) {
										var contact = response.list[i]
										people[i] = {
											name: (contact.firstName ? contact.firstName + " " : "") + (contact.middleName ? contact.middleName + " " : "") + (contact.lastName ? contact.lastName : ""),
											emails: []
										}
										if (contact.emails && Array.isArray(contact.emails) && contact.emails.length) {
											for (var j in contact.emails) {
												people[i].emails[j] = {
													value: contact.emails[j].value,
													label: contact.emails[j].label ? contact.emails[j].label.toLowerCase().replace(/\_/g, " ") : null
												}
											}
										}
									}

								// message (list people > list emails)
									var message = ""
									var responseHTML = "<ul>"
									for (var i in people) {
										responseHTML += "<li><b>" + people[i].name + "</b><br>"
										if (people[i].emails.length) {
											responseHTML += "<ul>"
											for (var j in people[i].emails) {
												message += people[i].name + "'s " + (people[i].emails[j].label ? people[i].emails[j].label : "email") + " is " + people[i].emails[j].value + " ... "
												responseHTML += "<li><a target='_blank' href='mailto:" + people[i].emails[j].value + "'>" + (people[i].emails[j].label ? (people[i].emails[j].label + ": ") : "") + people[i].emails[j].value + "</a></li>"
											}
											responseHTML += "</ul>"
										}
										responseHTML += "</li>"
									}
									responseHTML += "</ul>"

								// send response
									message = "I found " + people.length + (people.length == 1 ? "person" : "people") + ": " + message
									responseHTML = "<h2>" + remainder + " emails</h2>" + responseHTML
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get contacts.", html: "<h2>Error: unable to get contacts:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get address": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f464;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// no remainder?
						remainder = remainder.replace(/[?!,:;"_\/\(\)\$\%]/gi,"").trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return	
						}

					// build options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=getContacts&name=" + remainder
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// not successful?
									if (!response.success) {
										callback({icon: icon, error: true, message: "I was unable to find " + remainder, html: "<h2>Error: unable to find contact:</h2>" + remainder})
										return
									}

								// extract addresses
									var people = []
									for (var i in response.list) {
										var contact = response.list[i]
										people[i] = {
											name: (contact.firstName ? contact.firstName + " " : "") + (contact.middleName ? contact.middleName + " " : "") + (contact.lastName ? contact.lastName : ""),
											addresses: []
										}
										if (contact.addresses && Array.isArray(contact.addresses) && contact.addresses.length) {
											for (var j in contact.addresses) {
												people[i].addresses[j] = {
													value: contact.addresses[j].value,
													label: contact.addresses[j].label ? contact.addresses[j].label.toLowerCase().replace(/\_/g, " ") : null
												}
											}
										}
									}

								// message (list people > list addresses)
									var message = ""
									var responseHTML = "<ul>"
									for (var i in people) {
										responseHTML += "<li><b>" + people[i].name + "</b><br>"
										if (people[i].addresses.length) {
											responseHTML += "<ul>"
											for (var j in people[i].addresses) {
												message += people[i].name + "'s " + (people[i].addresses[j].label ? people[i].addresses[j].label : "address") + " is " + people[i].addresses[j].value + " ... "
												responseHTML += "<li><a target='_blank' href='https://maps.google.com/?q=" + people[i].addresses[j].value + "'>" + (people[i].addresses[j].label ? (people[i].addresses[j].label + ": ") : "") + people[i].addresses[j].value + "</a></li>"
											}
											responseHTML += "</ul>"
										}
										responseHTML += "</li>"
									}
									responseHTML += "</ul>"

								// send response
									message = "I found " + people.length + (people.length == 1 ? "person" : "people") + ": " + message
									responseHTML = "<h2>" + remainder + " addresses</h2>" + responseHTML
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get contacts.", html: "<h2>Error: unable to get contacts:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"log gratitude": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f33b;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script 2"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script 2.", html: "<h2>Error: missing configuration:</h2><li>google apps script 2</li>"})
							return
						}

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I add?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// build options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script 2"] + "&text=" + remainder
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// response
									var message = response.message
									var responseHTML = "<h2>" + response.message + "</h2>"
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to log gratitude.", html: "<h2>Error: unable to log gratitude:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// Google APIs
			"search google": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f50d;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google custom search"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google custom search.", html: "<h2>Error: missing configuration:</h2><li>google custom search</li>"})
							return
						}
						else if (!window.CONFIGURATION_LIBRARY["google api key"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google api key.", html: "<h2>Error: missing configuration:</h2></li>google api key</li>"})
							return
						}

					// no remainder
						remainder = remainder.trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google custom search"] + "&key=" + window.CONFIGURATION_LIBRARY["google api key"] + "&q=" + remainder
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// no results?
									if (!response.items || !response.items.length) {
										callback({icon: icon, error: true, message: "I found no results for " + remainder, html: "<h2>Error: no results:</h2>" + remainder})
										return
									}

								// all results
									var results = []
									for (var i in response.items) {
										var responseMessage = response.items[i].title + " " + response.items[i].snippet
										var responseHTML = "<a target='_blank' href='https://www.google.com?q=" + remainder + "'><h2>" + remainder + "</h2></a>" +
											"<p><a target='_blank' href='" + response.items[i].link + "'><b>" + response.items[i].title + "</b></a><br>" + response.items[i].snippet + "</p>"

										results.push({icon: icon, message: responseMessage, html: responseHTML})
									}

								// send response
									var firstResult = results.shift()
									callback({icon: icon, message: firstResult.message, html: firstResult.html, results: results})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get search results.", html: "<h2>Error: unable to get search results:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"search google directions": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f5fa;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google api key"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google api key.", html: "<h2>Error: missing configuration:</h2><li>google api key</li>"})
							return
						}

					// no remainder
						remainder = " " + remainder.trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// split at keywords
						var origin = remainder.replace(/[?!,;'"_\(\)\$\%]/gi,"").split(/ leaving from | from | starting at | start at | etween | originating at | origin /gi)
							origin = (origin[1] || origin[0]).split(/ going to | go to | ending at | end at | to | and | arriving at | destination | for /gi)[0].trim()

						var destination = remainder.replace(/[?!,;'"_\(\)\$\%]/gi,"").split(/ going to | go to | ending at | end at | to | and | arriving at | destination | for /gi)
							destination = (destination[1] || destination[0]).split(/ leaving from | from | starting at | start at | between | originating at | origin /gi)[0].trim()

					// options
						var options = {
							url: "https://maps.googleapis.com/maps/api/directions/json?key=" + window.CONFIGURATION_LIBRARY["google api key"] + "&origin=" + origin + "&destination=" + destination
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// no results?
									if (!response || !response.routes || !response.routes[0] || !response.routes[0].legs || !response.routes[0].legs[0]) {
										callback({icon: icon, error: true, message: "I couldn't find a route.", html: "<h2>Error: unable to find a route:</h2><li>from: " + origin + "</li><li>to: " + destination + "</li>"})
										return
									}

								// format response
									var distance = response.routes[0].legs[0].distance.text
									var duration = response.routes[0].legs[0].duration.text
									var steps = response.routes[0].legs[0].steps.map(function(step) {
										return "<li><b>" + step.distance.text + " (" + step.duration.text + ")" + "</b><br>" + step.html_instructions + "</li>"
									}) || []

								// message & link
									var message = origin + " to " + destination + " is " + distance + " for " + duration + "."
									var responseHTML = "<a target='_blank' href='https://www.google.com/maps/dir/" + origin + "/" + destination + "'><h2>" + origin + " to " + destination + "</h2></a>" +
										"<i>" + distance + " for " + duration + "</i><b2>" +
										"<ol>" + steps.join("") + "</ol>"

								// response
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get search results.", html: "<h2>Error: unable to get search results:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"search google places": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f5fa;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google api key"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google api key.", html: "<h2>Error: missing configuration:</h2><li>google api key</li>"})
							return
						}

					// no remainder
						remainder = remainder.trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// options
						var options = {
							url: "https://maps.googleapis.com/maps/api/place/findplacefromtext/json?key=" + window.CONFIGURATION_LIBRARY["google api key"] + "&inputtype=textquery&fields=place_id&input=" + remainder
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// no results?
									if (!response || !response.candidates || !response.candidates[0] || !response.candidates[0].place_id) {
										callback({icon: icon, error: true, message: "I couldn't find that place.", html: "<h2>Error: unable to find place:</h2>" + remainder})
										return
									}

								// second trip, with place_id
									var place_id = response.candidates[0].place_id
									var options = {
										url: "https://maps.googleapis.com/maps/api/place/details/json?key=" + window.CONFIGURATION_LIBRARY["google api key"] + "&inputtype=textquery&fields=name,photo,url,website,formatted_phone_number,formatted_address,geometry,opening_hours&place_id=" + place_id
									}

									window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
										try {
											// no results?
												if (!response || !response.result) {
													callback({icon: icon, error: true, message: "I couldn't find that place.", html: "<h2>Error: unable to find place:</h2>" + remainder})
													return
												}

											// get open now / hours
												var place = response.result
												if (place.opening_hours) {
													var openNow = "It's currently " + (place.opening_hours.open_now ? " open." : "closed.")
													var openHours = "<br><ul><li>" + place.opening_hours.weekday_text.join("</li><li>") + "</li></ul>"
												}
												else {
													var openNow = ""
													var openHours = ""
												}

											// message & html
												var message = "I found " + place.name + " at " + (place.formatted_address || "an unknown address") + ". " + openNow
												var responseHTML = "<h2>" + place.name + "</h2>" + 
													"<ul><li><a target='_blank' href='" + place.url + "'>" + (place.formatted_address || "<i>no address found</i>") + "</a></li><li>" + (place.formatted_phone_number || "<i>no phone number found</i>") + "</li><li>" + (place.website ? ("<a target='_blank' href='" + place.website + "'>" + place.website + "</a>") : "<i>no website found</i>") + "<li>hours: " + (openHours || "<i>no hours found</i>") + "</li></ul>"

											// response
												callback({icon: icon, message: message, html: responseHTML})
										}
										catch (error) {
											callback({icon: icon, error: true, message: "I was unable to get search results.", html: "<h2>Error: unable to get search results:</h2>" + error})
										}
									})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get search results.", html: "<h2>Error: unable to get search results:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"search youtube": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4fa;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google api key"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google api key.", html: "<h2>Error: missing configuration:</h2><li>google api key</li>"})
							return
						}

					// no remainder
						remainder = remainder.trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// options
						var options = {
							url: "https://www.googleapis.com/youtube/v3/search?key=" + window.CONFIGURATION_LIBRARY["google api key"] + "&part=snippet&type=video&videoEmbeddable=true&maxResults=10&order=viewCount&q=" + remainder
						}

					// proxy request
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// no results
									if (!response || !response.items || !response.items.length || !response.items[0].id || !response.items[0].id.videoId) {
										callback({icon: icon, error: true, message: "I couldn't find " + remainder + " on Youtube.", html: "<h2>Error: unable to find Youtube video:</h2>" + remainder})
										return
									}

								// all results
									var results = []
									for (var i in response.items) {
										var message = "Now playing " + response.items[i].snippet.title
										var randomID = window.FUNCTION_LIBRARY.generateRandom()
										var responseHTML = '<iframe id="' + randomID + '" width="560" height="315" src="https://www.youtube.com/embed/' + response.items[i].id.videoId + '?autoplay=1" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'
										results.push({icon: icon, message: message, html: responseHTML, followup: false, video: randomID})
									}

								// send response
									var firstResult = results.shift()
									callback({icon: icon, message: firstResult.message, html: firstResult.html, followup: false, video: firstResult.video, results: results})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get search results.", html: "<h2>Error: unable to get search results:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"google translate": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f30e;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google api key"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google api key.", html: "<h2>Error: missing configuration:</h2><li>google api key</li>"})
							return
						}

					// no remainder
						remainder = " " + remainder.trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I translate?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// split at keywords
						var components = remainder.split(/ to | in | into /gi)
						var phrase = components[0].trim()
						var language = components[1].trim().toLowerCase()

					// language code
						var languageCodes = {
							"amharic":		"am",
							"arabic":		"ar",
							"basque":		"eu",
							"bengali":		"bn",
							"bulgarian":	"bg",
							"catalan":		"ca",
							"cherokee":		"chr",
							"croatian":		"hr",
							"czech":		"cs",
							"danish":		"da",
							"dutch":		"nl",
							"english": 		"en",
							"estonian":		"et",
							"filipino":		"fil",
							"finnish":		"fi",
							"french":		"fr",
							"german":		"de",
							"greek":		"el",
							"gujarati":		"gu",
							"hebrew":		"iw",
							"hindi":		"hi",
							"hungarian":	"hu",
							"icelandic":	"is",
							"indonesian":	"id",
							"italian":		"it",
							"japanese":		"ja",
							"kannada":		"kn",
							"korean":		"ko",
							"latvian":		"lv",
							"lithuanian":	"lt",
							"malay":		"ms",
							"malayalam":	"ml",
							"marathi":		"mr",
							"norwegian":	"no",
							"polish":		"pl",
							"portuguese": 	"pt-PT",
							"romanian":		"ro",
							"russian":		"ru",
							"serbian":		"sr",
							"chinese": 		"zh-CN",
							"slovak":		"sk",
							"slovenian":	"sl",
							"spanish":		"es",
							"swahili":		"sw",
							"swedish":		"sv",
							"tamil":		"ta",
							"telugu":		"te",
							"thai":			"th",
							"turkish":		"tr",
							"urdu":			"ur",
							"ukrainian":	"uk",
							"vietnamese":	"vi",
							"welsh":		"cy"
						}
						var languageCode = languageCodes[language] || null

					// unidentified language
						if (!languageCode || !phrase) {
							callback({icon: icon, error: true, message: "I couldn't identify that language", html: "<h2>Error: unknown language:</h2>" + language})
							return
						}

					// options
						var options = {
							url: "https://translation.googleapis.com/language/translate/v2?key=" + window.CONFIGURATION_LIBRARY["google api key"] + "&q=" + phrase + "&target=" + languageCode
						}

					// proxy request
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// no results
									if (!response.data || !response.data.translations || !response.data.translations[0] || !response.data.translations[0].translatedText) {
										callback({icon: icon, error: true, message: "I couldn't translate that phrase.", html: "<h2>Error: unable to access Google Translate:</h2>" + response})
										return
									}

								// translation
									var translation = response.data.translations[0].translatedText.replace(/\&\#39\;/gi, "'")
									
								// response
									var message = translation
									var responseHTML = "<a target='_blank' href='https://translate.google.com/?sl=en&tl=" + languageCode + "&text=" + phrase + "'><h2>" + translation + "</h2></a>" +
										"<b>" + language + "</b> for \"<i>" + phrase + "</i>\""
									callback({icon: icon, message: message, html: responseHTML, language: languageCode})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to translate that phrase.", html: "<h2>Error: unable to get translation:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// games
			"play more or less": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4af;"

					// remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()

					// pick a number
						if (window.CONTEXT_LIBRARY.flow !== "play more or less") {
							window.CONTEXT_LIBRARY.flow = "play more or less"
							window.CONTEXT_LIBRARY["play more or less"] = {
								number: Math.floor(Math.random() * 100) + 1,
								guesses: 0
							}

							var message = "Okay, I'm thinking of a number between 1 and 100."
							var responseHTML = "<h2>number between 1 and 100</h2><li>Make a guess.</li><li>I'll tell you if my number is more or less.</li>"
							callback({icon: icon, message: message, html: responseHTML})
						}

					// interpret guess
						else {
							// gameState
								var gameState = window.CONTEXT_LIBRARY["play more or less"]

							// get guess
								var guess = Number(window.FUNCTION_LIBRARY.getDigits(remainder))

							// not a number
								if (isNaN(guess)) {
									callback({icon: icon, error: true, message: "I don't know that number.", html: "<h2>Error: invalid number:</h2>" + remainder})
									return
								}
							
							// increase guess count
								gameState.guesses++

							// correct
								if (guess == gameState.number) {
									// response
										var message = "You took " + gameState.guesses + " guess" + (gameState.guesses == 1 ? "" : "es") + " to find my number: " + gameState.number + "."
										var responseHTML = "<h2>" + gameState.guesses + " guess" + (gameState.guesses == 1 ? "" : "es") + "</h2><li>my number: <b>" + gameState.number + "</b></li>"
										callback({icon: icon, message: message, html: responseHTML})

									// end flow
										window.CONTEXT_LIBRARY.flow = null
										delete window.CONTEXT_LIBRARY["play more or less"]
								}

							// more
								else if (gameState.number > guess) {
									// response
										var message = "More than " + guess
										var responseHTML = "<h2>&uarr; &gt; " + guess + " &uarr;</h2>"
										callback({icon: icon, message: message, html: responseHTML})
								}

							// less
								else if (gameState.number < guess) {
									// response
										var message = "Less than " + guess
										var responseHTML = "<h2>&darr; &lt; " + guess + " &darr;</h2>"
										callback({icon: icon, message: message, html: responseHTML})
								}
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"play true or false": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4cb;"

					// remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()

					// initialize game
						if (window.CONTEXT_LIBRARY.flow !== "play true or false") {
							// options
								var options = {
									url: "https://opentdb.com/api.php?amount=10&type=boolean"
								}

							// proxy to server
								window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
									try {
										// enter flow
											window.CONTEXT_LIBRARY.flow = "play true or false"
											window.CONTEXT_LIBRARY["play true or false"] = {
												score: 0,
												index: 0,
												questions: response.results
											}

										// gameState
											var gameState = window.CONTEXT_LIBRARY["play true or false"]

										// first question
											var question = gameState.questions[gameState.index].question
												question = question.replace(/(&#039;)/gi,"\'")
											var questionNumber = gameState.index + 1

										// response
											var message = "True or False: " + question
											var responseHTML = "<h2>True or False #" + questionNumber + "</h2>" + question
											callback({icon: icon, message: message, html: responseHTML})
									}
									catch (error) {
										window.CONTEXT_LIBRARY.flow = null
										callback({icon: icon, error: true, message: "I don't know any fun facts.", html: "<h2>Error: unable to access trivia</h2>"})
									}
								})
						}

					// interpret guess
						else {
							// gameState
								var gameState = window.CONTEXT_LIBRARY["play true or false"]

							// validate
								var guess = remainder

							// true / false
								if (guess.includes("true")) {
									guess = "True"
								}
								else if (guess.includes("false")) {
									guess = "False"
								}

							// other
								else {
									callback({icon: icon, error: true, message: "I only understand True and False.", html: "<h2>Error: invalid guess:</h2>" + remainder})
									return
								}

							// correct
								var correctAnswer = gameState.questions[gameState.index].correct_answer
								if (guess == correctAnswer) {
									gameState.score++
									var situation = guess.toUpperCase() + " is correct!"
								}

							// incorrect
								else {
									var situation = "Sorry, this is actually " + correctAnswer.toUpperCase() + "."
								}

							// advance
								if (gameState.index + 1 < gameState.questions.length) {
									// next question
										gameState.index++
										var nextQuestion = gameState.questions[gameState.index].question
										var nextQuestionNumber = gameState.index + 1

									// response
										var message = situation + " ... " + "Question " + nextQuestionNumber + ": True or False: " + nextQuestion
										var responseHTML = situation + "<br><h2>True or False #" + nextQuestionNumber + "</h2>" + nextQuestion
										callback({icon: icon, message: message, html: responseHTML})
								}

							// done
								else {
									// final score
										var finalScore = gameState.score || 0

									// end flow
										window.CONTEXT_LIBRARY.flow = null
										delete window.CONTEXT_LIBRARY["play true or false"]

									// response
										var message = situation + " ... " + "You got " + finalScore + " questions correct."
										var responseHTML = situation + "<br><h2>Final score: " + finalScore + "</h2>"
										callback({icon: icon, message: message, html: responseHTML})
								}
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"play blackjack": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f0a1;"

					// remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()

					// initialize
						if (window.CONTEXT_LIBRARY.flow !== "play blackjack") {
							// enter flow
								window.CONTEXT_LIBRARY.flow = "play blackjack"

							// create game state
								var gameState = window.CONTEXT_LIBRARY["play blackjack"] = {
									playable: false,
									roundWinner: null,
									turnLoop: null,
									deck: [],
									discard: [
										{symbol: "&spades;", suit: "spades",   value: 1, name: "Ace"}, {symbol: "&spades;", suit: "spades",   value: 2, name: 2}, {symbol: "&spades;", suit: "spades",   value: 3, name: 3}, {symbol: "&spades;", suit: "spades",   value: 4, name: 4}, {symbol: "&spades;", suit: "spades",   value: 5, name: 5}, {symbol: "&spades;", suit: "spades",   value: 6, name: 6}, {symbol: "&spades;", suit: "spades",   value: 7, name: 7}, {symbol: "&spades;", suit: "spades",   value: 8, name: 8}, {symbol: "&spades;", suit: "spades",   value: 9, name: 9}, {symbol: "&spades;", suit: "spades",   value: 10, name: 10}, {symbol: "&spades;", suit: "spades",   value: 10, name: "Jack"}, {symbol: "&spades;", suit: "spades",   value: 10, name: "Queen"}, {symbol: "&spades;", suit: "spades",   value: 10, name: "King"},
										{symbol: "&hearts;", suit: "hearts",   value: 1, name: "Ace"}, {symbol: "&hearts;", suit: "hearts",   value: 2, name: 2}, {symbol: "&hearts;", suit: "hearts",   value: 3, name: 3}, {symbol: "&hearts;", suit: "hearts",   value: 4, name: 4}, {symbol: "&hearts;", suit: "hearts",   value: 5, name: 5}, {symbol: "&hearts;", suit: "hearts",   value: 6, name: 6}, {symbol: "&hearts;", suit: "hearts",   value: 7, name: 7}, {symbol: "&hearts;", suit: "hearts",   value: 8, name: 8}, {symbol: "&hearts;", suit: "hearts",   value: 9, name: 9}, {symbol: "&hearts;", suit: "hearts",   value: 10, name: 10}, {symbol: "&hearts;", suit: "hearts",   value: 10, name: "Jack"}, {symbol: "&hearts;", suit: "hearts",   value: 10, name: "Queen"}, {symbol: "&hearts;", suit: "hearts",   value: 10, name: "King"},
										{symbol: "&clubs;",  suit: "clubs",    value: 1, name: "Ace"}, {symbol: "&clubs;",  suit: "clubs",    value: 2, name: 2}, {symbol: "&clubs;",  suit: "clubs",    value: 3, name: 3}, {symbol: "&clubs;",  suit: "clubs",    value: 4, name: 4}, {symbol: "&clubs;",  suit: "clubs",    value: 5, name: 5}, {symbol: "&clubs;",  suit: "clubs",    value: 6, name: 6}, {symbol: "&clubs;",  suit: "clubs",    value: 7, name: 7}, {symbol: "&clubs;",  suit: "clubs",    value: 8, name: 8}, {symbol: "&clubs;",  suit: "clubs",    value: 9, name: 9}, {symbol: "&clubs;",  suit: "clubs",    value: 10, name: 10}, {symbol: "&clubs;",  suit: "clubs",    value: 10, name: "Jack"}, {symbol: "&clubs;",  suit: "clubs",    value: 10, name: "Queen"}, {symbol: "&clubs;",  suit: "clubs",    value: 10, name: "King"},
										{symbol: "&diams;",  suit: "diamonds", value: 1, name: "Ace"}, {symbol: "&diams;",  suit: "diamonds", value: 2, name: 2}, {symbol: "&diams;",  suit: "diamonds", value: 3, name: 3}, {symbol: "&diams;",  suit: "diamonds", value: 4, name: 4}, {symbol: "&diams;",  suit: "diamonds", value: 5, name: 5}, {symbol: "&diams;",  suit: "diamonds", value: 6, name: 6}, {symbol: "&diams;",  suit: "diamonds", value: 7, name: 7}, {symbol: "&diams;",  suit: "diamonds", value: 8, name: 8}, {symbol: "&diams;",  suit: "diamonds", value: 9, name: 9}, {symbol: "&diams;",  suit: "diamonds", value: 10, name: 10}, {symbol: "&diams;",  suit: "diamonds", value: 10, name: "Jack"}, {symbol: "&diams;",  suit: "diamonds", value: 10, name: "Queen"}, {symbol: "&diams;",  suit: "diamonds", value: 10, name: "King"}
									],
									pot: 0,
									player: {
										chips: 10,
										bust: false,
										facedown: [],
										faceup: []
									},
									dealer: {
										chips: 10,
										bust: false,
										facedown: [],
										faceup: []
									}
								}

							// start
								var message = "I'll shuffle the deck."
								var responseHTML =  "<h2>dealer: $" + gameState.dealer.chips + "</h2>" + "<h2>player: $" + gameState.player.chips + "</h2>"
								callback({icon: icon, message: message, html: responseHTML, followup: false})

							// new round
								setTimeout(function() {
									startBlackjackRound()
								}, 3000)
						}

					// human turn
						else if (window.CONTEXT_LIBRARY["play blackjack"].playable) {
							// game state
								var gameState = window.CONTEXT_LIBRARY["play blackjack"]

							// hit
								if (remainder.includes("hit") || remainder.includes("another")) {
									// deal card
										dealBlackjackCard("player", "faceup")

									// display state
										displayBlackjackState()

									// 5-cards? dealer's turn
										var count = 1 + gameState.player.faceup.length
										if (count == 5) {
											gameState.playable = false
										}

									// bust? dealer's turn
										var bestSum = getBestBlackjackSum("player")
										if (!bestSum) {
											gameState.player.bust = true
											gameState.playable = false
										}
										else if (bestSum == 21) {
											gameState.playable = false	
										}
								}

							// stay
								else if (remainder.includes("stay") || remainder.includes("done")) {
									// response
										var message = "Okay, my turn."
										var responseHTML = "<h2>Dealer's turn.</h2>"
										callback({icon: icon, message: message, html: responseHTML, followup: false})

									// switch to dealer's turn
										gameState.playable = false
								}

							// other
								else {
									// response
										callback({icon: icon, error: true, message: "Sorry, I only understand hit and stay.", html: "<h2>Error: invalid response.</h2>"})
								}

							// player is done
								if (!gameState.playable) {
									// player busted?
										if (gameState.player.bust) {
											compareBlackjackHands()
										}

									// dealer's turn
										else {
											gameState.turnLoop = setInterval(function() {
												// get count
													var count = 1 + gameState.dealer.faceup.length

												// bust? compare
													var bestSum = getBestBlackjackSum("dealer")
													if (!bestSum) {
														gameState.dealer.bust = true
														compareBlackjackHands()
													}

												// continue
													else {
														// dealer hits on 16
															var playableSum = getBestBlackjackSum("dealer", 16)

															if (count < 5 && playableSum) {
																// deal card
																	dealBlackjackCard("dealer", "faceup")

																// display state
																	displayBlackjackState()
															}
														
														// compare hands
															else {
																compareBlackjackHands()
															}
													}
											}, 3000)
										}
								}
						}

					// deal card
						function dealBlackjackCard(who, how) {
							// gameState
								var gameState = window.CONTEXT_LIBRARY["play blackjack"]

							// no cards? shuffle discard
								if (!gameState.deck.length) {
									gameState.deck = window.FUNCTION_LIBRARY.sortRandom(gameState.discard)
									gameState.discard = []
								}

							// select a random card
								var index = Math.floor(Math.random() * gameState.deck.length)
								var card = gameState.deck[index]

							// pull it from the deck
								gameState.deck.splice(index, 1)

							// add it to the person's hand
								gameState[who][how].push(card)
						}

					// compareBlackjackHands
						function compareBlackjackHands() {
							// gameState
								var gameState = window.CONTEXT_LIBRARY["play blackjack"]

							// stop loop
								clearInterval(gameState.turnLoop)
								gameState.turnLoop = null

							// player busted?
								if (gameState.player.bust) {
									gameState.roundWinner = "dealer"
								}

							// dealer busted?
								else if (gameState.dealer.bust) {
									gameState.roundWinner = "player"
								}

							// both 21 and under
								else {
									// player sum
										var bestPlayerSum = getBestBlackjackSum("player")
										
									// dealer sum
										var bestDealerSum = getBestBlackjackSum("dealer")

									// winner
										if (bestPlayerSum > bestDealerSum) {
											gameState.roundWinner = "player"
										}
										else {
											gameState.roundWinner = "dealer"
										}
								}

							// chips
								gameState.pot -= 2
								gameState[gameState.roundWinner].chips += 2

							// display
								displayBlackjackState()

							// say "next round"
								if (gameState.player.chips && gameState.dealer.chips) {
									setTimeout(function() {
										callback({icon: icon, message: "Next round.", html: "<h2>next round</h2>", followup: false})
									}, 4000)
								}

							// next round
								setTimeout(function() {
									startBlackjackRound()
								}, 6000)
						}

					// startBlackjackRound
						function startBlackjackRound() {
							// gameState
								var gameState = window.CONTEXT_LIBRARY["play blackjack"]

							// game over?
								if (gameState.player.chips == 0) {
									// response
										var message = "The dealer wins the game."
										var responseHTML = "<h2>dealer wins</h2>"
										callback({icon: icon, message: message, html: responseHTML, followup: false})

									// end flow
										window.CONTEXT_LIBRARY.flow = null
										delete window.CONTEXT_LIBRARY["play blackjack"]
								}
								else if (gameState.dealer.chips == 0) {
									// response
										var message = "You win the game."
										var responseHTML = "<h2>player wins</h2>"
										callback({icon: icon, message: message, html: responseHTML, followup: false})

									// end flow
										window.CONTEXT_LIBRARY.flow = null
										delete window.CONTEXT_LIBRARY["play blackjack"]
								}

							// next round
								else {
									// discard player cards
										for (var i in gameState.player.facedown) {
											var card = gameState.player.facedown[i]
											gameState.discard.push(JSON.parse(JSON.stringify(card)))
										}
										for (var i in gameState.player.faceup) {
											var card = gameState.player.faceup[i]
											gameState.discard.push(JSON.parse(JSON.stringify(card)))
										}
										gameState.player.facedown = []
										gameState.player.faceup = []

									// discard dealer cards
										for (var i in gameState.dealer.facedown) {
											var card = gameState.dealer.facedown[i]
											gameState.discard.push(JSON.parse(JSON.stringify(card)))
										}
										for (var i in gameState.dealer.faceup) {
											var card = gameState.dealer.faceup[i]
											gameState.discard.push(JSON.parse(JSON.stringify(card)))
										}
										gameState.dealer.facedown = []
										gameState.dealer.faceup = []

									// deal cards (first deal includes shuffling)
										dealBlackjackCard("player", "facedown")
										dealBlackjackCard("player", "faceup")
										dealBlackjackCard("dealer", "facedown")
										dealBlackjackCard("dealer", "faceup")

									// chips
										gameState.player.chips -= 1
										gameState.dealer.chips -= 1
										gameState.pot += 2

									// reset bust
										gameState.player.bust = false
										gameState.dealer.bust = false

									// player's turn
										gameState.roundWinner = null
										gameState.playable = true

									// display
										displayBlackjackState()
								}
						}

					// getBestBlackjackSum
						function getBestBlackjackSum(who, limit, secret) {
							// gameState
								var gameState = window.CONTEXT_LIBRARY["play blackjack"]

							// limit
								var limit = limit || 21

							// possible sums
								var possibleSums = [((secret ?  0 : gameState[who].facedown[0].value) + gameState[who].faceup.map(function(card) { return card.value }).reduce(function(total, value) { return total + value }))]
								var aces = (secret ? 0 : (gameState[who].facedown[0].value == 1 ? 1 : 0))
								for (var i in gameState[who].faceup) {
									if (gameState[who].faceup[i].value == 1) {
										aces += 1
									}
								}
								for (var i = 0; i < aces; i++) {
									possibleSums.push(possibleSums[possibleSums.length - 1] + 10)
								}


							// sort sums
								possibleSums = possibleSums.sort(function(a,b) { return a - b })

							// get best sum
								var bestSum = 0
								for (var i in possibleSums) {
									if (bestSum < possibleSums[i] && possibleSums[i] <= limit) {
										bestSum = possibleSums[i]
									}
								}

							// return
								return bestSum
						}

					// displayBlackjackState
						function displayBlackjackState() {
							// gameState
								var gameState = window.CONTEXT_LIBRARY["play blackjack"]

							// sums
								var dealerSum = getBestBlackjackSum("dealer", null, gameState.roundWinner ? false : true)
								var playerSum = getBestBlackjackSum("player")

							// html
								var dealerHTML = gameState.roundWinner ? ("<li>[" + (gameState.dealer.facedown[0].name == 10 ? "10" : String(gameState.dealer.facedown[0].name).slice(0,1)) + gameState.dealer.facedown[0].symbol  + "]</li>" ): "<li>[???]</li>"
								for (var i in gameState.dealer.faceup) {
									dealerHTML += "<li>[" + (gameState.dealer.faceup[i].name == 10 ? "10" : String(gameState.dealer.faceup[i].name).slice(0,1)) + gameState.dealer.faceup[i].symbol + "]</li>"
								}

								var playerHTML = "<li>[" + (gameState.player.facedown[0].name == 10 ? "10" : String(gameState.player.facedown[0].name).slice(0,1)) + gameState.player.facedown[0].symbol + "]</li>"
								for (var i in gameState.player.faceup) {
									playerHTML += "<li>[" + (gameState.player.faceup[i].name == 10 ? "10" : String(gameState.player.faceup[i].name).slice(0,1)) + gameState.player.faceup[i].symbol + "]</li>"
								}

							// response
								var message = (gameState.dealer.bust || !dealerSum ? "Dealer busts. " : ("Dealer shows " + dealerSum + ". ")) +
									(gameState.player.bust || !playerSum ? "You bust. " : (("You have " + playerSum + ". ") +
									(gameState.playable && !gameState.player.bust && playerSum && playerSum !== 21 ? "Hit or stay? " : ""))) +
									(gameState.roundWinner ? (gameState.roundWinner + " wins. ") : "")
								var responseHTML = (gameState.pot ? ("<h2>pot: $" + gameState.pot + "</h2>") : "") +
									("<h2>dealer: $" + gameState.dealer.chips + "</h2>" + dealerHTML) +
									("<h2>player: $" + gameState.player.chips + "</h2>" + playerHTML)
								var followup = (gameState.playable && !gameState.player.bust && playerSum && playerSum !== 21) ? true : false
								callback({icon: icon, message: message, html: responseHTML, followup: followup})
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"play hangman": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f3dc;"

					// remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()

					// drawings
						var drawings = [
							"        \n" +
							"        \n" +
							"        \n" +
							"        \n" +
							"        \n" +
							"        \n",

							"        \n" +
							"        \n" +
							"        \n" +
							"      | \n" +
							"      | \n" +
							"  ____|_\n",

							"  ____  \n" +
							"  |   | \n" +
							"      | \n" +
							"      | \n" +
							"      | \n" +
							"  ____|_\n",

							"  ____  \n" +
							"  |   | \n" +
							"  O   | \n" +
							"      | \n" +
							"      | \n" +
							"  ____|_\n",

							"  ____  \n" +
							"  |   | \n" +
							"  O   | \n" +
							"  |   | \n" +
							"      | \n" +
							"  ____|_\n",

							"  ____  \n" +
							"  |   | \n" +
							"  O   | \n" +
							" -|   | \n" +
							"      | \n" +
							"  ____|_\n",

							"  ____  \n" +
							"  |   | \n" +
							"  O   | \n" +
							" -|-  | \n" +
							"      | \n" +
							"  ____|_\n",

							"  ____  \n" +
							"  |   | \n" +
							"  O   | \n" +
							" -|-  | \n" +
							" /    | \n" +
							"  ____|_\n",

							"  ____  \n" +
							"  |   | \n" +
							"  O   | \n" +
							" -|-  | \n" +
							" / \\  | \n" +
							"  ____|_\n"
						]

					// homophones
						var homophones = {
							"eh": "a",
							"hey": "a",
							"bee": "b",
							"sea": "c",
							"see": "c",
							"dee": "d",
							"he": "e",
							"app": "f",
							"gee": "g",
							"chi": "g",
							"each": "h",
							"eye": "i",
							"hi": "i",
							"jay": "j",
							"kay": "k",
							"hell": "l",
							"al": "l",
							"elf": "l",
							"um": "m",
							"and": "n",
							"end": "n",
							"ann": "n",
							"anne": "n",
							"oh": "o",
							"owe": "o",
							"pea": "p",
							"pee": "p",
							"cue": "q",
							"queue": "q",
							"are": "r",
							"our": "r",
							"as": "s",
							"ask": "s",
							"tea": "t",
							"tee": "t",
							"ewe": "u",
							"you": "u",
							"via": "v",
							"vis": "v",
							"viz": "v",
							"double": "w",
							"ax": "x",
							"axe": "x",
							"ex": "x",
							"why": "y",
							"while": "y",
							"the": "z",
							"zed": "z"
						}

					// initialize game
						if (window.CONTEXT_LIBRARY.flow !== "play hangman") {
							// get a random key
								var options = {
									asIs: true,
									url: "http://random-word-api.herokuapp.com/key"
								}

							// proxy to server
								window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
									try {
										// options
											var options = {
												url: "http://random-word-api.herokuapp.com/word?key=" + String(response) + "&number=100"
											}

										// proxy to server
											window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
												try {
													// get words between 6 and 12 letters long
														if (!Array.isArray(response)) {
															response = Array.from(response)
														}
														var words = response.filter(function(word) {
															return 5 < word.length && word.length < 13
														})

													// pick a random word
														var word = window.FUNCTION_LIBRARY.chooseRandom(words).toLowerCase().trim()
														var visibleLetters = []
														while (visibleLetters.length < word.length) {
															visibleLetters.push("_")
														}

													// start the flow
														window.CONTEXT_LIBRARY.flow = "play hangman"
														window.CONTEXT_LIBRARY["play hangman"] = {
															word: word,
															visibleLetters: visibleLetters,
															guessedLetters: [],
															wrongGuesses: 0,
														}

													// gameState
														var gameState = window.CONTEXT_LIBRARY["play hangman"]

													// message
														var message = "The word is " + gameState.word.length + " letters long. Guess a letter."
														var responseHTML = "<h2>" + gameState.visibleLetters.join(" ") + "</h2><pre>" + drawings[gameState.wrongGuesses] + "</pre>guesses: [" + gameState.guessedLetters.join(" ") + "]"

													// response
														callback({icon: icon, message: message, html: responseHTML})
												}
												catch (error) {
													window.CONTEXT_LIBRARY.flow = null
													callback({icon: icon, error: true, message: "I couldn't access the random word API.", html: "<h2>Error: unable to access random word API</h2>"})
												}
											})
									}
									catch (error) {
										window.CONTEXT_LIBRARY.flow = null
										callback({icon: icon, error: true, message: "I couldn't access the random word API.", html: "<h2>Error: unable to access random word API</h2>"})
									}
								})
						}

					// guess a letter
						else {
							// gameState
								var gameState = window.CONTEXT_LIBRARY["play hangman"]

							// identify letter
								var letter = null
								var phraseWords = remainder.split(/\s/gi)
								for (var i in phraseWords) {
									if ((/^[a-z]{1}$/).test(phraseWords[i])) {
										letter = phraseWords[i]
										break
									}
									else if (homophones[phraseWords[i]]) {
										letter = homophones[phraseWords[i]]
										break
									}
								}

							// no letter
								if (!letter) {
									callback({icon: icon, error: true, message: "I couldn't identify that letter.", html: "<h2>Error: invalid guess:</h2>" + remainder})
									return
								}

							// already guessed?
								else if (gameState.guessedLetters.includes(letter)) {
									callback({icon: icon, error: true, message: "You already guessed the letter '" + letter.toUpperCase() + "'.", html: "<h2>Error: duplicate guess:</h2>" + letter})
									return
								}

							// log guess
								gameState.guessedLetters.push(letter)

							// in word
								if (gameState.word.includes(letter)) {
									// update visible letters
										var count = 0
										var blanksCount = 0
										for (var i = 0; i < gameState.word.length; i++) {
											if (gameState.word[i] == letter) {
												count++
												gameState.visibleLetters[i] = letter
											}
											else if (gameState.visibleLetters[i] == "_") {
												blanksCount++
											}
										}

									// still more blanks?
										if (blanksCount) {
											// message
												var message = "The letter '" + letter.toUpperCase() + "' appears " + count + (count == 1 ? " time. " : "times. ") + "The word is now " + gameState.visibleLetters.map(function(l) { return l.replace("_", "blank").toUpperCase() }).join(", ")
												var responseHTML = "<h2>" + gameState.visibleLetters.join(" ") + "</h2><pre>" + drawings[gameState.wrongGuesses] + "</pre>guesses: [" + gameState.guessedLetters.join(" ") + "]"

											// response
												callback({icon: icon, message: message, html: responseHTML})
										}

									// game over (victory)
										else {
											// message
												gameState.visibleLetters = gameState.word.split("")
												var message = "You win. The word was " + gameState.word
												var responseHTML = "<h2>" + gameState.visibleLetters.join(" ") + "</h2><pre>" + drawings[gameState.wrongGuesses] + "</pre>guesses: [" + gameState.guessedLetters.join(" ") + "]"

											// response
												callback({icon: icon, message: message, html: responseHTML})

											// end flow
												window.CONTEXT_LIBRARY.flow = null
												delete window.CONTEXT_LIBRARY["play hangman"]
										}
								}

							// not in word
								else {
									// increment wrong guesses
										gameState.wrongGuesses++

									// game continues
										if (gameState.wrongGuesses < 8) {
											callback({icon: icon, message: "The word does not contain the letter '" + letter.toUpperCase() + "'.", html: "<h2>" + gameState.visibleLetters.join(" ") + "</h2><pre>" + drawings[gameState.wrongGuesses] + "</pre>guesses: [" + gameState.guessedLetters.join(" ") + "]"})
										}

									// game over (loss)
										else {
											// response
												gameState.visibleLetters = gameState.word.split("")
												callback({icon: icon, message: "You lose. The word was " + gameState.word, html: "<h2>" + gameState.visibleLetters.join(" ") + "</h2><pre>" + drawings[8] + "</pre>guesses: [" + gameState.guessedLetters.join(" ") + "]"})

											// end flow
												window.CONTEXT_LIBRARY.flow = null
												delete window.CONTEXT_LIBRARY["play hangman"]
										}
								}
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
	
		// SONOS

		// Wink
			"get wink devices": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4a1;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["api.wink.com"] || !window.CONFIGURATION_LIBRARY["api.wink.com"].access_token || !window.CONFIGURATION_LIBRARY["api.wink.com"].expiration || window.CONFIGURATION_LIBRARY["api.wink.com"].expiration < new Date().getTime()) {
							// attempt to reauthorize
								window.ACTION_LIBRARY["authorize platform"]("wink", function(response) {
									callback(response)
									
									// now authorized? re-run this function
										if (window.CONFIGURATION_LIBRARY["api.wink.com"] && window.CONFIGURATION_LIBRARY["api.wink.com"].access_token && window.CONFIGURATION_LIBRARY["api.wink.com"].expiration && window.CONFIGURATION_LIBRARY["api.wink.com"].expiration >= new Date().getTime()) {
											window.ACTION_LIBRARY["get wink devices"](remainder, callback)
										}
								})
								return
						}

					// build options
						var options = {
							url: "https://api.wink.com/users/me/wink_devices?client_id=" + window.CONFIGURATION_LIBRARY["wink key"] + "&client_secret=" + window.CONFIGURATION_LIBRARY["wink secret"],
							Authorization: "Bearer " + window.CONFIGURATION_LIBRARY["api.wink.com"].access_token
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// loop through response data to build out devices
									var devices = {}
									for (var i in response.data) {
										// get device info & save to device
											var device = {
												uuid: response.data[i].uuid,
												name: response.data[i].name,
												model_name: response.data[i].model_name,
												current_state: null,
												type: null
											}
											devices[device.uuid] = device

										// get device type & current state
											if (response.data[i].light_bulb_id) {
												device.type = "light_bulb"
												device.current_state = response.data[i].last_reading.connection ? (response.data[i].last_reading.powered ? "on" : "off") : "disconnected"
											}
											else if (response.data[i].smoke_detector_id) {
												device.type = "smoke_detector"
												device.current_state = response.data[i].last_reading.connection ? (response.data[i].last_reading.co_detected ? "CO!" : "no CO") + " & " + (response.data[i].last_reading.smoke_detected ? "smoke!" : "no smoke") : "disconnected"
											}
											else if (response.data[i].air_conditioner_id) {
												device.type = "air_conditioner"
												device.current_state = response.data[i].last_reading.connection ? ((response.data[i].last_reading.temperature * 9 / 5) + 32 + "°F") : "disconnected"
											}
											else if (response.data[i].thermostat_id) {
												device.type = "thermostat"
												device.current_state = response.data[i].last_reading.connection ? ((response.data[i].last_reading.temperature * 9 / 5) + 32 + "°F") : "disconnected"
											}
											else if (response.data[i].outlets) {
												device.type = "powerstrip"
												device.current_state = response.data[i].last_reading.connection ? "connected" : "disconnected"

												for (var j in response.data[i].outlets) {
													var subdevice = {
														uuid: response.data[i].outlets[j].uuid,
														name: response.data[i].outlets[j].name,
														model_name: device.model_name + " (outlet)",
														type: "outlet",
														current_state: response.data[i].last_reading.connection ? (response.data[i].outlets[j].last_reading.powered ? "on" : "off") : "disconnected"
													}
													devices[subdevice.uuid] = subdevice
												}
											}
											else {
												device.type = "hub"
												device.current_state = response.data[i].last_reading.connection ? "connected" : "disconnected"
											}
									}
								
								// save devices to configuration library
									var value = window.CONFIGURATION_LIBRARY["api.wink.com"]
										value.devices = devices
									window.FUNCTION_LIBRARY.changeConfiguration({key: "api.wink.com", value: value})

								// assume no lights, no temperature, no smoke
									var lightsOn = 0
									var temperature = 0
									var smoke = 0
									var responseHTML = "<h2>Wink devices</h2><ul>"

								// loop through devices
									for (var i in devices) {
										responseHTML += "<li><b>" + devices[i].name + "</b> - [" + (devices[i].current_state || "") + "]<br>" + devices[i].model_name + "</li>"

										// lights
											if (devices[i].type == "light_bulb" && devices[i].current_state == "on") {
												lightsOn++
											}

										// temperature
											else if (devices[i].type == "thermostat" && devices[i].current_state !== "disconnected") {
												temperature = devices[i].current_state.replace("°F", "")
											}

										// smoke
											else if (devices[i].type == "smoke_detector" && devices[i].current_state !== "disconnected") {
												if (devices[i].current_state.includes("smoke!") || devices[i].current_state.includes("CO!")) {
													smoke = 1
												}
											}
									}
									responseHTML += "</ul>"

								// messages
									var message = (smoke ? "The smoke detector has detected a threat. " : "") +
										"I detected " + Object.keys(devices).length + " devices on Wink. " +
										"The temperature is " + temperature + " degrees. " +
										"There are " + lightsOn + " lights on."

								// response
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get wink devices.", html: "<h2>Error: unable to get Wink devices:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"set wink devices": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4a1;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["api.wink.com"] || !window.CONFIGURATION_LIBRARY["api.wink.com"].access_token || !window.CONFIGURATION_LIBRARY["api.wink.com"].expiration || window.CONFIGURATION_LIBRARY["api.wink.com"].expiration < new Date().getTime()) {
							// attempt to reauthorize
								window.ACTION_LIBRARY["authorize platform"]("wink", function(response) {
									callback(response)
									
									// now authorized? re-run this function
										if (window.CONFIGURATION_LIBRARY["api.wink.com"] && window.CONFIGURATION_LIBRARY["api.wink.com"].access_token && window.CONFIGURATION_LIBRARY["api.wink.com"].expiration && window.CONFIGURATION_LIBRARY["api.wink.com"].expiration >= new Date().getTime()) {
											window.ACTION_LIBRARY["set wink devices"](remainder, callback)
										}
								})
								return
						}

					// missing devices?
						else if (!window.CONFIGURATION_LIBRARY["api.wink.com"].devices || !Object.keys(window.CONFIGURATION_LIBRARY["api.wink.com"].devices).length) {
							// get devices first
								window.ACTION_LIBRARY["get wink devices"](null, function(response) {
									callback(response)
									
									// devices set? re-run this function
										if (window.CONFIGURATION_LIBRARY["api.wink.com"].devices && Object.keys(window.CONFIGURATION_LIBRARY["api.wink.com"].devices).length) {
											window.ACTION_LIBRARY["set wink devices"](remainder, callback)
										}
								})
								return
						}

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I adjust?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// split remainder
						var components = remainder.split(/ to | become | into | at /gi)
						var deviceName = components[0].trim().replace(/the /gi,"")
						var desiredState = window.FUNCTION_LIBRARY.getDigits(components[1].trim())

					// replace number words with numbers
						deviceName = deviceName.split(/\s/gi)
						for (var word in deviceName) {
							deviceName[word] = window.FUNCTION_LIBRARY.getDigits(deviceName[word])
						}
						deviceName = deviceName.join(" ")

					// groups
						var group = null
						if (["all lights"].includes(deviceName)) {
							group = "lights"
						}
						else if (["temperature", "thermostat", "heat", "air conditioner", "air conditioning", "fan"].includes(deviceName)) {
							group = "temperature"
						}

					// identify devices
						var deviceIds = []
						if (group == "lights") {
							deviceIds = Object.keys(window.CONFIGURATION_LIBRARY["api.wink.com"].devices).filter(function(d) {
								return window.CONFIGURATION_LIBRARY["api.wink.com"].devices[d].type == "light_bulb"
							}) || []
						}
						else if (group == "temperature") {
							deviceIds = Object.keys(window.CONFIGURATION_LIBRARY["api.wink.com"].devices).filter(function(d) {
								return ["air_conditioner", "thermostat"].includes(window.CONFIGURATION_LIBRARY["api.wink.com"].devices[d].type)
							}) || []
						}
						else {
							deviceNames = deviceName.split(" and ")
							for (var i in deviceNames) {
								var deviceId = Object.keys(window.CONFIGURATION_LIBRARY["api.wink.com"].devices).find(function(d) {
									return window.CONFIGURATION_LIBRARY["api.wink.com"].devices[d].name.toLowerCase() == deviceNames[i]
								}) || null
								if (deviceId) {
									deviceIds.push(deviceId)
								}
							}
						}

					// no devices?
						if (!deviceIds.length) {
							callback({icon: icon, error: true, message: "I couldn't identify that device.", html: "<h2>Error: unable to identify device:</h2>" + deviceName})
							return
						}

					// identify state
						if (desiredState == "on" || desiredState == "active" || desiredState == "powered") {
							desiredState = {powered: true}
						}
						else if (desiredState == "off" || desiredState == "inactive" || desiredState == "unpowered") {
							desiredState = {powered: false}
						}
						else if (!isNaN(desiredState) && group == "temperature") {
							var farenheit = Number(desiredState) + " degrees"
							var celsius = (desiredState - 32) * 5 / 9
							desiredState = {max_set_point: celsius, min_set_point: celsius}
						}
						else {
							callback({icon: icon, error: true, message: "I couldn't understand that desired state.", html: "<h2>Error: unable to set state:</h2>" + desiredState})
							return
						}

					// generate message & html
						var responseHTML = "<h2>Wink devices updated</h2><ul>"
						for (var i in deviceIds) {
							responseHTML += "<li>" + window.CONFIGURATION_LIBRARY["api.wink.com"].devices[deviceIds[i]].name + ": " + JSON.stringify(desiredState) + "</li>"
						}
						responseHTML += "</ul>"
						var messageState = (desiredState.powered === true) ? "on" : (desiredState.powered === false) ? "off" : (desiredState.max_set_point || desiredState.min_set_point) ? farenheit : "unknown"

					// response
						var message = "Okay, I set " + deviceName + " to " + messageState
						callback({icon: icon, message: message, html: responseHTML})

					// actually attempt to set the desiredState for each device
						for (var i in deviceIds) {
							// build options
								var options = {
									method: "put",
									url: "https://api.wink.com/" + window.CONFIGURATION_LIBRARY["api.wink.com"].devices[deviceIds[i]].type + "s/" + deviceIds[i] + "/desired_state?client_id=" + window.CONFIGURATION_LIBRARY["wink key"] + "&client_secret=" + window.CONFIGURATION_LIBRARY["wink secret"],
									Authorization: "Bearer " + window.CONFIGURATION_LIBRARY["api.wink.com"].access_token,
									body: {
										"desired_state": desiredState
									}
								}

							// proxy
								window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
									try {
										if (response.errors && response.errors.length) {
											callback({icon: icon, error: true, message: "I was unable to update a device.", html: "<h2>Error: Wink responded with these errors:</h2><li>" + response.errors.join("</li><li>") + "</li>"})
										}
									}
									catch (error) {
										callback({icon: icon, error: true, message: "I was unable to update a device.", html: "<h2>Error: Wink responded with these errors:</h2><li>" + error + "</li>"})
									}
								})
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"turn off wink device": function(remainder, callback) {
				try {
					// proxy to set wink devices
						window.ACTION_LIBRARY["set wink devices"](remainder + " to off", callback)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"turn on wink device": function(remainder, callback) {
				try {
					// proxy to set wink devices
						window.ACTION_LIBRARY["set wink devices"](remainder + " to on", callback)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// Reddit
			"ask reddit": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4bb;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["www.reddit.com"] || !window.CONFIGURATION_LIBRARY["www.reddit.com"].access_token || !window.CONFIGURATION_LIBRARY["www.reddit.com"].expiration || window.CONFIGURATION_LIBRARY["www.reddit.com"].expiration < new Date().getTime()) {
							// attempt to reauthorize
								window.ACTION_LIBRARY["authorize platform"]("reddit", function(response) {
									callback(response)
									
									// now authorized? re-run this function
										if (window.CONFIGURATION_LIBRARY["www.reddit.com"] && window.CONFIGURATION_LIBRARY["www.reddit.com"].access_token && window.CONFIGURATION_LIBRARY["www.reddit.com"].expiration && window.CONFIGURATION_LIBRARY["www.reddit.com"].expiration >= new Date().getTime()) {
											window.ACTION_LIBRARY["ask reddit"](remainder, callback)
										}
								})
								return
						}

					// options
						var options = {
							"User-Agent": "web:bluejay:v1 (by /u/quargy)",
							Authorization: "Bearer " + window.CONFIGURATION_LIBRARY["www.reddit.com"].access_token,
							url: "https://oauth.reddit.com/r/askreddit/"
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// shuffle results
									var questions = window.FUNCTION_LIBRARY.sortRandom(response.data.children)

								// all results
									var results = []
									for (var i in questions) {
										var message = questions[i].data.title
										var responseHTML = "<a target='_blank' href='" + questions[i].data.url + "'><h2>" + questions[i].data.title + "</h2></a>"
										results.push({icon: icon, message: message, html: responseHTML})
									}

								// send response
									var firstResult = results.shift()
									callback({icon: icon, message: firstResult.message, html: firstResult.html, results: results})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I don't have any questions.", html: "<h2>Error: unable to access reddit</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get a reddit writing prompt": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4bb;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["www.reddit.com"] || !window.CONFIGURATION_LIBRARY["www.reddit.com"].access_token || !window.CONFIGURATION_LIBRARY["www.reddit.com"].expiration || window.CONFIGURATION_LIBRARY["www.reddit.com"].expiration < new Date().getTime()) {
							// attempt to reuathorize
								window.ACTION_LIBRARY["authorize platform"]("reddit", function(response) {
									callback(response)
									
									// now authorized? re-run this function
										if (window.CONFIGURATION_LIBRARY["www.reddit.com"] && window.CONFIGURATION_LIBRARY["www.reddit.com"].access_token && window.CONFIGURATION_LIBRARY["www.reddit.com"].expiration && window.CONFIGURATION_LIBRARY["www.reddit.com"].expiration >= new Date().getTime()) {
											window.ACTION_LIBRARY["get a reddit writing prompt"](remainder, callback)
										}
								})
								return
						}

					// options
						var options = {
							"User-Agent": "web:bluejay:v1 (by /u/quargy)",
							Authorization: "Bearer " + window.CONFIGURATION_LIBRARY["www.reddit.com"].access_token,
							url: "https://oauth.reddit.com/r/writingprompts/"
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// shuffle results
									var prompts = window.FUNCTION_LIBRARY.sortRandom(response.data.children)

								// all results
									var results = []
									for (var i in prompts) {
										var message = prompts[i].data.title
										var responseHTML = "<a target='_blank' href='" + prompts[i].data.url + "'><h2>" + prompts[i].data.title + "</h2></a>"
										results.push({icon: icon, message: message, html: responseHTML})
									}

								// send response
									var firstResult = results.shift()
									callback({icon: icon, message: firstResult.message, html: firstResult.html, results: results})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I don't have any writing prompts.", html: "<h2>Error: unable to access reddit</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// custom APIs
			"convert": function(remainder, callback) {
				try {
					// icon
						var icon = "&#9878;"

					// no remainder
						remainder = " " + remainder.replace(/[?!,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I convert?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// parameters
						var toUnit = remainder.split(/ into | to /gi)
							toUnit = (toUnit[1] || toUnit[0]).split(/ from /gi)[0].trim()

						var fromUnit = remainder.split(/ from /gi)
							fromUnit = (fromUnit[1] || fromUnit[0]).split(/ into | to /gi)[0].trim()
						
						var words = fromUnit.split(/\s/gi)
							for (var i in words) {
								words[i] = window.FUNCTION_LIBRARY.getDigits(words[i].trim())
							}
							words = words.join(" ")
							fromUnit = words.replace(/[0-9]/gi,"").trim()
						
						var quantity = Number(words.replace(/[^0-9]/gi,"")) || 1

					// options
						var options = {
							url: "https://us-central1-projects-3bd0e.cloudfunctions.net/unitconverter?quantity=" + quantity + "&from=" + fromUnit + "&to=" + toUnit
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// failure
									if (!response.success) {
										callback({icon: icon, error: true, message: "I was unable to convert from " + fromUnit + "to" + toUnit, html: "<h2>Error: unable to convert:</h2>" + response.message + "<br></br>" + quantity + " " + fromUnit + " = <b>???</b> " + toUnit})
										return
									}
								
								// get output
									var outputQuantity = Number(response.output).toLocaleString("fullwide", {useGrouping: true, maximumSignificantDigits: 21})
									var outputFromUnit = (response.parameters.from.prefix !== "_" ? response.parameters.from.prefix : "") + response.parameters.from.unit
									var outputToUnit   = (response.parameters.to.prefix   !== "_" ? response.parameters.to.prefix   : "") + response.parameters.to.unit

								// response
									var message = outputQuantity + " " + outputToUnit
									var responseHTML = "<h2>" + response.parameters.quantity + " " + outputFromUnit + " = <b>" + outputQuantity + "</b> " + outputToUnit + "</h2>"
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to convert.", html: "<h2>Error: unable to access unitConverter</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"find factors": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x2a37;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// parameters
						var input = window.FUNCTION_LIBRARY.getDigits(remainder)

					// options
						var options = {
							url: "https://us-central1-projects-3bd0e.cloudfunctions.net/factorfinder?number=" + input
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// failure
									if (!response.success) {
										callback({icon: icon, error: true, message: "I was unable to find the factors of " + remainder, html: "<h2>Error: unable to find factors:</h2>" + response.message})
										return
									}
								
								// generate message
									var message = response.qualities.map(function(q) {
										return q.replace("<li>","").replace("</li>","").replace(/\<\/?br\>/gi," ")
									}) || []
										message[0] = message[0].replace(/x/gi, "times")
										message = message.join("... ")
										message = "Here's what I found for " + input + ": " + message

								// response
									var responseHTML = "<h2>" + input + "</h2><ul>" + response.html + "</ul>"
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to fetch that number.", html: "<h2>Error: unable to access factorFinder</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"analyze chord": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f3b5;"

					// no remainder
						remainder = remainder.replace(/[?!.:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I analyze?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// parameters
						var input = remainder.replace(/and/gi,"")
							input = input.split(/,\s|,|\s/gi)
						for (var i in input) {
							input[i] = input[i].slice(0,1).toUpperCase() + input[i].slice(1,input[i].length)
						}
							input = input.join(",")

					// options
						var options = {
							url: "https://us-central1-projects-3bd0e.cloudfunctions.net/chordanalyzer?notes=" + encodeURIComponent(input)
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// failure
									if (!response.success) {
										callback({icon: icon, error: true, message: "I was unable to do a chordal analysis of " + remainder, html: "<h2>Error: unable to analyze chord:</h2>" + response.message})
										return
									}
								
								// response
									var message = response.smallOutput.replace(/\#/gi," sharp").replace(/b/g, " flat")
									var responseHTML = response.chord.join(" - ") + "<h2>" + response.bigOutput + "</h2>" + response.smallOutput
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to analyze that chord.", html: "<h2>Error: unable to access chordAnalyzer</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"shuffle word": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f500;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I shuffle?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// parameters
						var input = remainder

					// options
						var options = {
							url: "https://us-central1-projects-3bd0e.cloudfunctions.net/wordshuffler?word=" + input
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// failure
									if (!response.success) {
										callback({icon: icon, error: true, message: "I was unable to shuffle the word " + remainder, html: "<h2>Error: unable to shuffle word:</h2>" + response.message})
										return
									}
							
								// get word list
									var wordList = []
									for (var i in response.results) {
										for (var j in response.results[i]) {
											wordList.push(response.results[i][j])
										}
									}

								// response
									var message = "I found " + wordList.length + " words within " + input + ": " + wordList.join(", ")
									var responseHTML = "<h2>" + input + "</h2>" + response.html
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to shuffle that word.", html: "<h2>Error: unable to access wordShuffler</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
	}
