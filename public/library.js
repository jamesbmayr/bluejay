/* phrase library */
	window.PHRASE_LIBRARY = {
		// settings
			"change voice to": 					"change voice",
			"change the voice to": 				"change voice",
			"set voice to": 					"change voice",
			"set the voice to": 				"change voice",
			"set new voice": 					"change voice",
			"switch voice to": 					"change voice",
			"switch the voice to": 				"change voice",

			"change volume to": 				"change volume",
			"change the volume to": 			"change volume",
			"set volume to": 					"change volume",
			"set the volume to": 				"change volume",
			"set new volume": 					"change volume",

			"edit configuration": 				"edit configuration",
			"edit configuration for": 			"edit configuration",
			"set configuration": 				"edit configuration",
			"set configuration for": 			"edit configuration",
			"set my configuration for": 		"edit configuration",
			"set a new configuration": 			"edit configuration",
			"change a configuration": 			"edit configuration",
			"change my configuration": 			"edit configuration",
			"change my configuration for": 		"edit configuration",
			"add to my profile": 				"edit configuration",
			"add this to my profile": 			"edit configuration",
			"edit my profile": 					"edit configuration",
			"save my": 							"edit configuration",
			"set my saved": 					"edit configuration",
			"change my saved": 					"edit configuration",
			"update my saved": 					"edit configuration",
			"configure my": 					"edit configuration",
			"configure": 						"edit configuration",

		// meta
			"repeat after me": 					"repeat after me",
			"say what i say": 					"repeat after me",
			"say exactly what i say": 			"repeat after me",
			"say this back": 					"repeat after me",
			"jot this down": 					"repeat after me",
			"copy this down": 					"repeat after me",
			"write this down": 					"repeat after me",

		// time
			"what time is it": 					"what time is it",
			"what is the time": 				"what time is it",
			"whats the time": 					"what time is it",
			"tell me the time": 				"what time is it",

			"what day is it": 					"what day is it",
			"what day is today": 				"what day is it",
			"whats the day": 					"what day is it",
			"whats today": 						"what day is it",
			"tell me the day": 					"what day is it",

			"what month is it": 				"what month is it",
			"what is the month": 				"what month is it",
			"whats the month": 					"what month is it",
			"tell me the month": 				"what month is it",

			"what is the date": 				"what is the date",
			"what is todays date": 				"what is the date",
			"whats the date": 					"what is the date",
			"tell me the date": 				"what is the date",

		// rng
			"roll a": 							"roll dice",
			"roll me a": 						"roll dice",
			"roll a die": 						"roll dice",
			"roll me": 							"roll dice",
			"roll me some": 					"roll dice",
			"roll some dice": 					"roll dice",
			"roll some": 						"roll dice",
			"roll": 							"roll dice",

			"flip a coin": 						"flip a coin",
			"heads or tails": 					"flip a coin",

		// math
			"calculate": 						"calculate",
			"lets do some math": 				"calculate",
			"do some math for me": 				"calculate",
			"add": 								"calculate",
			"subtract": 						"calculate",
			"multiply": 						"calculate",
			"divide": 							"calculate",
			
			"double": 							"double",
			"triple": 							"triple",

			"average": 							"average",
			"find the average of": 				"average",
			"what is the average of": 			"average",
			"whats the average of": 			"average",

		// word api fetches
			"what rhymes with": 				"find rhymes",
			"find a rhyme for": 				"find rhymes",
			"find rhymes for": 					"find rhymes",
			"get a rhyme for": 					"find rhymes",
			"get rhymes for": 					"find rhymes",
			"rhymes with": 						"find rhymes",
			"something that rhymes with": 		"find rhymes",

			"what is a synonym for": 			"find synonyms",
			"find a synonym for": 				"find synonyms",
			"find synonyms for": 				"find synonyms",
			"get a synonym for": 				"find synonyms",
			"get synonyms for": 				"find synonyms",
			"synonym of": 						"find synonyms",
			"what has the same meaning as": 	"find synonyms",

			"define": 							"define",
			"define the word": 					"define",
			"look up the word": 				"define",
			"provide a definition for": 		"define",
			"what is the meaning of": 			"define",
			"whats the meaning of": 			"define",

		// content api fetches
			"tell me a joke": 					"tell a joke",
			"know any jokes": 					"tell a joke",
			"do you know any jokes": 			"tell a joke",
			"say something funny": 				"tell a joke",
			"be funny": 						"tell a joke",
			"i could use a joke": 				"tell a joke",
			"tell a joke": 						"tell a joke",

			"get a quote": 						"get a quote",
			"get me a quote": 					"get a quote",
			"give me a quote": 					"get a quote",
			"get a random quote": 				"get a quote",
			"get me a random quote": 			"get a quote",
			"give me a random quote": 			"get a quote",
			"random quote": 					"get a quote",
			"famous quote": 					"get a quote",

			"get the headlines": 				"get the headlines",
			"get todays headlines": 			"get the headlines",
			"whats happening in the world": 	"get the headlines",
			"what is happening in the world": 	"get the headlines",
			"get the top stories": 				"get the headlines",
			"get me the news": 					"get the headlines",
			"give me the news": 				"get the headlines",
			"fetch the news": 					"get the headlines",
			"what is the news": 				"get the headlines",
			"whats the news": 					"get the headlines",
			"whats the latest news": 			"get the headlines",
			"what is the latest news": 			"get the headlines",
			"whats happening in the news": 		"get the headlines",
			"what is happening in the news": 	"get the headlines",
			"read the headlines": 				"get the headlines",
			"read me the headlines": 			"get the headlines",

		// Google Apps Script
			"add to wish list": 				"wish list",
			"add to my wish list": 				"wish list",
			"add this to my wish list": 		"wish list",
			"include on my wish list": 			"wish list",
			"edit my wish list to include": 	"wish list",

			"what is my account balance for": 	"get balance",
			"whats my account balance for": 	"get balance",
			"check my account balance for": 	"get balance",
			"how much money do i have in": 		"get balance",
			"how much do i have in": 			"get balance",
			"how much money do i have in my": 	"get balance",
			"how much do i have in my": 		"get balance",
			"what is the balance in my": 		"get balance",
			"whats the balance in my": 			"get balance",
			"what is the balance on my": 		"get balance",
			"whats the balance on my": 			"get balance",
			"how much money is left in my": 	"get balance",
			"how much money is in my": 			"get balance",
			"how much is in my": 				"get balance",

			"i just bought": 					"log purchase",
			"i bought": 						"log purchase",
			"add a purchase": 					"log purchase",
			"add a purchase of": 				"log purchase",
			"add my purchase": 					"log purchase",
			"add my purchase of": 				"log purchase",
			"record a purchase": 				"log purchase",
			"record my purchase": 				"log purchase",
			"record a purchase of": 			"log purchase",
			"record my purchase of": 			"log purchase",
			"log a purchase": 					"log purchase",
			"log my purchase": 					"log purchase",
			"log a purchase of": 				"log purchase",
			"log my purchase of": 				"log purchase",

			"fetch events": 					"fetch events",
			"fetch my events": 					"fetch events",
			"fetch upcoming events": 			"fetch events",
			"fetch my upcoming events": 		"fetch events",
			"fetch my calendar": 				"fetch events",
			"what is on my calendar": 			"fetch events",
			"whats on my calendar": 			"fetch events",
			"what is on the calendar": 			"fetch events",
			"whats on the calendar": 			"fetch events",
			"what is happening": 				"fetch events",
			"whats happening": 					"fetch events",

		// Google APIs
			"look this up on google": 			"google search",
			"do a google search": 				"google search",
			"do a google search for": 			"google search",
			"google": 							"google search",
			"do a search for": 					"google search",
			"do a search": 						"google search",
			"search": 							"google search",
			"i wonder if": 						"google search",
			"i wonder": 						"google search",
			"i am curious": 					"google search",
			"im curious": 						"google search",
	}

/* action library */
	window.ACTION_LIBRARY = {
		// settings
			"change voice": function(remainder, callback) {
				try {
					var name = remainder.toLowerCase().replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").trim()
					callback(window.FUNCTION_LIBRARY.changeVoice({phrase: name}))
				} catch (error) {}
			},
			"change volume": function(remainder, callback) {
				try {
					var volume = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").trim()
					callback(window.FUNCTION_LIBRARY.changeVolume({phrase: volume}))
				} catch (error) {}
			},
			"edit configuration": function(remainder, callback) {
				try {
					// get key and value
						var pair = remainder.split(/ equal to | equals | to | is | as /gi)
						if (pair[0] === undefined || pair[0] === null || pair[1] === undefined || pair[1] === null) {
							callback({message: "The key or value is missing.", html: "invalid key or value"})
							return
						}
						else {
							var key = String(pair[0]).toLowerCase()
							var value = String(pair[1])
						}

					// try converting to number
						if (!isNaN(Number(value))) {
							value = Number(value)
						}

					// save and respond
						callback(window.FUNCTION_LIBRARY.changeConfiguration({key: key, value: value}))
				} catch (error) {}
			},

		// meta
			"repeat after me": function(remainder, callback) {
				try {
					callback({message: remainder, html: remainder})
				} catch (error) {}
			},

		// time
			"what time is it": function(remainder, callback) {
				try {
					var response = new Date().toLocaleTimeString()
					callback({message: response, html: "The time is " + response + "."})
				} catch (error) {}
			},
			"what day is it": function(remainder, callback) {
				try {
					var response = (["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][new Date().getDay()])
					callback({message: response, html: "Today is " + response + "."})
				} catch (error) {}
			},
			"what month is it": function(remainder, callback) {
				try {
					var response = (["January","February","March","April","May","June","July","August","September","October","November","December"][new Date().getMonth()])
					callback({message: response, html: "The month is " + response + "."})
				} catch (error) {}
			},
			"what is the date": function(remainder, callback) {
				try {
					var response = (["January","February","March","April","May","June","July","August","September","October","November","December"][new Date().getMonth()] + " " + new Date().getDate())
					callback({message: response, html: "The date is " + response + "."})
				} catch (error) {}
			},

		// rng
			"roll dice": function(remainder, callback) {
				try {
					console.log(remainder)
					// extract options					
						var count = Number(remainder.split(/dice with |die with |dice having |d/gi)[0]) || 1
						var sides = (remainder.split(/dice with |die with |d/gi)[1] || remainder).replace(/[^0-9]/gi,"") || 6

					// roll dice
						var sum = 0
						for (var i = 0; i < count; i++) {
							sum += Math.floor(Math.random() * sides) + 1
						}

					// return sum
						callback({message: sum || "Unable to roll dice.", html: count + "d" + sides + ": " + (sum || "invalid dice")})
				} catch (error) { console.log(error) }
			},
			"flip a coin": function(remainder, callback) {
				try {
					var response = ["heads","tails"][Math.floor(Math.random() * 2)]
					callback({message: response, html: "coin: " + response})
				} catch (error) {}
			},
		
		// math
			"calculate": function(remainder, callback) {
				try {
					// loop through and identify terms
						var terms = remainder.split(/\s/gi)
						for (var i = 0; i < terms.length; i++) {
							if (isNaN(terms[i])) {
								terms[i] = terms[i].toLowerCase()
								if      (terms[i] == "by")      { terms[i] = "" }
								else if (terms[i] == "of")      { terms[i] = "" }
								else if (terms[i] == "plus")    { terms[i] = "+" }
								else if (terms[i] == "minus")   { terms[i] = "-" }
								else if (terms[i] == "times")   { terms[i] = "*" }
								else if (terms[i] == "divided") { terms[i] = "/" }
								else if (terms[i] == "squared") { terms[i] = "** 2" }
								else if (terms[i] == "cubed")   { terms[i] = "** 3" }
								else if (terms[i] == "halved")  { terms[i] = "/ 2" }
								else if (terms[i] == "power")   { terms[i] = "**" }
								else if (terms[i] == "root")    { terms[i] = "** (1/"; terms.splice(i + 2, 0, ")")}
								else if (terms[i] == "percent") { terms[i] = "/ 100 *"}
								else if (terms[i] == "(" || terms[i] == ")") {}
							}
							else {
								terms[i] = Number(terms[i])
							}
						}

					// evaluate and return result
						var result = eval(terms.join(" "))
						if (isNaN(result)) {
							callback({message: "Unable to calculate.", html: "invalid calculation: " + remainder})
						}
						else {
							callback({message: Number(result), html: terms.join(" ") + " = " + result})
						}
				}
				catch (error) { callback({message: "Unable to calculate.", html: "invalid calculation"}) }
			},
			"double": function(remainder, callback) {
				try {
					var term = remainder.replace(/[?!,:;'"_\/\(\)\$\%]/gi,"")
					var result = 2 * Number(term)
					if (isNaN(result)) {
						callback({message: "Unable to calculate.", html: "invalid calculation"})
					}
					else {
						callback({message: Number(result), html: "2 * " + term + " = " + result})
					}
				}
				catch (error) { callback({message: "Unable to calculate.", html: "invalid calculation"}) }
			},
			"triple": function(remainder, callback) {
				try {
					var term = remainder.replace(/[?!,:;'"_\/\(\)\$\%]/gi,"")
					var result = 3 * Number(term)
					if (isNaN(result)) {
						callback({message: "Unable to calculate.", html: "invalid calculation"})
					}
					else {
						callback({message: Number(result), html: "3 * " + term + " = " + result})
					}
				}
				catch (error) { callback({message: "Unable to calculate.", html: "invalid calculation"}) }
			},
			"average": function(remainder, callback) {
				try {
					// loop through and aggregate terms
						var terms = remainder.replace(/[?!,:;'"_\/\(\)\$\%]/gi,"").split(/\s/gi)
						var numbers = []
						for (var i = 0; i < terms.length; i++) {
							if (!isNaN(terms[i])) {
								numbers.push(Number(terms[i]))
							}
						}

						var result = numbers.reduce(function(total, term) {
							return (total + term)
						}) / (numbers.length || 1)

					// return result
						if (isNaN(result)) {
							callback({message: "Unable to calculate.", html: "invalid calculation"})
						}
						else {
							callback({message: Number(result), html: numbers.join(" + ") + " / " + numbers.length + " = " + result})
						}
				}
				catch (error) { callback({message: "Unable to calculate.", html: "invalid calculation"}) }
			},

		// word api fetches
			"find rhymes": function(remainder, callback) {
				try {
					// options
						var options = {
							url: "https://api.datamuse.com/words?rel_rhy=" + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// construct response list
									var list = response || []
									var listItems = []
									for (var i in list) {
										list[i] = list[i].word
										listItems[i] = "<li>" + list[i] + "</li>"
									}

								// message, link, list
									var message = "I found " + list.length + " rhyme" + (list.length == 1 ? "" : "s") + " for " + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").trim() + "."
									var link = "<a target='_blank' href='https://rhymezone.com/r/rhyme.cgi?typeofrhyme=perfect&Word=" + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim() + "'>" + message + "</a>"
									callback({message: message + " " + list.join(","), html: link + "<ul>" + listItems.join("") + "</ul>"})
							}
							catch (error) {
								callback({message: "I can't rhyme that.", html: "invalid word: " + remainder})
							}
						})
				} catch (error) {}
			},

			"find synonyms": function(remainder, callback) {
				try {
					// options
						var options = {
							url: "https://api.datamuse.com/words?rel_syn=" + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// construct response list
									var list = response || []
									var listItems = []
									for (var i in list) {
										list[i] = list[i].word
										listItems[i] = "<li>" + list[i] + "</li>"
									}

								// message, link, list
									var message = "I found " + list.length + " synonym" + (list.length == 1 ? "" : "s") + " for " + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").trim() + "."
									var link = "<a target='_blank' href='https://rhymezone.com/r/rhyme.cgi?typeofrhyme=syn&Word=" + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim() + "'>" + message + "</a>"
									callback({message: message + " " + list.join(","), html: link + "<ul>" + listItems.join("") + "</ul>"})
							}
							catch (error) {
								callback({message: "I don't know any synonyms for that.", html: "invalid word: " + remainder})
							}
						})
				} catch (error) {}
			},

			"define": function(remainder, callback) {
				try {
					// options
						var options = {
							url: "https://api.datamuse.com/words?md=d&sp=" + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// construct response list
									var word = response[0]
									var list = []
									var listItems = []
									for (var i in word.defs) {
										word.defs[i] = "[" + word.defs[i].replace(/\t/,"] ")
										word.defs[i] = word.defs[i].replace("[n]", "[noun]").replace("[v]", "[verb]").replace("[adj]", "[adjective]").replace("[adv]", "[adverb]").replace("[u]", "[other]")
										list[i] = word.defs[i]
										listItems[i] = "<li>" + word.defs[i] + "</li>"
									}

								// message, link, list
									var message = "I found " + list.length + " definition" + (list.length == 1 ? "" : "s") + " for " + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").trim() + "."
									var link = "<a target='_blank' href='http://wordnetweb.princeton.edu/perl/webwn?s=" + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim() + "'>" + message + "</a>"
									callback({message: message + " " + list.join(","), html: link + "<ul>" + listItems.join("") + "</ul>"})
							}
							catch (error) {
								callback({message: "I can't define that.", html: "invalid word: " + remainder})
							}
						})
				} catch (error) {}
			},

		// content api fetches
			"tell a joke": function(remainder, callback) {
				try {
					// options
						var options = {
							url: "https://icanhazdadjoke.com/slack"
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// construct response link
									var jokeLink = "https://icanhazdadjoke.com"
									var jokeText = response.attachments[0].text
									callback({message: jokeText, html: "<a target='_blank' href='" + jokeLink + "'>" + jokeText + "</a>"})
							}
							catch (error) {
								callback({message: "I don't know any jokes.", html: "unable to access jokes"})
							}
							
						})
				} catch (error) {}
			},

			"get a quote": function(remainder, callback) {
				try {
					// options
						var options = {
							url: "http://api.forismatic.com/api/1.0/?method=getQuote&format=json&lang=en"
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// construct response link
									var quoteLink   = response.quoteLink
									var quoteText   = response.quoteText
									var quoteAuthor = response.quoteAuthor
									callback({message: quoteAuthor + " said " + quoteText, html: "<a target='_blank' href='" + quoteLink + "'>\"" + quoteText + "\" - " + quoteAuthor + "</a>"})
							}
							catch (error) {
								callback({message: "I don't know any quotes.", html: "unable to access quotes"})
							}
						})
				} catch (error) {}
			},

			"get the headlines": function(remainder, callback) {
				try {
					// initial callback
						callback({message: "Let me fetch the latest news.", html: "querying the New York Times..."})

					// options
						var options = {
							url: "https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml"
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// construct response list
									var list = response.rss.channel.item
									var stories = []
									var storyItems = []
									for (var i = 0; i < list.length - 1; i++) {
										stories.push(list[i].title + " " + list[i].description)
										storyItems.push("<li><a target='_blank' href='" + list[i].link + "'><b>" + list[i].title + "</b></a><p>" + list[i].description + "</p></li>")
									}

								// message, link, list
									var message = "I found " + stories.length + " stor" + (list.length == 1 ? "y" : "ies") + "."
									callback({message: message + " " + stories.join("... "), html: message + "<ul>" + storyItems.join("") + "</ul>"})
							}
							catch (error) {
								callback({message: "I can't get the news.", html: "unable to access headlines"})
							}
						})
				}
				catch (error) {}
			},

		// Google Apps Script
			"wish list": function(remainder, callback) {
				try {
					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "missing configuration: google apps script"})
							return
						}

					// split at space
						var cost = remainder.split(/ for | costing | that costs | which costs /gi)
							cost = (cost[1] || cost[0]).split(/ called | named | by the name | which is a | which is an | which is the /gi)[0].trim()

						var item = remainder.split(/ called | named | by the name /gi)
							item = (item[1] || item[0]).split(/ for | costing | that costs | which costs | which is a | which is an | which is the /gi)[0].trim()

						var type = remainder.split(/ which is a | which is an | which is the /gi)
							type = (type[1] || type[0]).split(/ for | costing | that costs | which costs | called | named | by the name /gi)[0].trim()

					// build options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=listWish&item=" + item + "&cost=" + cost + "&type=" + type
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							var responseHTML = "<ul><li><b>item: </b>" + response.item + "</li><li><b>cost: </b>" + response.cost + "</li><li><b>type: </b>" + response.type + "</li></ul>" 
							callback({message: response.message, html: responseHTML})
						})
				}
				catch (error) { console.log(error) }
			},

			"get balance": function(remainder, callback) {
				try {
					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "missing configuration: google apps script"})
							return
						}

					// build options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=getBalance&account=" + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							var responseHTML = "<ul><li><b>account: </b>" + response.account + "</li><li><b>amount: </b>" + response.amount + "</li></ul>" 
							callback({message: response.message, html: responseHTML})
						})
				}
				catch (error) { console.log(error) }
			},

			"log purchase": function(remainder, callback) {
				try {
					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "missing configuration: google apps script"})
							return
						}

					// split at space
						var amount = remainder.split(/ for | costing | that cost | that costs | which cost | which costs /gi)
							amount = (amount[1] || amount[0]).split(/ called | named | by the name | item | which is a | which is an | which is the | which is type | which is category | which is | type | category /gi)[0].trim()
							amount = amount.replace("$","")

						var description = remainder.split(/ called | named | by the name | item /gi)
							description = (description[1] || description[0]).split(/ for | costing | that cost | that costs | which cost | which costs | which is a | which is an | which is the | which is type | which is category | which is | type | category /gi)[0].trim()

						var category = remainder.split(/ which is a | which is an | which is the | which is type | which is category | which is | type | category /gi)
							category = (category[1] || category[0]).split(/ for | costing | that cost | that costs | which cost | which costs | called | named | by the name | item /gi)[0].trim()

					// build options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=logPurchase&category=" + category + "&description=" + description + "&amount=" + amount
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							var responseHTML = "<ul><li><b>description: </b>" + response.description + "</li><li><b>amount: </b>" + response.amount + "</li><li><b>category: </b>" + response.category + "</li></ul>" 
							callback({message: response.message, html: responseHTML})
						})
				}
				catch (error) { console.log(error) }
			},

			"fetch events": function(remainder, callback) {
				try {
					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "missing configuration: google apps script"})
							return
						}

					// split at space
						var startDate = remainder.replace(/[?!,;'"_\(\)\$\%]/gi,"").split(/from |starting at |start date |between |for /gi)
							startDate = (startDate[1] || startDate[0]).split(/ to | until | ending at | end time | and | through /gi)[0].toLowerCase().trim()
							if (startDate == "today")     { startDate = new Date().toLocaleDateString() }
							if (startDate == "yesterday") { startDate = new Date(new Date().getTime() - (1000 * 60 * 60 * 24)).toLocaleDateString() }
							if (startDate == "tomorrow")  { startDate = new Date(new Date().getTime() + (1000 * 60 * 60 * 24)).toLocaleDateString() }

						var endDate = remainder.replace(/[?!,;'"_\(\)\$\%]/gi,"").split(/to |until |ending at |end date |and |through /gi)
							endDate = (endDate[1] || endDate[0]).split(/ from | starting at | start time | between | for /gi)[0].toLowerCase().trim()
							if (endDate == "today")     { endDate = new Date().toLocaleDateString() }
							if (endDate == "yesterday") { endDate = new Date(new Date().getTime() - (1000 * 60 * 60 * 24)).toLocaleDateString() }
							if (endDate == "tomorrow")  { endDate = new Date(new Date().getTime() + (1000 * 60 * 60 * 24)).toLocaleDateString() }

					// build options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=fetchEvents" + (startDate ? "&startDate=" + startDate : "") + (endDate ? "&endDate=" + endDate : "")
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							// create list
								var eventList = []
								var eventItems = []
								if (response.events) {
									for (var i = 0; i < response.events.length; i++) {
										var event = response.events[i]
										var startTime = new Date(event.startTime).toLocaleString()
										var endTime = new Date(event.endTime).toLocaleString()

										eventList.push(event.title + " from " + startTime + " until " + endTime + " at " + (event.location || "unknown location"))
										eventItems.push("<li><b>" + event.title + "</b><p>" + startTime + " - " + endTime + "<br><a target='_blank' href='https://www.google.com/maps/?q=" + event.location + "'>" + event.location + "</a><br>" + event.description + "</p></li>")
									}
								}

							// send response
								var responseLink = "https://calendar.google.com"
								var responseText = response.message
								callback({message: response.message + " " + eventList.join("..."),html: "<a target='_blank' href='" + responseLink + "'>" + responseText + "</a><ul>" + eventItems.join("") + "</ul>"})
						})
				}
				catch (error) { console.log(error) }
			},

		// Google APIs
			"google search": function(remainder, callback) {
				try {
					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google custom search"]) {
							callback({message: "I'm not authorized to do that yet. Set a configuration for google custom search.", html: "missing configuration: google custom search"})
							return
						}

					// options
						var options = {
							url: window.CONFIGURATION_LIBRARY["google custom search"] + "&q=" + remainder
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							// no results?
								if (!response.items || !response.items.length) {
									var responseLink = "https://www.google.com?q=" + remainder
									var responseText = "No results found."
									var topResultText = ""
									var topResult = ""
								}

							// 1+ results
								else {
									var responseLink = "https://www.google.com?q=" + remainder
									var responseText = "Top result:"
									var topResultText = response.items[0].title + " " + response.items[0].snippet
									var topResult = "<p><a target='_blank' href='" + response.items[0].link + "'><b>" + response.items[0].title + "</b></a><br>" + response.items[0].snippet + "</p>"
								}

							// send response								
								callback({message: responseText + " " + topResultText, html: "<a target='_blank' href='" + responseLink + "'>" + responseText + "</a>" + topResult})
						})
				}
				catch (error) {}
			}
	}
