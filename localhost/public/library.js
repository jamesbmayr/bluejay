/* phrase library */
	window.PHRASE_LIBRARY = {
		// casual responses
			"thank you": 						"receive gratitude",
			"thanks": 							"receive gratitude",
			"i appreciate": 					"receive gratitude",
			"well thank you": 					"receive gratitude",
			"well thanks": 						"receive gratitude",
			"good job": 						"receive gratitude",
			"excellent": 						"receive gratitude",
			"excellent work": 					"receive gratitude",
			"job well done": 					"receive gratitude",
			"well done": 						"receive gratitude",

			"im sorry": 						"receive apology",
			"sorry": 							"receive apology",
			"i am sorry": 						"receive apology",
			"i apologize": 						"receive apology",
			"my apologies": 					"receive apology",
			"apologies": 						"receive apology",
			"can you forgive": 					"receive apology",
			"do you forgive": 					"receive apology",
			"would you forgive": 				"receive apology",

			"who is a good": 					"receive affirmation",
			"whos a good": 						"receive affirmation",
			"whose a good": 					"receive affirmation",
			"who is my good": 					"receive affirmation",
			"whos my good": 					"receive affirmation",
			"whose my good": 					"receive affirmation",
			"youre an excellent": 				"receive affirmation",
			"you are an excellent": 			"receive affirmation",
			"youre a good": 					"receive affirmation",
			"you are a good": 					"receive affirmation",
			"youre great": 						"receive affirmation",
			"you are great": 					"receive affirmation",
			"youre wonderful": 					"receive affirmation",
			"you are wonderful": 				"receive affirmation",
			"youre awesome": 					"receive affirmation",
			"you are awesome": 					"receive affirmation",
			"youre wonderful": 					"receive affirmation",
			"you are wonderful": 				"receive affirmation",
			"youre amazing": 					"receive affirmation",
			"you are amazing": 					"receive affirmation",

			"hello": 							"receive greeting",
			"happy": 							"receive greeting",
			"good": 							"receive greeting",
			"merry": 							"receive greeting",
			"i hope you have a happy": 			"receive greeting",
			"i hope you have a good": 			"receive greeting",
			"i hope you have a great": 			"receive greeting",
			"i hope you have a merry": 			"receive greeting",
			"i hope youre enjoying": 			"receive greeting",
			"i hope youre enjoying your": 		"receive greeting",
			"i hope youre enjoying this": 		"receive greeting",
			"i hope you are enjoying": 			"receive greeting",
			"i hope you are enjoying your": 	"receive greeting",
			"i hope you are enjoying this": 	"receive greeting",
			"have a happy": 					"receive greeting",
			"have a good": 						"receive greeting",
			"have a great": 					"receive greeting",
			"have a merry": 					"receive greeting",

		// meta
			"list actions": 					"list actions",
			"help": 							"list actions",
			"get help": 						"list actions",
			"what are your functions": 			"list actions",
			"what can you do": 					"list actions",
			"i need help": 						"list actions",
			"what are your functions": 			"list actions",
			"what can you do": 					"list actions",
			"i need some help": 				"list actions",
			"what can i say": 					"list actions",
			"list functions": 					"list actions",
			"list commands": 					"list actions",

			"explain self": 					"explain self",
			"how do you work": 					"explain self",
			"how do i set up": 					"explain self",
			"set up an integration": 			"explain self",
			"set up an api": 					"explain self",
			"why do you exist": 				"explain self",
			"how does this work": 				"explain self",
			"explain this": 					"explain self",
			"what are you": 					"explain self",
			"what is your purpose": 			"explain self",

			"repeat this": 						"repeat this",
			"repeat after me": 					"repeat this",
			"say what i say": 					"repeat this",
			"say exactly what i say": 			"repeat this",
			"say this back": 					"repeat this",
			"jot this down": 					"repeat this",
			"copy this down": 					"repeat this",
			"write this down": 					"repeat this",

			"repeat that": 						"repeat that",
			"repeat what you said": 			"repeat that",
			"say what you said": 				"repeat that",
			"say what you said again": 			"repeat that",
			"say that again": 					"repeat that",
			"run that by me again": 			"repeat that",
			"can you repeat that": 				"repeat that",
			"i didnt catch that": 				"repeat that",
			"come again": 						"repeat that",

			"do that again": 					"do that again",
			"one more time": 					"do that again",
			"do that action again": 			"do that again",
			"try that again": 					"do that again",
			"try that action again": 			"do that again",
			"do that one more time": 			"do that again",
			"can you do that again": 			"do that again",
			"again": 							"do that again",

			"get next result": 					"get next result",
			"get the next result": 				"get next result",
			"get next results": 				"get next result",
			"get the next results": 			"get next result",
			"get the next one": 				"get next result",
			"display next result": 				"get next result",
			"display the next result": 			"get next result",
			"display next results": 			"get next result",
			"display the next results": 		"get next result",
			"display the next one": 			"get next result",
			"show next result": 				"get next result",
			"show the next result": 			"get next result",
			"show next results": 				"get next result",
			"show the next results": 			"get next result",
			"show the next one": 				"get next result",
			"play next result": 				"get next result",
			"play the next result": 			"get next result",
			"play next results": 				"get next result",
			"play the next results": 			"get next result",
			"play the next one": 				"get next result",
			"read next result": 				"get next result",
			"read the next result": 			"get next result",
			"read next results": 				"get next result",
			"read the next results": 			"get next result",
			"read the next one": 				"get next result",
			"tell me next result": 				"get next result",
			"tell me another": 					"get next result",
			"tell me the next result": 			"get next result",
			"tell me next results": 			"get next result",
			"tell me the next results": 		"get next result",
			"next result": 						"get next result",
			"next results": 					"get next result",
			"give me another": 					"get next result",
			"give me the next result": 			"get next result",
			"give me the next one": 			"get next result",
			"give me the next results": 		"get next result",
			"get me another": 					"get next result",
			"get me the next result": 			"get next result",
			"get me the next one": 				"get next result",
			"get me the next results": 			"get next result",
			"next": 							"get next result",
			"another": 							"get next result",

			"stop last video": 					"stop last video",
			"stop the last video": 				"stop last video",
			"stop that video": 					"stop last video",
			"stop the video": 					"stop last video",
			"pause last video": 				"stop last video",
			"pause the last video": 			"stop last video",
			"pause that video": 				"stop last video",
			"pause the video": 					"stop last video",

			"restart last video": 				"restart last video",
			"restart the last video": 			"restart last video",
			"restart that video": 				"restart last video",
			"restart the video": 				"restart last video",
			"play last video": 					"restart last video",
			"play the last video": 				"restart last video",
			"play that video": 					"restart last video",
			"play the video": 					"restart last video",

			"open": 							"open",
			"open up": 							"open",
			"open this": 						"open",
			"open this up": 					"open",
			"open in a new tab": 				"open",
			"open in another tab": 				"open",
			"open in a new window": 			"open",
			"open in another window": 			"open",

		// settings
			"stop listening": 					"stop listening",
			"stop listening to me": 			"stop listening",
			"quit listening": 					"stop listening",
			"quit listening to me": 			"stop listening",
			"cease listening": 					"stop listening",
			"cease listening to me": 			"stop listening",

			"change voice": 					"change voice",
			"change voice to": 					"change voice",
			"change the voice to": 				"change voice",
			"set voice to": 					"change voice",
			"set the voice to": 				"change voice",
			"set new voice": 					"change voice",
			"switch voice to": 					"change voice",
			"switch the voice to": 				"change voice",

			"change volume": 					"change volume",
			"change volume to": 				"change volume",
			"change the volume to": 			"change volume",
			"set volume to": 					"change volume",
			"set the volume to": 				"change volume",
			"set new volume": 					"change volume",
			"set new volume at": 				"change volume",

			"change brightness": 				"change brightness",
			"change brightness to": 			"change brightness",
			"change the brightness to": 		"change brightness",
			"set brightness to": 				"change brightness",
			"set the brightness to": 			"change brightness",
			"set new brightness": 				"change brightness",
			"set new brightness at": 			"change brightness",

			"change listening duration": 		"change listening duration",
			"change listening duration to": 	"change listening duration",
			"change the listening duration to": "change listening duration",
			"set listening duration to": 		"change listening duration",
			"set the listening duration to": 	"change listening duration",
			"set new listening duration": 		"change listening duration",
			"set new listening duration at": 	"change listening duration",
			"change recognition duration": 		"change listening duration",
			"change recognition duration to": 	"change listening duration",
			"change the recognition duration to": "change listening duration",
			"set recognition duration to": 		"change listening duration",
			"set the recognition duration to": 	"change listening duration",
			"set new recognition duration": 	"change listening duration",
			"set new recognition duration at": 	"change listening duration",

			"change configuration": 			"change configuration",
			"change configuration for": 		"change configuration",
			"edit configuration": 				"change configuration",
			"edit configuration for": 			"change configuration",
			"set configuration": 				"change configuration",
			"set a configuration": 				"change configuration",
			"set this configuration": 			"change configuration",
			"set configuration for": 			"change configuration",
			"set a configuration for": 			"change configuration",
			"set the configuration for": 		"change configuration",
			"set my configuration for": 		"change configuration",
			"set new configuration": 			"change configuration",
			"set new configuration for": 		"change configuration",
			"set a new configuration": 			"change configuration",
			"set a new configuration for": 		"change configuration",
			"change a configuration": 			"change configuration",
			"change my configuration": 			"change configuration",
			"change my configuration for": 		"change configuration",
			"add to my profile": 				"change configuration",
			"add this to my profile": 			"change configuration",
			"edit my profile": 					"change configuration",
			"save my": 							"change configuration",
			"set my saved": 					"change configuration",
			"change my saved": 					"change configuration",
			"update my saved": 					"change configuration",
			"configure my": 					"change configuration",
			"configure": 						"change configuration",

			"authorize": 						"authorize platform",
			"create authorization": 			"authorize platform",
			"get authorization link": 			"authorize platform",
			"activate": 						"authorize platform",
			"create activation": 				"authorize platform",
			"get activation link": 				"authorize platform",
			"authorize a platform": 			"authorize platform",
			"authorize platform": 				"authorize platform",

		// time
			"get the time": 					"get the time",
			"what time is it": 					"get the time",
			"what is the time": 				"get the time",
			"whats the time": 					"get the time",
			"tell me the time": 				"get the time",
			"what time is it now": 				"get the time",
			"what time is it right now": 		"get the time",
			"get the time here": 				"get the time",
			"what time is it here": 			"get the time",
			"what is the time here": 			"get the time",
			"whats the time here": 				"get the time",
			"tell me the time here": 			"get the time",
			"what time is it now here": 		"get the time",
			"what time is it right now here": 	"get the time",
			"get the time in": 					"get the time",
			"what time is it in": 				"get the time",
			"what is the time in": 				"get the time",
			"whats the time in": 				"get the time",
			"tell me the time in": 				"get the time",
			"what time is it now in": 			"get the time",
			"what time is it right now in": 	"get the time",

			"get the day": 						"get the day",
			"get the day on": 					"get the day",
			"what day is it": 					"get the day",
			"what day is": 						"get the day",
			"what day was": 					"get the day",
			"what day was it": 					"get the day",
			"what day was it on": 				"get the day",
			"what day will it be": 				"get the day",
			"what day will it be on": 			"get the day",
			"whats the day": 					"get the day",
			"whats today": 						"get the day",
			"tell me the day": 					"get the day",
			"tell me the day on": 				"get the day",

			"get the month": 					"get the month",
			"what month is it": 				"get the month",
			"what is the month": 				"get the month",
			"whats the month": 					"get the month",
			"tell me the month": 				"get the month",

			"get the date": 					"get the date",
			"what date is it": 					"get the date",
			"whats todays date": 				"get the date",
			"what is the date": 				"get the date",
			"what is todays date": 				"get the date",
			"whats the date": 					"get the date",
			"tell me the date": 				"get the date",

			"get time until": 					"get time until",
			"get time till": 					"get time until",
			"get time on": 						"get time until",
			"get time left until": 				"get time until",
			"get time left till": 				"get time until",
			"get time left on": 				"get time until",
			"get time remaining until": 		"get time until",
			"get time remaining till": 			"get time until",
			"get time remaining on": 			"get time until",
			"how much time until": 				"get time until",
			"how much time till": 				"get time until",
			"how much time on": 				"get time until",
			"how much time left until": 		"get time until",
			"how much time left till": 			"get time until",
			"how much time left on": 			"get time until",
			"how much time is left until": 		"get time until",
			"how much time is left till": 		"get time until",
			"how much time is left on": 		"get time until",
			"how much time is remaining until": "get time until",
			"how much time is remaining till": 	"get time until",
			"how much time is remaining on": 	"get time until",
			"how much time remains until": 		"get time until",
			"how much time remains till": 		"get time until",
			"how much time remains on": 		"get time until",
			"get days until": 					"get time until",
			"get days till": 					"get time until",
			"get days on": 						"get time until",
			"get days left until": 				"get time until",
			"get days left till": 				"get time until",
			"get days left on": 				"get time until",
			"get days remaining until": 		"get time until",
			"get days remaining till": 			"get time until",
			"get days remaining on": 			"get time until",
			"how many days until": 				"get time until",
			"how many days till": 				"get time until",
			"how many days on": 				"get time until",
			"how many days left until": 		"get time until",
			"how many days left till": 			"get time until",
			"how many days left on": 			"get time until",
			"how many days are left until": 	"get time until",
			"how many days are left till": 		"get time until",
			"how many days are left on": 		"get time until",
			"how many days are remaining until": "get time until",
			"how many days are remaining till": "get time until",
			"how many days are remaining on": 	"get time until",
			"how many days remain until": 		"get time until",
			"how many days remain till": 		"get time until",
			"how many days remain on": 			"get time until",
			"how long until": 					"get time until",
			"how long is it until": 			"get time until",

			"get time since": 					"get time since",
			"how much time since": 				"get time since",
			"get days since": 					"get time since",
			"how many days since": 				"get time since",
			"how long has it been since": 		"get time since",
			"how long ago was": 				"get time since",
			"how many days has it been since": 	"get time since",
			"how many days ago was": 			"get time since",
			"how long since": 					"get time since",

		// alarms
			"set alarm": 						"set alarm",
			"set an alarm": 					"set alarm",
			"set alarm for": 					"set alarm",
			"set an alarm for": 				"set alarm",
			"set a timer": 						"set alarm",
			"set timer": 						"set alarm",
			"set a timer for": 					"set alarm",
			"set timer for": 					"set alarm",
			"wake me up": 						"set alarm",
			"alert me": 						"set alarm",
			"wake me up at": 					"set alarm",
			"alert me at": 						"set alarm",

			"get alarms": 						"get alarms",
			"get all alarms": 					"get alarms",
			"get my alarms": 					"get alarms",
			"when are my alarms": 				"get alarms",
			"what alarms do i have": 			"get alarms",
			"get alarm": 						"get alarms",
			"get my alarm": 					"get alarms",
			"when is my alarm": 				"get alarms",
			"what alarm do i have": 			"get alarms",
			"get timer": 						"get alarms",
			"get my timer": 					"get alarms",
			"when is my timer": 				"get alarms",
			"what timer do i have": 			"get alarms",

			"cancel alarm": 					"cancel alarm",
			"turn off alarm": 					"cancel alarm",
			"deactivate alarm": 				"cancel alarm",
			"unset alarm": 						"cancel alarm",
			"stop alarm": 						"cancel alarm",
			"cancel my alarm": 					"cancel alarm",
			"turn off my alarm": 				"cancel alarm",
			"deactivate my alarm": 				"cancel alarm",
			"unset my alarm": 					"cancel alarm",
			"stop my alarm": 					"cancel alarm",
			"cancel timer": 					"cancel alarm",
			"turn off timer": 					"cancel alarm",
			"deactivate timer": 				"cancel alarm",
			"unset timer": 						"cancel alarm",
			"stop timer": 						"cancel alarm",
			"cancel my timer": 					"cancel alarm",
			"turn off my timer": 				"cancel alarm",
			"deactivate my timer": 				"cancel alarm",
			"unset my timer": 					"cancel alarm",
			"stop my timer": 					"cancel alarm",

			"cancel all alarms": 				"cancel all alarms",
			"turn off all alarms": 				"cancel all alarms",
			"deactivate all alarms": 			"cancel all alarms",
			"unset all alarms": 				"cancel all alarms",
			"stop all alarms": 					"cancel all alarms",
			"cancel all my alarms": 			"cancel all alarms",
			"turn off all my alarms": 			"cancel all alarms",
			"deactivate all my alarms": 		"cancel all alarms",
			"unset all my alarms": 				"cancel all alarms",
			"stop all my alarms": 				"cancel all alarms",
			"cancel all of my alarms": 			"cancel all alarms",
			"turn off all of my alarms": 		"cancel all alarms",
			"deactivate all of my alarms": 		"cancel all alarms",
			"unset all of my alarms": 			"cancel all alarms",
			"stop all of my alarms": 			"cancel all alarms",
			"cancel all timers": 				"cancel all alarms",
			"turn off all timers": 				"cancel all alarms",
			"deactivate all timers": 			"cancel all alarms",
			"unset all timers": 				"cancel all alarms",
			"stop all timers": 					"cancel all alarms",
			"cancel all my timers": 			"cancel all alarms",
			"turn off all my timers": 			"cancel all alarms",
			"deactivate all my timers": 		"cancel all alarms",
			"unset all my timers": 				"cancel all alarms",
			"stop all my timers": 				"cancel all alarms",
			"cancel all of my timers": 			"cancel all alarms",
			"turn off all of my timers": 		"cancel all alarms",
			"deactivate all of my timers": 		"cancel all alarms",
			"unset all of my timers": 			"cancel all alarms",
			"stop all of my timers": 			"cancel all alarms",

		// rng
			"roll": 							"roll dice",
			"roll me": 							"roll dice",
			"roll me some": 					"roll dice",
			"roll some": 						"roll dice",

			"flip a coin": 						"flip a coin",
			"heads or tails": 					"flip a coin",

			"choose randomly": 					"choose randomly",
			"choose randomly from a list": 		"choose randomly",
			"choose randomly from this list": 	"choose randomly",
			"choose a random thing": 			"choose randomly",
			"choose a random item": 			"choose randomly",
			"choose from this list": 			"choose randomly",
			"choose from a list": 				"choose randomly",
			"choose an item": 					"choose randomly",
			"choose one of these": 				"choose randomly",
			"pick randomly": 					"choose randomly",
			"pick randomly from a list": 		"choose randomly",
			"pick randomly from this list": 	"choose randomly",
			"pick a random thing": 				"choose randomly",
			"pick a random item": 				"choose randomly",
			"pick from this list": 				"choose randomly",
			"pick from a list": 				"choose randomly",
			"pick an item": 					"choose randomly",
			"pick one of these": 				"choose randomly",
			"select randomly": 					"choose randomly",
			"select randomly from a list": 		"choose randomly",
			"select randomly from this list": 	"choose randomly",
			"select a random thing": 			"choose randomly",
			"select a random item": 			"choose randomly",
			"select from this list": 			"choose randomly",
			"select from a list": 				"choose randomly",
			"select an item": 					"choose randomly",
			"select one of these": 				"choose randomly",

			"consult the magic 8 ball": 		"consult the magic 8 ball",
			"consult a magic 8 ball": 			"consult the magic 8 ball",
			"shake the magic 8 ball": 			"consult the magic 8 ball",
			"ask the magic 8 ball": 			"consult the magic 8 ball",
			"magic 8 ball": 					"consult the magic 8 ball",
			"consult the magic 8-ball": 		"consult the magic 8 ball",
			"consult a magic 8-ball": 			"consult the magic 8 ball",
			"shake the magic 8-ball": 			"consult the magic 8 ball",
			"ask the magic 8-ball": 			"consult the magic 8 ball",
			"magic 8-ball": 					"consult the magic 8 ball",
			"magic conch": 						"consult the magic 8 ball",
			"read my future": 					"consult the magic 8 ball",

		// math
			"calculate": 						"calculate",
			"lets do some math": 				"calculate",
			"do some math for me": 				"calculate",
			"add": 								"calculate",
			"subtract": 						"calculate",
			"multiply": 						"calculate",
			"divide": 							"calculate",
			
			"double": 							"double",
			"triple": 							"triple",

			"average": 							"average",
			"find the average of": 				"average",
			"what is the average of": 			"average",
			"whats the average of": 			"average",

			"start counting": 					"count",
			"count": 							"count",
			"can you count": 					"count",
			"lets count": 						"count",
			"give me a count": 					"count",

		// words
			"spell word": 						"spell word",
			"spell": 							"spell word",
			"spell a word": 					"spell word",
			"spell the word": 					"spell word",
			"how do you spell": 				"spell word",
			"how do you spell the word": 		"spell word",
			"can you spell": 					"spell word",
			"can you spell the word": 			"spell word",
			"what is the spelling of": 			"spell word",
			"whats the spelling of": 			"spell word",
			"tell me how to spell": 			"spell word",
			"tell me how to spell the word": 	"spell word",
			"tell me the spelling of": 			"spell word",
			"tell me the spelling for": 		"spell word",
			"tell me the spelling of the word": "spell word",
			"tell me the spelling for the word": "spell word",

			"pronounce word": 					"pronounce word",
			"pronounce": 						"pronounce word",
			"pronounce a word": 				"pronounce word",
			"pronounce the word": 				"pronounce word",
			"how do you pronounce": 			"pronounce word",
			"how do you pronounce the word": 	"pronounce word",
			"can you pronounce": 				"pronounce word",
			"can you pronounce the word": 		"pronounce word",
			"what is the pronunciation of": 	"pronounce word",
			"whats the pronunciation of": 		"pronounce word",
			"tell me how to pronounce": 		"pronounce word",
			"tell me how to pronounce the word": "pronounce word",
			"tell me the pronunciation of": 	"pronounce word",
			"tell me the pronunciation for": 	"pronounce word",
			"tell me the pronunciation of the word": "pronounce word",
			"tell me the pronunciation for the word": "pronounce word",

			"get rhymes": 						"get rhymes",
			"get a rhyme for": 					"get rhymes",
			"get rhymes for": 					"get rhymes",
			"find rhymes": 						"get rhymes",
			"what rhymes with": 				"get rhymes",
			"find a rhyme for": 				"get rhymes",
			"find rhymes for": 					"get rhymes",
			"rhymes with": 						"get rhymes",
			"something that rhymes with": 		"get rhymes",

			"get synonyms": 					"get synonyms",
			"get a synonym for": 				"get synonyms",
			"get synonyms for": 				"get synonyms",
			"find synonyms": 					"get synonyms",
			"what is a synonym for": 			"get synonyms",
			"find a synonym for": 				"get synonyms",
			"find synonyms for": 				"get synonyms",
			"synonym of": 						"get synonyms",
			"what has the same meaning as": 	"get synonyms",

			"get antonyms": 					"get antonyms",
			"get an antonym for": 				"get antonyms",
			"get antonyms for": 				"get antonyms",
			"find antonyms": 					"get antonyms",
			"what is an antonym for": 			"get antonyms",
			"find an antonym for": 				"get antonyms",
			"find antonyms for": 				"get antonyms",
			"antonym of": 						"get antonyms",
			"what has the opposite meaning of": "get antonyms",

			"get definition": 					"get definition",
			"get definition for": 				"get definition",
			"get definition of": 				"get definition",
			"get a definition for": 			"get definition",
			"get the definition of": 			"get definition",
			"get definition for": 				"get definition",
			"get the meaning of": 				"get definition",
			"find definition": 					"get definition",
			"find a definition for": 			"get definition",
			"find definition for": 				"get definition",
			"find the meaning of": 				"get definition",
			"find the definition of": 			"get definition",
			"find a definition for": 			"get definition",
			"define": 							"get definition",
			"define the word": 					"get definition",
			"look up the word": 				"get definition",
			"provide a definition for": 		"get definition",
			"what is the meaning of": 			"get definition",
			"whats the meaning of": 			"get definition",

			"get etymology": 					"get etymology",
			"get etymology of": 				"get etymology",
			"get the etymology of": 			"get etymology",
			"get etymology of the word": 		"get etymology",
			"get the etymology of the word": 	"get etymology",
			"find etymology": 					"get etymology",
			"find the etymology": 				"get etymology",
			"find etymology of": 				"get etymology",
			"find the etymology of": 			"get etymology",
			"find etymology of the word": 		"get etymology",
			"find the etymology of the word": 	"get etymology",
			"what is etymology of": 			"get etymology",
			"what is the etymology of": 		"get etymology",
			"what is etymology of the word": 	"get etymology",
			"what is the etymology of the word": "get etymology",
			"whats etymology of": 				"get etymology",
			"whats the etymology of": 			"get etymology",
			"whats etymology of the word": 		"get etymology",
			"whats the etymology of the word": 	"get etymology",
			"what is history of": 				"get etymology",
			"what is the history of": 			"get etymology",
			"what is history of the word": 		"get etymology",
			"what is the history of the word": 	"get etymology",
			"whats history of": 				"get etymology",
			"whats the history of": 			"get etymology",
			"whats history of the word": 		"get etymology",
			"whats the history of the word": 	"get etymology",
			"what is origin of": 				"get etymology",
			"what is the origin of": 			"get etymology",
			"what is origin of the word": 		"get etymology",
			"what is the origin of the word": 	"get etymology",
			"whats origin of": 					"get etymology",
			"whats the origin of": 				"get etymology",
			"whats origin of the word": 		"get etymology",
			"whats the origin of the word": 	"get etymology",

			"get idiom": 						"get idiom",
			"get the idiom": 					"get idiom",
			"get this idiom": 					"get idiom",
			"get an idiom": 					"get idiom",
			"define idiom": 					"get idiom",
			"define the idiom": 				"get idiom",
			"define this idiom": 				"get idiom",
			"define an idiom": 					"get idiom",
			"define phrase": 					"get idiom",
			"define the phrase": 				"get idiom",
			"define this phrase": 				"get idiom",
			"define a phrase": 					"get idiom",
			"define saying": 					"get idiom",
			"define the saying": 				"get idiom",
			"define this saying": 				"get idiom",
			"define a saying": 					"get idiom",
			"what is the meaning of the idiom": "get idiom",
			"whats the meaning of the idiom": 	"get idiom",
			"what is the meaning of the phrase": "get idiom",
			"whats the meaning of the phrase": 	"get idiom",
			"what is the meaning of the saying": "get idiom",
			"whats the meaning of the saying": 	"get idiom",

		// random content
			"get a joke": 						"get a joke",
			"tell me a joke": 					"get a joke",
			"know any jokes": 					"get a joke",
			"do you know any jokes": 			"get a joke",
			"say something funny": 				"get a joke",
			"be funny": 						"get a joke",
			"i could use a joke": 				"get a joke",
			"tell a joke": 						"get a joke",
			"tell us a joke": 					"get a joke",
			"make me laugh": 					"get a joke",
			"fetch a joke": 					"get a joke",
			"fetch me a joke": 					"get a joke",
			"tell me something funny": 			"get a joke",

			"get a quote": 						"get a quote",
			"get me a quote": 					"get a quote",
			"give me a quote": 					"get a quote",
			"get a random quote": 				"get a quote",
			"get me a random quote": 			"get a quote",
			"give me a random quote": 			"get a quote",
			"random quote": 					"get a quote",
			"famous quote": 					"get a quote",
			"inspire me": 						"get a quote",
			"tell me a random quote": 			"get a quote",
			"tell me a quote": 					"get a quote",
			"fetch a quote": 					"get a quote",
			"fetch me a quote": 				"get a quote",

			"get a fortune": 					"get a fortune",
			"get me a fortune": 				"get a fortune",
			"give me a fortune": 				"get a fortune",
			"get a random fortune": 			"get a fortune",
			"get me a random fortune": 			"get a fortune",
			"give me a random fortune": 		"get a fortune",
			"random fortune": 					"get a fortune",
			"tell my fortune": 					"get a fortune",
			"tell me my fortune": 				"get a fortune",
			"read my fortune": 					"get a fortune",
			"tell me a random fortune": 		"get a fortune",
			"tell me a fortune": 				"get a fortune",
			"fetch a fortune": 					"get a fortune",
			"fetch me a fortune": 				"get a fortune",
			"what is my fortune": 				"get a fortune",
			"whats my fortune": 				"get a fortune",
			"get my fortune": 					"get a fortune",

			"get an insult": 					"get an insult",
			"insult me": 						"get an insult",
			"disrespect me": 					"get an insult",
			"dis me": 							"get an insult",
			"diss me": 							"get an insult",
			"your mother": 						"get an insult",
			"your mothers": 					"get an insult",
			"youre mother": 					"get an insult",
			"youre mothers": 					"get an insult",
			"your mom": 						"get an insult",
			"your moms": 						"get an insult",
			"youre mom": 						"get an insult",
			"youre moms": 						"get an insult",
			"your mama": 						"get an insult",
			"your mamas": 						"get an insult",
			"youre mama": 						"get an insult",
			"youre mamas": 						"get an insult",
			"yo mama": 							"get an insult",
			"yo mamas": 						"get an insult",
			"yo momma": 						"get an insult",
			"yo mommas": 						"get an insult",

		// search content
			"get a wikipedia entry": 			"get a wikipedia entry",
			"tell me about": 					"get a wikipedia entry",
			"on wikipedia tell me about": 		"get a wikipedia entry",
			"look this up on wikipedia": 		"get a wikipedia entry",
			"search wikipedia for": 			"get a wikipedia entry",
			"get the wikipedia entry about": 	"get a wikipedia entry",
			"get the wikipedia entry for": 		"get a wikipedia entry",
			"on wikipedia find": 				"get a wikipedia entry",
			"on wikipedia look up": 			"get a wikipedia entry",
			"on wikipedia search for": 			"get a wikipedia entry",
			"read the wikipedia page about": 	"get a wikipedia entry",
			"read me the wikipedia page about": "get a wikipedia entry",
			"read the wikipedia entry for": 	"get a wikipedia entry",
			"read me the wikipedia entry for": 	"get a wikipedia entry",
			"get the wikipedia page for": 		"get a wikipedia entry",
			"give me the wikipedia page for": 	"get a wikipedia entry",
			"get me the wikipedia page for": 	"get a wikipedia entry",
			"do a wikipedia search for": 		"get a wikipedia entry",
			"get the wikipedia article for": 	"get a wikipedia entry",
			"get the wikipedia article about": 	"get a wikipedia entry",
			"get the wikipedia page on": 		"get a wikipedia entry",
			"get the wikipedia page about": 	"get a wikipedia entry",
			"get the wikipedia page for": 		"get a wikipedia entry",

			"get this day in history": 			"get this day in history",
			"what happened today in history": 	"get this day in history",
			"get today in history": 			"get this day in history",
			"tell me about today in history": 	"get this day in history",
			"what went down in history today": 	"get this day in history",
			"what happened on this date": 		"get this day in history",

			"get the weather": 					"get the weather",
			"get me the weather": 				"get the weather",
			"look up the weather": 				"get the weather",
			"whats the weather": 				"get the weather",
			"what is the weather": 				"get the weather",
			"what will the weather be": 		"get the weather",
			"whats the weather going to be": 	"get the weather",
			"what is the weather going to be": 	"get the weather",
			"whats the weather gonna be": 		"get the weather",
			"what is the weather gonna be": 	"get the weather",
			"hows the weather": 				"get the weather",
			"how is the weather": 				"get the weather",
			"is it going to rain": 				"get the weather",
			"will it rain": 					"get the weather",
			"is it going to snow": 				"get the weather",
			"will it snow": 					"get the weather",

			"get sunrise": 						"get sunrise",
			"get the sunrise": 					"get sunrise",
			"get me the sunrise": 				"get sunrise",
			"get the sunrise for": 				"get sunrise",
			"get me the sunrise for": 			"get sunrise",
			"get sunrise time": 				"get sunrise",
			"get the sunrise time": 			"get sunrise",
			"get me the sunrise time": 			"get sunrise",
			"what time is the sunrise": 		"get sunrise",
			"when is the sunrise": 				"get sunrise",
			"when will the sunrise": 			"get sunrise",
			"when will the sun rise": 			"get sunrise",
			"get sunrise in": 					"get sunrise",
			"get the sunrise in": 				"get sunrise",
			"get me the sunrise in": 			"get sunrise",
			"get sunrise time for": 			"get sunrise",
			"get the sunrise time for": 		"get sunrise",
			"get me the sunrise time for": 		"get sunrise",
			"what time is the sunrise in": 		"get sunrise",
			"when is the sunrise in": 			"get sunrise",
			"when will the sunrise in": 		"get sunrise",
			"when will the sun rise in": 		"get sunrise",

			"get sunset": 						"get sunset",
			"get the sunset": 					"get sunset",
			"get me the sunset": 				"get sunset",
			"get the sunset for": 				"get sunset",
			"get me the sunset for": 			"get sunset",
			"get sunset time": 					"get sunset",
			"get the sunset time": 				"get sunset",
			"get me the sunset time": 			"get sunset",
			"what time is the sunset": 			"get sunset",
			"when is the sunset": 				"get sunset",
			"when will the sunset": 			"get sunset",
			"when will the sun rise": 			"get sunset",
			"get sunset in": 					"get sunset",
			"get the sunset in": 				"get sunset",
			"get me the sunset in": 			"get sunset",
			"get sunset time for": 				"get sunset",
			"get the sunset time for": 			"get sunset",
			"get me the sunset time for": 		"get sunset",
			"what time is the sunset in": 		"get sunset",
			"when is the sunset in": 			"get sunset",
			"when will the sunset in": 			"get sunset",
			"when will the sun set in": 		"get sunset",

			"get nutrition facts": 				"get nutrition facts",
			"get nutrition facts about": 		"get nutrition facts",
			"get nutrition facts for": 			"get nutrition facts",
			"get the nutrition facts": 			"get nutrition facts",
			"get the nutrition facts about": 	"get nutrition facts",
			"get the nutrition facts for": 		"get nutrition facts",
			"give me the nutrition facts": 		"get nutrition facts",
			"give me the nutrition facts about": "get nutrition facts",
			"give me the nutrition facts for": 	"get nutrition facts",
			"tell me about the dish": 			"get nutrition facts",
			"tell me about the dish called": 	"get nutrition facts",
			"tell me about a dish": 			"get nutrition facts",
			"tell me about a dish called": 		"get nutrition facts",
			"look up the dish": 				"get nutrition facts",
			"look up the dish called": 			"get nutrition facts",
			"look up a dish": 					"get nutrition facts",
			"look up a dish called": 			"get nutrition facts",
			"tell me about the meal": 			"get nutrition facts",
			"tell me about the meal called": 	"get nutrition facts",
			"tell me about a meal": 			"get nutrition facts",
			"tell me about a meal called": 		"get nutrition facts",
			"look up the meal": 				"get nutrition facts",
			"look up the meal called": 			"get nutrition facts",
			"look up a meal": 					"get nutrition facts",
			"look up a meal called": 			"get nutrition facts",
			"tell me about the food": 			"get nutrition facts",
			"tell me about the food called": 	"get nutrition facts",
			"tell me about a food": 			"get nutrition facts",
			"tell me about a food called": 		"get nutrition facts",
			"look up the food": 				"get nutrition facts",
			"look up the food called": 			"get nutrition facts",
			"look up a food": 					"get nutrition facts",
			"look up a food called": 			"get nutrition facts",

			"get nutrition answer": 			"get nutrition answer",
			"get nutrition answer about": 		"get nutrition answer",
			"get nutrition answer for": 		"get nutrition answer",
			"get a nutrition answer": 			"get nutrition answer",
			"get a nutrition answer about": 	"get nutrition answer",
			"get a nutrition answer for": 		"get nutrition answer",
			"get me nutrition answer": 			"get nutrition answer",
			"get me nutrition answer about": 	"get nutrition answer",
			"get me nutrition answer for": 		"get nutrition answer",
			"get me a nutrition answer": 		"get nutrition answer",
			"get me a nutrition answer about": 	"get nutrition answer",
			"get me a nutrition answer for": 	"get nutrition answer",
			"do a nutrition search": 			"get nutrition answer",
			"do a nutrition search for": 		"get nutrition answer",
			"do a nutrition search about": 		"get nutrition answer",
			"i have a nutrition question": 		"get nutrition answer",
			"let me ask a nutrition question": 	"get nutrition answer",
			"heres a nutrition question": 		"get nutrition answer",

			"get a book": 						"get a book",
			"get me a book": 					"get a book",
			"search library": 					"get a book",
			"search open library for": 			"get a book",
			"on open library search": 			"get a book",
			"on open library search for": 		"get a book",
			"on open library look up": 			"get a book",
			"on open library look for": 		"get a book",
			"find the book": 					"get a book",
			"find a book": 						"get a book",
			"get the book": 					"get a book",
			"i want to read": 					"get a book",
			"i want to read a book called": 	"get a book",
			"look up the book": 				"get a book",
			"look up a book": 					"get a book",
			"look for a book": 					"get a book",
			"look up a book on open library": 	"get a book",
			"look for a book on open library": 	"get a book",
			"look up a book called": 			"get a book",
			"look up this book": 				"get a book",
			"tell me about the book": 			"get a book",
			"look up a book about": 			"get a book",
			"look up books about": 				"get a book",
			"find a book about": 				"get a book",
			"find books about": 				"get a book",
			"find me a book about": 			"get a book",
			"find me books about": 				"get a book",
			"get a book about": 				"get a book",
			"get books about": 					"get a book",
			"get me a book about": 				"get a book",
			"get me books about": 				"get a book",
			"search for a book about": 			"get a book",
			"search for books about": 			"get a book",
			"get a book by": 					"get a book",
			"get books by": 					"get a book",
			"get me a book by": 				"get a book",
			"get me books by": 					"get a book",
			"look up a book by": 				"get a book",
			"look up books by": 				"get a book",
			"what books were written by": 		"get a book",
			"what was written by": 				"get a book",
			"find books by": 					"get a book",
			"look up a book by the author": 	"get a book",
			"look up books by the author": 		"get a book",
			"what books were written by the author": "get a book",
			"what was written by the author": 	"get a book",
			"find books by the author": 		"get a book",

			"get lyrics": 						"get lyrics",
			"get me lyrics": 					"get lyrics",
			"get lyrics for": 					"get lyrics",
			"get me lyrics for": 				"get lyrics",
			"get the lyrics for": 				"get lyrics",
			"get the lyrics to": 				"get lyrics",
			"get me the lyrics for": 			"get lyrics",
			"get me the lyrics to": 			"get lyrics",
			"find lyrics": 						"get lyrics",
			"find me lyrics": 					"get lyrics",
			"find lyrics for": 					"get lyrics",
			"find me lyrics for": 				"get lyrics",
			"find the lyrics for": 				"get lyrics",
			"find the lyrics to": 				"get lyrics",
			"find me the lyrics for": 			"get lyrics",
			"find me the lyrics to": 			"get lyrics",
			"search for lyrics": 				"get lyrics",
			"search for lyrics for": 			"get lyrics",
			"search for the lyrics for": 		"get lyrics",
			"search for the lyrics to": 		"get lyrics",

			"get stock price": 					"get stock price",
			"get stock price for": 				"get stock price",
			"get stock price of": 				"get stock price",
			"get the stock price": 				"get stock price",
			"get the stock price for": 			"get stock price",
			"get the stock price of": 			"get stock price",
			"fetch the stock price": 			"get stock price",
			"fetch the stock price for": 		"get stock price",
			"fetch the stock price of": 		"get stock price",
			"whats the stock price": 			"get stock price",
			"whats the stock price for": 		"get stock price",
			"whats the stock price of": 		"get stock price",
			"what is the stock price": 			"get stock price",
			"what is the stock price for": 		"get stock price",
			"what is the stock price of": 		"get stock price",

			"get a movie": 						"get a movie",
			"get the movie": 					"get a movie",
			"get a movie called": 				"get a movie",
			"get the movie called": 			"get a movie",
			"get a movie named": 				"get a movie",
			"get the movie named": 				"get a movie",
			"find a movie": 					"get a movie",
			"find a movie called": 				"get a movie",
			"find a movie named": 				"get a movie",
			"look up the movie": 				"get a movie",
			"look up a movie called": 			"get a movie",
			"look up a movie named": 			"get a movie",
			"search for the movie": 			"get a movie",
			"search for a movie called": 		"get a movie",
			"search for a movie named": 		"get a movie",
			"who was in the movie": 			"get a movie",
			"who starred in the movie": 		"get a movie",
			"who acted in the movie": 			"get a movie",
			"who directed the movie": 			"get a movie",
			"who wrote the movie": 				"get a movie",
			"what was the release of the movie": "get a movie",
			"what was the release date of the movie": "get a movie",
			"what is the rating of the movie": 	"get a movie",
			"what is the average rating of the movie": "get a movie",
			"get reviews for the movie": 		"get a movie",
			"find reviews for the movie": 		"get a movie",
			"look up reviews for the movie": 	"get a movie",
			"search for reviews for the movie": "get a movie",
			"get reviews of the movie": 		"get a movie",
			"find reviews of the movie": 		"get a movie",
			"look up reviews of the movie": 	"get a movie",
			"search for reviews of the movie": 	"get a movie",
			"what is the plot of the movie": 	"get a movie",
			"tell me about the movie": 			"get a movie",
			"get a film": 						"get a movie",
			"get the film": 					"get a movie",
			"get a film called": 				"get a movie",
			"get the film called": 				"get a movie",
			"get a film named": 				"get a movie",
			"get the film named": 				"get a movie",
			"find a film": 						"get a movie",
			"find a film called": 				"get a movie",
			"find a film named": 				"get a movie",
			"look up the film": 				"get a movie",
			"look up a film called": 			"get a movie",
			"look up a film named": 			"get a movie",
			"search for the film": 				"get a movie",
			"search for a film called": 		"get a movie",
			"search for a film named": 			"get a movie",
			"who was in the film": 				"get a movie",
			"who starred in the film": 			"get a movie",
			"who acted in the film": 			"get a movie",
			"who directed the film": 			"get a movie",
			"who wrote the film": 				"get a movie",
			"what was the release of the film": "get a movie",
			"what was the release date of the film": "get a movie",
			"what is the rating of the film": 	"get a movie",
			"what is the average rating of the film": "get a movie",
			"get reviews for the film": 		"get a movie",
			"find reviews for the film": 		"get a movie",
			"look up reviews for the film": 	"get a movie",
			"search for reviews for the film": 	"get a movie",
			"get reviews of the film": 			"get a movie",
			"find reviews of the film": 		"get a movie",
			"look up reviews of the film": 		"get a movie",
			"search for reviews of the film": 	"get a movie",
			"what is the plot of the film": 	"get a movie",
			"tell me about the film": 			"get a movie",

			"get metro predictions": 			"get metro predictions",
			"get subway predictions": 			"get metro predictions",
			"get bus predictions": 				"get metro predictions",
			"get train predictions": 			"get metro predictions",
			"get rail predictions": 			"get metro predictions",
			"get trolley predictions": 			"get metro predictions",
			"get tram predictions": 			"get metro predictions",
			"get ferry predictions": 			"get metro predictions",
			"get me metro predictions": 		"get metro predictions",
			"get me subway predictions": 		"get metro predictions",
			"get me bus predictions": 			"get metro predictions",
			"get me train predictions": 		"get metro predictions",
			"get me rail predictions": 			"get metro predictions",
			"get me trolley predictions": 		"get metro predictions",
			"get me tram predictions": 			"get metro predictions",
			"get me ferry predictions": 		"get metro predictions",
			"get metro predictions for the": 	"get metro predictions",
			"get subway predictions for the": 	"get metro predictions",
			"get bus predictions for the": 		"get metro predictions",
			"get train predictions for the": 	"get metro predictions",
			"get rail predictions for the": 	"get metro predictions",
			"get trolley predictions for the": 	"get metro predictions",
			"get tram predictions for the": 	"get metro predictions",
			"get ferry predictions for the": 	"get metro predictions",
			"get me metro predictions for the": "get metro predictions",
			"get me subway predictions for the": "get metro predictions",
			"get me bus predictions for the": 	"get metro predictions",
			"get me train predictions for the": "get metro predictions",
			"get me rail predictions for the": 	"get metro predictions",
			"get me trolley predictions for the": "get metro predictions",
			"get me tram predictions for the": 	"get metro predictions",
			"get me ferry predictions for the": "get metro predictions",
			"when is the next": 				"get metro predictions",
			"tell me about route": 				"get metro predictions",
			"what is the status of the": 		"get metro predictions",
			"whats the status of the": 			"get metro predictions",

		// news & blogs
			"get the latest post": 				"get the latest post",
			"get me the latest post": 			"get the latest post",
			"get the latest post from": 		"get the latest post",
			"get me the latest post from": 		"get the latest post",
			"get the latest post on": 			"get the latest post",
			"get me the latest post on": 		"get the latest post",
			"get the latest news": 				"get the latest post",
			"get me the latest news": 			"get the latest post",
			"get the latest news from": 		"get the latest post",
			"get me the latest news from": 		"get the latest post",
			"get the latest news on": 			"get the latest post",
			"get me the latest news on": 		"get the latest post",
			"give me the latest post": 			"get the latest post",
			"give me the latest post from": 	"get the latest post",
			"give me the latest post on": 		"get the latest post",
			"fetch the latest post": 			"get the latest post",
			"fetch the latest post from": 		"get the latest post",
			"fetch the latest post on": 		"get the latest post",
			"read the latest entry": 			"get the latest post",
			"read me the latest entry": 		"get the latest post",
			"read the latest entry from": 		"get the latest post",
			"read me the latest entry from": 	"get the latest post",
			"read the latest entry on": 		"get the latest post",
			"read me the latest entry on": 		"get the latest post",
			"read the latest post": 			"get the latest post",
			"read me the latest post": 			"get the latest post",
			"read the latest post from": 		"get the latest post",
			"read me the latest post from": 	"get the latest post",
			"read the latest post on": 			"get the latest post",
			"read me the latest post on": 		"get the latest post",

			"get a random post": 				"get a random post",
			"get me a random post": 			"get a random post",
			"get a random post from": 			"get a random post",
			"get me a random post from": 		"get a random post",
			"get a random post on": 			"get a random post",
			"get me a random post on": 			"get a random post",
			"give me a random post": 			"get a random post",
			"give me a random post from": 		"get a random post",
			"give me a random post on": 		"get a random post",
			"fetch a random post": 				"get a random post",
			"fetch a random post from": 		"get a random post",
			"fetch a random post on": 			"get a random post",
			"read a random entry": 				"get a random post",
			"read me a random entry": 			"get a random post",
			"read a random entry from": 		"get a random post",
			"read me a random entry from": 		"get a random post",
			"read a random entry on": 			"get a random post",
			"read me a random entry on": 		"get a random post",
			"read a random post": 				"get a random post",
			"read me a random post": 			"get a random post",
			"read a random post from": 			"get a random post",
			"read me a random post from": 		"get a random post",
			"read a random post on": 			"get a random post",
			"read me a random post on": 		"get a random post",

			"get all posts": 					"get all posts",
			"get me all posts": 				"get all posts",
			"get all posts from": 				"get all posts",
			"get me all posts from": 			"get all posts",
			"get all posts on": 				"get all posts",
			"get me all posts on": 				"get all posts",
			"get everything": 					"get all posts",
			"get me everything": 				"get all posts",
			"get everything from": 				"get all posts",
			"get me everything from": 			"get all posts",
			"get everything on": 				"get all posts",
			"get me everything on": 			"get all posts",
			"give me all posts": 				"get all posts",
			"give me all posts from": 			"get all posts",
			"give me all posts on": 			"get all posts",
			"fetch all posts": 					"get all posts",
			"fetch all posts from": 			"get all posts",
			"fetch all posts on": 				"get all posts",
			"read all entries": 				"get all posts",
			"read me all entries": 				"get all posts",
			"read all entries from": 			"get all posts",
			"read me all entries from": 		"get all posts",
			"read all entries on": 				"get all posts",
			"read me all entries on": 			"get all posts",
			"read all posts": 					"get all posts",
			"read me all posts": 				"get all posts",
			"read all posts from": 				"get all posts",
			"read me all posts from": 			"get all posts",
			"read all posts on": 				"get all posts",
			"read me all posts on": 			"get all posts",

			"get the headlines": 				"get the headlines",
			"get todays headlines": 			"get the headlines",
			"whats happening in the world": 	"get the headlines",
			"what is happening in the world": 	"get the headlines",
			"get the top stories": 				"get the headlines",
			"get the news": 					"get the headlines",
			"get me the news": 					"get the headlines",
			"give me the news": 				"get the headlines",
			"fetch the news": 					"get the headlines",
			"what is the news": 				"get the headlines",
			"whats the news": 					"get the headlines",
			"whats the latest news": 			"get the headlines",
			"what is the latest news": 			"get the headlines",
			"whats happening in the news": 		"get the headlines",
			"what is happening in the news": 	"get the headlines",
			"read the headlines": 				"get the headlines",
			"read me the headlines": 			"get the headlines",

		// Google Apps Script
			"edit wish list": 					"edit wish list",
			"add to wish list": 				"edit wish list",
			"add to my wish list": 				"edit wish list",
			"add this to my wish list": 		"edit wish list",
			"include on my wish list": 			"edit wish list",
			"edit my wish list to include": 	"edit wish list",

			"get balance": 						"get balance",
			"what is my account balance for": 	"get balance",
			"whats my account balance for": 	"get balance",
			"check my account balance for": 	"get balance",
			"how much money do i have in": 		"get balance",
			"how much do i have in": 			"get balance",
			"how much money do i have in my": 	"get balance",
			"how much do i have in my": 		"get balance",
			"what is the balance in my": 		"get balance",
			"whats the balance in my": 			"get balance",
			"what is the balance on my": 		"get balance",
			"whats the balance on my": 			"get balance",
			"how much money is left in my": 	"get balance",
			"how much money is in my": 			"get balance",
			"how much is in my": 				"get balance",

			"log purchase": 					"log purchase",
			"i just bought": 					"log purchase",
			"i bought": 						"log purchase",
			"add a purchase": 					"log purchase",
			"add a purchase of": 				"log purchase",
			"add my purchase": 					"log purchase",
			"add my purchase of": 				"log purchase",
			"record a purchase": 				"log purchase",
			"record my purchase": 				"log purchase",
			"record a purchase of": 			"log purchase",
			"record my purchase of": 			"log purchase",
			"log a purchase": 					"log purchase",
			"log my purchase": 					"log purchase",
			"log a purchase of": 				"log purchase",
			"log my purchase of": 				"log purchase",

			"get calendar": 					"get calendar",
			"get all events": 					"get calendar",
			"get events": 						"get calendar",
			"get my events": 					"get calendar",
			"get all my events": 				"get calendar",
			"get upcoming events": 				"get calendar",
			"get my upcoming events": 			"get calendar",
			"get my calendar": 					"get calendar",
			"fetch calendar": 					"get calendar",
			"fetch events": 					"get calendar",
			"fetch my events": 					"get calendar",
			"fetch upcoming events": 			"get calendar",
			"fetch my upcoming events": 		"get calendar",
			"fetch my calendar": 				"get calendar",
			"what is on my calendar": 			"get calendar",
			"whats on my calendar": 			"get calendar",
			"what is on the calendar": 			"get calendar",
			"whats on the calendar": 			"get calendar",
			"what is happening": 				"get calendar",
			"whats happening": 					"get calendar",

			"add event": 						"add event",
			"add an event": 					"add event",
			"add this event": 					"add event",
			"create event": 					"add event",
			"create an event": 					"add event",
			"create this event": 				"add event",
			"add event to my calendar": 		"add event",
			"add an event to my calendar": 		"add event",
			"add this event to my calendar": 	"add event",
			"create event on my calendar": 		"add event",
			"create an event on my calendar": 	"add event",
			"create this event on my calendar": "add event",
			"add event called": 				"add event",
			"add an event called": 				"add event",
			"create event called": 				"add event",
			"create an event called": 			"add event",
			"add event to my calendar called": 	"add event",
			"add an event to my calendar called": "add event",
			"create event on my calendar called": 	"add event",
			"create an event on my calendar called": "add event",
			"add event named": 					"add event",
			"add an event named": 				"add event",
			"create event named": 				"add event",
			"create an event named": 			"add event",
			"add event to my calendar named": 	"add event",
			"add an event to my calendar named": "add event",
			"create event on my calendar named": "add event",
			"create an event on my calendar named": "add event",

			"get event": 						"get event",
			"get an event": 					"get event",
			"get events": 						"get event",
			"get all events": 					"get event",
			"get event called": 				"get event",
			"get an event called": 				"get event",
			"get events called": 				"get event",
			"get all events called": 			"get event",
			"get event named": 					"get event",
			"get an event named": 				"get event",
			"get events named": 				"get event",
			"get all events named": 			"get event",
			"find event": 						"get event",
			"find an event": 					"get event",
			"find events": 						"get event",
			"find all events": 					"get event",
			"find event called": 				"get event",
			"find an event called": 			"get event",
			"find events called": 				"get event",
			"find all events called": 			"get event",
			"find event named": 				"get event",
			"find an event named": 				"get event",
			"find events named": 				"get event",
			"find all events named": 			"get event",
			"search for event": 				"get event",
			"search for an event": 				"get event",
			"search for events": 				"get event",
			"search for all events": 			"get event",
			"search for event called": 			"get event",
			"search for an event called": 		"get event",
			"search for events called": 		"get event",
			"search for all events called": 	"get event",
			"search for event named": 			"get event",
			"search for an event named": 		"get event",
			"search for events named": 			"get event",
			"search for all events named": 		"get event",
			"when is": 							"get event",
			"when is the event": 				"get event",
			"when is the event called": 		"get event",
			"when is the event named": 			"get event",

			"get a list": 						"get a list",
			"get my list": 						"get a list",
			"get the list": 					"get a list",
			"get a list named": 				"get a list",
			"get my list named": 				"get a list",
			"get the list named": 				"get a list",
			"get a list called": 				"get a list",
			"get my list called": 				"get a list",
			"get the list called": 				"get a list",
			"fetch a list": 					"get a list",
			"fetch my list": 					"get a list",
			"fetch the list": 					"get a list",
			"fetch a list named": 				"get a list",
			"fetch my list named": 				"get a list",
			"fetch the list named": 			"get a list",
			"fetch a list called": 				"get a list",
			"fetch my list called": 			"get a list",
			"fetch the list called": 			"get a list",
			"what is on my list": 				"get a list",
			"whats on my list": 				"get a list",
			"what is on the list": 				"get a list",
			"whats on the list": 				"get a list",
			"whats on my todo list": 			"get a list",
			"whats on my to do list": 			"get a list",
			"what is on my todo list": 			"get a list",
			"what is on my to do list": 		"get a list",

			"add an item to a list": 			"add an item to a list",
			"add an item to the": 				"add an item to a list",
			"add an item to my": 				"add an item to a list",
			"add an item to": 					"add an item to a list",
			"add a task to a list": 			"add an item to a list",
			"add a task to the": 				"add an item to a list",
			"add a task to my": 				"add an item to a list",
			"add a task to": 					"add an item to a list",
			"add this to": 						"add an item to a list",
			"add this to the": 					"add an item to a list",
			"add this to my": 					"add an item to a list",
			"add to my": 						"add an item to a list",
			"add to": 							"add an item to a list",
			"add something to": 				"add an item to a list",
			"add something to the": 			"add an item to a list",
			"add something to my": 				"add an item to a list",
			"uncheck this on the": 				"add an item to a list",
			"uncheck this on my": 				"add an item to a list",
			"uncheck this on": 					"add an item to a list",
			"uncheck this from the": 			"add an item to a list",
			"uncheck this from my": 			"add an item to a list",
			"uncheck this from": 				"add an item to a list",
			"uncheck an item on the": 			"add an item to a list",
			"uncheck an item on my": 			"add an item to a list",
			"uncheck an item on": 				"add an item to a list",
			"uncheck a task on the": 			"add an item to a list",
			"uncheck a task on my": 			"add an item to a list",
			"uncheck a task on": 				"add an item to a list",
			"uncheck something from a list": 	"add an item to a list",
			"log an item on": 					"add an item to a list",
			"log an item on the": 				"add an item to a list",
			"log a task on my": 				"add an item to a list",
			"log a task on": 					"add an item to a list",
			"log a task on the": 				"add an item to a list",
			"log a task on my": 				"add an item to a list",

			"get contacts": 					"get contacts",
			"get contacts named": 				"get contacts",
			"get contacts with the name": 		"get contacts",
			"get contacts by the name": 		"get contacts",
			"get a contact": 					"get contacts",
			"get a named": 						"get contacts",
			"get all contacts named": 			"get contacts",
			"get all contacts with the name": 	"get contacts",
			"search for contacts named": 		"get contacts",
			"search for contacts with the name": "get contacts",
			"search for contacts by the name": 	"get contacts",
			"search for contacts called": 		"get contacts",
			"look up a contact named": 			"get contacts",
			"look up a contact with the name": 	"get contacts",
			"look up contacts named": 			"get contacts",
			"look up contacts with the name": 	"get contacts",
			"look up contacts by the name": 	"get contacts",
			"look up contacts containing": 		"get contacts",
			"look up contacts whose names include": "get contacts",
			"find contacts whose names include": "get contacts",
			"find a contact": 					"get contacts",
			"find a contact named": 			"get contacts",
			"find a contact with the name": 	"get contacts",
			"find contacts named": 				"get contacts",
			"find contacts with the name": 		"get contacts",

			"get birthday": 					"get birthday",
			"get birthday for": 				"get birthday",
			"get birthday of": 					"get birthday",
			"get the birthday": 				"get birthday",
			"get the birthday for": 			"get birthday",
			"get the birthday of": 				"get birthday",
			"look up the birthday": 			"get birthday",
			"look up the birthday for": 		"get birthday",
			"look up the birthday of": 			"get birthday",
			"when is the birthday": 			"get birthday",
			"when is the birthday for": 		"get birthday",
			"when is the birthday of": 			"get birthday",

			"get phone number": 				"get phone number",
			"get phone number for": 			"get phone number",
			"get phone number of": 				"get phone number",
			"get the phone number": 			"get phone number",
			"get the phone number for": 		"get phone number",
			"get the phone number of": 			"get phone number",
			"look up the phone number": 		"get phone number",
			"look up the phone number for": 	"get phone number",
			"look up the phone number of": 		"get phone number",
			"when is the phone number": 		"get phone number",
			"when is the phone number for": 	"get phone number",
			"when is the phone number of": 		"get phone number",

			"get email": 						"get email",
			"get email for": 					"get email",
			"get email of": 					"get email",
			"get the email": 					"get email",
			"get the email for": 				"get email",
			"get the email of": 				"get email",
			"look up the email": 				"get email",
			"look up the email for": 			"get email",
			"look up the email of": 			"get email",
			"when is the email": 				"get email",
			"when is the email for": 			"get email",
			"when is the email of": 			"get email",
			"get email address": 				"get email",
			"get email address for": 			"get email",
			"get email address of": 			"get email",
			"get the email address": 			"get email",
			"get the email address for": 		"get email",
			"get the email address of": 		"get email",
			"look up the email address": 		"get email",
			"look up the email address for": 	"get email",
			"look up the email address of": 	"get email",
			"when is the email address": 		"get email",
			"when is the email address for": 	"get email",
			"when is the email address of": 	"get email",

			"get address": 						"get address",
			"get address for": 					"get address",
			"get address of": 					"get address",
			"get the address": 					"get address",
			"get the address for": 				"get address",
			"get the address of": 				"get address",
			"look up the address": 				"get address",
			"look up the address for": 			"get address",
			"look up the address of": 			"get address",
			"when is the address": 				"get address",
			"when is the address for": 			"get address",
			"when is the address of": 			"get address",

			"draft email": 						"draft email",
			"draft an email": 					"draft email",
			"write email": 						"draft email",
			"write an email": 					"draft email",
			"compose email": 					"draft email",
			"compose an email": 				"draft email",
			"create email": 					"draft email",
			"create an email": 					"draft email",
			"draft message": 					"draft email",
			"draft an message": 				"draft email",
			"write message": 					"draft email",
			"write an message": 				"draft email",
			"compose message": 					"draft email",
			"compose an message": 				"draft email",
			"create message": 					"draft email",
			"create an message": 				"draft email",
			"draft email to": 					"draft email",
			"draft an email to": 				"draft email",
			"write email to": 					"draft email",
			"write an email to": 				"draft email",
			"compose email to": 				"draft email",
			"compose an email to": 				"draft email",
			"create email to": 					"draft email",
			"create an email to": 				"draft email",
			"draft message to": 				"draft email",
			"draft an message to": 				"draft email",
			"write message to": 				"draft email",
			"write an message to": 				"draft email",
			"compose message to": 				"draft email",
			"compose an message to": 			"draft email",
			"create message to": 				"draft email",
			"create an message to": 			"draft email",

			"log gratitude": 					"log gratitude",
			"i feel grateful for": 				"log gratitude",
			"i am grateful for": 				"log gratitude",
			"i am feeling grateful for": 		"log gratitude",
			"im grateful for": 					"log gratitude",
			"im feeling grateful for": 			"log gratitude",
			"today i feel grateful for": 		"log gratitude",
			"today i am grateful for": 			"log gratitude",
			"today i am feeling grateful for": 	"log gratitude",
			"today im grateful for": 			"log gratitude",
			"today im feeling grateful for": 	"log gratitude",
			"i feel thankful for": 				"log gratitude",
			"i am thankful for": 				"log gratitude",
			"i am feeling thankful for": 		"log gratitude",
			"im thankful for": 					"log gratitude",
			"im feeling thankful for": 			"log gratitude",
			"today i feel thankful for": 		"log gratitude",
			"today i am thankful for": 			"log gratitude",
			"today i am feeling thankful for": 	"log gratitude",
			"today im thankful for": 			"log gratitude",
			"today im feeling thankful for": 	"log gratitude",

		// Google APIs
			"search google": 					"search google",
			"search google for": 				"search google",
			"look this up on google": 			"search google",
			"do a google search": 				"search google",
			"do a google search for": 			"search google",
			"google": 							"search google",
			"do a search for": 					"search google",
			"do a search": 						"search google",
			"search": 							"search google",
			"i wonder if": 						"search google",
			"i wonder": 						"search google",
			"i am curious": 					"search google",
			"im curious": 						"search google",

			"google geolocate": 				"google geolocate",
			"geolocate": 						"google geolocate",
			"get coordinates": 					"google geolocate",
			"get coordinates of": 				"google geolocate",
			"get coordinates for": 				"google geolocate",
			"get the coordinates": 				"google geolocate",
			"get the coordinates of": 			"google geolocate",
			"get the coordinates for": 			"google geolocate",
			"find the coordinates": 			"google geolocate",
			"find the coordinates of": 			"google geolocate",
			"find the coordinates for": 		"google geolocate",
			"what are the coordinates": 		"google geolocate",
			"what are the coordinates of": 		"google geolocate",
			"what are the coordinates for": 	"google geolocate",
			"get latitude": 					"google geolocate",
			"get latitude of": 					"google geolocate",
			"get latitude for": 				"google geolocate",
			"get the latitude": 				"google geolocate",
			"get the latitude of": 				"google geolocate",
			"get the latitude for": 			"google geolocate",
			"find the latitude": 				"google geolocate",
			"find the latitude of": 			"google geolocate",
			"find the latitude for": 			"google geolocate",
			"what is the latitude": 			"google geolocate",
			"what is the latitude of": 			"google geolocate",
			"what is the latitude for": 		"google geolocate",
			"get longitude": 					"google geolocate",
			"get longitude of": 				"google geolocate",
			"get longitude for": 				"google geolocate",
			"get the longitude": 				"google geolocate",
			"get the longitude of": 			"google geolocate",
			"get the longitude for": 			"google geolocate",
			"find the longitude": 				"google geolocate",
			"find the longitude of": 			"google geolocate",
			"find the longitude for": 			"google geolocate",
			"what is the longitude": 			"google geolocate",
			"what is the longitude of": 		"google geolocate",
			"what is the longitude for": 		"google geolocate",
			"get a map": 						"google geolocate",
			"get a map of": 					"google geolocate",
			"get a map for": 					"google geolocate",
			"get me a map": 					"google geolocate",
			"get me a map of": 					"google geolocate",
			"get me a map for": 				"google geolocate",
			"find me a map": 					"google geolocate",
			"find me a map of": 				"google geolocate",
			"find me a map for": 				"google geolocate",

			"search google directions": 		"search google directions",
			"how do i get": 					"search google directions",
			"how do i go": 						"search google directions",
			"tell me how to get": 				"search google directions",
			"tell me how to go": 				"search google directions",
			"get me directions": 				"search google directions",
			"get directions": 					"search google directions",
			"look up directions": 				"search google directions",
			"look up how to get": 				"search google directions",
			"look up how to go": 				"search google directions",
			"get a route": 						"search google directions",
			"route me": 						"search google directions",

			"search google places": 			"search google places",
			"search google places for": 		"search google places",
			"find a place": 					"search google places",
			"find a place called": 				"search google places",
			"find a place named": 				"search google places",
			"find a place by the name": 		"search google places",
			"find me a place": 					"search google places",
			"find me a place called": 			"search google places",
			"find me a place named": 			"search google places",
			"find me a place by the name": 		"search google places",
			"look up a place": 					"search google places",
			"look up a place called": 			"search google places",
			"look up a place named": 			"search google places",
			"look up a place by the name": 		"search google places",
			"search for a place": 				"search google places",
			"search for a place called": 		"search google places",
			"search for a place named": 		"search google places",
			"search for a place by the name": 	"search google places",
			"look for a place": 				"search google places",
			"look for a place called": 			"search google places",
			"look for a place named": 			"search google places",
			"look for a place by the name": 	"search google places",
			"what are the business hours at": 	"search google places",
			"what are the hours at": 			"search google places",
			"what are the business hours of": 	"search google places",
			"what are the hours of": 			"search google places",
			"get the business hours for": 		"search google places",
			"get the hours for": 				"search google places",
			"get the business hours of": 		"search google places",
			"get the hours of": 				"search google places",

			"search youtube": 					"search youtube",
			"search youtube for": 				"search youtube",
			"find on youtube": 					"search youtube",
			"on youtube find": 					"search youtube",
			"on youtube look for": 				"search youtube",
			"on youtube play": 					"search youtube",
			"on youtube try": 					"search youtube",
			"play on youtube": 					"search youtube",
			"play this on youtube": 			"search youtube",
			"lets watch": 						"search youtube",
			"lets listen to": 					"search youtube",
			"on youtube put on": 				"search youtube",
			"on youtube open up": 				"search youtube",
			"on youtube open": 					"search youtube",
			"do a youtube search for": 			"search youtube",

			"google translate": 				"google translate",
			"translate": 						"google translate",
			"get a translation": 				"google translate",
			"get me a translation": 			"google translate",
			"give a translation": 				"google translate",
			"give me a translation": 			"google translate",
			"get a translation of": 			"google translate",
			"get me a translation of": 			"google translate",
			"give a translation of": 			"google translate",
			"give me a translation of": 		"google translate",
			"get a translation for": 			"google translate",
			"get me a translation for": 		"google translate",
			"give a translation for": 			"google translate",
			"give me a translation for": 		"google translate",
			"how do you say": 					"google translate",
			"how would you say": 				"google translate",
			"how can you say": 					"google translate",
			"how to say": 						"google translate",

			"search google timezone": 			"search google timezone",
			"search google timezones": 			"search google timezone",
			"search google time zone": 			"search google timezone",
			"search google time zones": 		"search google timezone",
			"what timezone is": 				"search google timezone",
			"what time zone is": 				"search google timezone",
			"what is the timezone": 			"search google timezone",
			"what is the timezone in": 			"search google timezone",
			"what is the timezone for":			"search google timezone",
			"what is the timezone of": 			"search google timezone",
			"whats the timezone": 				"search google timezone",
			"whats the timezone in": 			"search google timezone",
			"whats the timezone for":			"search google timezone",
			"whats the timezone of": 			"search google timezone",
			"get the timezone": 				"search google timezone",
			"get the timezone in": 				"search google timezone",
			"get the timezone for":				"search google timezone",
			"get the timezone of": 				"search google timezone",
			"what is the time zone": 			"search google timezone",
			"what is the time zone in": 		"search google timezone",
			"what is the time zone for":		"search google timezone",
			"what is the time zone of": 		"search google timezone",
			"whats the time zone": 				"search google timezone",
			"whats the time zone in": 			"search google timezone",
			"whats the time zone for":			"search google timezone",
			"whats the time zone of": 			"search google timezone",
			"get the time zone": 				"search google timezone",
			"get the time zone in": 			"search google timezone",
			"get the time zone for":			"search google timezone",
			"get the time zone of": 			"search google timezone",

		// games
			"play more or less": 				"play more or less",
			"lets play more or less": 			"play more or less",
			"lets play the more or less game": 	"play more or less",
			"think of a number": 				"play more or less",
			"pick a number": 					"play more or less",
			"i want to guess a number": 		"play more or less",
			"lets play more or less": 			"play more or less",

			"play true or false": 				"play true or false",
			"quiz me": 							"play true or false",
			"tell me a fact": 					"play true or false",
			"tell me a fun fact": 				"play true or false",
			"give me a fact": 					"play true or false",
			"give me a fun fact": 				"play true or false",
			"lets do trivia": 					"play true or false",
			"lets do some trivia": 				"play true or false",
			"lets play trivia": 				"play true or false",
			"lets play some trivia": 			"play true or false",
			"lets play true or false": 			"play true or false",

			"play blackjack": 					"play blackjack",
			"lets play blackjack": 				"play blackjack",
			"play 21": 							"play blackjack",
			"lets play 21": 					"play blackjack",
			"deal me in": 						"play blackjack",
			"deal me cards": 					"play blackjack",
			"deal me some cards": 				"play blackjack",

			"play hangman": 					"play hangman",
			"lets play hangman": 				"play hangman",
			"play guess the word": 				"play hangman",
			"lets play guess the word": 		"play hangman",
			"play guess that word": 			"play hangman",
			"lets play guess that word": 		"play hangman",
			"think of a word": 					"play hangman",
			"think of a random word": 			"play hangman",
			"i want to guess a word": 			"play hangman",
			"i want to guess your word": 		"play hangman",

		// IFTTT
			"trigger i f t t t": 				"trigger ifttt",
			"trigger ifttt": 					"trigger ifttt",
			"trigger if this then that": 		"trigger ifttt",
			"i f t t t": 						"trigger ifttt",
			"ifttt": 							"trigger ifttt",
			"if this then that": 				"trigger ifttt",
			"run i f t t t command": 			"trigger ifttt",
			"run ifttt command": 				"trigger ifttt",
			"run if this then that command": 	"trigger ifttt",
			"run i f t t t action": 			"trigger ifttt",
			"run ifttt action": 				"trigger ifttt",
			"run if this then that action": 	"trigger ifttt",
			"on i f t t t do": 					"trigger ifttt",
			"on ifttt do": 						"trigger ifttt",
			"on if this then that do": 			"trigger ifttt",
			"do i f t t t action": 				"trigger ifttt",
			"do ifttt action": 					"trigger ifttt",
			"do if this then that action": 		"trigger ifttt",
			"set ifttt devices": 				"trigger ifttt",
			"set ifttt device": 				"trigger ifttt",
			"on ifttt set": 					"trigger ifttt",
			"on ifttt update": 					"trigger ifttt",
			"on ifttt turn": 					"trigger ifttt",
			"on ifttt change": 					"trigger ifttt",
			"on ifttt alter": 					"trigger ifttt",
			"on ifttt make": 					"trigger ifttt",

			"turn on ifttt device": 			"turn on ifttt device",
			"turn on ifttt devices": 			"turn on ifttt device",
			"on ifttt turn on": 				"turn on ifttt device",
			"on ifttt switch on": 				"turn on ifttt device",
			"on ifttt flip on": 				"turn on ifttt device",
			"on ifttt activate": 				"turn on ifttt device",
			"turn on": 							"turn on ifttt device",
			"switch on": 						"turn on ifttt device",
			"flip on": 							"turn on ifttt device",
			"activate": 						"turn on ifttt device",

			"turn off ifttt device": 			"turn off ifttt device",
			"turn off ifttt devices": 			"turn off ifttt device",
			"on ifttt turn off": 				"turn off ifttt device",
			"on ifttt switch off": 				"turn off ifttt device",
			"on ifttt flip off": 				"turn off ifttt device",
			"on ifttt deactivate": 				"turn off ifttt device",
			"turn off": 						"turn off ifttt device",
			"switch off": 						"turn off ifttt device",
			"flip off": 						"turn off ifttt device",
			"deactivate": 						"turn off ifttt device",

			"toggle ifttt device": 				"toggle ifttt device",
			"toggle ifttt devices": 			"toggle ifttt device",
			"on ifttt toggle": 					"toggle ifttt device",
			"on ifttt toggle": 					"toggle ifttt device",
			"on ifttt flip": 					"toggle ifttt device",
			"toggle": 							"toggle ifttt device",
			"switch": 							"toggle ifttt device",
			"flip": 							"toggle ifttt device",

		// SONOS
			"get sonos devices": 				"get sonos devices",
			"get all sonos devices": 			"get sonos devices",
			"get my sonos devices": 			"get sonos devices",
			"on sonos get devices": 			"get sonos devices",
			"on sonos get my devices": 			"get sonos devices",
			"on sonos get all devices": 		"get sonos devices",
			"on sonos get the devices": 		"get sonos devices",
			"on sonos get all the devices": 	"get sonos devices",
			"on sonos get all of the devices": 	"get sonos devices",
			"on sonos get status": 				"get sonos devices",
			"on sonos whats the situation": 	"get sonos devices",
			"on sonos what is the situation": 	"get sonos devices",
			"on sonos give me a status report": "get sonos devices",
			"on sonos report": 					"get sonos devices",
			"on sonos tell me the situation": 	"get sonos devices",

			"set sonos devices": 				"set sonos devices",
			"set sonos device": 				"set sonos devices",
			"on sonos set": 					"set sonos devices",
			"on sonos update": 					"set sonos devices",
			"on sonos turn": 					"set sonos devices",
			"on sonos change": 					"set sonos devices",
			"on sonos alter": 					"set sonos devices",
			"on sonos make": 					"set sonos devices",

			"turn off sonos device": 			"turn off sonos device",
			"turn off sonos devices": 			"turn off sonos device",
			"on sonos turn off": 				"turn off sonos device",
			"on sonos switch off": 				"turn off sonos device",
			"on sonos flip off": 				"turn off sonos device",
			"on sonos deactivate": 				"turn off sonos device",
			"on sonos mute": 					"turn off sonos device",
			"turn off player": 					"turn off sonos device",
			"switch off player": 				"turn off sonos device",
			"flip off player": 					"turn off sonos device",
			"deactivate player": 				"turn off sonos device",
			"mute player": 						"turn off sonos device",
			"turn off players": 				"turn off sonos device",
			"switch off players": 				"turn off sonos device",
			"flip off players": 				"turn off sonos device",
			"deactivate players": 				"turn off sonos device",
			"mute players": 					"turn off sonos device",
			"turn off all players": 			"turn off sonos device",
			"switch off all players": 			"turn off sonos device",
			"flip off all players": 			"turn off sonos device",
			"deactivate all players": 			"turn off sonos device",
			"mute all players": 				"turn off sonos device",
			"turn off speaker": 				"turn off sonos device",
			"switch off speaker": 				"turn off sonos device",
			"flip off speaker": 				"turn off sonos device",
			"deactivate speaker": 				"turn off sonos device",
			"mute speaker": 					"turn off sonos device",
			"turn off speakers": 				"turn off sonos device",
			"switch off speakers": 				"turn off sonos device",
			"flip off speakers": 				"turn off sonos device",
			"deactivate speakers": 				"turn off sonos device",
			"mute speakers": 					"turn off sonos device",
			"turn off all speakers": 			"turn off sonos device",
			"switch off all speakers": 			"turn off sonos device",
			"flip off all speakers": 			"turn off sonos device",
			"deactivate all speakers": 			"turn off sonos device",
			"mute all speakers": 				"turn off sonos device",
			"turn off the player in the": 		"turn off sonos device",
			"switch off the player in the": 	"turn off sonos device",
			"flip off the player in the": 		"turn off sonos device",
			"deactivate the player in the": 	"turn off sonos device",
			"mute the player in the": 			"turn off sonos device",
			"turn off the speaker in the": 		"turn off sonos device",
			"switch off the speaker in the": 	"turn off sonos device",
			"flip off the speaker in the": 		"turn off sonos device",
			"deactivate the speaker in the": 	"turn off sonos device",
			"mute the speaker in the": 			"turn off sonos device",

			"turn on sonos device": 			"turn on sonos device",
			"turn on sonos devices": 			"turn on sonos device",
			"on sonos turn on": 				"turn on sonos device",
			"on sonos switch on": 				"turn on sonos device",
			"on sonos flip on": 				"turn on sonos device",
			"on sonos activate": 				"turn on sonos device",
			"on sonos unmute": 					"turn on sonos device",
			"turn on player": 					"turn on sonos device",
			"switch on player": 				"turn on sonos device",
			"flip on player": 					"turn on sonos device",
			"activate player": 					"turn on sonos device",
			"unmute player": 					"turn on sonos device",
			"turn on players": 					"turn on sonos device",
			"switch on players": 				"turn on sonos device",
			"flip on players": 					"turn on sonos device",
			"activate players": 				"turn on sonos device",
			"unmute players": 					"turn on sonos device",
			"turn on all players": 				"turn on sonos device",
			"switch on all players": 			"turn on sonos device",
			"flip on all players": 				"turn on sonos device",
			"activate all players": 			"turn on sonos device",
			"unmute all players": 				"turn on sonos device",
			"turn on speaker": 					"turn on sonos device",
			"switch on speaker": 				"turn on sonos device",
			"flip on speaker": 					"turn on sonos device",
			"activate speaker": 				"turn on sonos device",
			"unmute speaker": 					"turn on sonos device",
			"turn on speakers": 				"turn on sonos device",
			"switch on speakers": 				"turn on sonos device",
			"flip on speakers": 				"turn on sonos device",
			"activate speakers": 				"turn on sonos device",
			"unmute speakers": 					"turn on sonos device",
			"turn on all speakers": 			"turn on sonos device",
			"switch on all speakers": 			"turn on sonos device",
			"flip on all speakers": 			"turn on sonos device",
			"activate all speakers": 			"turn on sonos device",
			"unmute all speakers": 				"turn on sonos device",
			"turn on the player in the": 		"turn on sonos device",
			"switch on the player in the": 		"turn on sonos device",
			"flip on the player in the": 		"turn on sonos device",
			"activate the player in the": 		"turn on sonos device",
			"unmute the player in the": 		"turn on sonos device",
			"turn on the speaker in the": 		"turn on sonos device",
			"switch on the speaker in the": 	"turn on sonos device",
			"flip on the speaker in the": 		"turn on sonos device",
			"activate the speaker in the": 		"turn on sonos device",
			"unmute the speaker in the": 		"turn on sonos device",

			"turn up sonos device": 			"turn up sonos device",
			"turn up the speaker in": 			"turn up sonos device",
			"turn up the speaker in the": 		"turn up sonos device",
			"turn up the speakers in": 			"turn up sonos device",
			"turn up the speakers in the": 		"turn up sonos device",
			"turn up all speakers": 			"turn up sonos device",
			"turn up the player in": 			"turn up sonos device",
			"turn up the player in the": 		"turn up sonos device",
			"turn up the players in": 			"turn up sonos device",
			"turn up the players in the": 		"turn up sonos device",
			"turn up all players": 				"turn up sonos device",
			"turn up the volume": 				"turn up sonos device",

			"turn down sonos device": 			"turn down sonos device",
			"turn down the speaker in": 		"turn down sonos device",
			"turn down the speaker in the": 	"turn down sonos device",
			"turn down the speakers in": 		"turn down sonos device",
			"turn down the speakers in the": 	"turn down sonos device",
			"turn down all speakers": 			"turn down sonos device",
			"turn down the player in": 			"turn down sonos device",
			"turn down the player in the": 		"turn down sonos device",
			"turn down the players in": 		"turn down sonos device",
			"turn down the players in the": 	"turn down sonos device",
			"turn down all players": 			"turn down sonos device",
			"turn down the volume": 			"turn down sonos device",

			"pause sonos device": 				"pause sonos device",
			"pause sonos devices": 				"pause sonos device",
			"pause all sonos devices": 			"pause sonos device",
			"pause sonos": 						"pause sonos device",
			"pause the music": 					"pause sonos device",
			"pause music": 						"pause sonos device",
			"stop sonos device": 				"pause sonos device",
			"stop sonos devices": 				"pause sonos device",
			"stop all sonos devices": 			"pause sonos device",
			"stop sonos": 						"pause sonos device",
			"stop the music": 					"pause sonos device",
			"stop music": 						"pause sonos device",
			"on sonos pause device": 			"pause sonos device",
			"on sonos pause devices": 			"pause sonos device",
			"on sonos pause all": 				"pause sonos device",
			"on sonos pause all devices": 		"pause sonos device",
			"on sonos stop device": 			"pause sonos device",
			"on sonos stop devices": 			"pause sonos device",
			"on sonos stop all": 				"pause sonos device",
			"on sonos stop all devices": 		"pause sonos device",

			"play sonos device": 				"play sonos device",
			"play sonos devices": 				"play sonos device",
			"play all sonos devices": 			"play sonos device",
			"play sonos": 						"play sonos device",
			"play the music": 					"play sonos device",
			"play music": 						"play sonos device",
			"start sonos device": 				"play sonos device",
			"start sonos devices": 				"play sonos device",
			"start all sonos devices": 			"play sonos device",
			"start sonos": 						"play sonos device",
			"start the music": 					"play sonos device",
			"start music": 						"play sonos device",
			"on sonos play device": 			"play sonos device",
			"on sonos play devices": 			"play sonos device",
			"on sonos play all": 				"play sonos device",
			"on sonos play all devices": 		"play sonos device",
			"on sonos start device": 			"play sonos device",
			"on sonos start devices": 			"play sonos device",
			"on sonos start all": 				"play sonos device",
			"on sonos start all devices": 		"play sonos device",

			"play next on sonos": 				"play next on sonos",
			"skip track": 						"play next on sonos",
			"skip this song": 					"play next on sonos",
			"next track": 						"play next on sonos",
			"play next track": 					"play next on sonos",
			"play the next track": 				"play next on sonos",
			"next song": 						"play next on sonos",
			"play next song": 					"play next on sonos",
			"play the next song": 				"play next on sonos",
			"on sonos play the next track": 	"play next on sonos",
			"on sonos play the next song": 		"play next on sonos",
			"on sonos skip this track": 		"play next on sonos",
			"on sonos skip this song": 			"play next on sonos",
			"on sonos skip to the next track": 	"play next on sonos",
			"on sonos skip to the next song": 	"play next on sonos",

			"play previous on sonos": 			"play previous on sonos",
			"go back a track": 					"play previous on sonos",
			"go back a song": 					"play previous on sonos",
			"previous track": 					"play previous on sonos",
			"play previous track": 				"play previous on sonos",
			"play the previous track": 			"play previous on sonos",
			"previous song": 					"play previous on sonos",
			"play previous song": 				"play previous on sonos",
			"play the previous song": 			"play previous on sonos",
			"on sonos play the previous track": "play previous on sonos",
			"on sonos play the previous song": 	"play previous on sonos",
			"on sonos go back": 				"play previous on sonos",
			"on sonos go back a track": 		"play previous on sonos",
			"on sonos go back a song": 			"play previous on sonos",
			"on sonos skip to the previous track": "play previous on sonos",
			"on sonos skip to the previous song": "play previous on sonos",

			"get now playing on sonos": 		"get now playing on sonos",
			"what is playing on sonos": 		"get now playing on sonos",
			"whats playing on sonos": 			"get now playing on sonos",
			"what is this song": 				"get now playing on sonos",
			"whats this song": 					"get now playing on sonos",
			"what song is this": 				"get now playing on sonos",
			"what is this track": 				"get now playing on sonos",
			"whats this track": 				"get now playing on sonos",
			"what track is this": 				"get now playing on sonos",

			"get favorites on sonos": 			"get favorites on sonos",
			"on sonos get favorites": 			"get favorites on sonos",
			"get sonos favorites": 				"get favorites on sonos",
			"get my favorites on sonos": 		"get favorites on sonos",
			"on sonos get my favorites": 		"get favorites on sonos",
			"get my sonos favorites": 			"get favorites on sonos",
			"what are my sonos favorites": 		"get favorites on sonos",
			"list favorites on sonos": 			"get favorites on sonos",
			"list my favorites on sonos": 		"get favorites on sonos",
			"list sonos favorites": 			"get favorites on sonos",
			"list my sonos favorites": 			"get favorites on sonos",

			"play favorite on sonos": 			"play favorite on sonos",
			"play this on sonos": 				"play favorite on sonos",
			"on sonos play": 					"play favorite on sonos",
			"on sonos play this": 				"play favorite on sonos",
			"on sonos play this favorite": 		"play favorite on sonos",
			"on sonos play favorite": 			"play favorite on sonos",
			"on sonos play favorite number": 	"play favorite on sonos",
			"on sonos play number": 			"play favorite on sonos",

		// Wink
			"get wink devices": 				"get wink devices",
			"get all wink devices": 			"get wink devices",
			"get my wink devices": 				"get wink devices",
			"on wink get devices": 				"get wink devices",
			"on wink get my devices": 			"get wink devices",
			"on wink get all devices": 			"get wink devices",
			"on wink get the devices": 			"get wink devices",
			"on wink get all the devices": 		"get wink devices",
			"on wink get all of the devices": 	"get wink devices",
			"on wink get status": 				"get wink devices",
			"on wink whats the situation": 		"get wink devices",
			"on wink what is the situation": 	"get wink devices",
			"on wink give me a status report": 	"get wink devices",
			"on wink what is the temperature": 	"get wink devices",
			"on wink whats the temperature": 	"get wink devices",
			"on wink tell me the temperature": 	"get wink devices",
			"on wink report": 					"get wink devices",
			"on wink tell me the situation": 	"get wink devices",

			"set wink devices": 				"set wink devices",
			"set wink device": 					"set wink devices",
			"on wink set": 						"set wink devices",
			"on wink update": 					"set wink devices",
			"on wink turn": 					"set wink devices",
			"on wink change": 					"set wink devices",
			"on wink alter": 					"set wink devices",
			"on wink make": 					"set wink devices",

			"turn off wink device": 			"turn off wink device",
			"turn off wink devices": 			"turn off wink device",
			"on wink turn off": 				"turn off wink device",
			"on wink switch off": 				"turn off wink device",
			"on wink flip off": 				"turn off wink device",
			"on wink deactivate": 				"turn off wink device",
			
			"turn on wink device": 				"turn on wink device",
			"turn on wink devices": 			"turn on wink device",
			"on wink turn on": 					"turn on wink device",
			"on wink switch on": 				"turn on wink device",
			"on wink flip on": 					"turn on wink device",
			"on wink activate": 				"turn on wink device",

		// Reddit
			"get a reddit post": 				"get a reddit post",
			"get a random reddit post": 		"get a reddit post",
			"what is happening on reddit": 		"get a reddit post",
			"whats happening on reddit": 		"get a reddit post",
			"fetch reddit": 					"get a reddit post",

			"ask reddit": 						"ask reddit",
			"ask a question": 					"ask reddit",
			"ask me a question": 				"ask reddit",
			"ask us a question": 				"ask reddit",
			"ask me something": 				"ask reddit",
			"ask us something": 				"ask reddit",
			"ask something": 					"ask reddit",
			"change the subject": 				"ask reddit",
			"change the topic": 				"ask reddit",
			"change topic": 					"ask reddit",
			"change subject": 					"ask reddit",

			"get a reddit writing prompt": 		"get a reddit writing prompt",
			"get a writing prompt": 			"get a reddit writing prompt",
			"give me a writing prompt": 		"get a reddit writing prompt",
			"fetch a writing prompt": 			"get a reddit writing prompt",
			"what should i write about": 		"get a reddit writing prompt",

			"get a reddit shower thought": 		"get a reddit shower thought",
			"get a shower thought": 			"get a reddit shower thought",
			"give me a shower thought": 		"get a reddit shower thought",
			"fetch a shower thought": 			"get a reddit shower thought",
			"give me an idea": 					"get a reddit shower thought",
			"give me something to think about": "get a reddit shower thought",

		// custom APIs
			"convert": 							"convert",
			"do a conversion": 					"convert",
			"can you convert": 					"convert",
			"lets convert": 					"convert",

			"find factors": 					"find factors",
			"find factors of": 					"find factors",
			"find the factors of": 				"find factors",
			"find factors for": 				"find factors",
			"what are the factors of": 			"find factors",
			"tell me about the number": 		"find factors",
			"is this number prime": 			"find factors",
			"is this number composite": 		"find factors",
			"what are the prime factors of": 	"find factors",
			"what numbers go into": 			"find factors",
			"what are the divisors of": 		"find factors",
			"get the factors of": 				"find factors",

			"analyze chord": 					"analyze chord",
			"tell me about the notes": 			"analyze chord",
			"analyze the chord": 				"analyze chord",
			"analyze this chord": 				"analyze chord",
			"what chord are the notes": 		"analyze chord",
			"make a chord from the notes": 		"analyze chord",
			"make a chord from": 				"analyze chord",

			"shuffle word": 					"shuffle word",
			"shuffle": 							"shuffle word",
			"shuffle the word": 				"shuffle word",
			"shuffle this word": 				"shuffle word",
			"what words can you make from": 	"shuffle word",
			"what are some anagrams for": 		"shuffle word",
			"make new words from": 				"shuffle word",
			"find anagrams for": 				"shuffle word",
			"find anagrams of": 				"shuffle word",

			"convert base": 					"convert base",
			"convert bases": 					"convert base",
			"do a base conversion": 			"convert base",
			"do base conversion": 				"convert base",
			"perform a base conversion": 		"convert base",
			"perform base conversion": 			"convert base",
			"change base for number": 			"convert base",
			"change bases for number": 			"convert base",
			"convert base for number":			"convert base",
			"convert bases for number": 		"convert base",
			"do a base conversion for number": 	"convert base",
			"do base conversion for number": 	"convert base",
			"perform a base conversion for number": "convert base",
			"perform base conversion for number": "convert base",
			"change base for number": 			"convert base",
			"change bases for number": 			"convert base",
			"change base 4 number": 			"convert base",
			"change bases 4 number": 			"convert base",
			"convert base 4 number":			"convert base",
			"convert bases 4 number": 		"convert base",
			"do a base conversion 4 number": 	"convert base",
			"do base conversion 4 number": 	"convert base",
			"perform a base conversion 4 number": "convert base",
			"perform base conversion 4 number": "convert base",
			"change base 4 number": 			"convert base",
			"change bases 4 number": 			"convert base",
			"convert bass": 					"convert base",
			"convert basses": 					"convert base",
			"do a bass conversion": 			"convert base",
			"do bass conversion": 				"convert base",
			"perform a bass conversion": 		"convert base",
			"perform bass conversion": 			"convert base",
			"change bass for number": 			"convert base",
			"change basses for number": 		"convert base",
			"convert bass for number":			"convert base",
			"convert basses for number": 		"convert base",
			"do a bass conversion for number": 	"convert base",
			"do bass conversion for number": 	"convert base",
			"perform a bass conversion for number": "convert base",
			"perform bass conversion for number": "convert base",
			"change bass 4 number": 			"convert base",
			"change basses 4 number": 		"convert base",
			"change bass 4 number": 			"convert base",
			"change basses 4 number": 		"convert base",
			"convert bass 4 number":			"convert base",
			"convert basses 4 number": 		"convert base",
			"do a bass conversion 4 number": 	"convert base",
			"do bass conversion 4 number": 	"convert base",
			"perform a bass conversion 4 number": "convert base",
			"perform bass conversion 4 number": "convert base",
			"change bass 4 number": 			"convert base",
			"change basses 4 number": 		"convert base",

			"encrypt message": 					"encrypt message",
			"encrypt this message": 			"encrypt message",
			"encrypt text": 					"encrypt message",
			"encrypt this text": 				"encrypt message",
			"encrypt this": 					"encrypt message",
			"encrypt": 							"encrypt message",
			"do an encryption": 				"encrypt message",
			"do an encryption for": 			"encrypt message",
			"perform an encryption": 			"encrypt message",
			"perform an encryption for": 		"encrypt message",

			"decrypt message": 					"decrypt message",
			"decrypt this message": 			"decrypt message",
			"decrypt text": 					"decrypt message",
			"decrypt this text": 				"decrypt message",
			"decrypt this": 					"decrypt message",
			"decrypt": 							"decrypt message",
			"do a decryption": 					"decrypt message",
			"do a decryption for": 				"decrypt message",
			"perform a decryption": 			"decrypt message",
			"perform a decryption for": 		"decrypt message",
	}

/* action library */
	window.ACTION_LIBRARY = {
		// casual responses
			"receive gratitude": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f426;"

					// possible messages
						var messages = ["You're welcome.", "Glad I could help.", "Any time.", "Don't mention it.", "No problem."]

					// send random message
						var message = window.FUNCTION_LIBRARY.chooseRandom(messages)
						var responseHTML = "<h2>" + message + "</h2>"
						callback({icon: icon, auto: true, message: message, html: responseHTML, followup: false})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"receive apology": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f426;"

					// possible messages
						var messages = ["Don't worry about it.", "I forgive you.", "It's all right.", "No worries.", "Everything will be okay."]

					// send random message
						var message = window.FUNCTION_LIBRARY.chooseRandom(messages)
						var responseHTML = "<h2>" + message + "</h2>"
						callback({icon: icon, auto: true, message: message, html: responseHTML, followup: false})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"receive affirmation": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f426;"

					// possible messages
						var messages = ["I am a good bird.", "Thank you. I try my hardest.", "That's kind of you to say.", "I'm glad you think so.", "I appreciate that."]

					// send random message
						var message = window.FUNCTION_LIBRARY.chooseRandom(messages)
						var responseHTML = "<h2>" + message + "</h2>"
						callback({icon: icon, auto: true, message: message, html: responseHTML, followup: false})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"receive greeting": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f44b;"

					// clean up remainder
						remainder = remainder.toLowerCase().replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").trim()
						var words = remainder.split(/\s/gi) || []
						var message = ""

					// time of day
						if (words.includes("morning")) {
							message = "Good morning to you too!"
						}
						else if (words.includes("day")) {
							message = "I hope you have a great day too!"
						}
						else if (words.includes("afternoon") ) {
							message = "Good afternoon to you too!"
						}
						else if (words.includes("evening")) {
							message = "Good evening to you too!"
						}
						else if (words.includes("night")) {
							message = "I hope you have a good night too!"
						}

					// holidays
						else if (words.includes("christmas")) {
							message = "Merry Christmas to you too!"
						}
						else if (remainder.length) {
							message = "Happy " + remainder + " to you too!"
						}

					// default
						else {
							message = "Hello!"
						}

					// response
						var responseHTML = "<h2>" + message + "</h2>"
						callback({icon: icon, auto: true, message: message, html: responseHTML, followup: false})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// meta
			"list actions": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f426;"

					// actions
						var phraseLists = []
						var actionList = Object.keys(window.ACTION_LIBRARY)
						for (var i in actionList) {
							phraseLists[actionList[i]] = []
						}

					// phrases
						for (var i in window.PHRASE_LIBRARY) {
							phraseLists[window.PHRASE_LIBRARY[i]].push(i)
						}

					// pick three at random
						var nonsuggestable = ["receive gratitude", "receive apology", "receive affirmation", "receive greeting",
							"list actions", "stop last video", "stop listening", "change configuration", "authorize platform", "cancel alarm", "cancel all alarms"]
						var suggestableActionList = actionList.filter(function(name) {
							return !nonsuggestable.includes(name)
						})
						var randomActions = []
						var escapeCount = 10
						while (randomActions.length < 3 && escapeCount) {
							escapeCount--
							var randomAction = window.FUNCTION_LIBRARY.chooseRandom(suggestableActionList)
							if (!randomActions.includes(randomAction)) {
								randomActions.push(randomAction)
							} 
						}

					// response
						var message = "Here are all the actions I know. Why don't you try " + randomActions.join(", or ") + "?"
						var responseHTML = "<h2>all actions</h2>" + 
							actionList.map(function(action) {
								return "<details>" + 
								"<summary>" + action + "</summary>" + 
								"<ul><li>" + phraseLists[action].join("</li><li>") + "</li></ul>" + 
								"</details>"
							}).join("")
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"explain self": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f426;"

					// send response
						var message = "Bluejay is an action-voice engine by James Mayr. Here's how I work and how you can customize me."
						var url = "/README.md"
						var responseHTML = "<a target='_blank' href='" + url + "'><h2>readme</h2></a>" +
						"<iframe src='" + url + "' width='600' height='400' frameborder='0'></iframe>"
						callback({icon: icon, message: message, html: responseHTML, url: url})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"repeat this": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f426;"

					// no remainder
						remainder = remainder.replace(/[?!,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I repeat?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// send response
						var message = remainder
						var responseHTML = "<h2>" + remainder + "</h2>"
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"repeat that": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f426;"

					// no history
						if (!window.CONTEXT_LIBRARY.lastAction || !window.ACTION_LIBRARY[window.CONTEXT_LIBRARY.lastAction]) {
							callback({icon: icon, error: true, message: "There's nothing for me to repeat.", html: "<h2>Error: no previous response.</h2>", followup: false})
							return
						}

					// send response
						var message = window.CONTEXT_LIBRARY.lastResponseMessage
						var responseHTML = "<h2>" + window.CONTEXT_LIBRARY.lastResponseHTML + "</h2>"
						callback({icon: window.CONTEXT_LIBRARY.lastResponseIcon || icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"do that again": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f426;"

					// no history
						if (!window.CONTEXT_LIBRARY.lastAction || !window.ACTION_LIBRARY[window.CONTEXT_LIBRARY.lastAction]) {
							callback({icon: icon, error: true, message: "There's nothing for me to do.", html: "<h2>Error: no previous action.</h2>", followup: false})
							return
						}

					// perform action again
						window.ACTION_LIBRARY[window.CONTEXT_LIBRARY.lastAction](window.CONTEXT_LIBRARY.lastRemainder || null, callback)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get next result": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x23ed;"

					// no more results
						if (!window.CONTEXT_LIBRARY.lastResults || !window.CONTEXT_LIBRARY.lastResults.length) {
							// no history at all
								if (!window.CONTEXT_LIBRARY.lastAction || !window.ACTION_LIBRARY[window.CONTEXT_LIBRARY.lastAction]) {
									callback({icon: icon, error: true, message: "I don't have any results.", html: "<h2>No more results.</h2>", followup: false})
									return
								}

							// run the function again
								window.ACTION_LIBRARY[window.CONTEXT_LIBRARY.lastAction](window.CONTEXT_LIBRARY.lastRemainder || null, callback)
								return
						}

					// get first of lastResults
						var nextResult = window.CONTEXT_LIBRARY.lastResults.shift()

					// if video
						if (nextResult.video && window.CONTEXT_LIBRARY.lastResponseVideo) {
							window.FUNCTION_LIBRARY.stopVideo(window.CONTEXT_LIBRARY.lastResponseVideo)
						}

					// send response
						callback(nextResult)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"stop last video": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f6ab;"

					// no video
						if (!window.CONTEXT_LIBRARY.lastResponseVideo) {
							callback({icon: icon, error: true, message: "I don't have a video to stop.", html: "<h2>No previous video.</h2>", followup: false})
							return
						}

					// stop the video
						var success = window.FUNCTION_LIBRARY.stopVideo(window.CONTEXT_LIBRARY.lastResponseVideo)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"restart last video": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4fa;"

					// no video
						if (!window.CONTEXT_LIBRARY.lastResponseVideo) {
							callback({icon: icon, error: true, message: "I don't have a video to restart.", html: "<h2>No previous video.</h2>", followup: false})
							return
						}

					// restart the video
						var success = window.FUNCTION_LIBRARY.restartVideo(window.CONTEXT_LIBRARY.lastResponseVideo)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"open": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f5a5;"

					// clean up remainder
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What did you want me to open?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// url
						var url = null

					// that?
						if (remainder == "that") {
							url = window.CONTEXT_LIBRARY.lastResponseURL
						}

					// url?
						if (!url) {
							try {
								url = new URL(remainder).href
							}
							catch (error) {}
						}

					// name?
						if (!url) {
							// name
								var name = remainder.replace(/[?!,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
								if (!name || !name.trim()) {
									callback({icon: icon, error: true, message: "What did you want me to open?", html: "<h2>Error: invalid query</h2>"})
									return
								}

							// websites library
								var websites = {
									"google": "https://google.com",
									"drive": "https://www.drive.google.com",
									"google drive": "https://www.drive.google.com",
									"gmail": "https://www.mail.google.com",
									"google calendar": "https://www.calendar.google.com",
									"youtube": "https://www.youtube.com",
									"wikipedia": "https://www.wikipedia.com",
									"reddit": "https://www.reddit.com",
									"tumblr": "https://www.tumblr.com",
									"hulu": "https://www.hulu.com",
									"netflix": "https://www.netflix.com",
									"amazon": "https://www.amazon.com"
								}

							// can't be found
								if (!websites[name] && !window.CONFIGURATION_LIBRARY[name]) {
									callback({icon: icon, error: true, message: "I don't know that website.", html: "<h2>Error: unknown website:</h2>" + name})
									return
								}

							// named website
								url = websites[name] || window.CONFIGURATION_LIBRARY[name]
						}

					// still no url
						if (!url) {
							callback({icon: icon, error: true, message: "I don't know that website.", html: "<h2>Error: unknown website:</h2>" + name})
							return
						}

					// response
						var message = ""
						var responseHTML = "<a target='_blank' href='" + url + "'><h2>" + (name || url) + "</h2></a>"
						callback({icon: icon, auto: true, message: message, html: responseHTML, url: url})

					// open window
						window.open(url, "_blank")
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// settings
			"stop listening": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f507;"

					// force whistling off
						window.FUNCTION_LIBRARY.changeWhistleOn({forceOff: true})
						var restartTime = null

					// split into array
						remainder = remainder.replace(/[?!.,;'"_\(\)\$\%]/gi,"").toLowerCase().trim()
						var words = remainder.split(/\s/gi) || []

					// then
						if (remainder.includes("then") && window.CONTEXT_LIBRARY.lastResponseTime) {
							restartTime = window.CONTEXT_LIBRARY.lastResponseTime.getTime()
						}

					// timer
						else if ((/second|minute|hour|day|for/gi).test(remainder)) {
							var units = {
								"second": 1000,
								"minute": 1000 * 60,
								"hour": 1000 * 60 * 60,
								"day": 1000 * 60 * 60 * 24
							}

							var amounts = []
							for (var i = 0; i < words.length; i++) {
								words[i] = window.FUNCTION_LIBRARY.getDigits(words[i])

								if (!isNaN(words[i])) {
									if (words[i + 1] && units[words[i + 1].replace(/s$/gi,"").toLowerCase()]) {
										amounts.push({
											number: Number(words[i]),
											unit: words[i + 1].replace(/s$/gi,"")
										})
									}
									else {
										amounts.push({
											number: Number(words[i]),
											unit: "minute"
										})
									}
								}
							}

							var duration = 0
							for (var i in amounts) {
								duration += (amounts[i].number * units[amounts[i].unit])
							}

							if (duration && !isNaN(duration)) {
								restartTime = new Date().getTime() + duration
							}
						}

					// alarm
						else if ((/until|till|til/gi).test(remainder)) {
							var timePhrase = remainder.replace(/until|till|til/gi,"").toLowerCase().trim()
							restartTime = window.FUNCTION_LIBRARY.getDateTime(timePhrase)
							restartTime = new Date(restartTime).getTime()
						}

					// restartTime?
						if (restartTime && !isNaN(restartTime)) {
							window.CONTEXT_LIBRARY.startListening = restartTime
						}
						else {
							window.CONTEXT_LIBRARY.startListening = null
						}

					// get message
						if (restartTime) {
							var time = new Date(restartTime)
							var responseHTML = "<h2>whistle detection turned off until <b>" + time.toLocaleString() + "</b></h2>"
						}
						else {
							var time = null
							var responseHTML = "<h2>whistle detection turned off</h2>"
						}
						
					// response
						callback({icon: icon, auto: true, message: "", html: responseHTML, followup: false, time: time})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"change voice": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f50a;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What voice should I set?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// chang evoice
						var name = remainder
						var voice = window.FUNCTION_LIBRARY.changeVoice({name: name})

					// failure
						if (voice === false) {
							callback({icon: icon, error: true, message: "I don't recognize that voice.", html: "<h2>Error: voice not found:</h2>" + remainder})
							return
						}

					// success
						var message = "Voice set to " + voice
						var responseHTML = "<h2>voice: " + voice + "</h2>"
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"change volume": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f50a;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What volume should I set?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// change volume
						var volume = remainder.replace(/percent/gi, "").trim()
							volume = window.FUNCTION_LIBRARY.getDigits(volume)
						var newVolume = window.FUNCTION_LIBRARY.changeVoiceVolume({volume: volume})

					// failure
						if (newVolume === false) {
							callback({icon: icon, error: true, message: "I don't know that number.", html: "<h2>Error: invalid volume:</h2>" + remainder})
							return
						}

					// success
						var message = "Volume set to " + newVolume + " percent"
						var responseHTML = "<h2>volume: " + newVolume + "%</h2>"
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"change brightness": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f506;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What brightness should I set?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// change brightness
						var brightness = remainder.replace(/percent/gi, "").trim()
							brightness = window.FUNCTION_LIBRARY.getDigits(brightness)
						var newBrightness = window.FUNCTION_LIBRARY.changeBrightness({brightness: brightness})

					// failure
						if (newBrightness === false) {
							callback({icon: icon, error: true, message: "I don't know that number.", html: "<h2>Error: invalid brightness:</h2>" + remainder})
							return
						}

					// success
						var message = "Brightness set to " + newBrightness + " percent"
						var responseHTML = "<h2>brightness: " + newBrightness + "%</h2>"
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"change listening duration": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f399;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What duration should I set?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// get duration
						var words = remainder.split(/\s/gi)
						var duration = null
						for (var i in words) {
							words[i] = window.FUNCTION_LIBRARY.getDigits(words[i])
							if (!isNaN(words[i])) {
								duration = Number(words[i])
								break
							}
						}

					// no duration
						if (duration === null) {
							callback({icon: icon, error: true, message: "I don't know that number.", html: "<h2>Error: invalid duration:</h2>" + remainder})
							return
						}

					// change duration
						var newDuration = window.FUNCTION_LIBRARY.changeRecognitionDuration({duration: duration})

					// failure
						if (newDuration === false) {
							callback({icon: icon, error: true, message: "I don't know that number.", html: "<h2>Error: invalid duration:</h2>" + remainder})
							return
						}

					// success
						var message =  "Listening duration set to " + newDuration + (newDuration == 1 ? " second" : " seconds")
						var responseHTML = "<h2>listening duration: " + newDuration + (newDuration == 1 ? " second" : " seconds") + "</h2>"
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"change configuration": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x2699;"

					// no remainder
						remainder = remainder.trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What key and value should I set?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// get key and value
						var pair = remainder.split(/ equal to | equals | to | is | as /gi)
						if (pair[0] === undefined || pair[0] === null || pair[1] === undefined || pair[1] === null) {
							callback({icon: icon, error: true, message: "I'm missing a key or value.", html: "<h2>Error: invalid key or value</h2>"})
							return
						}
						
						var key = String(pair[0]).toLowerCase()
						var value = String(pair[1])

					// try converting to number
						if (!isNaN(Number(value))) {
							value = Number(value)
						}

					// save configuration
						var success = window.FUNCTION_LIBRARY.changeConfiguration({key: key, value: value})

					// failure
						if (!success) {
							callback({icon: icon, error: true, message: "I couldn't set that configuration.", html: "<h2>Error: invalid or missing key and value</h2>"})
							return
						}
					
					// success
						var message = key + " is now " + value
						var responseHTML = "<h2>" + key + " = " + value + "</h2>"
						callback({icon: icon, auto: true, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"authorize platform": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f510;"

					// no remainder
						remainder = remainder.trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What platform should I authorize?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// get credentials
						var credentials = remainder.split(/\s/gi)
						var name = credentials[0].toLowerCase() || ""

					// no platform?
						var platforms = {
							"sonos": {
								host: "api.sonos.com",
								authPath: "/login/v3/oauth?response_type=code&scope=playback-control-all",
								reauthPath: "/login/v3/oauth/access",
								stateSecret: function(key, secret) { return btoa(key + ":" + secret) }
							},
							"wink": {
								host: "api.wink.com",
								authPath: "/oauth2/authorize?response_type=code",
								reauthPath: "/oauth2/token",
								stateSecret: function(key, secret) { return secret }
							},
							"reddit": {
								host: "www.reddit.com",
								authPath: "/api/v1/authorize/?response_type=code&duration=permanent&scope=read",
								reauthPath: "/api/v1/access_token",
								stateSecret: function(key, secret) { return btoa(key + ":" + secret) }
							}
						}

					// failure
						if (!name || !Object.keys(platforms).includes(name)) {
							callback({icon: icon, error: true, message: "I couldn't identify that platform.", html: "<h2>Error: unable to authorize:</h2>" + remainder})
							return
						}

					// host
						var host = platforms[name].host

					// fresh
						if (!window.CONFIGURATION_LIBRARY[host] || !window.CONFIGURATION_LIBRARY[host].refresh_token) {
							// key, secret, redirect
								var key = credentials[1] || window.CONFIGURATION_LIBRARY[name + " key"] || ""
								var secret = credentials[2] || window.CONFIGURATION_LIBRARY[name + " secret"] || ""
								var redirect = credentials[2] || window.CONFIGURATION_LIBRARY[name + " redirect"] || ""

							// missing credentials
								if (!key || !secret || !redirect) {
									callback({icon: icon, error: true, message: "I need a key, a secret, and a redirect to connect to " + name + ".", html: "<h2>Error: missing configurations:</h2>" + remainder + "<br><ul><li>" + name + " key</li><li>" + name + " secret</li><li>" + name + " redirect</li></ul>"})
									return
								}
							
							// generate popup
								var state = encodeURIComponent((window.location.origin + window.location.pathname) + ";;;" + platforms[name].stateSecret(key, secret))
								var url = "https://" + host + platforms[name].authPath + "&client_id=" + key + "&state=" + state + "&redirect_uri=" + encodeURIComponent(redirect)
								var popup = window.open(url, null, "height=500,width=500,status=yes,toolbar=no,menubar=no,location=no")

							// response
								var responseHTML = "<h2>activating <b>" + host + "</b> in external popup</h2>"
								callback({icon: icon, auto: true, message: "", html: responseHTML})

							// periodically attempt to read authorization from localStorage (set by popup)
								var authChecks = 0
								var authCheckLoop = setInterval(function() {
									try {
										// check configuration
											var configuration = JSON.parse(localStorage.CONFIGURATION_LIBRARY)

										// not present
											if (!configuration[host]) {
												authChecks++
												
												if (authChecks > 100) {
													clearInterval(authCheckLoop)
													var message = "I was not able to authorize " + host
													var responseHTML = "<h2>unable to authorize " + host + "</h2>"
													callback({icon: icon, error: true, message: message, html: responseHTML})
													popup.close()
												}

												return
											}
										
										// present --> set to config library
											clearInterval(authCheckLoop)
											CONFIGURATION_LIBRARY[host] = configuration[host]

										// show success
											var message = host + " authorized"
											var responseHTML = "<h2>" + host + " authorized</h2>until " + new Date(CONFIGURATION_LIBRARY[host].expiration).toLocaleString()
											callback({icon: icon, auto: true, message: message, html: responseHTML})

										// close popup
											popup.close()
									}
									catch (error) {}
								}, 1000)

							// THE BLUEJAY-OAUTH FLOW
								// 1: parse the user response or look in the CONFIGURATION_LIBRARY for the platform's key, secret, and redirect
								// 2: create a popup to the platform's auth screen; the "state" query param includes bluejay url and platform API key and/or secret
								// 3: user goes through and completes the auth flow
								// 4: external platform redirects the popup based on the redirect param (currently a Google Apps Script); auth code is a param of this page
								// 5: Google Apps Script logs this and uses the "state" param and the new auth code to generate a bluejay link to /authorization
								// 6: the page auto-redirects to the /authorization url, with an embeddedPost parameter
								// 7: this page sends a proxyRequest to the bluejay server
								// 8: bluejay server sends the API request to external platform with the auth code
								// 9: platform responds with the actual access token (and refresh token)
								// 10: bluejay server sends this back to /authorization
								// 11: that page saves the credentials to localStorage
								// 12: the main bluejay page has been checking localStorage every second
								// 13: bluejay now sees the values and updates CONFIGURATION_LIBRARY
								// 14: subsequent Sonos API calls can include the access_token
								// 15: otherwise, after 120 seconds, bluejay gives up and says the authorization failed
						}

					// expired
						else if (window.CONFIGURATION_LIBRARY[host] && (!window.CONFIGURATION_LIBRARY[host].expiration || isNaN(window.CONFIGURATION_LIBRARY[host].expiration) || window.CONFIGURATION_LIBRARY[host].expiration < new Date().getTime())) {
							// key, secret, redirect
								var key = credentials[1] || window.CONFIGURATION_LIBRARY[name + " key"] || ""
								var secret = credentials[2] || window.CONFIGURATION_LIBRARY[name + " secret"] || ""
								var refresh_token = window.CONFIGURATION_LIBRARY[host].refresh_token || ""

							// missing credentials
								if (!key || !secret || !refresh_token) {
									callback({icon: icon, error: true, message: "I need a key, a secret, and a refresh token to reconnect to " + name + ".", html: "<h2>Error: unable to reauthorize:</h2>" + remainder + "<br><br><b>required configurations:</b><ul><li>" + name + " key</li><li>" + name + " secret</li><li>" + name + " refresh_token</li></ul>"})
									return
								}
							
							// options
								var url = "https://" + host + platforms[name].reauthPath + "?grant_type=refresh_token&refresh_token=" + refresh_token
								var options = {
									method: "post",
									responseType: "json",
									url: url,
									"Authorization": "Basic " + platforms[name].stateSecret(key, secret),
									"Content-Type": "application/x-www-form-urlencoded;charset=utf-8"
								}

							// proxy request
								window.FUNCTION_LIBRARY.proxyRequest(options, function(data) {
									try {
										// invalid response
											if (!data.access_token) {
												callback({icon: icon, error: true, message: "I couldn't reauthorize " + host, html: "<h2>Error: unable to reauthorize:</h2>" + host})
												return
											}

										// authorization successful
											var value = window.CONFIGURATION_LIBRARY[host]
												value.access_token = data.access_token
												value.refresh_token = data.refresh_token
												value.expiration = new Date().getTime() + (data.expires_in * 1000)
											window.FUNCTION_LIBRARY.changeConfiguration({key: host, value: value})

											var responseHTML = "<h2>" + host + " authorized</h2>until " + new Date(CONFIGURATION_LIBRARY[host].expiration).toLocaleString()
											callback({icon: icon, auto: true, message: "", html: responseHTML})
									}
									catch (error) {
										callback({icon: icon, error: true, message: "I couldn't reauthorize " + host, html: "<h2>Error: unable to reauthorize:</h2>" + host})
									}
								}, true)
						}

					// already authorized
						else {
							var responseHTML = "<h2>" + host + " authorized</h2>until " + new Date(CONFIGURATION_LIBRARY[host].expiration).toLocaleString()
							callback({icon: icon, auto: true, message: "", html: responseHTML})
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// time
			"get the time": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f553;"

					// remainder
						remainder = remainder.replace(/[?!:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()

					// no remainder --> get time here
						if (!remainder || !remainder.trim()) {
							var time = new Date()
							var message = time.toLocaleTimeString()
							var responseHTML = "The time is <h2>" + message + "</h2>"
							callback({icon: icon, message: message, html: responseHTML, time: time})
							return
						}

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google api key"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google api key.", html: "<h2>Error: missing configuration:</h2><li>google api key</li>"})
							return
						}

					// get longitude & latitude from locale
						if (!isNaN(remainder.split(/,\s?/gi)[0]) && !isNaN(remainder.split(/,\s?/gi)[1])) {
							var latitude  = Number(remainder.split(/,\s?/gi)[0])
							var longitude = Number(remainder.split(/,\s?/gi)[1])

							getTimeZone(latitude, longitude, callback)
							return
						}

					// geolocation
						// options
							var options = {
								responseType: "json",
								url: "https://maps.googleapis.com/maps/api/geocode/json?key=" + window.CONFIGURATION_LIBRARY["google api key"] + "&address=" + remainder
							}

						// proxy request to server
							window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
								try {
									// no results?
										if (!response || !response.results || !response.results[0] || !response.results[0].geometry || !response.results[0].geometry.location) {
											callback({icon: icon, error: true, message: "I couldn't geolocate that.", html: "<h2>Error: unable to geolocate:</h2>" + remainder})
											return
										}

									// geolocation
										var latitude  = Number(response.results[0].geometry.location.lat.toFixed(7))
										var longitude = Number(response.results[0].geometry.location.lng.toFixed(7))
										getTimeZone(latitude, longitude, callback)
										return
								}
								catch (error) {
									callback({icon: icon, error: true, message: "I was unable to get search results.", html: "<h2>Error: unable to get search results:</h2>" + error})
								}
							})

					// getTimeZone
						function getTimeZone(latitude, longitude, callback) {
							// options
								var options = {
									responseType: "json",
									url: "https://maps.googleapis.com/maps/api/timezone/json?key=" + window.CONFIGURATION_LIBRARY["google api key"] + "&location=" + latitude + "," + longitude + "&timestamp=" + Math.floor(new Date().getTime() / 1000)
								}

							// proxy request
								window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
									try {
										// no results
											if (!response.timeZoneName) {
												callback({icon: icon, error: true, message: "I couldn't find that timezone.", html: "<h2>Error: unable to access Google Time Zone:</h2>" + response})
												return
											}

										// date
											var timeZoneName = response.timeZoneName
											var timeZoneLocation = response.timeZoneId
											var timeZoneOffsetMS = (response.rawOffset + response.dstOffset) * 1000
											var currentTimeZoneOffsetMS = (new Date().getTimezoneOffset() * 60) * 1000 * -1
											var differenceMS = timeZoneOffsetMS - currentTimeZoneOffsetMS
											
										// response
											var time = new Date(new Date().getTime() + differenceMS)
											var message = time.toLocaleTimeString()
											var responseHTML = "The <b>" + timeZoneName + "</b> is <h2>" + message + "</h2><i>" + timeZoneLocation + "</i>"
											callback({icon: icon, message: message, html: responseHTML, time: time})
									}
									catch (error) {
										callback({icon: icon, error: true, message: "I couldn't find that timezone.", html: "<h2>Error: unable to access Google Time Zone:</h2>" + error})
									}
								})
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get the day": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4c5;"

					// remainder?
						if (remainder && remainder.trim()) {
							// then
								if (remainder.trim() == "then" && window.CONTEXT_LIBRARY.lastResponseTime) {
									var date = window.CONTEXT_LIBRARY.lastResponseTime
								}

							// other
								else {
									var date = window.FUNCTION_LIBRARY.getDateTime(remainder)
								}
						}

					// response
						var time = new Date(date || null)
						var word = (["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][time.getDay()])
						var message = word
						var responseHTML = (date ? new Date(date).toLocaleDateString() : "Today") + " is <h2>" + word + "</h2>"
						callback({icon: icon, message: message, html: responseHTML, word: word, time: time})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get the month": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4c5;"

					// response
						var time = new Date()
						var message = (["January","February","March","April","May","June","July","August","September","October","November","December"][time.getMonth()])
						var responseHTML = "The month is <h2>" + message + "</h2>"
						callback({icon: icon, message: message, html: responseHTML, time: time})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get the date": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4c5;"

					// response
						var time = new Date()
						var message = (["January","February","March","April","May","June","July","August","September","October","November","December"][time.getMonth()] + " " + time.getDate())
						var responseHTML = "The date is <h2>" + message + "</h2>"
						callback({icon: icon, message: message, html: responseHTML, time: time})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get time until": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4c5;"

					// no remainder
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What time or date should I calculate?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// remainder?
						if (remainder && remainder.trim()) {
							// then
								if (remainder == "then" && window.CONTEXT_LIBRARY.lastResponseTime) {
									var date = window.CONTEXT_LIBRARY.lastResponseTime
								}

							// alarm
								else if (remainder.includes("alarm") || remainder.includes("timer")) {
									var index = null
									var words = remainder.split(/\s/gi)
									for (var i in words) {
										words[i] = window.FUNCTION_LIBRARY.getDigits(words[i])
										if (!isNaN(words[i])) {
											index = Number(words[i])
										}
									}

									if (!index || !window.CONTEXT_LIBRARY.alarms[index - 1]) {
										callback({icon: icon, error: true, message: "I couldn't find that alarm.", html: "<h2>Error: invalid alarm</h2>"})
										return
									}
									var date = new Date(window.CONTEXT_LIBRARY.alarms[index - 1])
								}

							// getDateTime
								else {
									var date = window.FUNCTION_LIBRARY.getDateTime(remainder)
								}
						}

					// get time
						var number = new Date(date).getTime() - new Date().getTime()
						var segments = []
						var days = Math.floor(Math.abs(number) / (1000 * 60 * 60 * 24))
						if (days) { segments.push(days + " day" + (days == 1 ? "" : "s")) }
						var hours = Math.floor(Math.abs(number) / (1000 * 60 * 60) % 24)
						if (hours) { segments.push(hours + " hour" + (hours == 1 ? "" : "s")) }
						var minutes = Math.floor(Math.abs(number) / (1000 * 60) % 60)
						if (minutes) { segments.push(minutes + " minute" + (minutes == 1 ? "" : "s")) }
						var seconds = Math.floor(Math.abs(number) / (1000) % 60)
						if (seconds) { segments.push(seconds + " second" + (seconds == 1 ? "" : "s")) }

					// response
						var time = new Date(date)
						var message = segments.join(", ")
						var responseHTML = (time.toLocaleString() + " - " + new Date().toLocaleString()) + "<h2>" + message + "</h2>"
						callback({icon: icon, message: message, html: responseHTML, number: number, time: time})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get time since": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4c5;"

					// no remainder
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What time or date should I calculate?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// remainder?
						if (remainder && remainder.trim()) {
							// then
								if (remainder == "then" && window.CONTEXT_LIBRARY.lastResponseTime) {
									var date = window.CONTEXT_LIBRARY.lastResponseTime
								}

							// alarm
								else if (remainder.includes("alarm") || remainder.includes("timer")) {
									var index = null
									var words = remainder.split(/\s/gi)
									for (var i in words) {
										words[i] = window.FUNCTION_LIBRARY.getDigits(words[i])
										if (!isNaN(words[i])) {
											index = Number(words[i])
										}
									}

									if (!index || !window.CONTEXT_LIBRARY.alarms[index - 1]) {
										callback({icon: icon, error: true, message: "I couldn't find that alarm.", html: "<h2>Error: invalid alarm</h2>"})
										return
									}
									var date = new Date(window.CONTEXT_LIBRARY.alarms[index - 1])
								}

							// getDateTime
								else {
									var date = window.FUNCTION_LIBRARY.getDateTime(remainder, true)
								}
						}

					// get time
						var number = new Date().getTime() - new Date(date).getTime()
						var segments = []
						var days = Math.floor(Math.abs(number) / (1000 * 60 * 60 * 24))
						if (days) { segments.push(days + " day" + (days == 1 ? "" : "s")) }
						var hours = Math.floor(Math.abs(number) / (1000 * 60 * 60) % 24)
						if (hours) { segments.push(hours + " hour" + (hours == 1 ? "" : "s")) }
						var minutes = Math.floor(Math.abs(number) / (1000 * 60) % 60)
						if (minutes) { segments.push(minutes + " minute" + (minutes == 1 ? "" : "s")) }
						var seconds = Math.floor(Math.abs(number) / (1000) % 60)
						if (seconds) { segments.push(seconds + " second" + (seconds == 1 ? "" : "s")) }

					// response
						var time = new Date(date)
						var message = segments.join(", ")
						var responseHTML = (new Date().toLocaleString() + " - " + time.toLocaleString()) + "<h2>" + message + "</h2>"
						callback({icon: icon, message: message, html: responseHTML, number: number, time: time})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// alarms
			"set alarm": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x23f0;"

					// no remainder
						remainder = remainder.replace(/[?!.,;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What alarm should I set?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// split into array
						var words = remainder.split(/\s/gi) || []

					// then
						if (remainder == "then" && window.CONTEXT_LIBRARY.lastResponseTime) {
							var endTime = window.CONTEXT_LIBRARY.lastResponseTime.getTime()
						}

					// timer
						else if ((/second|minute|hour|day|in/gi).test(remainder)) {
							// possible units
								var units = {
									"second": 1000,
									"minute": 1000 * 60,
									"hour": 1000 * 60 * 60,
									"day": 1000 * 60 * 60 * 24
								}

							// identify amounts
								var amounts = []
								for (var i = 0; i < words.length; i++) {
									words[i] = window.FUNCTION_LIBRARY.getDigits(words[i])

									if (!isNaN(words[i])) {
										if (words[i + 1] && units[words[i + 1].replace(/s$/gi,"").toLowerCase()]) {
											amounts.push({
												number: Number(words[i]),
												unit: words[i + 1].replace(/s$/gi,"")
											})
										}
									}
								}

							// sum amounts
								var duration = 0
								for (var i in amounts) {
									duration += (amounts[i].number * units[amounts[i].unit])
								}

							// no duration
								if (!duration || isNaN(duration)) {
									callback({icon: icon, error: true, message: "I was unable to set that timer.", html: "<h2>Error: unable to set timer:</h2>" + response})
									return
								}
							
							// identify endTime
								var endTime = new Date().getTime() + duration
						}

					// alarm
						else {
							// identify endtime
								var timePhrase = remainder.replace(/in|at|for|after|before|around/gi,"").toLowerCase().trim()
								var endTime = window.FUNCTION_LIBRARY.getDateTime(timePhrase)
									endTime = new Date(endTime).getTime()
							
							// invalid endTime
								if (isNaN(endTime)) {
									callback({icon: icon, error: true, message: "I was unable to set that alarm.", html: "<h2>Error: unable to set alarm:</h2>" + remainder})
									return
								}
						}

					// endTime
						if (endTime && !isNaN(endTime)) {
							// add alarm
								window.CONTEXT_LIBRARY.alarms.push(endTime)

							// response
								var time = new Date(endTime)
								var message = "Alarm #" + window.CONTEXT_LIBRARY.alarms.length + " set for " + time.toLocaleTimeString()
								var responseHTML = "<h2>alarm #" + window.CONTEXT_LIBRARY.alarms.length + ": <b>" + time.toLocaleString() + "</b></h2>"
								callback({icon: icon, message: message, html: responseHTML, time: time})
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get alarms": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x23f0;"

					// loop through alarms
						var time = null
						var message = "Here are your upcoming alarms: "
						var responseHTML = "<h2>all upcoming alarms</h2><ul>"
						for (var i = 0; i < window.CONTEXT_LIBRARY.alarms.length; i++) {
							var alarmTime = new Date(window.CONTEXT_LIBRARY.alarms[i])
							if (alarmTime.getTime() > new Date().getTime()) {
								if (!time) {
									time = alarmTime.getTime()
								}
								message += " ... alarm " + (i + 1) + ": " + alarmTime.toLocaleTimeString()
								responseHTML += "<li><b>alarm #" + (i + 1) + ":</b> " + alarmTime.toLocaleString() + "</li>"
							}
						}
						responseHTML += "</ul>"

					// response
						callback({icon: icon, message: message, html: responseHTML, time: time})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"cancel alarm": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x23f0;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What alarm should I cancel?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// split into array
						var words = remainder.split(/\s/gi) || []

					// index
						var index = null
						for (var i in words) {
							words[i] = window.FUNCTION_LIBRARY.getDigits(words[i])
							if (!isNaN(words[i])) {
								index = Number(words[i])
								break
							}
						}

					// no index?
						if (index === null) {
							callback({icon: icon, error: true, message: "I was unable to find that alarm.", html: "<h2>Error: unable to cancel alarm:</h2>" + remainder})
							return
						}

					// cancel alarm
						var time = new Date(window.CONTEXT_LIBRARY.alarms[index - 1])
						window.CONTEXT_LIBRARY.alarms[index - 1] = null

					// response
						var message = "I cancelled alarm #" + index + ", which was set for " + time.toLocaleString() + "."
						var responseHTML = "<h2>cancelled alarm #" + index + ": <b>" + time.toLocaleString() + "</b></h2>"
						callback({icon: icon, message: message, html: responseHTML, time: time})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"cancel all alarms": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x23f0;"

					// empty alarms array
						window.CONTEXT_LIBRARY.alarms = []

					// response
						var message = "I turned off all alarms."
						var responseHTML = "<h2>all alarms cancelled</h2>"
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// rng
			"roll dice": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f3b2;"

					// defaults
						remainder = " " + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						var count = 1
						var sides = 6

					// X dice with Y sides format
						if (remainder.includes("side") || remainder.includes("face")) {
							var count = Number(window.FUNCTION_LIBRARY.getDigits(remainder.split(/ dice with | die with | dice having /gi)[0])) || 1
							var sides = Number(window.FUNCTION_LIBRARY.getDigits((remainder.split(/ dice with | die with | dice having /gi)[1] || "").replace(/sides/gi,"").replace(/faces/gi,"").replace(/side/gi,"").replace(/face/gi,"")))
						}

					// XdY format
						else {
							var count = Number(window.FUNCTION_LIBRARY.getDigits(remainder.split(/d/gi)[0])) || 1
							var sides = Number(remainder.split(/d/gi)[1])
						}

					// roll dice
						var sum = 0
						for (var i = 0; i < count; i++) {
							sum += Math.floor(Math.random() * sides) + 1
						}

					// no sum?
						if (!sum || isNaN(sum)) {
							callback({icon: icon, error: true, message: "I couldn't roll those dice.", html: "<h2>Error: invalid dice:</h2>" + remainder})
							return
						}

					// return sum
						var message = sum
						var responseHTML = "<h2>" + count + "d" + sides + ": " + sum + "</h2>"
						callback({icon: icon, message: message, html: responseHTML, number: sum})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"flip a coin": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f3b2;"

					// response
						var message = window.FUNCTION_LIBRARY.chooseRandom(["heads","tails"])
						var responseHTML = "<h2>coin: " + message + "</h2>"
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"choose randomly": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f3b2;"

					// no remainder
						remainder = remainder.replace(/[?!,:;'"_\$]/gi,"").toLowerCase().trim()
						var items = remainder.split(/ and | or |\s/gi)
						if (!remainder || !remainder.trim() || !items || items.length < 2) {
							callback({icon: icon, error: true, message: "What should I choose from?", html: "<h2>Error: invalid input</h2>"})
							return
						}

					// choose
						var word = window.FUNCTION_LIBRARY.chooseRandom(items)

					// response
						var message = word
						var responseHTML = "<h2>" + word + "</h2>" + 
							"all options:<br><ul><li>" + 
							items.join("</li><li>") +
							"</li></ul>"
					callback({icon: icon, message: message, html: responseHTML, word: word})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"consult the magic 8 ball": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f3b1;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What are you asking?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// possible options
						var options = ["It is certain", "It is decidedly so", "Without a doubt", "Yes - definitely", "You may rely on it", "As I see it, yes", "Most likely", "Outlook good", "Yes", "Signs point to yes", "Don't count on it", "My reply is no", "My sources say no", "Outlook not so good", "Very doubtful", "Reply hazy, try again", "Ask again later", "Better not tell you now", "Cannot predict now", "Concentrate and ask again"]

					// response
						var message = window.FUNCTION_LIBRARY.chooseRandom(options)
						var responseHTML = remainder + "<h2>" + message + "</h2>"
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
		
		// math
			"calculate": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x00b1;"

					// no remainder
						remainder = remainder.replace(/[?!,:;'"_\$]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I calculate?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// loop through and identify terms
						var terms = remainder.toLowerCase().replace(/the/gi, "").replace(/percent of/gi, "percent").replace(/square root/gi, "sqrt").replace(/cube root/gi, "cbrt").split(/\s/gi)
						for (var i = 0; i < terms.length; i++) {
							if (isNaN(terms[i])) {
								terms[i] = terms[i]
									 if (terms[i] == "that") 	{ terms[i] = Number(window.CONTEXT_LIBRARY.lastResponseNumber) || 0 }
								else if (terms[i] == "by")      { terms[i] = "" }
								else if (terms[i] == "of")      { terms[i] = "*" }
								else if (terms[i] == "plus")    { terms[i] = "+" }
								else if (terms[i] == "minus")   { terms[i] = "-" }
								else if (terms[i] == "times")   { terms[i] = "*" }
								else if (terms[i] == "divided") { terms[i] = "/" }
								else if (terms[i] == "sqrt") 	{ terms[i] = "** (1/2)" }
								else if (terms[i] == "cbrt") 	{ terms[i] = "** (1/3)" }
								else if (terms[i] == "squared") { terms[i] = "** 2" }
								else if (terms[i] == "cubed")   { terms[i] = "** 3" }
								else if (terms[i] == "halved")  { terms[i] = "/ 2" }
								else if (terms[i] == "power")   { terms[i] = "**" }
								else if (terms[i] == "root")    { terms[i] = "** (1/"; terms.splice(i + 2, 0, ")")}
								else if (terms[i] == "%") 		{ terms[i] = "/ 100 *"}
								else if (terms[i] == "percent") { terms[i] = "/ 100 *"}
								else if (["+","-","*","/","(",")","**"].includes(terms[i])) {}
								else {
									terms[i] = window.FUNCTION_LIBRARY.getDigits(terms[i])
									if (isNaN(terms[i])) {
										terms[i] = "/*" + terms[i] + "*/"
									}
								}
							}
							else {
								terms[i] = Number(terms[i])
							}
						}

					// evaluate
						if (isNaN(terms[0])) {
							terms.unshift(1)
						}
						for (var i = 0; i < terms.length - 1; i++) {
							if (!isNaN(terms[i]) && !isNaN(terms[i + 1])) {
								terms.splice(i + 1, 0, "*")
								i--
							}
						}
						var result = eval(terms.join(" "))

					// not a number?
						if (isNaN(result)) {
							callback({icon: icon, error: true, message: "I couldn't perform that calculation.", html: "<h2>Error: invalid calculation:</h2>" + remainder})
							return
						}
					
					// response
						var message = Number(result)
						var responseHTML = "<h2>" + terms.join(" ") + " = <b>" + result + "</b></h2>"
						callback({icon: icon, message: message, html: responseHTML, number: Number(result)})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"double": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x00b1;"

					// no remainder
						remainder = remainder.replace(/[?!,:;'"_\$]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I calculate?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// identify multiplier
						var term = window.FUNCTION_LIBRARY.getDigits(remainder)
						if (term == "that") {
							term = Number(window.CONTEXT_LIBRARY.lastResponseNumber)
						}

					// multiply
						var result = 2 * Number(term)

					// not a number?
						if (isNaN(result)) {
							callback({icon: icon, error: true, message: "I couldn't double that number.", html: "<h2>Error: invalid multiplier</h2>"})
							return
						}
					
					// response
						var message = Number(result)
						var responseHTML = "<h2>2 * " + term + " = <b>" + result + "</b></h2>"
						callback({icon: icon, message: message, html: responseHTML, number: Number(result)})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"triple": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x00b1;"

					// no remainder
						remainder = remainder.replace(/[?!,:;'"_\$]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I calculate?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// identify multiplier
						var term = window.FUNCTION_LIBRARY.getDigits(remainder)
						if (term == "that") {
							term = Number(window.CONTEXT_LIBRARY.lastResponseNumber)
						}

					// multiply
						var result = 3 * Number(term)

					// not a number?
						if (isNaN(result)) {
							callback({icon: icon, error: true, message: "I couldn't triple that number.", html: "<h2>Error: invalid multiplier</h2>"})
							return
						}
					
					// response
						var message = Number(result)
						var responseHTML = "<h2>3 * " + term + " = <b>" + result + "</b></h2>"
						callback({icon: icon, message: message, html: responseHTML, number: Number(result)})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"average": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x00b1;"

					// no remainder
						remainder = remainder.replace(/[?!,:;'"_\$]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I calculate?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// loop through to identify terms
						var terms = remainder.split(/\s/gi)
						var numbers = []
						for (var i = 0; i < terms.length; i++) {
							terms[i] = window.FUNCTION_LIBRARY.getDigits(terms[i].toLowerCase().trim())

							if (terms[i] == "that") {
								terms[i] = Number(window.CONTEXT_LIBRARY.lastResponseNumber)
							}

							if (!isNaN(terms[i])) {
								numbers.push(Number(terms[i]))
							}
						}

					// sum terms, then divide
						var result = numbers.reduce(function(total, term) {
							return (total + term)
						}) / (numbers.length || 1)

					// not a number?
						if (isNaN(result)) {
							callback({icon: icon, error: true, message: "I couldn't find the average.", html: "<h2>Error: invalid calculation</h2>"})
							return
						}
					
					// response
						var message = Number(result)
						var responseHTML = "<h2>" + numbers.join(" + ") + " / " + numbers.length + " = <b>" + result + "</b></h2>"
						callback({icon: icon, message: message, html: responseHTML, number: Number(result)})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"count": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x2673;"

					// remainder
						remainder = " " + remainder.replace(/[?!,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()

					// startNumber
						var startNumber = remainder.split(/ up from | down from | from | starting at | start at | between | for /gi)
							startNumber = (startNumber[1] || startNumber[0]).split(/ and go to | and go until | up to | down to | to | until | ending at | end at | and | through /gi)[0].trim()
							startNumber = window.FUNCTION_LIBRARY.getDigits(startNumber)
						if (startNumber == "that") { startNumber = Number(window.CONTEXT_LIBRARY.lastResponseNumber) }
						if (!startNumber || isNaN(startNumber)) { startNumber = 1 }

					// end number
						var endNumber = remainder.split(/ and go to | and go until | up to | down to | to | until | ending at | end at | and | through /gi)
							endNumber = (endNumber[1] || endNumber[0]).split(/ up from | down from | starting at | start at | between | for /gi)[0].trim()
							endNumber = window.FUNCTION_LIBRARY.getDigits(endNumber)
						if (endNumber == "that") { endNumber = Number(window.CONTEXT_LIBRARY.lastResponseNumber) }
						if (!endNumber || isNaN(endNumber)) { endNumber = 100 }

					// up or down
						var list = []
						if (startNumber <= endNumber) {
							for (var i = startNumber; i <= endNumber; i++) {
								list.push(i)
							}
						}
						else {
							for (var i = startNumber; i >= endNumber; i--) {
								list.push(i)
							}
						}

					// message
						var message = list.join("... ")
						var responseHTML = "<h2>counting from <b>" + String(startNumber) + "</b> to <b>" + String(endNumber) + "</b></h2>"
						callback({icon: icon, message: message, html: responseHTML})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// words
			"spell word": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4dd;"

					// no remainder
						remainder = remainder.replace(/[?!,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I spell?", html: "<h2>Error: invalid query</h2>"})
							return
						}
						var word = remainder

					// that?
						if (remainder == "that" && window.CONTEXT_LIBRARY.lastResponseWord) {
							word = window.CONTEXT_LIBRARY.lastResponseWord
						}

					// letters
						var letters = word.toUpperCase().split("")

					// response
						var message = word + "... " + letters.join(", ")
						var responseHTML = "<h2>" + letters.join(" - ") + "</h2>"
						callback({icon: icon, message: message, html: responseHTML, word: word.toLowerCase()})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"pronounce word": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4dd;"

					// clean up remainder
						remainder = remainder.replace(/[?!,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What did you want me to say?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// that
						if (remainder == "that" && window.CONTEXT_LIBRARY.lastResponseWord) {
							var letters = window.CONTEXT_LIBRARY.lastResponseWord.split("")
						}

					// from remainder --> all one word
						else if (!remainder.includes(" ")) {
							var letters = remainder.split("")
						}

					// from remainder --> multiple words
						else {
							// split at spaces
								var letters = remainder.split(/\s/gi)
								for (var i in letters) {
									letters[i] = window.FUNCTION_LIBRARY.getLetters(letters[i])
								}

							// multi-letter letters?
								if (letters.filter(function(letter) { return letter.trim().length !== 1 }).length) {
									callback({icon: icon, error: true, message: "I couldn't identify those letters.", html: "<h2>Error: invalid letters:</h2>" + letters.join(" - ")})
									return
								}
						}

					// combine and say
						word = letters.join("")
						var message = word
						var responseHTML = "<h2>" + word + "</h2>" + word.toUpperCase().split("").join(" - ")
						callback({icon: icon, message: message, html: responseHTML, word: word})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get rhymes": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4da;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}
						var word = remainder

					// that
						if (remainder == "that" && window.CONTEXT_LIBRARY.lastResponseWord) {
							word = window.CONTEXT_LIBRARY.lastResponseWord
						}

					// options
						var options = {
							responseType: "json",
							url: "https://api.datamuse.com/words?rel_rhy=" + word
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// construct response list
									var list = response || []
									var listItems = []
									for (var i in list) {
										list[i] = list[i].word
										listItems[i] = "<li>" + list[i] + "</li>"
									}

								// message & link
									var message = "I found " + list.length + " rhyme" + (list.length == 1 ? "" : "s") + " for " + word + ". " + list.join(",")
									var url = "https://rhymezone.com/r/rhyme.cgi?typeofrhyme=perfect&Word=" + word
									var responseHTML = "<a target='_blank' href='" + url + "'><h2>" + word + "</h2></a>" +
										"<ul>" + listItems.join("") + "</ul>"

								// response
									callback({icon: icon, message: message, html: responseHTML, url: url, word: word})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I couldn't rhyme that.", html: "<h2>Error: unable to access rhymes</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get synonyms": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4da;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}
						var word = remainder

					// that?
						if (remainder == "that" && window.CONTEXT_LIBRARY.lastResponseWord) {
							word = window.CONTEXT_LIBRARY.lastResponseWord
						}

					// options
						var options = {
							responseType: "json",
							url: "https://api.datamuse.com/words?rel_syn=" + word
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// construct response list
									var list = response || []
									var listItems = []
									for (var i in list) {
										list[i] = list[i].word
										listItems[i] = "<li>" + list[i] + "</li>"
									}

								// message & link
									var message = "I found " + list.length + " synonym" + (list.length == 1 ? "" : "s") + " for " + word + ". " + list.join(",")
									var url = "https://rhymezone.com/r/rhyme.cgi?typeofrhyme=syn&Word=" + word
									var responseHTML = "<a target='_blank' href='" + url + "'><h2>" + word + "</h2></a>" +
										"<ul>" + listItems.join("") + "</ul>"

								// response
									callback({icon: icon, message: message, html: responseHTML, url: url, word: word})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I don't know any synonyms for that.", html: "<h2>Error: unable to access synonyms</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get antonyms": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4da;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}
						var word = remainder

					// that?
						if (remainder == "that" && window.CONTEXT_LIBRARY.lastResponseWord) {
							word = window.CONTEXT_LIBRARY.lastResponseWord
						}

					// options
						var options = {
							responseType: "json",
							url: "https://api.datamuse.com/words?rel_ant=" + word
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// construct response list
									var list = response || []
									var listItems = []
									for (var i in list) {
										list[i] = list[i].word
										listItems[i] = "<li>" + list[i] + "</li>"
									}

								// message & link
									var message = "I found " + list.length + " antonym" + (list.length == 1 ? "" : "s") + " for " + word + ". " + list.join(",")
									var url = "https://rhymezone.com/r/rhyme.cgi?typeofrhyme=ant&Word=" + word
									var responseHTML = "<a target='_blank' href='" + url + "'><h2>" + word + "</h2></a>" +
										"<ul>" + listItems.join("") + "</ul>"

								// response
									callback({icon: icon, message: message, html: responseHTML, url: url, word: word})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I don't know any antonyms for that.", html: "<h2>Error: unable to access antonyms</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get definition": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4da;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}
						var word = remainder

					// that?
						if (remainder == "that" && window.CONTEXT_LIBRARY.lastResponseWord) {
							word = window.CONTEXT_LIBRARY.lastResponseWord
						}

					// options
						var options = {
							responseType: "json",
							url: "https://api.datamuse.com/words?md=d&sp=" + word
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// construct response list
									var wordGroup = response[0]
									var list = []
									var listItems = []
									for (var i in wordGroup.defs) {
										wordGroup.defs[i] = "[" + wordGroup.defs[i].replace(/\t/,"] ")
										wordGroup.defs[i] = wordGroup.defs[i].replace("[n]", "[noun]").replace("[v]", "[verb]").replace("[adj]", "[adjective]").replace("[adv]", "[adverb]").replace("[u]", "[other]")
										list[i] = wordGroup.defs[i]
										listItems[i] = "<li>" + wordGroup.defs[i] + "</li>"
									}

								// message & link
									var message = "I found " + list.length + " definition" + (list.length == 1 ? "" : "s") + " for " + word + ". " + list.join(",")
									var url = "http://wordnetweb.princeton.edu/perl/webwn?s=" + word
									var responseHTML = "<a target='_blank' href='" + url + "'><h2>" + word + "</h2></a>" + 
										"<ul>" + listItems.join("") + "</ul>"

								// response
									callback({icon: icon, message: message, html: responseHTML, url: url, word: word})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I couldn't define that.", html: "<h2>Error: unable to access definitions</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get etymology": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4da;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}
						var word = remainder

					// that?
						if (remainder == "that" && window.CONTEXT_LIBRARY.lastResponseWord) {
							word = window.CONTEXT_LIBRARY.lastResponseWord
						}

					// options
						var options = {
							responseType: null,
							url: "https://www.etymonline.com/word/" + word
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// put response in a temporary element
									var temporaryElement = document.createElement("div")
										temporaryElement.innerHTML = response

								// get objects
									var wordGroups = []
									var objects = Array.from(temporaryElement.querySelectorAll(".word--C9UPa object"))

								// no objects
									if (!objects || !objects.length) {
										callback({icon: icon, error: true, message: "I couldn't find the etymology of " + word, html: "<h2>Error: no etymology found:</h2>" + word})
										return
									}
								
								// loop through objects to extract relevant information
									for (var i in objects) {
										// get title --> word & part of speech
											var objectTitle = objects[i].querySelector(".word__name--TTbAA").innerText.split("(")
											var objectWord = (objectTitle[0] || "").trim()
											var objectPartOfSpeech = objectTitle[1] || ""
											if (objectPartOfSpeech) {
												objectPartOfSpeech = objectPartOfSpeech.split(")")[0] || ""
												objectPartOfSpeech = objectPartOfSpeech.replace("n.", "noun").replace("v.", "verb").replace("adj.", "adjective").replace("adv.", "adverb").replace("prep.", "preposition").replace(/[0-9]/gi, "").trim()
											}
										
										// get paragraphs --> history
											var objectHistory = []
											var objectParagraphs = objects[i].querySelectorAll(".word__defination--2q7ZH p")
											for (var j in objectParagraphs) {
												objectHistory.push(objectParagraphs[j].innerText)
											}

										// package into an object
											wordGroups.push({
												word: objectWord,
												partOfSpeech: objectPartOfSpeech,
												history: objectHistory
											})
									}

								// message & list
									var message = "I found " + wordGroups.length + (wordGroups.length == 1 ? " etymology... " : " etymologies... ") + (wordGroups.length ? wordGroups.map(function(entry) { return entry.word + ", " + entry.partOfSpeech + "... " + entry.history.join(" ... ") }).join(" ... ... ") : "")
									var url = "https://www.etymonline.com/word/" + word
									var responseHTML = "<a target='_blank' href='" + url + "'><h2>" + word + "</h2></a>" +
										(wordGroups.length ? ("<ul><li>" + wordGroups.map(function(entry) { return "<h3>" + entry.word + (entry.partOfSpeech ? (" (" + entry.partOfSpeech + ")") : "") + "</h3><p>" + entry.history.join("</p><p>") + "</p>" }).join("</li><li>") + "</li></ul>") : "")

								// response
									callback({icon: icon, message: message, html: responseHTML, url: url, word: word})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I couldn't find the etymology of that.", html: "<h2>Error: unable to access etymonline</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get idiom": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4ac;"

					// clean up remainder
						remainder = remainder.replace(/[?!,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}
						var word = remainder

					// that?
						if (remainder == "that" && window.CONTEXT_LIBRARY.lastResponseWord) {
							word = window.CONTEXT_LIBRARY.lastResponseWord
						}

					// options
						var options = {
							responseType: null,
							url: "https://www.thefreedictionary.com/_/partner.aspx?Set=idioms&Word=" + word
						}

					// proxy request
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// put response in a temporary element
									var temporaryElement = document.createElement("div")
										temporaryElement.innerHTML = response

								// get sections
									var idioms = []
									var sections = Array.from(temporaryElement.querySelectorAll("#MainTxt section"))

								// no sections
									if (!sections || !sections.length) {
										callback({icon: icon, error: true, message: "I couldn't find the meaning of " + remainder, html: "<h2>Error: no definition found:</h2>" + remainder})
										return
									}

								// loop through sections to extract relevant information
									for (var i in sections) {
										// get h2 --> phrase
											var header = sections[i].querySelector("h2")
											if (!header) {
												continue
											}
											var phrase = header.innerText

										// examples
											var exampleBlocks = Array.from(sections[i].querySelectorAll(".illustration")) || []
											var examples = exampleBlocks.map(function(example) { return example ? example.innerText : null })

										// seeAlso & copyright
											var seeAlso = sections[i].querySelector(".SeeAlso") || null
											var copyright = sections[i].querySelector(".brand_copy") || null

										// definition
											var definition = sections[i].innerText
												definition = definition.replace(phrase, "")
											if (seeAlso) {
												definition = definition.replace(seeAlso.innerText, "")
											}
											if (copyright) {
												definition = definition.replace(copyright.innerText, "")
											}
											if (examples && examples.length) {
												for (var i in examples) {
													definition = definition.replace(examples[i], "")
												}
											}
												definition = definition.trim()

										// package into an object
											idioms.push({
												phrase: phrase,
												definition: definition,
												examples: examples
											})
									}

								// message & list
									var message = "I found " + idioms.length + (idioms.length == 1 ? " idiom... " : " idioms... ") + 
										(idioms.length ? idioms.map(function(entry) { return entry.phrase + ", " + entry.definition + "... " + (entry.examples && entry.examples.length ? " for example: " + entry.examples.join(" ... ") : "") }).join(" ... ... ") : "")
									var url = "https://idioms.thefreedictionary.com/" + word
									var responseHTML = "<a target='_blank' href='" + url + "'><h2>" + word + "</h2></a>" +
										(idioms.length ? ("<ul><li>" + idioms.map(function(entry) {
											return "<h3>" + entry.phrase + "</h3><p>" + entry.definition + (entry.examples && entry.examples.length ? ("<ul><li>" + entry.examples.join("</li><li>") + "</li></ul>") : "") + "</p>"
										}).join("</li><li>") + "</li></ul>") : "")

								// response
									callback({icon: icon, message: message, html: responseHTML, url: url, word: word})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I couldn't find the meaning of that.", html: "<h2>Error: unable to access idioms</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// random content
			"get a joke": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f0cf;"

					// options
						var options = {
							responseType: "json",
							url: "https://icanhazdadjoke.com/slack"
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// response
									var message = response.attachments[0].text
									var url = "https://icanhazdadjoke.com"
									var responseHTML = "<a target='_blank' href='" + url + "'><h2>" + response.attachments[0].text + "</h2></a>"
									callback({icon: icon, message: message, html: responseHTML, url: url})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I don't know any jokes.", html: "<h2>Error: unable to access jokes</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get a quote": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f399;"

					// options
						var options = {
							responseType: "json",
							url: "http://api.forismatic.com/api/1.0/?method=getQuote&format=json&lang=en"
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// missing quote or author
									if (!response.quoteText || !response.quoteAuthor) {
										callback({icon: icon, error: true, message: "I was unable to get any quotes.", html: "<h2>Error: unable to access quotes</h2>"})
										return
									}

								// response
									var message = response.quoteAuthor + " said... " + response.quoteText
									var url = response.quoteLink
									var responseHTML = "<a target='_blank' href='" + url + "'><h2>\"" + response.quoteText + "\" - " + response.quoteAuthor + "</h2></a>"
									callback({icon: icon, message: message, html: responseHTML, url: url})
							}
							catch (error) {
								callback({icon: icon, message: "I don't know any quotes.", html: "unable to access quotes"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get a fortune": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4dc;"

					// options
						var options = {
							responseType: "json",
							url: "http://yerkee.com/api/fortune"
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// fortunes
									var fortune = response.fortune.replace(/\n|\t/gi," ")

								// all results
									var message = fortune
									var url = "http://yerkee.com/"
									var responseHTML = "<a target='_blank' href='" + url + "'><h2>" + fortune + "</h2></a>"

								// send response
									callback({icon: icon, message: message, html: responseHTML, url: url})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I don't know any fortunes.", html: "<h2>Error: unable to access fortunes</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get an insult": function(remainder, callback) {
				try {
					// icon
						var icon = "&#128293;"

					// options
						var options = {
							responseType: "json",
							url: "https://evilinsult.com/generate_insult.php?lang=en&type=json"
						}

					// proxy request
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// response
									var message = response.insult
									var responseHTML = "<h2>" + response.insult + "</h2>"
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon, icon, error: true, message: "I don't know any insults.", html: "<h2>Error: unable to access insults</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// search content
			"get a wikipedia entry": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f310;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}
						var word = remainder

					// that?
						if (remainder == "that" && window.CONTEXT_LIBRARY.lastResponseWord) {
							word = window.CONTEXT_LIBRARY.lastResponseWord
						}

					// attempt counter
						if (!window.CONTEXT_LIBRARY["wikipedia attempt counter"]) {
							window.CONTEXT_LIBRARY["wikipedia attempt counter"] = 1
						}

					// options
						var options = {
							responseType: "json",
							url: "https://en.wikipedia.org/w/api.php?action=query&format=json&list=search&utf8=1&srsearch=" + word
						}

					// proxy to server --> search
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							// invalid response
								if (!response || !response.query || !response.query.search || !response.query.search[0]) {
									// too busy (fewer than 5 attempts)
										if (response.error && response.error.code == "cirrussearch-too-busy-error" && window.CONTEXT_LIBRARY["wikipedia attempt counter"] < 5) {
											callback({icon: icon, message: "Wikipedia was too busy. Trying again.", html: "attempt #" + window.CONTEXT_LIBRARY["wikipedia attempt counter"] + " <b>" + remainder + "</b> on Wikipedia<br><br>Wikipedia was too busy. Trying again."})

											window.CONTEXT_LIBRARY["wikipedia attempt counter"]++
											window.ACTION_LIBRARY["get a wikipedia entry"](remainder, callback)

											return
										}

									// other error
										window.CONTEXT_LIBRARY["wikipedia attempt counter"] = 0
										callback({icon: icon, error: true, message: "I couldn't find " + remainder + " on Wikipedia.", html: "<h2>Error: unable to access Wikipedia</h2>"})
										return
								}
							
							// options
								var options = {
									responseType: "json",
									url: "https://en.wikipedia.org/w/api.php?action=parse&format=json&utf8=1&page=" + response.query.search[0].title
								}

							// proxy to server --> display full page
								window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
									try {
										// too busy (fewer than 5 attempts)
											if (response.error && response.error.code == "cirrussearch-too-busy-error" && window.CONTEXT_LIBRARY["wikipedia attempt counter"] < 5) {
												callback({icon: icon, message: "Wikipedia was too busy. Trying again.", html: "attempt #" + window.CONTEXT_LIBRARY["wikipedia attempt counter"] + " <b>" + remainder + "</b> on Wikipedia<br><br>Wikipedia was too busy. Trying again."})

												window.CONTEXT_LIBRARY["wikipedia attempt counter"]++
												window.ACTION_LIBRARY["get a wikipedia entry"](remainder, callback)

												return
											}
									
										// get text
											var responseHTML = response.parse.text["*"]
												responseHTML = responseHTML.split('id="References">References')[0]
												responseHTML = responseHTML.split('id="See_also">See also')[0]
												responseHTML = responseHTML.replace(/\<a href='\//gi, "<a target='_blank' href='https://en.wikipedia.org/")
												responseHTML = responseHTML.replace(/\<a href="\//gi, '<a target="_blank" href="https://en.wikipedia.org/')

											var messageNode = document.createElement("div")
												messageNode.innerHTML = responseHTML.replace(/<table[\s\S]*?>[\s\S]*?<\/table>/gi,"")
											var message = messageNode.innerText
												message = message.replace(/\[[0-9]+\]/gi, "")
												message = message.replace(/\[edit\]/gi,"")
											
										// response
											var url = "https://en.wikipedia.org/?curid=" + response.parse.pageid
											responseHTML = "<a target='_blank' href='" + url + "'><h2>" + response.parse.title + "</h2></a>" + responseHTML
											callback({icon: icon, message: message, html: responseHTML, url: url, word: word})

										// reset counter
											window.CONTEXT_LIBRARY["wikipedia attempt counter"] = 0
									}
									catch (error) {
										callback({icon: icon, error: true, message: "I couldn't find " + remainder + " on Wikipedia.", html: "<h2>Error: unable to access Wikipedia</h2>"})
									}
								})
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get this day in history": function(remainder, callback) {
				try {
					// get day
						var today = ["January","February","March","April","May","June","July","August","September","October","November","December"][new Date().getMonth()] + "_" + new Date().getDate()

					// proxy to wikipedia action
						window.ACTION_LIBRARY["get a wikipedia entry"](today, callback)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get the weather": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x26c8;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["open weather api"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for open weather api.", html: "<h2>Error: missing configuration:</h2><li>open weather api</li>"})
							return
						}

					// remainder
						remainder = " " + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()

					// locale
						if (remainder) {
							var locale = remainder.replace(/ in | at | for | inside /gi,"").trim() || window.CONFIGURATION_LIBRARY["city"] || window.CONFIGURATION_LIBRARY["zip code"] || null
						}
						else {
							var locale = window.CONFIGURATION_LIBRARY["city"] || window.CONFIGURATION_LIBRARY["zip code"] || null
						}

					// no locale
						if (!locale) {
							callback({icon: icon, error: true, message: "What city should I get the weather for?", html: "<h2>Error: missing configuration:</h2><li>city</li>"})
							return
						}
					
					// options
						var options = {
							responseType: "json",
							url: "https://api.openweathermap.org/data/2.5/forecast?appid=" + window.CONFIGURATION_LIBRARY["open weather api"] + (isNaN(locale) ? ("&q=" + locale) : "&zip=" + locale) + ",us&mode=json&units=imperial"
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// invalid response
									if (!response || !response.city || !response.list) {
										callback({icon: icon, error: true, message: "I was unable to get the weather.", html: "<h2>Error: unable to access weather</h2>"})
										return
									}

								// days of the week
									var allDays = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]
									var dayStates = {}

								// axes
									var dayColumns = []
									var timeRows = []
									for (var l in response.list) {
										var segment = response.list[l]
										var date = new Date(response.list[l].dt_txt + " UTC")
										
										segment.day = allDays[new Date(date).getDay()]
										if (dayColumns[dayColumns.length - 1] !== segment.day) {
											dayColumns.push(segment.day)
										}
										
										segment.time = date.toLocaleTimeString()
										if (!timeRows.includes(segment.time)) {
											timeRows.push(segment.time)
										}

										segment.cell = "<td>" + Math.round(segment.main.temp) + "F<br><br>" + (segment.weather ? segment.weather[0].description : "clear") + "</td>"

										// dayStates (for message)
											if (!dayStates[segment.day]) {
												dayStates[segment.day] = {
													hours: []
												}
											}
											dayStates[segment.day].hours.push({temperature: Math.round(segment.main.temp), condition: (segment.weather ? segment.weather[0].description : "clear")})
									}

								// sort times
									timeRows.sort(function(a,b) {
										a = a.replace(/\:/g,"")
										b = b.replace(/\:/g,"")
										if (a.toLowerCase().includes("pm")) { a = Number(a.replace(/pm/gi,"")) % 120000 + 120000 } else { a = Number(a.replace(/am/gi, "")) % 120000 }
										if (b.toLowerCase().includes("pm")) { b = Number(b.replace(/pm/gi,"")) % 120000 + 120000 } else { b = Number(b.replace(/am/gi,"")) % 120000 }
										return a - b
									})

								// grid
									var grid = {}
									for (var t in timeRows) {
										grid[timeRows[t]] = {}
										grid[timeRows[t]].time = "<td>" + timeRows[t] + "</td>"
										for (var d in dayColumns) {
											grid[timeRows[t]][dayColumns[d]] = "<td> - </td>"
										}
									}

									for (var l in response.list) {
										var data = response.list[l]
										grid[data.time][data.day] = data.cell
									}

								// draw table
									var heading = "<tr><th>&#128339;</th>"
									for (var d in dayColumns) {
										heading += ("<th>" + dayColumns[d] + "</th>")
									}
									heading += "</tr>"

									var table = "<table><tbody>" + heading
									for (var y in grid) {
										var row = "<tr>"
										for (var x in grid[y]) {
											row += grid[y][x]
										}
										row += "</tr>"
										table += row
									}
									table += "</tbody></table>"

								// day synopses
									for (var d in dayStates) {
										dayStates[d].high = -1000 // arbitrarily low
										dayStates[d].low = 1000 // arbitrarily high
										dayStates[d].conditions = []
										for (var h in dayStates[d].hours) {
											if (dayStates[d].hours[h].temperature > dayStates[d].high) {
												dayStates[d].high = dayStates[d].hours[h].temperature
											}
											if (dayStates[d].hours[h].temperature < dayStates[d].low) {
												dayStates[d].low = dayStates[d].hours[h].temperature
											}

											if (!dayStates[d].conditions.length || dayStates[d].hours[h].condition !== dayStates[d].conditions[dayStates[d].conditions.length - 1]) {
												dayStates[d].conditions.push(dayStates[d].hours[h].condition)
											}
										}
									}

								// day summaries
									var daySummaries = Object.keys(dayStates).map(function(d) { return (d + " has a high of " + dayStates[d].high + " and a low of " + dayStates[d].low + "; conditions will be " + dayStates[d].conditions.join(", then ")) }) || []

								// get locale, conditions, message, link
									var locale = response.city.name + ", " + response.city.country
									var message = "Here's the weather for " + locale + " ... " +
										"Right now it's " + Math.round(response.list[0].main.temp) + " degrees and " + (response.list[0].weather ? response.list[0].weather[0].description : "clear") + " ... " +
										daySummaries.join(" ... ")
									var url = "https://openweathermap.org/find?q=" + locale
									var responseHTML = "<a target='_blank' href='" + url + "'><h2>weather in <b>" + locale + "</b></h2></a>" + table

								// response
									callback({icon: icon, message: message, html: responseHTML, url: url})
							}
							catch (error) {
								var location = (locale || remainder.trim() || window.CONFIGURATION_LIBRARY["city"] || window.CONFIGURATION_LIBRARY["zip code"])
								callback({icon: icon, error: true, message: "I was unable to get the weather for " + location, html: "<h2>Error: unable to access the weather for that location:</h2>" + location})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get sunrise": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f305;"

					// missing config?
						if ((!window.CONFIGURATION_LIBRARY["latitude"] || !window.CONFIGURATION_LIBRARY["longitude"]) && !window.CONFIGURATION_LIBRARY["google api key"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google api key.", html: "<h2>Error: missing configuration:</h2><li>google api key</li>"})
							return
						}

					// remainder
						remainder = " " + remainder.replace(/[?!;'"_\(\)\$\%]/gi,"").toLowerCase().trim()

					// split at keywords
						var date = remainder.split(/ on /gi)
							date = (date[1] || date[0]).split(/ in /gi)[0].trim()

						var locale = remainder.split(/ in /gi)
							locale = (locale[1] || locale[0]).split(/ on /gi)[0].trim()

					// specific date
						if (date && date.trim() && date !== locale) {
							// then
								if (date.trim() == "then" && window.CONTEXT_LIBRARY.lastResponseTime) {
									date = window.CONTEXT_LIBRARY.lastResponseTime
								}

							// other
								else {
									date = window.FUNCTION_LIBRARY.getDateTime(date)
								}
						}
						else {
							date = null
						}

					// get longitude & latitude from locale
						if (locale && locale.trim() && !isNaN(locale.split(/,\s?/gi)[0]) && !isNaN(locale.split(/,\s?/gi)[1])) {
							var latitude  = Number(locale.split(/,\s?/gi)[0])
							var longitude = Number(locale.split(/,\s?/gi)[1])
						}

					// get longitude & latitude from configuration
						else if (!locale.trim() && window.CONFIGURATION_LIBRARY["latitude"] && window.CONFIGURATION_LIBRARY["longitude"]) {
							var latitude  = Number(window.CONFIGURATION_LIBRARY["latitude"])
							var longitude = Number(window.CONFIGURATION_LIBRARY["longitude"])
						}

					// get longitude & latitude from locale via Google Geolocation API
						else {
							// remainder
								if (locale && locale.trim()) {
									locale = locale
								}

							// city
								else if (window.CONFIGURATION_LIBRARY["city"]) {
									locale = window.CONFIGURATION_LIBRARY["city"]
								}

							// zip code
								else if (window.CONFIGURATION_LIBRARY["zip code"]) {
									locale = window.CONFIGURATION_LIBRARY["zip code"]
								}

							// no location?
								else {
									callback({icon: icon, error: true, message: "What city should I search for?", html: "<h2>Error: missing configuration:</h2><li>city</li>"})
									return
								}

							// options
								var options = {
									responseType: "json",
									url: "https://maps.googleapis.com/maps/api/geocode/json?key=" + window.CONFIGURATION_LIBRARY["google api key"] + "&address=" + locale
								}

							// proxy to server
								window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
									try {
										// no results?
											if (!response || !response.results || !response.results[0] || !response.results[0].geometry || !response.results[0].geometry.location) {
												callback({icon: icon, error: true, message: "I couldn't geolocate that.", html: "<h2>Error: unable to geolocate:</h2>" + remainder})
												return
											}

										// geolocation
											var latitude  = Number(response.results[0].geometry.location.lat.toFixed(7))
											var longitude = Number(response.results[0].geometry.location.lng.toFixed(7))

										// rerun this function
											window.ACTION_LIBRARY["get sunrise"](latitude + ", " + longitude + (date ? " on " + date.toLocaleDateString() : ""), callback)
											return
									}
									catch (error) {
										callback({icon: icon, error: true, message: "I was unable to geolocate " + locale, html: "<h2>Error: unable to access geolocation:</h2>" + locale})
									}
								})
						}

					// get sunrise & sunset
						if (latitude && longitude) {
							// build options
								var options = {
									responseType: "json",
									url: "https://api.sunrise-sunset.org/json?lat=" + latitude + "&lng=" + longitude + "&date=" + (date ? new Date(date).toLocaleDateString() : "today")
								}

							// proxy to server
								window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
									try {
										// convert times
											var msOffset = new Date(date || null).getTimezoneOffset() * 60 * 1000
											var sunrise = new Date(new Date(new Date(date || null).toLocaleDateString() + " " + response.results.sunrise).getTime()     - msOffset)
												var sunriseString = sunrise.toLocaleTimeString()
											var noon    = new Date(new Date(new Date(date || null).toLocaleDateString() + " " + response.results.solar_noon).getTime()  - msOffset)
												var noonString = noon.toLocaleTimeString()
											var sunset  = new Date(new Date(new Date(date || null).toLocaleDateString() + " " + response.results.sunset).getTime()      - msOffset)
												var sunsetString = sunset.toLocaleTimeString()

										// response
											var message = "Sunrise is at " + sunriseString + ". Noon is at " + noonString + ". Sunset is at " + sunsetString + "."
											var url = "https://sunrise-sunset.org/search?location=" + latitude + "," + longitude
											var responseHTML = "<a target='_blank' href='" + url + "'><h2>times for " + (latitude + ", " + longitude) + "</h2></a>" +
												"<li>sunrise: " + sunriseString + "</li>" +
												"<li>noon: " + noonString + "</li>" +
												"<li>sunset: " + sunsetString + "</li>"
											callback({icon: icon, message: message, html: responseHTML, url: url, time: sunrise})

									}
									catch (error) {
										callback({icon: icon, error: true, message: "I was unable to find the sunrise and sunset.", html: "<h2>Error: unable to access sunrise & sunset:</h2>" + latitude + ", " + longitude})
									}
								})
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get sunset": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f305;"

					// missing config?
						if ((!window.CONFIGURATION_LIBRARY["latitude"] || !window.CONFIGURATION_LIBRARY["longitude"]) && !window.CONFIGURATION_LIBRARY["google api key"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google api key.", html: "<h2>Error: missing configuration:</h2><li>google api key</li>"})
							return
						}

					// remainder
						remainder = " " + remainder.replace(/[?!;'"_\(\)\$\%]/gi,"").toLowerCase().trim()

					// split at keywords
						var date = remainder.split(/ on /gi)
							date = (date[1] || date[0]).split(/ in /gi)[0].trim()

						var locale = remainder.split(/ in /gi)
							locale = (locale[1] || locale[0]).split(/ on /gi)[0].trim()

					// specific date
						if (date && date.trim() && date !== locale) {
							// then
								if (date.trim() == "then" && window.CONTEXT_LIBRARY.lastResponseTime) {
									date = window.CONTEXT_LIBRARY.lastResponseTime
								}

							// other
								else {
									date = window.FUNCTION_LIBRARY.getDateTime(date)
								}
						}
						else {
							date = null
						}

					// get longitude & latitude from locale
						if (locale && locale.trim() && !isNaN(locale.split(/,\s?/gi)[0]) && !isNaN(locale.split(/,\s?/gi)[1])) {
							var latitude  = Number(locale.split(/,\s?/gi)[0])
							var longitude = Number(locale.split(/,\s?/gi)[1])
						}

					// get longitude & latitude from configuration
						else if (!locale.trim() && window.CONFIGURATION_LIBRARY["latitude"] && window.CONFIGURATION_LIBRARY["longitude"]) {
							var latitude  = Number(window.CONFIGURATION_LIBRARY["latitude"])
							var longitude = Number(window.CONFIGURATION_LIBRARY["longitude"])
						}

					// get longitude & latitude from locale via Google Geolocation API
						else {
							// remainder
								if (locale && locale.trim()) {
									locale = locale
								}

							// city
								else if (window.CONFIGURATION_LIBRARY["city"]) {
									locale = window.CONFIGURATION_LIBRARY["city"]
								}

							// zip code
								else if (window.CONFIGURATION_LIBRARY["zip code"]) {
									locale = window.CONFIGURATION_LIBRARY["zip code"]
								}

							// no location?
								else {
									callback({icon: icon, error: true, message: "What city should I search for?", html: "<h2>Error: missing configuration:</h2><li>city</li>"})
									return
								}

							// options
								var options = {
									responseType: "json",
									url: "https://maps.googleapis.com/maps/api/geocode/json?key=" + window.CONFIGURATION_LIBRARY["google api key"] + "&address=" + locale
								}

							// proxy to server
								window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
									try {
										// no results?
											if (!response || !response.results || !response.results[0] || !response.results[0].geometry || !response.results[0].geometry.location) {
												callback({icon: icon, error: true, message: "I couldn't geolocate that.", html: "<h2>Error: unable to geolocate:</h2>" + remainder})
												return
											}

										// geolocation
											var latitude  = Number(response.results[0].geometry.location.lat.toFixed(7))
											var longitude = Number(response.results[0].geometry.location.lng.toFixed(7))

										// rerun this function
											window.ACTION_LIBRARY["get sunset"](latitude + ", " + longitude + (date ? " on " + date.toLocaleDateString() : ""), callback)
											return
									}
									catch (error) {
										callback({icon: icon, error: true, message: "I was unable to geolocate " + locale, html: "<h2>Error: unable to access geolocation:</h2>" + locale})
									}
								})
						}

					// get sunrise & sunset
						if (latitude && longitude) {
							// build options
								var options = {
									responseType: "json",
									url: "https://api.sunrise-sunset.org/json?lat=" + latitude + "&lng=" + longitude + "&date=" + (date ? new Date(date).toLocaleDateString() : "today")
								}

							// proxy to server
								window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
									try {
										// convert times
											var msOffset = new Date(date || null).getTimezoneOffset() * 60 * 1000
											var sunrise = new Date(new Date(new Date(date || null).toLocaleDateString() + " " + response.results.sunrise).getTime()     - msOffset)
												var sunriseString = sunrise.toLocaleTimeString()
											var noon    = new Date(new Date(new Date(date || null).toLocaleDateString() + " " + response.results.solar_noon).getTime()  - msOffset)
												var noonString = noon.toLocaleTimeString()
											var sunset  = new Date(new Date(new Date(date || null).toLocaleDateString() + " " + response.results.sunset).getTime()      - msOffset)
												var sunsetString = sunset.toLocaleTimeString()

										// response
											var message = "Sunrise is at " + sunriseString + ". Noon is at " + noonString + ". Sunset is at " + sunsetString + "."
											var url = "https://sunrise-sunset.org/search?location=" + latitude + "," + longitude
											var responseHTML = "<a target='_blank' href='" + url + "'><h2>times for " + (latitude + ", " + longitude) + "</h2></a>" +
												"<li>sunrise: " + sunriseString + "</li>" +
												"<li>noon: " + noonString + "</li>" +
												"<li>sunset: " + sunsetString + "</li>"
											callback({icon: icon, message: message, html: responseHTML, url: url, time: sunset})

									}
									catch (error) {
										callback({icon: icon, error: true, message: "I was unable to find the sunrise and sunset.", html: "<h2>Error: unable to access sunrise & sunset:</h2>" + latitude + ", " + longitude})
									}
								})
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get nutrition facts": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f34e;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["spoonacular api"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for spoonacular api.", html: "<h2>Error: missing configuration:</h2><li>spoonacular api</li>"})
							return
						}

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// options
						var options = {
							responseType: "json",
							url: "https://api.spoonacular.com/recipes/guessNutrition?apiKey=" + window.CONFIGURATION_LIBRARY["spoonacular api"] + "&title=" + remainder
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// invalid response
									if (!response.calories) {
										callback({icon: icon, error: true, message: "I was unable to get nutrition facts for " + remainder, html: "<h2>Error: unable to get nutrition facts:</h2>" + remainder})
										return
									}

								// get nutrition info
									var calories 	= response.calories.value 	+ " " + response.calories.unit
									var carbs 		= response.carbs.value 		+ " " + response.carbs.unit
									var fat 		= response.fat.value 		+ " " + response.fat.unit
									var protein 	= response.protein.value 	+ " " + response.protein.unit

								// construct response
									var message = "Here's what I found for " + remainder + "... " + calories + "; " + carbs + " of carbs; " + fat + " of fat; " + protein + " of protein"
									var responseHTML = "<h2>" + remainder + "</h2>" +
										"<li><b>calories:</b> " + calories + "</li>" +
										"<li><b>carbs:</b> " + carbs + "</li>" +
										"<li><b>fat:</b> " + fat + "</li>" +
										"<li><b>protein:</b> " + protein + "</li>"

								// send response
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get nutrition facts for " + remainder, html: "<h2>Error: unable to get nutrition facts:" + remainder})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get nutrition answer": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f34e;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["spoonacular api"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for spoonacular api.", html: "<h2>Error: missing configuration:</h2><li>spoonacular api</li>"})
							return
						}

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// options
						var options = {
							responseType: "json",
							url: "https://api.spoonacular.com/recipes/quickAnswer?apiKey=" + window.CONFIGURATION_LIBRARY["spoonacular api"] + "&q=" + remainder
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// invalid answer
									if (!response.answer) {
										callback({icon: icon, error: true, message: "I was unable to get a nutrition answer about " + remainder, html: "<h2>Error: unable to get a nutrition answer:</h2>" + remainder})
										return
									}
								
								// respond with answer
									var message = response.answer
									var responseHTML = "<h2>" + response.answer + "</h2>"
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get a nutrition answer about " + remainder, html: "<h2>Error: unable to get a nutrition answer:</h2>" + remainder})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get a book": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4da;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// options
						var options = {
							url: "http://openlibrary.org/search.json?q=" + remainder
						}

					// proxy request - have your people talk to my people
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// get a list of books
									var books = JSON.parse(response).docs

									if (!Array.isArray(books)) {
										books = [books]
									}
								
								// loop through all results
									var results = []
									for (var i in books) {
										// get info
											var coverImage = "http://covers.openlibrary.org/b/olid/" + (books[i].cover_edition_key) + "-L.jpg"
											var title = books[i].title.replace(/\&amp\;/gi, "&") + (books[i].subtitle ? ": " + books[i].subtitle.replace(/\&amp\;/gi, "&") : "")
											var author = books[i].author_name ? books[i].author_name.join(" & ") : null
											var url = "https://openlibrary.org" + books[i].key

										// construct publication date
											var publicationDate = books[i].first_publish_year
											var publisher = books[i].publisher ? books[i].publisher.join(", ") : null

										// table
											var responseHTML = "<table>" +
												"<tr><th rowspan='4'><img src='" + coverImage + "'></th><td><a target='_blank' href='" + url + "'><h2>" + title + "</h2></a></td></tr>" + 
												"<tr>" + 								"<td>" + (author || "???") + "</td></tr>" +
												"<tr>" + 								"<td>" + (publicationDate || "???") + "</td></tr>" +
												"<tr>" + 								"<td>" + (publisher || "???") + "</td></tr>" +
											"</table>"

										// message
											var message = title + 
												(author ? " by " + author : "") +
												(publicationDate || publisher ? " was published " +
													(publicationDate ? (" in " + publicationDate) : "") +
													(publisher ? (" by " + publisher) : "")
												: "")

										// add to results array
											results.push({icon: icon, message: message, html: responseHTML, url: url})
									}

								// display first result
									var firstResult = results.shift()
										firstResult.results = results
									callback(firstResult)
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I couldn't find that book.", html: "<h2>Error: unable to access openlibrary</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get lyrics": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f3b5;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// remove "by"
						var search = remainder.replace(/ performed by | played by | written by | composed by | sung by | by /gi, " ")

					// attempt counter
						if (!window.CONTEXT_LIBRARY["lyrics attempt counter"]) {
							window.CONTEXT_LIBRARY["lyrics attempt counter"] = 1
						}

					// options
						var options = {
							responseType: "json",
							url: "https://mourits.xyz:2096/?q=" + search
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// unsuccessful
									if (!response.success || !response.result) {
										// too long (fewer than 5 attempts)
											if (window.CONTEXT_LIBRARY["lyrics attempt counter"] < 5) {
												window.CONTEXT_LIBRARY["lyrics attempt counter"]++
												window.ACTION_LIBRARY["get lyrics"](remainder, callback)
												return
											}

										// other error
											window.CONTEXT_LIBRARY["lyrics attempt counter"] = 0
											callback({icon: icon, error: true, message: "I was unable to get lyrics for " + remainder, html: "<h2>Error: no results:</h2>" + response.error})
											return
									}
								
								// respond with answer
									window.CONTEXT_LIBRARY["lyrics attempt counter"] = 0
									
									var message = response.result.lyrics.replace(/\[.*[^\]]\]/gi, "").trim().replace(/\n\n\n|\n\n|\n/gi, " ... ")
									var url = response.result.source ? response.result.source.url : null
									var responseHTML = "<a target='_blank' href='" + url + "'><h2>" + response.song + "</h2></a>" +
										"<h3>" + response.artist + "</h3>" +
										"<p>" + response.result.lyrics.replace(/\n\n\n|\n\n|\n/gi, "<br>") + "</p>"
									callback({icon: icon, message: message, html: responseHTML, url: url})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get lyrics for " + remainder, html: "<h2>Error: unable to access lyrics:</h2>" + remainder})
							}
						})

				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get stock price": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4c8;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["alphavantage api"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for alphavantage api.", html: "<h2>Error: missing configuration:</h2><li>alphavantage api</li>"})
							return
						}

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// options
						var options = {
							responseType: "json",
							url: "https://www.alphavantage.co/query?apikey=" + window.CONFIGURATION_LIBRARY["alphavantage api"] + "&function=SYMBOL_SEARCH&keywords=" + remainder
						}

					// proxy request - have your people talk to my people
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// no matches
									if (!response.bestMatches || !response.bestMatches.length) {
										callback({icon: icon, error: true, message: "I couldn't find any stocks for " + remainder + ".", html: "<h2>Error: invalid search:</h2>" + remainder})
										return
									}

								// attempt counter
									var allMatches = response.bestMatches
									if (!window.CONTEXT_LIBRARY["alphavantage attempt counter"]) {
										window.CONTEXT_LIBRARY["alphavantage attempt counter"] = 0
									}

								// fetch
									fetchNextMatch(allMatches, handleMatch, callback)
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I couldn't find that corporation.", html: "<h2>Error: unable to access alphavantage</h2>"})
							}
						})
				
					// fetchNextMatch
						function fetchNextMatch(allMatches, handler, callback) {
							try {
								// options
									var symbol = allMatches[window.CONTEXT_LIBRARY["alphavantage attempt counter"]]["1. symbol"]
									var name = allMatches[window.CONTEXT_LIBRARY["alphavantage attempt counter"]]["2. name"]
									var options = {
										responseType: "json",
										url: "https://www.alphavantage.co/query?apikey=" + window.CONFIGURATION_LIBRARY["alphavantage api"] + "&function=TIME_SERIES_DAILY&symbol=" + symbol
									}

								// search
									window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
										handler(allMatches, symbol, name, response, callback)
									})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I couldn't find that corporation.", html: "<h2>Error: unable to access alphavantage</h2>"})
							}
						}

					// handleMatch
						function handleMatch(allMatches, symbol, name, response, callback) {
							try {
								// no data
									if (!response["Time Series (Daily)"] || !Object.keys(response["Time Series (Daily)"]).length) {
										// try again
											if (window.CONTEXT_LIBRARY["alphavantage attempt counter"] < 5 && allMatches[window.CONTEXT_LIBRARY["alphavantage attempt counter"] + 1]) {
												window.CONTEXT_LIBRARY["alphavantage attempt counter"]++
												fetchNextMatch(allMatches, handleMatch, callback)
												return
											}

										// give up
											window.CONTEXT_LIBRARY["alphavantage attempt counter"] = 0
											callback({icon: icon, error: true, message: "I couldn't find any stocks for " + remainder + ".", html: "<h2>Error: invalid search:</h2>" + remainder})
											return
									}

								// data
									var data = response["Time Series (Daily)"]
									var dates = Object.keys(data).slice(0,10)
									var minimum = 10000 // arbitrarily large
									var maximum = -10000 // arbitrarily small
									for (var i in dates) {
										var close = Number(data[dates[i]]["4. close"])
										if (close < minimum) {
											minimum = close
										}
										if (close > maximum) {
											maximum = close
										}
									}

								// prices
									var range = maximum - minimum
									var scaleFactor = 400 / range
									var dailyOpen = Number(data[dates[0]]["1. open"])
									var dailyClose = Number(data[dates[0]]["4. close"])
									var dailyChange = ((dailyClose - dailyOpen) / dailyOpen) * 100
									var prices = []
									for (var i = -1; i < 11; i++) {
										prices.push("<text fill='#dddddd' text-anchor='middle' font-size='25' x='35' y='" + (450 - (i * 40)) + "'>" + (minimum + range / 10 * i).toFixed(2) + "</text>")
									}

								// chart
									var points = []
									for (var i = 0; i < dates.length; i++) {
										points[i] = (1000 - i * 100) + "," + ((maximum - Number(data[dates[i]]["4. close"])) * scaleFactor + 50)
									}

									dates = dates.map(function(date, index) {
										return "<text fill='#dddddd' text-anchor='middle' font-size='25' x='" + (1000 - index * 100) + "' y='535'>" + date.slice(5, date.length) + "</text>"
									})

									var chart = "<svg viewBox='0 0 1050 550'>" +
										"<line stroke='#dddddd' stroke-width='5' x1='100' x2='100' y1='0' y2='500'></line>" +
										"<line stroke='#dddddd' stroke-width='5' x1='100' x2='1000' y1='500' y2='500'></line>" +
										"<polyline fill='transparent' stroke='#0093c4' stroke-width='5' points='" + points.join(" ") + "'/>" +
										prices.join("") +
										dates.join("") +
									"</svg>"

								// reset counter
									window.FUNCTION_LIBRARY["alphavantage attempt counter"] = 0

								// response
									var message = name + " is" + (dailyChange > 0 ? (" up " + dailyChange.toFixed(2) + " percent to ") : dailyChange < 0 ? (" down " + dailyChange.toFixed(2) + " percent to ") : " unchanged at ") + dailyClose + " dollars."
									var url = "https://www.google.com/search?tbm=fin&q=" + symbol
									var responseHTML = "<a target='_blank' href='" + url + "'><h2>" + name + " (" + symbol.toUpperCase() + ")</h2></a>" +
										"$" + dailyClose + " (" + dailyChange.toFixed(2) + "%)" +
										"<br><br>" + chart
									callback({icon: icon, message: message, html: responseHTML, url: url})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I couldn't find that corporation.", html: "<h2>Error: unable to access alphavantage</h2>"})
							}
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get a movie": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f3ac;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["omdb api"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for omdb api.", html: "<h2>Error: missing configuration:</h2><li>omdb api</li>"})
							return
						}

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// options
						var options = {
							responseType: "json",
							url: "https://www.omdbapi.com/?apikey=" + window.CONFIGURATION_LIBRARY["omdb api"] + "&s=" + remainder
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// unsuccessful
									if (!response.Search || !response.Search.length) {
										callback({icon: icon, error: true, message: "I was unable to find the film " + remainder, html: "<h2>Error: no results:</h2>" + remainder})
										return
									}

								// results
									var results = []
									var resultsCount = response.Search.length
								
								// loop through ids
									for (var i = 0; i < resultsCount; i++) {
										// options
											var id = response.Search[i].imdbID
											var options = {
												responseType: "json",
												url: "https://www.omdbapi.com/?apikey=" + window.CONFIGURATION_LIBRARY["omdb api"] + "&plot=full&i=" + id
											}

										// proxy to server
											window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
												try {
													// ratings
														var ratings = {
															imdb: 			(response.Ratings.find(function(r) { return r.Source == "Internet Movie Database"}) 	|| {Value: null}).Value,
															rottentomatoes: (response.Ratings.find(function(r) { return r.Source == "Rotten Tomatoes"}) 			|| {Value: null}).Value,
															metacritic: 	(response.Ratings.find(function(r) { return r.Source == "Metacritic"}) 					|| {Value: null}).Value
														}
														for (var i in ratings) {
															if (isNaN(ratings[i])) {
																if (ratings[i].includes("/")) {
																	ratings[i] = Math.round(Number(ratings[i].split("/")[0]) / Number(ratings[i].split("/")[1]) * 100)
																}
																else if (ratings[i].includes("%")) {
																	ratings[i] = Math.round(Number(ratings[i].split("%")[0]))
																}
															}
															else {
																ratings[i] = Math.round(Number(ratings[i]))
															}
														}

													// message
														var message = response.Title + " is " + (["a","e","i","o","u"].includes(response.Genre[0].toLowerCase()) ? "an " : "a ") + response.Genre + " film released by " + response.Production + " in " + response.Year + " ... " + 
															"It was written by " + response.Writer + " and directed by " + response.Director + " and stars " + response.Actors + " ... " +
															"It has a rating of " + ratings.imdb + " percent on IMDb, " + ratings.rottentomatoes + " percent on Rotten Tomatoes, and " + ratings.metacritic + " percent on Metacritic ... " +
															"Here's the plot: " + response.Plot

													// table
														var url = "https://imdb.com/title/" + response.imdbID
														var responseHTML = "<table>" +
															"<tr><th rowspan='6'><img src='" + response.Poster + "'></th><td colspan='3'><a target='_blank' href='" + url + "'><h2>" + response.Title + "</h2></a></td></tr>" + 
															"<tr>" + 													"<td><b>released</b><br>" + response.Released + "</td>" + 		"<td><b>runtime</b><br>" + response.Runtime + "</td>" + 					"<td><b>rated</b><br>" + response.Rated + "</td></tr>" +
															"<tr>" + 													"<td><b>production</b><br>" + response.Production + "</td>" +	"<td><b>writer</b><br>" + response.Writer + "</td>" + 					"<td><b>director</b><br>" + response.Director + "</td></tr>" +
															"<tr>" + 													"<td colspan='3'><b>starring</b><br>" + response.Actors + "</td></tr>" +
															"<tr>" + 													"<td colspan='3'>" + response.Plot + "</td></tr>" +
															"<tr>" + 													"<td><b>&#x2b50; IMDb</b><br>" + ratings.imdb + "%</td>" +			"<td><b>&#x2b50; Metacritic</b><br>" + ratings.metacritic + "%</td>" +		"<td><b>&#x2b50; Rotten Tomatoes</b><br>" + ratings.rottentomatoes + "%</td></tr>" +
														"</table>"

													// add to results
														results.push({icon: icon, message: message, html: responseHTML, url: url})

													// last one? display first result
														if (results.length == resultsCount) {
															var firstResult = results.shift()
																firstResult.results = results
															callback(firstResult)
														}
												}
												catch (error) {
													callback({icon: icon, error: true, message: "I was unable to find the film " + id, html: "<h2>Error: unable to access movies:</h2>" + id})
												}
											})
									}
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to find the film " + remainder, html: "<h2>Error: unable to access movies:</h2>" + remainder})
							}
						})

				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get metro predictions": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f687;"

					// remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// number words
						var route = remainder.split(/\s/gi)
						for (var i in route) {
							route[i] = window.FUNCTION_LIBRARY.getDigits(route[i].trim())
							if (["line", "route", "metro", "subway", "bus", "train", "rail", "trolley", "tram", "ferry"].includes(route[i])) {
								route[i] = ""
							}
						}
						route = route.join("").trim()

					// letter
						if (isNaN(route)) {
							route = route[0].toUpperCase() + route.slice(1)
						}

					// build options
						var options = {
							responseType: "json",
							url: "https://api-v3.mbta.com/predictions?sort=stop_sequence&include=stop&filter[route]=" + route
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// no data
									if (!response.data || !response.data.length || !response.included || !response.included.length) {
										callback({icon: icon, error: true, message: "I couldn't find any vehicles on that route.", html: "<h2>Error: invalid route:</h2>" + remainder})
										return
									}

								// stops
									var stops = {}
									for (var i in response.included) {
										stops[response.included[i].id] = response.included[i]
									}

								// vehicles
									var inbound = []
									var outbound = []
									for (var i in response.data) {
										var item = response.data[i]
										var stop = stops[item.relationships.stop.data.id]
										var stopName = stop.attributes.name || (stop.attributes.on_street + " @ " + stop.attributes.at_street)

										var listItem = "<li><b>" + stopName + ":</b><br>" +
											(item.attributes.arrival_time ? ("arrival: " + new Date(item.attributes.arrival_time).toLocaleTimeString()) : "") +
											(item.attributes.arrival_time && item.attributes.departure_time ? "<br>" : "") + 
											(item.attributes.departure_time ? ("departure: " + new Date(item.attributes.departure_time).toLocaleTimeString()) : "") +
											"</li>"

										if (item.attributes.direction_id == 1) {
											outbound.push(listItem)
										}
										else {
											inbound.push(listItem)
										}
									}

								// response
									var routeName = response.data[0].relationships.route.data.id
									var message = "Here's what I found for the " + routeName + " route: "
									var url = "https://mbta.com/schedules/" + routeName
									var responseHTML = "<a target='_blank' href='" + url + "'><h2>Route: " + routeName + "</h2></a>" + "<table>" +
										"<tr><th>in</th><th>out</th></tr>" +
										"<tr style='vertical-align: top; text-align: left;'><td><ul>" + inbound.join("") + "</ul></td><td><ul>" + outbound.join("") + "</ul></td></tr>" +
										"</table>"

								// alerts
									var options = {
										responseType: "json",
										url: "https://api-v3.mbta.com/alerts?filter[route]=" + route
									}

								// proxy to server
									window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
										try {
											// add to existing message & html
												if (response.data && response.data.length) {
													// bridge
														message += " ... There are " + response.data.length + " alert" + (response.data.length == 1 ? "" : "s") + " ... "
														responseHTML += "<br><hr><a target='_blank' href='" + url + "/alerts'><h2>alerts</h2></a><ul>"
													
													// loop through alerts
														for (var i in response.data) {
															message += (response.data[i].attributes.short_header || response.data[i].attributes.header) + " ... "
															responseHTML += "<li><b>" + (response.data[i].attributes.short_header || response.data[i].attributes.header) + "</b><br><i>" + response.data[i].attributes.description + "</i></li>"
														}

													// finish list
														responseHTML += "</ul>"
												}

											// send response
												callback({icon: icon, message: message, html: responseHTML, url: url})
										}
										catch (error) {
											callback({icon: icon, message: message, html: responseHTML, url: url})
										}
									})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get metro predictions.", html: "<h2>Error: unable to access metro API:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// news & blogs
			"get the latest post": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f5de;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// built-in feeds
						var feeds = {
							"bbc": "http://feeds.bbci.co.uk/news/rss.xml",
							"the bbc": "http://feeds.bbci.co.uk/news/rss.xml",
							"wired": "https://www.wired.com/feed/rss",
							"onion": "https://www.theonion.com/rss",
							"the onion": "https://www.theonion.com/rss",
							"fivethirtyeight": "https://fivethirtyeight.com/all/feed",
							"five thirtyeight": "https://fivethirtyeight.com/all/feed",
							"five thirty eight": "https://fivethirtyeight.com/all/feed",
							"538": "https://fivethirtyeight.com/all/feed",
							"science news": "https://sciencenews.org/feed",
							"anagram times": "https://www.anagramtimes.com/feeds/posts/default",
							"the anagram times": "https://www.anagramtimes.com/feeds/posts/default",
							"the muse": "https://www.themuse.com/feeds/rss",
							"new york times": "https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml",
							"the new york times": "https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml",
							"new york times": "https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml",
							"ny times": "https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml",
							"the ny times": "https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml",
							"nytimes": "https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml",
							"mcsweeneys": "https://www.mcsweeneys.net/rss",
							"google news": "https://news.google.com/rss?hl=en-US&gl=US&ceid=US:en",
							"cnn": "http://rss.cnn.com/rss/cnn_topstories.rss",
							"washington post": "http://feeds.washingtonpost.com/rss/world",
							"the washington post": "http://feeds.washingtonpost.com/rss/world",
							"npr": "https://www.npr.org/rss/rss.php?id=1001",
							"reuters": "http://feeds.reuters.com/reuters/topNews",
							"science daily": "http://feeds.sciencedaily.com/sciencedaily",
							"pbs": "https://www.pbs.org/wgbh/nova/rss/all/",
							"guardian": "https://www.theguardian.com/world/rss",
							"the guardian": "https://www.theguardian.com/world/rss",
							"vox": "https://www.vox.com/rss/world/index.xml",
							"abc": "https://abcnews.go.com/abcnews/internationalheadlines",
							"cbs": "https://www.cbsnews.com/latest/rss/world",
							"nbc": "https://www.cnbc.com/id/100727362/device/rss/rss.html",
							"time": "http://feeds.feedburner.com/time/world",
							"time magazine": "http://feeds.feedburner.com/time/world",
							"freakonomics": "http://freakonomics.com/feed/",
						}

					// missing config?
						if (!feeds[remainder] && !window.CONFIGURATION_LIBRARY[remainder]) {
							callback({icon: icon, error: true, message: "I'm not subscribed to that feed yet.", html: "<h2>Error: missing feed:</h2><li>" + remainder + "</li>"})
							return
						}

					// options
						var options = {
							responseType: null,
							url: feeds[remainder] || window.CONFIGURATION_LIBRARY[remainder]
						}

					// proxy request
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// get list (json)
									try {
										var list = JSON.parse(response)
										var json = true
									}

								// get list (xml)
									catch (error) {
										var rssDoc = new DOMParser().parseFromString(response, "text/xml")
										var list = rssDoc.querySelectorAll("channel item")
										if (!list.length) {
											var list = rssDoc.querySelectorAll("entry")
										}
										var json = false
									}

								// no list
									if (!list) {
										callback({icon: icon, error: true, message: "I couldn't parse that feed.", html: "<h2>Error: unparseable feed:</h2><li>" + remainder + "</li>"})
										return
									}

								// loop through all entries
									var entries = []
									for (var i in list) {
										if (typeof list[i] == "object") {
											// json
												if (json) {
													var url = list[i].url || list[i].link
													var title = list[i].title
													var author = list[i].author || list[i].writer
													var date = list[i].date || list[i].pubDate || list[i].publication
													var text = list[i].text || list[i].content || list[i].description
												}

											// xml
												else {
													var url = (list[i].querySelector("url") ? list[i].querySelector("url").innerHTML.replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, "") : null)
														|| (list[i].querySelector("link[type='text/html']") ? list[i].querySelector("link[type='text/html']").getAttribute("href") : null)
														|| (list[i].querySelector("link") ? list[i].querySelector("link").innerHTML.replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, "") : null)

													var title = (list[i].querySelector("title") ? list[i].querySelector("title").innerHTML.replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, "") : null)

													var author = (list[i].querySelector("author name") ? list[i].querySelector("author name").innerHTML.replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, "") : null)
														|| (list[i].querySelector("author") ? list[i].querySelector("author").innerHTML.replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, "") : null)
														|| (list[i].getElementsByTagNameNS("*", "creator").length ? list[i].getElementsByTagNameNS("*", "creator")[0].innerHTML.replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, "") : null)
														|| (list[i].getElementsByTagNameNS("*", "contributor").length ? list[i].getElementsByTagNameNS("*", "contributor")[0].innerHTML.replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, "") : null)

													var date = (list[i].querySelector("date") ? list[i].querySelector("date").innerHTML.replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, "") : null)
														|| (list[i].querySelector("pubDate") ? list[i].querySelector("pubDate").innerHTML.replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, "") : null)
														|| (list[i].querySelector("published") ? list[i].querySelector("published").innerHTML.replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, "") : null)

													var text = (list[i].querySelector("text") ? list[i].querySelector("text").innerHTML.replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, "") : null)
														|| (list[i].getElementsByTagNameNS("*", "encoded").length ? list[i].getElementsByTagNameNS("*", "encoded")[0].innerHTML .replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, ""): null)
														|| (list[i].querySelector("description") ? list[i].querySelector("description").innerHTML.replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, "") : null)
														|| (list[i].querySelector("content") ? list[i].querySelector("content").innerHTML .replace(/\<\!\[CDATA\[/gi, "").replace(/\]\]\>/gi, ""): null)
												}
											
											// entry
												entries.push({
													url: url || null,
													title: title || "untitled",
													author: author || null,
													date: date ? new Date(date) : null,
													text: text || null
												})
										}
									}
									entries = entries.sort(function(a,b) { return new Date(b.date).getTime() - new Date(a.date).getTime() })

								// loop through all results
									var results = []
									for (var i in entries) {
										if (entries[i].text) {
											// clean up
												entries[i].text = entries[i].text.replace(/&amp;/gi, "&").replace(/&#8217;/gi, "'").replace(/\&lt\;/gi, "<").replace(/\&gt\;/gi, ">").replace(/srcset\=/gi, "data-srcset=").replace(/\<a href\=/gi, "<a target='_blank' href=")

											// message
												var textNode = document.createElement("div")
													textNode.innerHTML = entries[i].text.replace(/\n/gi, " ... ").replace(/\<script[^>]*\>(.*?)script\>/gi, "").replace(/\<style[^>]*\>(.*?)style\>/gi, "")
												var text = textNode.innerText
												var message = entries[i].title + (entries[i].author ? entries[i].author : "") + " ... " + (text || "")

											// html
												var responseHTML = (entries[i].url ? ("<a target='_blank' href='" + entries[i].url + "'><h2>" + entries[i].title + "</h2></a>") : ("<h2>" + entries[i].title + "</h2>")) + 
													(entries[i].author ? ("<i>" + entries[i].author + "</i>") : "") +
													(entries[i].author && entries[i].date ? ", " : "") +
													(entries[i].date ? ("<i>" + new Date(entries[i].date).toLocaleDateString() + "</i>") : "") +
													("<p>" + entries[i].text.replace(/\n/gi, "<br>").replace(/height\=\"1\"/gi, 'height="1" style="display:none !important;"') + "</p>")

											// add to results
												results.push({icon: icon, message: message, html: responseHTML, url: entries[i].url})
										}
									}

								// display first result
									var firstResult = results.shift()
										firstResult.results = results
									callback(firstResult)
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I couldn't access that feed.", html: "<h2>Error: unable to access feed</h2>" + remainder})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get a random post": function(remainder, callback) {
				try {
					// proxy to get the latest post (ordered list)
						window.ACTION_LIBRARY["get the latest post"](remainder, function(response) {
							// error?
								if (response.error) {
									callback({icon: response.icon, error: true, message: response.message, html: response.html})
									return
								}

							// extract results
								var results = response.results || []
									results.unshift({icon: response.icon, message: response.message, html: response.html, url: response.url})

							// shuffle them 
								results = window.FUNCTION_LIBRARY.sortRandom(results)

							// display first result
								var firstResult = results.shift()
									firstResult.results = results
								callback(firstResult)
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get all posts": function(remainder, callback) {
				try {
					// proxy to get the latest post (ordered list)
						window.ACTION_LIBRARY["get the latest post"](remainder, function(response) {
							// error?
								if (response.error) {
									callback({icon: icon, error: true, message: response.message, html: response.html})
									return
								}

							// extract results
								var results = response.results || []
									results.unshift({icon: response.icon, message: response.message, html: response.html, url: response.url})

							// display all results
								var icon = results[0].icon
								var message = "I found " + results.length + (results.length == 1 ? " post: " : " posts: ") +
									results.map(function(result) { return result.message }).join(" ... ")
								var responseHTML = "<h2>top posts from " + remainder + "</h2>" +
									results.map(function(result) { return "<p>" + result.html + "</p>"}).join("<hr>")
								callback({icon: icon, message: message, html: responseHTML, url: results[0].url})
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get the headlines": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4f0;"

					// proxy to get the latest post (ordered list)
						window.ACTION_LIBRARY["get all posts"]("npr", callback)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// Google Apps Script
			"edit wish list": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4dd;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// no remainder
						remainder = " " + remainder.replace(/[?!,:;'"_\/\(\)\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I add?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// split at keywords
						var cost = remainder.split(/ for | costing | that costs | which costs /gi)
							cost = (cost[1] || cost[0]).split(/ called | named | by the name | which is a | which is an | which is the /gi)[0].trim()

						var item = remainder.split(/ called | named | by the name /gi)
							item = (item[1] || item[0]).split(/ for | costing | that costs | which costs | which is a | which is an | which is the /gi)[0].trim()

						var type = remainder.split(/ which is a | which is an | which is the /gi)
							type = (type[1] || type[0]).split(/ for | costing | that costs | which costs | called | named | by the name /gi)[0].trim()

					// build options
						var options = {
							responseType: "json",
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=listWish&item=" + item + "&cost=" + cost + "&type=" + type
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// response
									var message = response.message
									var responseHTML = "<h2>" + response.item + "</h2><li><b>cost: </b>" + response.cost + "</li><li><b>type: </b>" + response.type + "</li>"
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to edit your wish list.", html: "<h2>Error: unable to edit wish list:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get balance": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4b5;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// build options
						var options = {
							responseType: "json",
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=getBalance&account=" + remainder
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// no account
									if (!response.account) {
										callback({icon: icon, error: true, message: "I couldn't find that account.", html: "<h2>Error: invalid account</h2>"})
										return
									}

								// response
									var message = response.message
									var responseHTML = "<h2><b>" + response.account + ":</b> $" + response.amount + "</h2>"
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get your balance.", html: "<h2>Error: unable to get balance:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"log purchase": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4b5;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// no remainder
						remainder = " " + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I add?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// split at keywords
						var amount = remainder.split(/ for | costing | that cost | that costs | which cost | which costs /gi)
							amount = (amount[1] || amount[0]).split(/ called | named | by the name | item | which is a | which is an | which is the | which is type | which is category | which is | type | category /gi)[0].trim()

						var description = remainder.split(/ called | named | by the name | item /gi)
							description = (description[1] || description[0]).split(/ for | costing | that cost | that costs | which cost | which costs | which is a | which is an | which is the | which is type | which is category | which is | type | category /gi)[0].trim()

						var category = remainder.split(/ which is a | which is an | which is the | which is type | which is category | which is | type | category /gi)
							category = (category[1] || category[0]).split(/ for | costing | that cost | that costs | which cost | which costs | called | named | by the name | item /gi)[0].trim()

					// build options
						var options = {
							responseType: "json",
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=logPurchase&category=" + category + "&description=" + description + "&amount=" + amount
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// response
									var message = response.message
									var responseHTML = "<h2>" + response.description + "</h2><li><b>amount: </b>" + response.amount + "</li><li><b>category: </b>" + response.category + "</li>"
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to log your purchase.", html: "<h2>Error: unable to log purchase:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get calendar": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4c5;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// remainder
						remainder = " " + remainder.replace(/[?!.,:;'"_\(\)\$\%]/gi,"").toLowerCase().trim()

					// split at keywords
						var startDate = remainder.replace(/[?!,;'"_\(\)\$\%]/gi,"").split(/ from | starting at | start date | start time | between | for /gi)
							startDate = (startDate[1] || startDate[0]).split(/ to | until | ending at | end date | end time | and | through /gi)[0].trim()
							if (startDate == "then" && window.CONTEXT_LIBRARY.lastResponseTime) {
								startDate = window.CONTEXT_LIBRARY.lastResponseTime
							}
							else {
								startDate = window.FUNCTION_LIBRARY.getDateTime(startDate)
							}

						var endDate = remainder.replace(/[?!,;'"_\(\)\$\%]/gi,"").split(/ to | until | ending at | end date | end time | and | through /gi)
							endDate = (endDate[1] || endDate[0]).split(/ from | starting at | start date | start time | between | for /gi)[0].trim()
							if (endDate == "then" && window.CONTEXT_LIBRARY.lastResponseTime) {
								endDate = window.CONTEXT_LIBRARY.lastResponseTime
							}
							else {
								endDate = window.FUNCTION_LIBRARY.getDateTime(endDate)
							}

					// build options
						var options = {
							responseType: "json",
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=fetchEvents" + (startDate ? "&startDate=" + startDate.toLocaleString() : "") + (endDate ? "&endDate=" + endDate.toLocaleString() : "")
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// create list
									var eventList = []
									var eventItems = []
									if (response.events) {
										for (var i = 0; i < response.events.length; i++) {
											var event = response.events[i]
											var startTime = new Date(event.startTime).toLocaleString()
											var endTime = new Date(event.endTime).toLocaleString()

											eventList.push(event.title + " from " + startTime + " until " + endTime + " at " + (event.location || "unknown location"))
											eventItems.push("<li><b>" + event.title + "</b><p>" + startTime + " - " + endTime + "<br><a target='_blank' href='https://www.google.com/maps/?q=" + event.location + "'>" + event.location + "</a><br>" + event.description + "</p></li>")
										}
									}

								// response
									var time = response.events && response.events.length ? new Date(response.events[0].startTime) : null
									var message = response.message + eventList.join(" ... ")
									var url = "https://calendar.google.com"
									var responseHTML = "<a target='_blank' href='" + url + "'><h2>upcoming events</h2></a><ul>" + eventItems.join("") + "</ul>"
									callback({icon: icon, message: message, html: responseHTML, url: url, time: time})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to fetch your calendar.", html: "<h2>Error: unable to get calendar:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get event": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4c5;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !	remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// build options
						var options = {
							responseType: "json",
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=findEvent&name=" + remainder
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// create list
									var eventList = []
									var eventItems = []
									if (response.events) {
										for (var i = 0; i < response.events.length; i++) {
											var event = response.events[i]
											var startTime = new Date(event.startTime).toLocaleString()
											var endTime = new Date(event.endTime).toLocaleString()

											eventList.push(event.title + " from " + startTime + " until " + endTime + " at " + (event.location || "unknown location"))
											eventItems.push("<li><b>" + event.title + "</b><p>" + startTime + " - " + endTime + "<br><a target='_blank' href='https://www.google.com/maps/?q=" + event.location + "'>" + event.location + "</a><br>" + event.description + "</p></li>")
										}
									}

								// response
									var time = response.events && response.events.length ? new Date(response.events[0].startTime) : null
									var message = response.message + eventList.join(" ... ")
									var url = "https://calendar.google.com/calendar/r/search?q=" + remainder
									var responseHTML = "<a target='_blank' href='" + url + "'><h2>" + remainder + "</h2></a><ul>" + eventItems.join("") + "</ul>"
									callback({icon: icon, message: message, html: responseHTML, url: url, time: time})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to fetch your calendar.", html: "<h2>Error: unable to get calendar:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"add event": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4c5;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// enter flow
						window.CONTEXT_LIBRARY.flow = "add event"
						window.CONTEXT_LIBRARY["add event"] = window.CONTEXT_LIBRARY["add event"] || {
							title: null,
							startDate: null,
							startTime: null,
							endDate: null,
							endTime: null,
							location: null
						}

					// check what's missing
						var nextParameter = null
						for (var i in window.CONTEXT_LIBRARY["add event"]) {
							if (!window.CONTEXT_LIBRARY["add event"][i]) {
								nextParameter = i
								break
							}
						}

					// something missing
						if (nextParameter && remainder) {
							// clean remainder
								remainder = remainder.trim()

							// add it
								if (nextParameter == "title" || nextParameter == "location") {
									window.CONTEXT_LIBRARY["add event"][nextParameter] = remainder
								}
								else if (nextParameter == "startDate" || nextParameter == "endDate") {
									if (remainder == "then" && window.CONTEXT_LIBRARY.lastResponseTime) {
										var date = window.CONTEXT_LIBRARY.lastResponseTime.toLocaleDateString()
									}
									else {
										var date = window.FUNCTION_LIBRARY.getDateTime(remainder).toLocaleDateString()
									}

									if (!isNaN(new Date(date).getTime())) {
										window.CONTEXT_LIBRARY["add event"][nextParameter] = date
									}
								}
								else if (nextParameter == "startTime" || nextParameter == "endTime") {
									if (remainder == "then" && window.CONTEXT_LIBRARY.lastResponseTime) {
										var time = window.CONTEXT_LIBRARY.lastResponseTime.toLocaleTimeString()
									}
									else {
										var time = window.FUNCTION_LIBRARY.getDateTime(remainder).toLocaleTimeString()
									}

									if (!isNaN(new Date("1/1/1 " + time).getTime())) {
										window.CONTEXT_LIBRARY["add event"][nextParameter] = time
									}
								}

							// get new nextParameter
								var nextParameter = null
								for (var i in window.CONTEXT_LIBRARY["add event"]) {
									if (!window.CONTEXT_LIBRARY["add event"][i]) {
										nextParameter = i
										break
									}
								}
						}

					// still something missing
						if (nextParameter) {
							// response
								var message = "What is the " + nextParameter + "?"
								var responseHTML = "<h2>" + nextParameter + " = ?</h2>" + 
									"<ul>" + Object.keys(window.CONTEXT_LIBRARY["add event"]).map(function(key) {
										return "<li><b>" + key + ":</b> " + (window.CONTEXT_LIBRARY["add event"][key] || "?") + "</li>"
									}).join("") + "</ul>"
								callback({icon: icon, message: message, html: responseHTML})
								return
						}

					// build options
						var options = {
							responseType: "json",
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=addEvent" +
								"&title=" + window.CONTEXT_LIBRARY["add event"].title +
								"&startDate=" + window.CONTEXT_LIBRARY["add event"].startDate +
								"&startTime=" + window.CONTEXT_LIBRARY["add event"].startTime +
								"&endDate=" + window.CONTEXT_LIBRARY["add event"].endDate +
								"&endTime=" + window.CONTEXT_LIBRARY["add event"].endTime +
								"&location=" + window.CONTEXT_LIBRARY["add event"].location
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// not successful?
									if (!response.success) {
										callback({icon: icon, error: true, message: "I was unable to add the event.", html: "<h2>Error: unable to add event:</h2><pre style='text-align: left'>" + JSON.stringify(window.CONTEXT_LIBRARY["add event"], null, '\t') + "</pre>"})
										return
									}

								// response
									var time = new Date(response.event.startTime)
									var message = response.message + " " + response.event.title + ", from " + response.event.startTime + " to " + response.event.endTime + (response.event.location ? (" at " + response.event.location) : "")
									var url = "https://calendar.google.com"
									var responseHTML = "<a target='_blank' href='" + url + "'><h2>" + response.event.title + "</h2></a><ul>" +
										"<li>" + response.event.startTime + " - " + response.event.endTime + "</li>" +
										(response.event.location ? ("<li>" + response.event.location + "</li>") : "") +
										"</ul>"
									callback({icon: icon, message: message, html: responseHTML, url: url, time: time})

								// end flow
									window.CONTEXT_LIBRARY.flow = null
									delete window.CONTEXT_LIBRARY["add event"]
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to fetch your calendar.", html: "<h2>Error: unable to get calendar:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get a list": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4dd;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()

					// build options
						var list = remainder
						var options = {
							responseType: "json",
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=getList" + (list ? ("&list=" + list) : "")
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// not successful?
									if (!response.success || !response.list) {
										callback({icon: icon, error: true, message: "I was unable to get " + (list ? list : " your list"), html: "<h2>Error: unable to get list:</h2>" + remainder})
										return
									}

								// create structured list
									var structuredItems = {}
									var i = 0

								// loop through response list
									while (response.list.length) {
										// wrap back to the beginning of the list
											if (i == response.list.length) {
												i = 0
											}

										// get the item
											var item = response.list[i]

										// top-level?
											if (!item.parent) {
												structuredItems[item.id] = item
												response.list.splice(i, 1)
												i--
											}

										// subtask?
											else if (structuredItems[item.parent]) {
												if (!structuredItems[item.parent].children) {
													structuredItems[item.parent].children = {}
												}
												structuredItems[item.parent].children[item.id] = item
												response.list.splice(i, 1)
												i--
											}

										// sub-subtask? --> force top-level
											else if (!response.list.find(function(x) { return x.id == item.parent })) {
												structuredItems[item.id] = item
												response.list.splice(i, 1)
												i--
											}

										// increment
											i++
									}

								// sort list item keys by position
									var structuredItemKeys = Object.keys(structuredItems)
									structuredItemKeys = structuredItemKeys.sort(function(a, b) {
										return Number(structuredItems[a].position) - Number(structuredItems[b].position)
									})

								// empty message / html
									var message = ""
									var responseHTML = "<ul>"

								// loop through list item keys
									for (var i in structuredItemKeys) {
										var item = structuredItems[structuredItemKeys[i]]

										responseHTML += "<li><b>" + item.title + "</b>"
										message += item.title + " ... "

										// due date
											if (item.due) {
												responseHTML += "<br>" + new Date(new Date(item.due).getTime() + (1000 * 60 * 60 * 5)).toLocaleDateString()
												message += new Date(new Date(item.due).getTime() + (1000 * 60 * 60 * 5)).toLocaleDateString() + " ... "
											}

										// notes
											if (item.notes) {
												responseHTML += "<br>" + item.notes
												message += item.notes + " ... "
											}

										// subtasks
											if (item.children) {
												responseHTML += "<ul>"
												for (var j in item.children) {
													responseHTML += "<li><b>" + item.children[j].title + "</b>"
													message += item.children[j].title + " ... "

													// due date
														if (item.children[j].due) {
															responseHTML += "<br>" + new Date(new Date(item.children[j].due).getTime() + (1000 * 60 * 60 * 5)).toLocaleDateString()
															message += new Date(new Date(item.children[j].due).getTime() + (1000 * 60 * 60 * 5)).toLocaleDateString() + " ... "
														}

													// notes
														if (item.children[j].notes) {
															responseHTML += "<br>" + item.children[j].notes
															message += item.children[j].notes + " ... "
														}

													responseHTML += "</li>"
												}
												responseHTML += "</ul>"
											}

										responseHTML += "</li>"
									}
									responseHTML += "<ul>"

								// send response
									message = response.listName + " ... " + message
									var url = "https://mail.google.com"
									responseHTML = "<a target='_blank' href='" + url + "'><h2>" + response.listName + "</h2></a>" + responseHTML
									callback({icon: icon, message: message, html: responseHTML, url: url})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get your list.", html: "<h2>Error: unable to get list:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"add an item to a list": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4dd;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// no remainder
						remainder = " " + remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I add?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// split at keywords
						var components = remainder.split(/ list | list\: /gi)
						var list = components[0].trim() || ""
						var task = components[1] ? components[1] : components[0]

					// no task?
						if (!task || list == task) {
							callback({icon: icon, error: true, message: "I couldn't identify that item.", html: "<h2>Error: missing or invalid item:</h2>" + remainder})
							return
						}

					// build options
						var options = {
							responseType: "json",
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=addTask" + (list ? "&list=" + list : "") + "&task=" + task
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// not successful?
									if (!response.success || !response.list) {
										callback({icon: icon, error: true, message: "I was unable to add " + task + " to " + (list ? list : " your list"), html: "<h2>Error: unable to add item to list:</h2>" + remainder})
										return
									}

								// create structured list
									var structuredItems = {}
									var i = 0

								// loop through response list
									while (response.list.length) {
										// wrap back to the beginning of the list
											if (i == response.list.length) {
												i = 0
											}

										// get the item
											var item = response.list[i]

										// top-level?
											if (!item.parent) {
												structuredItems[item.id] = item
												response.list.splice(i, 1)
												i--
											}

										// subtask?
											else if (structuredItems[item.parent]) {
												if (!structuredItems[item.parent].children) {
													structuredItems[item.parent].children = {}
												}
												structuredItems[item.parent].children[item.id] = item
												response.list.splice(i, 1)
												i--
											}

										// sub-subtask? --> force top-level
											else if (!response.list.find(function(x) { return x.id == item.parent })) {
												structuredItems[item.id] = item
												response.list.splice(i, 1)
												i--
											}

										// increment
											i++
									}

								// sort list item keys by position
									var structuredItemKeys = Object.keys(structuredItems)
									structuredItemKeys = structuredItemKeys.sort(function(a, b) {
										return Number(structuredItems[a].position) - Number(structuredItems[b].position)
									})

								// empty html
									var responseHTML = "<ul>"

								// loop through list item keys
									for (var i in structuredItemKeys) {
										var item = structuredItems[structuredItemKeys[i]]

										responseHTML += "<li><b>" + item.title + "</b>"

										// due date
											if (item.due) {
												responseHTML += "<br>" + new Date(new Date(item.due).getTime() + (1000 * 60 * 60 * 5)).toLocaleDateString()
											}

										// notes
											if (item.notes) {
												responseHTML += "<br>" + item.notes
											}

										// subtasks
											if (item.children) {
												responseHTML += "<ul>"
												for (var j in item.children) {
													responseHTML += "<li><b>" + item.children[j].title + "</b>"

													// due date
														if (item.children[j].due) {
															responseHTML += "<br>" + new Date(new Date(item.children[j].due).getTime() + (1000 * 60 * 60 * 5)).toLocaleDateString()
														}

													// notes
														if (item.children[j].notes) {
															responseHTML += "<br>" + item.children[j].notes
														}

													responseHTML += "</li>"
												}
												responseHTML += "</ul>"
											}

										responseHTML += "</li>"
									}
									responseHTML += "<ul>"

								// send response
									var message = "I added " + task + " to " + response.listName
									var url = "https://mail.google.com"
									responseHTML = "<a target='_blank' href='" + url + "'><h2>" + response.listName + "</h2></a>" + responseHTML
									callback({icon: icon, message: message, html: responseHTML, url: url})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to add to your list.", html: "<h2>Error: unable to add to list:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get contacts": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f464;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// no remainder
						remainder = remainder.replace(/[?!,:;"_\/\(\)\$\%]/gi,"").trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// build options
						var options = {
							responseType: "json",
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=getContacts&name=" + remainder
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// not successful?
									if (!response.success) {
										callback({icon: icon, error: true, message: "I was unable to find " + remainder, html: "<h2>Error: unable to find contact:</h2>" + remainder})
										return
									}

								// possibilities
									var message = ""
									var responseHTML = "<ul>"
									for (var i in response.list) {
										var contact = response.list[i]

										// name
											var name = (contact.firstName ? contact.firstName + " " : "") + (contact.middleName ? contact.middleName + " " : "") + (contact.lastName ? contact.lastName : "")
											message += name + " ... "
											responseHTML += "<li><b>" + name + "</b>"
										
										// emails
											if (contact.emails && Array.isArray(contact.emails) && contact.emails.length) {
												responseHTML += "<ul>"
												for (var j in contact.emails) {
													responseHTML += "<li><a target='_blank' href='mailto:" + contact.emails[j].value + "'>" + (contact.emails[j].label ? contact.emails[j].label.toLowerCase().replace(/\_/g, " ") + ": " : "") + contact.emails[j].value + "</a></li>"
												}
												responseHTML += "</ul>"
											}

										// phone numbers
											if (contact.phoneNumbers && Array.isArray(contact.phoneNumbers) && contact.phoneNumbers.length) {
												responseHTML += "<ul>"
												for (var j in contact.phoneNumbers) {
													responseHTML += "<li><a target='_blank' href='tel:" + contact.phoneNumbers[j].value + "'>" + (contact.phoneNumbers[j].label ? contact.phoneNumbers[j].label.toLowerCase().replace(/\_/g, " ") + ": " : "") + contact.phoneNumbers[j].value + "</a></li>"
												}
												responseHTML += "</ul>"
											}

										// addresses
											if (contact.addresses && Array.isArray(contact.addresses) && contact.addresses.length) {
												responseHTML += "<ul>"
												for (var j in contact.addresses) {
													responseHTML += "<li><a target='_blank' href='https://maps.google.com?q=" + contact.addresses[j].value + "'>" + (contact.addresses[j].label ? contact.addresses[j].label.toLowerCase().replace(/\_/g, " ") + ": " : "") + contact.addresses[j].value + "</a></li>"
												}
												responseHTML += "</ul>"
											}

										// dates
											if (contact.dates && Array.isArray(contact.dates) && contact.dates.length) {
												responseHTML += "<ul>"
												for (var j in contact.dates) {
													responseHTML += "<li>" + (contact.dates[j].label ? contact.dates[j].label.toLowerCase().replace(/\_/g, " ") + ": " : "") + contact.dates[j].value + "</li>"
												}
												responseHTML += "</ul>"
											}

										// urls
											if (contact.urls && Array.isArray(contact.urls) && contact.urls.length) {
												responseHTML += "<ul>"
												for (var j in contact.urls) {
													responseHTML += "<li><a target='_blank' href='" + contact.urls[j].value + "'>" + (contact.urls[j].label ? contact.urls[j].label.toLowerCase().replace(/\_/g, " ") + ": " : "") + contact.urls[j].value + "</a></li>"
												}
												responseHTML += "</ul>"
											}
										
										responseHTML += "</li>"
									}
									responseHTML += "</ul>"

								// send response
									message = "I found " + response.list.length + (response.list.length == 1 ? "person" : "people") + ": " + message
									var url = "https://contacts.google.com/search/" + remainder
									responseHTML = "<a target='_blank' href='" + url + "'><h2>" + remainder + "</h2></a>" + responseHTML
									callback({icon: icon, message: message, html: responseHTML, url: url})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get contacts.", html: "<h2>Error: unable to get contacts:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get birthday": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f464;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// no remainder?
						remainder = remainder.replace(/[?!,:;"_\/\(\)\$\%]/gi,"").trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return	
						}

					// build options
						var options = {
							responseType: "json",
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=getContacts&name=" + remainder
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// not successful?
									if (!response.success) {
										callback({icon: icon, error: true, message: "I was unable to find " + remainder, html: "<h2>Error: unable to find contact:</h2>" + remainder})
										return
									}

								// extract birthdays
									var people = []
									for (var i in response.list) {
										var contact = response.list[i]
										people[i] = {
											name: (contact.firstName ? contact.firstName + " " : "") + (contact.middleName ? contact.middleName + " " : "") + (contact.lastName ? contact.lastName : ""),
											birthday: "unknown"
										}
										if (contact.dates && Array.isArray(contact.dates) && contact.dates.length) {
											for (var j in contact.dates) {
												if (contact.dates[j].label.toLowerCase() == "birthday") {
													people[i].birthday = contact.dates[j].value
												}
											}
										}
									}

								// message (list people/birthday)
									var message = ""
									var responseHTML = "<ul>"
									for (var i in people) {
										message += people[i].name + "'s birthday is " + people[i].birthday + " ... "
										responseHTML += "<li><b>" + people[i].name + "</b><br>birthday: " + people[i].birthday + "</li>"
									}
									responseHTML += "</ul>"

								// send response
									var time = people.length ? new Date(people[0].birthday) : null
									message = "I found " + people.length + (people.length == 1 ? "person" : "people") + ": " + message
									var url = "https://contacts.google.com/search/" + remainder
									responseHTML = "<a target='_blank' href='" + url + "'><h2>" + remainder + " birthdays</h2></a>" + responseHTML
									callback({icon: icon, message: message, html: responseHTML, url: url, time: time})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get contacts.", html: "<h2>Error: unable to get contacts:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get phone number": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f464;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// no remainder?
						remainder = remainder.replace(/[?!,:;"_\/\(\)\$\%]/gi,"").trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return	
						}

					// build options
						var options = {
							responseType: "json",
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=getContacts&name=" + remainder
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// not successful?
									if (!response.success) {
										callback({icon: icon, error: true, message: "I was unable to find " + remainder, html: "<h2>Error: unable to find contact:</h2>" + remainder})
										return
									}

								// extract phone numbers
									var people = []
									for (var i in response.list) {
										var contact = response.list[i]
										people[i] = {
											name: (contact.firstName ? contact.firstName + " " : "") + (contact.middleName ? contact.middleName + " " : "") + (contact.lastName ? contact.lastName : ""),
											phoneNumbers: []
										}
										if (contact.phoneNumbers && Array.isArray(contact.phoneNumbers) && contact.phoneNumbers.length) {
											for (var j in contact.phoneNumbers) {
												people[i].phoneNumbers[j] = {
													value: contact.phoneNumbers[j].value,
													label: contact.phoneNumbers[j].label ? contact.phoneNumbers[j].label.toLowerCase().replace(/\_/g, " ") : null
												}
											}
										}
									}

								// message (list people > list phone numbers)
									var message = ""
									var responseHTML = "<ul>"
									for (var i in people) {
										responseHTML += "<li><b>" + people[i].name + "</b><br>"
										if (people[i].phoneNumbers.length) {
											responseHTML += "<ul>"
											for (var j in people[i].phoneNumbers) {
												message += people[i].name + "'s " + (people[i].phoneNumbers[j].label ? people[i].phoneNumbers[j].label : "phone number") + " is " + people[i].phoneNumbers[j].value + " ... "
												responseHTML += "<li><a target='_blank' href='tel:" + people[i].phoneNumbers[j].value + "'>" + (people[i].phoneNumbers[j].label ? (people[i].phoneNumbers[j].label + ": ") : "") + people[i].phoneNumbers[j].value + "</a></li>"
											}
											responseHTML += "</ul>"
										}
										responseHTML += "</li>"
									}
									responseHTML += "</ul>"

								// send response
									message = "I found " + people.length + (people.length == 1 ? "person" : "people") + ": " + message
									var url = "https://contacts.google.com/search/" + remainder
									responseHTML = "<a target='_blank' href='" + url + "'><h2>" + remainder + " phone numbers</h2></a>" + responseHTML
									callback({icon: icon, message: message, html: responseHTML, url: url})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get contacts.", html: "<h2>Error: unable to get contacts:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get email": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f464;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// no remainder?
						remainder = remainder.replace(/[?!,:;"_\/\(\)\$\%]/gi,"").trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return	
						}

					// build options
						var options = {
							responseType: "json",
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=getContacts&name=" + remainder
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// not successful?
									if (!response.success) {
										callback({icon: icon, error: true, message: "I was unable to find " + remainder, html: "<h2>Error: unable to find contact:</h2>" + remainder})
										return
									}

								// extract emails
									var people = []
									for (var i in response.list) {
										var contact = response.list[i]
										people[i] = {
											name: (contact.firstName ? contact.firstName + " " : "") + (contact.middleName ? contact.middleName + " " : "") + (contact.lastName ? contact.lastName : ""),
											emails: []
										}
										if (contact.emails && Array.isArray(contact.emails) && contact.emails.length) {
											for (var j in contact.emails) {
												people[i].emails[j] = {
													value: contact.emails[j].value,
													label: contact.emails[j].label ? contact.emails[j].label.toLowerCase().replace(/\_/g, " ") : null
												}
											}
										}
									}

								// message (list people > list emails)
									var message = ""
									var responseHTML = "<ul>"
									for (var i in people) {
										responseHTML += "<li><b>" + people[i].name + "</b><br>"
										if (people[i].emails.length) {
											responseHTML += "<ul>"
											for (var j in people[i].emails) {
												message += people[i].name + "'s " + (people[i].emails[j].label ? people[i].emails[j].label : "email") + " is " + people[i].emails[j].value + " ... "
												responseHTML += "<li><a target='_blank' href='mailto:" + people[i].emails[j].value + "'>" + (people[i].emails[j].label ? (people[i].emails[j].label + ": ") : "") + people[i].emails[j].value + "</a></li>"
											}
											responseHTML += "</ul>"
										}
										responseHTML += "</li>"
									}
									responseHTML += "</ul>"

								// send response
									message = "I found " + people.length + (people.length == 1 ? "person" : "people") + ": " + message
									var url = "https://contacts.google.com/search/" + remainder
									responseHTML = "<a target='_blank' href='" + url + "'><h2>" + remainder + " emails</h2></a>" + responseHTML
									callback({icon: icon, message: message, html: responseHTML, url: url})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get contacts.", html: "<h2>Error: unable to get contacts:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get address": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f464;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// no remainder?
						remainder = remainder.replace(/[?!,:;"_\/\(\)\$\%]/gi,"").trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return	
						}

					// build options
						var options = {
							responseType: "json",
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=getContacts&name=" + remainder
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// not successful?
									if (!response.success) {
										callback({icon: icon, error: true, message: "I was unable to find " + remainder, html: "<h2>Error: unable to find contact:</h2>" + remainder})
										return
									}

								// extract addresses
									var people = []
									for (var i in response.list) {
										var contact = response.list[i]
										people[i] = {
											name: (contact.firstName ? contact.firstName + " " : "") + (contact.middleName ? contact.middleName + " " : "") + (contact.lastName ? contact.lastName : ""),
											addresses: []
										}
										if (contact.addresses && Array.isArray(contact.addresses) && contact.addresses.length) {
											for (var j in contact.addresses) {
												people[i].addresses[j] = {
													value: contact.addresses[j].value,
													label: contact.addresses[j].label ? contact.addresses[j].label.toLowerCase().replace(/\_/g, " ") : null
												}
											}
										}
									}

								// message (list people > list addresses)
									var message = ""
									var responseHTML = "<ul>"
									for (var i in people) {
										responseHTML += "<li><b>" + people[i].name + "</b><br>"
										if (people[i].addresses.length) {
											responseHTML += "<ul>"
											for (var j in people[i].addresses) {
												message += people[i].name + "'s " + (people[i].addresses[j].label ? people[i].addresses[j].label : "address") + " is " + people[i].addresses[j].value + " ... "
												responseHTML += "<li><a target='_blank' href='https://maps.google.com/?q=" + people[i].addresses[j].value + "'>" + (people[i].addresses[j].label ? (people[i].addresses[j].label + ": ") : "") + people[i].addresses[j].value + "</a></li>"
											}
											responseHTML += "</ul>"
										}
										responseHTML += "</li>"
									}
									responseHTML += "</ul>"

								// send response
									message = "I found " + people.length + (people.length == 1 ? "person" : "people") + ": " + message
									var url = "https://contacts.google.com/search/" + remainder
									responseHTML = "<a target='_blank' href='" + url + "'><h2>" + remainder + " addresses</h2></a>" + responseHTML
									callback({icon: icon, message: message, html: responseHTML, url: url})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get contacts.", html: "<h2>Error: unable to get contacts:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"draft email": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4e8;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script.", html: "<h2>Error: missing configuration:</h2><li>google apps script</li>"})
							return
						}

					// enter flow
						window.CONTEXT_LIBRARY.flow = "draft email"
						window.CONTEXT_LIBRARY["draft email"] = window.CONTEXT_LIBRARY["draft email"] || {
							recipient: null,
							subject: null,
							body: null,
						}

					// check what's missing
						var nextParameter = null
						for (var i in window.CONTEXT_LIBRARY["draft email"]) {
							if (!window.CONTEXT_LIBRARY["draft email"][i]) {
								nextParameter = i
								break
							}
						}

					// something missing
						if (nextParameter && remainder) {
							// clean remainder
								remainder = remainder.trim()

							// add it
								if (nextParameter == "recipient") {
									remainder = remainder.split(/ and |,\s?/gi).join(",")
								}

								window.CONTEXT_LIBRARY["draft email"][nextParameter] = remainder

							// get new nextParameter
								var nextParameter = null
								for (var i in window.CONTEXT_LIBRARY["draft email"]) {
									if (!window.CONTEXT_LIBRARY["draft email"][i]) {
										nextParameter = i
										break
									}
								}
						}

					// still something missing
						if (nextParameter) {
							// response
								var message = "What is the " + nextParameter + "?"
								var responseHTML = "<h2>" + nextParameter + " = ?</h2>" + 
									"<ul>" + Object.keys(window.CONTEXT_LIBRARY["draft email"]).map(function(key) {
										return "<li><b>" + key + ":</b> " + (window.CONTEXT_LIBRARY["draft email"][key] || "?") + "</li>"
									}).join("") + "</ul>"
								callback({icon: icon, message: message, html: responseHTML})
								return
						}

					// build options
						var options = {
							responseType: "json",
							url: window.CONFIGURATION_LIBRARY["google apps script"] + "&action=draftEmail" +
								"&recipient=" + encodeURI(window.CONTEXT_LIBRARY["draft email"].recipient) +
								"&subject=" + encodeURI(window.CONTEXT_LIBRARY["draft email"].subject) +
								"&body=" + encodeURI(window.CONTEXT_LIBRARY["draft email"].body)
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// not successful?
									if (!response.success) {
										callback({icon: icon, error: true, message: "I was unable to draft the email.", html: "<h2>Error: unable to draft email:</h2><pre style='text-align: left'>" + JSON.stringify(window.CONTEXT_LIBRARY["draft email"], null, '\t') + "</pre>"})
										return
									}

								// response
									var message = response.message + " ... " + response.draft.subject + " to " + response.draft.recipient.split(",").join(" and ")
									var url = "https://mail.google.com/mail/u/0/#drafts"
									var responseHTML = "<a target='_blank' href='" + url + "'><h2>new email draft</h2></a><ul>" +
										"<li><b>to</b><br>" + response.draft.recipient + "</li>" +
										"<li><b>subject</b><br>" + response.draft.subject + "</li>" +
										"<li><b>body</b><br>" + response.draft.body + "</li>" +
										"</ul>"
									callback({icon: icon, message: message, html: responseHTML, url: url})

								// end flow
									window.CONTEXT_LIBRARY.flow = null
									delete window.CONTEXT_LIBRARY["draft email"]
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to draft email.", html: "<h2>Error: unable to draft email:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"log gratitude": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f33b;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google apps script 2"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google apps script 2.", html: "<h2>Error: missing configuration:</h2><li>google apps script 2</li>"})
							return
						}

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I add?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// build options
						var options = {
							responseType: "json",
							url: window.CONFIGURATION_LIBRARY["google apps script 2"] + "&text=" + remainder
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// response
									var message = response.message
									var responseHTML = "<h2>" + response.message + "</h2>"
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to log gratitude.", html: "<h2>Error: unable to log gratitude:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// Google APIs
			"search google": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f50d;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google custom search"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google custom search.", html: "<h2>Error: missing configuration:</h2><li>google custom search</li>"})
							return
						}
						else if (!window.CONFIGURATION_LIBRARY["google api key"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google api key.", html: "<h2>Error: missing configuration:</h2></li>google api key</li>"})
							return
						}

					// no remainder
						remainder = remainder.trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}
						var word = remainder

					// that?
						if (remainder == "that" && window.CONTEXT_LIBRARY.lastResponseWord) {
							word = window.CONTEXT_LIBRARY.lastResponseWord
						}

					// options
						var options = {
							responseType: "json",
							url: window.CONFIGURATION_LIBRARY["google custom search"] + "&key=" + window.CONFIGURATION_LIBRARY["google api key"] + "&q=" + word
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// no results?
									if (!response.items || !response.items.length) {
										callback({icon: icon, error: true, message: "I found no results for " + remainder, html: "<h2>Error: no results:</h2>" + remainder})
										return
									}

								// all results
									var results = []
									for (var i in response.items) {
										var responseMessage = response.items[i].title + " " + response.items[i].snippet
										var url = response.items[i].link
										var responseHTML = "<a target='_blank' href='https://www.google.com/search?q=" + word + "'><h2>" + word + "</h2></a>" +
											"<p><a target='_blank' href='" + url + "'><b>" + response.items[i].title + "</b></a><br>" + response.items[i].snippet + "</p>"

										results.push({icon: icon, message: responseMessage, html: responseHTML, url: url, word: word})
									}

								// send response
									var firstResult = results.shift()
										firstResult.results = results
									callback(firstResult)
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get search results.", html: "<h2>Error: unable to get search results:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"google geolocate": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4cd;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google api key"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google api key.", html: "<h2>Error: missing configuration:</h2><li>google api key</li>"})
							return
						}

					// no remainder
						remainder = remainder.trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// options
						var options = {
							responseType: "json",
							url: "https://maps.googleapis.com/maps/api/geocode/json?key=" + window.CONFIGURATION_LIBRARY["google api key"] + "&address=" + remainder
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// no results?
									if (!response || !response.results || !response.results[0] || !response.results[0].geometry || !response.results[0].geometry.location) {
										callback({icon: icon, error: true, message: "I couldn't geolocate that.", html: "<h2>Error: unable to geolocate:</h2>" + remainder})
										return
									}

								// geolocation
									var latitude  = Number(response.results[0].geometry.location.lat.toFixed(7))
									var longitude = Number(response.results[0].geometry.location.lng.toFixed(7))
									var iframe = "<iframe src='https://maps.google.com/maps?q=" + latitude + "," + longitude + "&z=12&output=embed' width='600' height='400' frameborder='0' allowfullscreen></iframe>"

								// message & link
									var message = remainder + " is " + Math.abs(latitude) + " degrees " + (latitude > 0 ? "North" : latitude < 0 ? "South" : "") + ", " + Math.abs(longitude) + " degrees " + (longitude > 0 ? "East" : longitude < 0 ? "West" : "")
									var url = "https://www.google.com/maps/@" + latitude + "," + longitude +",12z"
									var responseHTML = "<a target='_blank' href='" + url + "'><h2>" + remainder + "</h2></a>" + iframe

								// response
									callback({icon: icon, message: message, html: responseHTML, url: url})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get search results.", html: "<h2>Error: unable to get search results:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"search google directions": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f5fa;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google api key"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google api key.", html: "<h2>Error: missing configuration:</h2><li>google api key</li>"})
							return
						}

					// no remainder
						remainder = " " + remainder.trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// split at keywords
						var origin = remainder.replace(/[?!,;'"_\(\)\$\%]/gi,"").split(/ leaving from | from | starting at | start at | etween | originating at | origin /gi)
							origin = (origin[1] || origin[0]).split(/ going to | go to | ending at | end at | to | and | arriving at | destination | for /gi)[0].trim()

						var destination = remainder.replace(/[?!,;'"_\(\)\$\%]/gi,"").split(/ going to | go to | ending at | end at | to | and | arriving at | destination | for /gi)
							destination = (destination[1] || destination[0]).split(/ leaving from | from | starting at | start at | between | originating at | origin /gi)[0].trim()

					// options
						var options = {
							responseType: "json",
							url: "https://maps.googleapis.com/maps/api/directions/json?key=" + window.CONFIGURATION_LIBRARY["google api key"] + "&origin=" + origin + "&destination=" + destination
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// no results?
									if (!response || !response.routes || !response.routes[0] || !response.routes[0].legs || !response.routes[0].legs[0]) {
										callback({icon: icon, error: true, message: "I couldn't find a route.", html: "<h2>Error: unable to find a route:</h2><li>from: " + origin + "</li><li>to: " + destination + "</li>"})
										return
									}

								// format response
									var route = response.routes[0]
									var distance = route.legs[0].distance.text
									var duration = route.legs[0].duration.text
									var origin = route.legs[0].start_address
									var destination = route.legs[0].end_address
									var steps = route.legs[0].steps.map(function(step) {
										return "<li><b>" + step.distance.text + " (" + step.duration.text + ")" + "</b><br>" + step.html_instructions + "</li>"
									}) || []

								// geolocation
									var latitude  = Number(route.legs[0].end_location.lat.toFixed(7))
									var longitude = Number(route.legs[0].end_location.lng.toFixed(7))
									var iframe = "<iframe src='https://maps.google.com/maps?q=" + latitude + "," + longitude + "&z=12&output=embed' width='600' height='400' frameborder='0' allowfullscreen></iframe>"

								// message & link
									var message = origin + " to " + destination + " is " + distance + " for " + duration + "."
									var url = "https://www.google.com/maps/dir/" + origin + "/" + destination
									var responseHTML = "<a target='_blank' href='" + url + "'><h2>" + origin + " to " + destination + "</h2></a>" +
										"<i>" + distance + " for " + duration + "</i><b2>" +
										"<ol>" + steps.join("") + "</ol>" + iframe

								// response
									callback({icon: icon, message: message, html: responseHTML, url: url})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get search results.", html: "<h2>Error: unable to get search results:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"search google places": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f5fa;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google api key"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google api key.", html: "<h2>Error: missing configuration:</h2><li>google api key</li>"})
							return
						}

					// no remainder
						remainder = remainder.trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// options
						var options = {
							responseType: "json",
							url: "https://maps.googleapis.com/maps/api/place/findplacefromtext/json?key=" + window.CONFIGURATION_LIBRARY["google api key"] + "&inputtype=textquery&fields=place_id&input=" + remainder
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// no results?
									if (!response || !response.candidates || !response.candidates[0] || !response.candidates[0].place_id) {
										callback({icon: icon, error: true, message: "I couldn't find that place.", html: "<h2>Error: unable to find place:</h2>" + remainder})
										return
									}

								// second trip, with place_id
									var place_id = response.candidates[0].place_id
									var options = {
										responseType: "json",
										url: "https://maps.googleapis.com/maps/api/place/details/json?key=" + window.CONFIGURATION_LIBRARY["google api key"] + "&inputtype=textquery&fields=name,photo,url,website,formatted_phone_number,formatted_address,geometry,opening_hours&place_id=" + place_id
									}

									window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
										try {
											// no results?
												if (!response || !response.result) {
													callback({icon: icon, error: true, message: "I couldn't find that place.", html: "<h2>Error: unable to find place:</h2>" + remainder})
													return
												}

											// get open now / hours
												var place = response.result
												if (place.opening_hours) {
													var openNow = "It's currently " + (place.opening_hours.open_now ? " open." : "closed.")
													var openHours = "<br><ul><li>" + place.opening_hours.weekday_text.join("</li><li>") + "</li></ul>"
												}
												else {
													var openNow = ""
													var openHours = ""
												}

											// geolocation
												var latitude  = Number(place.geometry.location.lat.toFixed(7))
												var longitude = Number(place.geometry.location.lng.toFixed(7))
												var iframe = "<iframe src='https://maps.google.com/maps?q=" + latitude + "," + longitude + "&z=12&output=embed' width='600' height='400' frameborder='0' allowfullscreen></iframe>"

											// message & html
												var message = "I found " + place.name + " at " + (place.formatted_address || "an unknown address") + ". " + openNow
												var url = place.url
												var responseHTML = "<h2>" + place.name + "</h2><ul>" + 
													"<li><a target='_blank' href='" + place.url + "'>" + (place.formatted_address || "<i>no address found</i>") + "</a></li>" + 
													"<li>" + (place.formatted_phone_number || "<i>no phone number found</i>") + "</li>" +
													"<li>" + (place.website ? ("<a target='_blank' href='" + place.website + "'>" + place.website + "</a>") : "<i>no website found</i>") + "</li>" + 
													"<li>hours: " + (openHours || "<i>no hours found</i>") + "</li>" +
													"</ul>" + iframe

											// response
												callback({icon: icon, message: message, html: responseHTML, url: url})
										}
										catch (error) {
											callback({icon: icon, error: true, message: "I was unable to get search results.", html: "<h2>Error: unable to get search results:</h2>" + error})
										}
									})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get search results.", html: "<h2>Error: unable to get search results:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"search youtube": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4fa;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["youtube api key"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for youtube api key.", html: "<h2>Error: missing configuration:</h2><li>youtube api key</li>"})
							return
						}

					// no remainder
						remainder = remainder.trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}
						var word = remainder

					// that?
						if (remainder == "that" && window.CONTEXT_LIBRARY.lastResponseWord) {
							word = window.CONTEXT_LIBRARY.lastResponseWord
						}

					// options
						var options = {
							responseType: "json",
							url: "https://www.googleapis.com/youtube/v3/search?key=" + window.CONFIGURATION_LIBRARY["youtube api key"] + "&part=snippet&type=video&videoEmbeddable=true&maxResults=10&order=viewCount&q=" + word
						}

					// proxy request
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// no results
									if (!response || !response.items || !response.items.length || !response.items[0].id || !response.items[0].id.videoId) {
										callback({icon: icon, error: true, message: "I couldn't find " + remainder + " on Youtube.", html: "<h2>Error: unable to find Youtube video:</h2>" + remainder})
										return
									}

								// all results
									var results = []
									for (var i in response.items) {
										var message = "Now playing " + response.items[i].snippet.title
										var randomID = window.FUNCTION_LIBRARY.generateRandom()
										var url = "https://www.youtube.com/embed/" + response.items[i].id.videoId + "?autoplay=1"
										var responseHTML = '<iframe id="' + randomID + '" width="560" height="315" src="' + url + '" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'
										results.push({icon: icon, message: message, html: responseHTML, followup: false, url: url, word: word, video: randomID})
									}

								// last video?
									if (window.CONTEXT_LIBRARY.lastResponseVideo) {
										window.FUNCTION_LIBRARY.stopVideo(window.CONTEXT_LIBRARY.lastResponseVideo)
									}

								// send response
									var firstResult = results.shift()
										firstResult.results = results
									callback(firstResult)
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get search results.", html: "<h2>Error: unable to get search results:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"google translate": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f30e;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google api key"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google api key.", html: "<h2>Error: missing configuration:</h2><li>google api key</li>"})
							return
						}

					// no remainder
						remainder = " " + remainder.trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I translate?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// split at keywords
						var components = remainder.split(/ to | in | into /gi)
						var phrase = components[0].trim()
						var language = components[1].trim().toLowerCase()

					// that?
						if (phrase == "that" && window.CONTEXT_LIBRARY.lastResponseWord) {
							phrase = window.CONTEXT_LIBRARY.lastResponseWord
						}

					// language code
						var languageCodes = {
							"amharic":		"am",
							"arabic":		"ar",
							"basque":		"eu",
							"bengali":		"bn",
							"bulgarian":	"bg",
							"catalan":		"ca",
							"cherokee":		"chr",
							"croatian":		"hr",
							"czech":		"cs",
							"danish":		"da",
							"dutch":		"nl",
							"english": 		"en",
							"estonian":		"et",
							"filipino":		"fil",
							"finnish":		"fi",
							"french":		"fr",
							"german":		"de",
							"greek":		"el",
							"gujarati":		"gu",
							"hebrew":		"iw",
							"hindi":		"hi",
							"hungarian":	"hu",
							"icelandic":	"is",
							"indonesian":	"id",
							"italian":		"it",
							"japanese":		"ja",
							"kannada":		"kn",
							"korean":		"ko",
							"latvian":		"lv",
							"lithuanian":	"lt",
							"malay":		"ms",
							"malayalam":	"ml",
							"marathi":		"mr",
							"norwegian":	"no",
							"polish":		"pl",
							"portuguese": 	"pt-PT",
							"romanian":		"ro",
							"russian":		"ru",
							"serbian":		"sr",
							"chinese": 		"zh-CN",
							"slovak":		"sk",
							"slovenian":	"sl",
							"spanish":		"es",
							"swahili":		"sw",
							"swedish":		"sv",
							"tamil":		"ta",
							"telugu":		"te",
							"thai":			"th",
							"turkish":		"tr",
							"urdu":			"ur",
							"ukrainian":	"uk",
							"vietnamese":	"vi",
							"welsh":		"cy"
						}
						var languageCode = languageCodes[language] || null

					// unidentified language
						if (!languageCode || !phrase) {
							callback({icon: icon, error: true, message: "I couldn't identify that language", html: "<h2>Error: unknown language:</h2>" + language})
							return
						}

					// options
						var options = {
							responseType: "json",
							url: "https://translation.googleapis.com/language/translate/v2?key=" + window.CONFIGURATION_LIBRARY["google api key"] + "&q=" + phrase + "&target=" + languageCode
						}

					// proxy request
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// no results
									if (!response.data || !response.data.translations || !response.data.translations[0] || !response.data.translations[0].translatedText) {
										callback({icon: icon, error: true, message: "I couldn't translate that phrase.", html: "<h2>Error: unable to access Google Translate:</h2>" + response})
										return
									}

								// translation
									var translation = response.data.translations[0].translatedText.replace(/\&\#39\;/gi, "'")
									
								// response
									var message = translation
									var url = "https://translate.google.com/?sl=en&tl=" + languageCode + "&text=" + phrase
									var responseHTML = "<a target='_blank' href='" + url + "'><h2>" + translation + "</h2></a>" +
										"<b>" + language + "</b> for \"<i>" + phrase + "</i>\""
									callback({icon: icon, message: message, html: responseHTML, url: url, language: languageCode, word: phrase})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to translate that phrase.", html: "<h2>Error: unable to get translation:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"search google timezone": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x231a;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["google api key"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for google api key.", html: "<h2>Error: missing configuration:</h2><li>google api key</li>"})
							return
						}

					// no remainder
						remainder = remainder.replace(/[?!:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What city should I get the timezone for?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// get longitude & latitude from locale
						if (!isNaN(remainder.split(/,\s?/gi)[0]) && !isNaN(remainder.split(/,\s?/gi)[1])) {
							var latitude  = Number(remainder.split(/,\s?/gi)[0])
							var longitude = Number(remainder.split(/,\s?/gi)[1])

							getTimeZone(latitude, longitude, callback)
							return
						}

					// geolocation
						// options
							var options = {
								responseType: "json",
								url: "https://maps.googleapis.com/maps/api/geocode/json?key=" + window.CONFIGURATION_LIBRARY["google api key"] + "&address=" + remainder
							}

						// proxy request to server
							window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
								try {
									// no results?
										if (!response || !response.results || !response.results[0] || !response.results[0].geometry || !response.results[0].geometry.location) {
											callback({icon: icon, error: true, message: "I couldn't geolocate that.", html: "<h2>Error: unable to geolocate:</h2>" + remainder})
											return
										}

									// geolocation
										var latitude  = Number(response.results[0].geometry.location.lat.toFixed(7))
										var longitude = Number(response.results[0].geometry.location.lng.toFixed(7))
										getTimeZone(latitude, longitude, callback)
										return
								}
								catch (error) {
									callback({icon: icon, error: true, message: "I was unable to get search results.", html: "<h2>Error: unable to get search results:</h2>" + error})
								}
							})

					// getTimeZone
						function getTimeZone(latitude, longitude, callback) {
							// options
								var options = {
									responseType: "json",
									url: "https://maps.googleapis.com/maps/api/timezone/json?key=" + window.CONFIGURATION_LIBRARY["google api key"] + "&location=" + latitude + "," + longitude + "&timestamp=" + Math.floor(new Date().getTime() / 1000)
								}

							// proxy request
								window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
									try {
										// no results
											if (!response.timeZoneName) {
												callback({icon: icon, error: true, message: "I couldn't find that timezone.", html: "<h2>Error: unable to access Google Time Zone:</h2>" + response})
												return
											}

										// date
											var timeZoneName = response.timeZoneName
											var timeZoneLocation = response.timeZoneId
											var timeZoneOffsetMS = (response.rawOffset + response.dstOffset) * 1000
											var currentTimeZoneOffsetMS = (new Date().getTimezoneOffset() * 60) * 1000 * -1
											var differenceMS = timeZoneOffsetMS - currentTimeZoneOffsetMS
											var number = Math.round(differenceMS / 1000 / 60 / 60)
											
										// response
											var message = (timeZoneLocation || "That location") + " is " + timeZoneName + " and is " + (!number ? "the same as" : (Math.abs(number) + " hour" + (Math.abs(number) == 1 ? " " : "s ") + (number < 0 ? "behind" : "ahead of"))) + " your current timezone."
											var responseHTML = "<h2>" + timeZoneName + "</h2>" +
												(!number ? "same as" : (Math.abs(number) + " hour" + (Math.abs(number) == 1 ? " " : "s ") + (number < 0 ? "behind" : "ahead of"))) + " current timezone"
											callback({icon: icon, message: message, html: responseHTML, number: number})
									}
									catch (error) {
										callback({icon: icon, error: true, message: "I couldn't find that timezone.", html: "<h2>Error: unable to access Google Time Zone:</h2>" + error})
									}
								})
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// games
			"play more or less": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4af;"

					// remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()

					// pick a number
						if (window.CONTEXT_LIBRARY.flow !== "play more or less") {
							window.CONTEXT_LIBRARY.flow = "play more or less"
							window.CONTEXT_LIBRARY["play more or less"] = {
								number: Math.floor(Math.random() * 100) + 1,
								guesses: 0
							}

							var message = "Okay, I'm thinking of a number between 1 and 100."
							var responseHTML = "<h2>number between 1 and 100</h2><li>Make a guess.</li><li>I'll tell you if my number is more or less.</li>"
							callback({icon: icon, message: message, html: responseHTML})
						}

					// interpret guess
						else {
							// gameState
								var gameState = window.CONTEXT_LIBRARY["play more or less"]

							// get guess
								var guess = Number(window.FUNCTION_LIBRARY.getDigits(remainder))

							// not a number
								if (isNaN(guess)) {
									callback({icon: icon, error: true, message: "I don't know that number.", html: "<h2>Error: invalid number:</h2>" + remainder})
									return
								}
							
							// increase guess count
								gameState.guesses++

							// correct
								if (guess == gameState.number) {
									// response
										var message = "You took " + gameState.guesses + " guess" + (gameState.guesses == 1 ? "" : "es") + " to find my number: " + gameState.number + "."
										var responseHTML = "<h2>" + gameState.guesses + " guess" + (gameState.guesses == 1 ? "" : "es") + "</h2><li>my number: <b>" + gameState.number + "</b></li>"
										callback({icon: icon, message: message, html: responseHTML, number: Number(gameState.number)})

									// end flow
										window.CONTEXT_LIBRARY.flow = null
										delete window.CONTEXT_LIBRARY["play more or less"]
								}

							// more
								else if (gameState.number > guess) {
									// response
										var message = "More than " + guess
										var responseHTML = "<h2>&uarr; &gt; " + guess + " &uarr;</h2>"
										callback({icon: icon, message: message, html: responseHTML})
								}

							// less
								else if (gameState.number < guess) {
									// response
										var message = "Less than " + guess
										var responseHTML = "<h2>&darr; &lt; " + guess + " &darr;</h2>"
										callback({icon: icon, message: message, html: responseHTML})
								}
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"play true or false": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4cb;"

					// remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()

					// initialize game
						if (window.CONTEXT_LIBRARY.flow !== "play true or false") {
							// options
								var options = {
									responseType: "json",
									url: "https://opentdb.com/api.php?amount=10&type=boolean"
								}

							// proxy to server
								window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
									try {
										// enter flow
											window.CONTEXT_LIBRARY.flow = "play true or false"
											window.CONTEXT_LIBRARY["play true or false"] = {
												score: 0,
												index: 0,
												questions: response.results
											}

										// gameState
											var gameState = window.CONTEXT_LIBRARY["play true or false"]

										// first question
											var question = gameState.questions[gameState.index].question
												question = question.replace(/(&#039;)/gi,"\'")
											var questionNumber = gameState.index + 1

										// response
											var message = "True or False: " + question
											var responseHTML = "<h2>True or False #" + questionNumber + "</h2>" + question
											callback({icon: icon, message: message, html: responseHTML})
									}
									catch (error) {
										window.CONTEXT_LIBRARY.flow = null
										delete window.CONTEXT_LIBRARY["play true or false"]
										callback({icon: icon, error: true, message: "I don't know any fun facts.", html: "<h2>Error: unable to access trivia</h2>"})
									}
								})
						}

					// interpret guess
						else {
							// gameState
								var gameState = window.CONTEXT_LIBRARY["play true or false"]

							// validate
								var guess = remainder

							// true / false
								if (guess.includes("true")) {
									guess = "True"
								}
								else if (guess.includes("false")) {
									guess = "False"
								}

							// other
								else {
									callback({icon: icon, error: true, message: "I only understand True and False.", html: "<h2>Error: invalid guess:</h2>" + remainder})
									return
								}

							// correct
								var correctAnswer = gameState.questions[gameState.index].correct_answer
								if (guess == correctAnswer) {
									gameState.score++
									var situation = guess.toUpperCase() + " is correct!"
								}

							// incorrect
								else {
									var situation = "Sorry, this is actually " + correctAnswer.toUpperCase() + "."
								}

							// advance
								if (gameState.index + 1 < gameState.questions.length) {
									// next question
										gameState.index++
										var nextQuestion = gameState.questions[gameState.index].question
										var nextQuestionNumber = gameState.index + 1

									// response
										var message = situation + " ... " + "Question " + nextQuestionNumber + ": True or False: " + nextQuestion
										var responseHTML = situation + "<br><h2>True or False #" + nextQuestionNumber + "</h2>" + nextQuestion
										callback({icon: icon, message: message, html: responseHTML})
								}

							// done
								else {
									// final score
										var finalScore = gameState.score || 0

									// end flow
										window.CONTEXT_LIBRARY.flow = null
										delete window.CONTEXT_LIBRARY["play true or false"]

									// response
										var message = situation + " ... " + "You got " + finalScore + " questions correct."
										var responseHTML = situation + "<br><h2>Final score: " + finalScore + "</h2>"
										callback({icon: icon, message: message, html: responseHTML})
								}
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"play blackjack": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f0a1;"

					// remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()

					// initialize
						if (window.CONTEXT_LIBRARY.flow !== "play blackjack") {
							// enter flow
								window.CONTEXT_LIBRARY.flow = "play blackjack"

							// create game state
								var gameState = window.CONTEXT_LIBRARY["play blackjack"] = {
									playable: false,
									roundWinner: null,
									turnLoop: null,
									deck: [],
									discard: [
										{symbol: "&spades;", suit: "spades",   value: 1, name: "Ace"}, {symbol: "&spades;", suit: "spades",   value: 2, name: 2}, {symbol: "&spades;", suit: "spades",   value: 3, name: 3}, {symbol: "&spades;", suit: "spades",   value: 4, name: 4}, {symbol: "&spades;", suit: "spades",   value: 5, name: 5}, {symbol: "&spades;", suit: "spades",   value: 6, name: 6}, {symbol: "&spades;", suit: "spades",   value: 7, name: 7}, {symbol: "&spades;", suit: "spades",   value: 8, name: 8}, {symbol: "&spades;", suit: "spades",   value: 9, name: 9}, {symbol: "&spades;", suit: "spades",   value: 10, name: 10}, {symbol: "&spades;", suit: "spades",   value: 10, name: "Jack"}, {symbol: "&spades;", suit: "spades",   value: 10, name: "Queen"}, {symbol: "&spades;", suit: "spades",   value: 10, name: "King"},
										{symbol: "&hearts;", suit: "hearts",   value: 1, name: "Ace"}, {symbol: "&hearts;", suit: "hearts",   value: 2, name: 2}, {symbol: "&hearts;", suit: "hearts",   value: 3, name: 3}, {symbol: "&hearts;", suit: "hearts",   value: 4, name: 4}, {symbol: "&hearts;", suit: "hearts",   value: 5, name: 5}, {symbol: "&hearts;", suit: "hearts",   value: 6, name: 6}, {symbol: "&hearts;", suit: "hearts",   value: 7, name: 7}, {symbol: "&hearts;", suit: "hearts",   value: 8, name: 8}, {symbol: "&hearts;", suit: "hearts",   value: 9, name: 9}, {symbol: "&hearts;", suit: "hearts",   value: 10, name: 10}, {symbol: "&hearts;", suit: "hearts",   value: 10, name: "Jack"}, {symbol: "&hearts;", suit: "hearts",   value: 10, name: "Queen"}, {symbol: "&hearts;", suit: "hearts",   value: 10, name: "King"},
										{symbol: "&clubs;",  suit: "clubs",    value: 1, name: "Ace"}, {symbol: "&clubs;",  suit: "clubs",    value: 2, name: 2}, {symbol: "&clubs;",  suit: "clubs",    value: 3, name: 3}, {symbol: "&clubs;",  suit: "clubs",    value: 4, name: 4}, {symbol: "&clubs;",  suit: "clubs",    value: 5, name: 5}, {symbol: "&clubs;",  suit: "clubs",    value: 6, name: 6}, {symbol: "&clubs;",  suit: "clubs",    value: 7, name: 7}, {symbol: "&clubs;",  suit: "clubs",    value: 8, name: 8}, {symbol: "&clubs;",  suit: "clubs",    value: 9, name: 9}, {symbol: "&clubs;",  suit: "clubs",    value: 10, name: 10}, {symbol: "&clubs;",  suit: "clubs",    value: 10, name: "Jack"}, {symbol: "&clubs;",  suit: "clubs",    value: 10, name: "Queen"}, {symbol: "&clubs;",  suit: "clubs",    value: 10, name: "King"},
										{symbol: "&diams;",  suit: "diamonds", value: 1, name: "Ace"}, {symbol: "&diams;",  suit: "diamonds", value: 2, name: 2}, {symbol: "&diams;",  suit: "diamonds", value: 3, name: 3}, {symbol: "&diams;",  suit: "diamonds", value: 4, name: 4}, {symbol: "&diams;",  suit: "diamonds", value: 5, name: 5}, {symbol: "&diams;",  suit: "diamonds", value: 6, name: 6}, {symbol: "&diams;",  suit: "diamonds", value: 7, name: 7}, {symbol: "&diams;",  suit: "diamonds", value: 8, name: 8}, {symbol: "&diams;",  suit: "diamonds", value: 9, name: 9}, {symbol: "&diams;",  suit: "diamonds", value: 10, name: 10}, {symbol: "&diams;",  suit: "diamonds", value: 10, name: "Jack"}, {symbol: "&diams;",  suit: "diamonds", value: 10, name: "Queen"}, {symbol: "&diams;",  suit: "diamonds", value: 10, name: "King"}
									],
									pot: 0,
									player: {
										chips: 10,
										bust: false,
										facedown: [],
										faceup: []
									},
									dealer: {
										chips: 10,
										bust: false,
										facedown: [],
										faceup: []
									}
								}

							// start
								var message = "I'll shuffle the deck."
								var responseHTML =  "<h2>dealer: $" + gameState.dealer.chips + "</h2>" + "<h2>player: $" + gameState.player.chips + "</h2>"
								callback({icon: icon, message: message, html: responseHTML, followup: false})

							// new round
								setTimeout(function() {
									startBlackjackRound()
								}, 3000)
						}

					// human turn
						else if (window.CONTEXT_LIBRARY["play blackjack"].playable) {
							// game state
								var gameState = window.CONTEXT_LIBRARY["play blackjack"]

							// hit
								if (remainder.includes("hit") || remainder.includes("another")) {
									// deal card
										dealBlackjackCard("player", "faceup")

									// display state
										displayBlackjackState()

									// 5-cards? dealer's turn
										var count = 1 + gameState.player.faceup.length
										if (count == 5) {
											gameState.playable = false
										}

									// bust? dealer's turn
										var bestSum = getBestBlackjackSum("player")
										if (!bestSum) {
											gameState.player.bust = true
											gameState.playable = false
										}
										else if (bestSum == 21) {
											gameState.playable = false	
										}
								}

							// stay
								else if (remainder.includes("stay") || remainder.includes("done")) {
									// response
										var message = "Okay, my turn."
										var responseHTML = "<h2>Dealer's turn.</h2>"
										callback({icon: icon, message: message, html: responseHTML, followup: false})

									// switch to dealer's turn
										gameState.playable = false
								}

							// other
								else {
									// response
										callback({icon: icon, error: true, message: "Sorry, I only understand hit and stay.", html: "<h2>Error: invalid response.</h2>"})
								}

							// player is done
								if (!gameState.playable) {
									// player busted?
										if (gameState.player.bust) {
											compareBlackjackHands()
										}

									// dealer's turn
										else {
											gameState.turnLoop = setInterval(function() {
												// get count
													var count = 1 + gameState.dealer.faceup.length

												// bust? compare
													var bestSum = getBestBlackjackSum("dealer")
													if (!bestSum) {
														gameState.dealer.bust = true
														compareBlackjackHands()
													}

												// continue
													else {
														// dealer hits on 16
															var playableSum = getBestBlackjackSum("dealer", 16)

															if (count < 5 && playableSum) {
																// deal card
																	dealBlackjackCard("dealer", "faceup")

																// display state
																	displayBlackjackState()
															}
														
														// compare hands
															else {
																compareBlackjackHands()
															}
													}
											}, 3000)
										}
								}
						}

					// deal card
						function dealBlackjackCard(who, how) {
							// gameState
								var gameState = window.CONTEXT_LIBRARY["play blackjack"]

							// no cards? shuffle discard
								if (!gameState.deck.length) {
									gameState.deck = window.FUNCTION_LIBRARY.sortRandom(gameState.discard)
									gameState.discard = []
								}

							// select a random card
								var index = Math.floor(Math.random() * gameState.deck.length)
								var card = gameState.deck[index]

							// pull it from the deck
								gameState.deck.splice(index, 1)

							// add it to the person's hand
								gameState[who][how].push(card)
						}

					// compareBlackjackHands
						function compareBlackjackHands() {
							// gameState
								var gameState = window.CONTEXT_LIBRARY["play blackjack"]

							// stop loop
								clearInterval(gameState.turnLoop)
								gameState.turnLoop = null

							// player busted?
								if (gameState.player.bust) {
									gameState.roundWinner = "dealer"
								}

							// dealer busted?
								else if (gameState.dealer.bust) {
									gameState.roundWinner = "player"
								}

							// both 21 and under
								else {
									// player sum
										var bestPlayerSum = getBestBlackjackSum("player")
										
									// dealer sum
										var bestDealerSum = getBestBlackjackSum("dealer")

									// winner
										if (bestPlayerSum > bestDealerSum) {
											gameState.roundWinner = "player"
										}
										else {
											gameState.roundWinner = "dealer"
										}
								}

							// chips
								gameState.pot -= 2
								gameState[gameState.roundWinner].chips += 2

							// display
								displayBlackjackState()

							// say "next round"
								if (gameState.player.chips && gameState.dealer.chips) {
									setTimeout(function() {
										callback({icon: icon, message: "Next round.", html: "<h2>next round</h2>", followup: false})
									}, 4000)
								}

							// next round
								setTimeout(function() {
									startBlackjackRound()
								}, 6000)
						}

					// startBlackjackRound
						function startBlackjackRound() {
							// gameState
								var gameState = window.CONTEXT_LIBRARY["play blackjack"]

							// game over?
								if (gameState.player.chips == 0) {
									// response
										var message = "The dealer wins the game."
										var responseHTML = "<h2>dealer wins</h2>"
										callback({icon: icon, message: message, html: responseHTML, followup: false})

									// end flow
										window.CONTEXT_LIBRARY.flow = null
										delete window.CONTEXT_LIBRARY["play blackjack"]
								}
								else if (gameState.dealer.chips == 0) {
									// response
										var message = "You win the game."
										var responseHTML = "<h2>player wins</h2>"
										callback({icon: icon, message: message, html: responseHTML, followup: false})

									// end flow
										window.CONTEXT_LIBRARY.flow = null
										delete window.CONTEXT_LIBRARY["play blackjack"]
								}

							// next round
								else {
									// discard player cards
										for (var i in gameState.player.facedown) {
											var card = gameState.player.facedown[i]
											gameState.discard.push(JSON.parse(JSON.stringify(card)))
										}
										for (var i in gameState.player.faceup) {
											var card = gameState.player.faceup[i]
											gameState.discard.push(JSON.parse(JSON.stringify(card)))
										}
										gameState.player.facedown = []
										gameState.player.faceup = []

									// discard dealer cards
										for (var i in gameState.dealer.facedown) {
											var card = gameState.dealer.facedown[i]
											gameState.discard.push(JSON.parse(JSON.stringify(card)))
										}
										for (var i in gameState.dealer.faceup) {
											var card = gameState.dealer.faceup[i]
											gameState.discard.push(JSON.parse(JSON.stringify(card)))
										}
										gameState.dealer.facedown = []
										gameState.dealer.faceup = []

									// deal cards (first deal includes shuffling)
										dealBlackjackCard("player", "facedown")
										dealBlackjackCard("player", "faceup")
										dealBlackjackCard("dealer", "facedown")
										dealBlackjackCard("dealer", "faceup")

									// chips
										gameState.player.chips -= 1
										gameState.dealer.chips -= 1
										gameState.pot += 2

									// reset bust
										gameState.player.bust = false
										gameState.dealer.bust = false

									// player's turn
										gameState.roundWinner = null
										gameState.playable = true

									// display
										displayBlackjackState()
								}
						}

					// getBestBlackjackSum
						function getBestBlackjackSum(who, limit, secret) {
							// gameState
								var gameState = window.CONTEXT_LIBRARY["play blackjack"]

							// limit
								var limit = limit || 21

							// possible sums
								var possibleSums = [((secret ?  0 : gameState[who].facedown[0].value) + gameState[who].faceup.map(function(card) { return card.value }).reduce(function(total, value) { return total + value }))]
								var aces = (secret ? 0 : (gameState[who].facedown[0].value == 1 ? 1 : 0))
								for (var i in gameState[who].faceup) {
									if (gameState[who].faceup[i].value == 1) {
										aces += 1
									}
								}
								for (var i = 0; i < aces; i++) {
									possibleSums.push(possibleSums[possibleSums.length - 1] + 10)
								}


							// sort sums
								possibleSums = possibleSums.sort(function(a,b) { return a - b })

							// get best sum
								var bestSum = 0
								for (var i in possibleSums) {
									if (bestSum < possibleSums[i] && possibleSums[i] <= limit) {
										bestSum = possibleSums[i]
									}
								}

							// return
								return bestSum
						}

					// displayBlackjackState
						function displayBlackjackState() {
							// gameState
								var gameState = window.CONTEXT_LIBRARY["play blackjack"]

							// sums
								var dealerSum = getBestBlackjackSum("dealer", null, gameState.roundWinner ? false : true)
								var playerSum = getBestBlackjackSum("player")

							// html
								var dealerHTML = gameState.roundWinner ? ("<li>[" + (gameState.dealer.facedown[0].name == 10 ? "10" : String(gameState.dealer.facedown[0].name).slice(0,1)) + gameState.dealer.facedown[0].symbol  + "]</li>" ): "<li>[???]</li>"
								for (var i in gameState.dealer.faceup) {
									dealerHTML += "<li>[" + (gameState.dealer.faceup[i].name == 10 ? "10" : String(gameState.dealer.faceup[i].name).slice(0,1)) + gameState.dealer.faceup[i].symbol + "]</li>"
								}

								var playerHTML = "<li>[" + (gameState.player.facedown[0].name == 10 ? "10" : String(gameState.player.facedown[0].name).slice(0,1)) + gameState.player.facedown[0].symbol + "]</li>"
								for (var i in gameState.player.faceup) {
									playerHTML += "<li>[" + (gameState.player.faceup[i].name == 10 ? "10" : String(gameState.player.faceup[i].name).slice(0,1)) + gameState.player.faceup[i].symbol + "]</li>"
								}

							// response
								var message = (gameState.dealer.bust || !dealerSum ? "Dealer busts. " : ("Dealer shows " + dealerSum + ". ")) +
									(gameState.player.bust || !playerSum ? "You bust. " : (("You have " + playerSum + ". ") +
									(gameState.playable && !gameState.player.bust && playerSum && playerSum !== 21 ? "Hit or stay? " : ""))) +
									(gameState.roundWinner ? (gameState.roundWinner + " wins. ") : "")
								var responseHTML = (gameState.pot ? ("<h2>pot: $" + gameState.pot + "</h2>") : "") +
									("<h2>dealer: $" + gameState.dealer.chips + "</h2>" + dealerHTML) +
									("<h2>player: $" + gameState.player.chips + "</h2>" + playerHTML)
								var followup = (gameState.playable && !gameState.player.bust && playerSum && playerSum !== 21) ? true : false
								callback({icon: icon, message: message, html: responseHTML, followup: followup})
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"play hangman": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f3dc;"

					// remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()

					// drawings
						var drawings = [
							"        \n" +
							"        \n" +
							"        \n" +
							"        \n" +
							"        \n" +
							"        \n",

							"        \n" +
							"        \n" +
							"        \n" +
							"      | \n" +
							"      | \n" +
							"  ____|_\n",

							"  ____  \n" +
							"  |   | \n" +
							"      | \n" +
							"      | \n" +
							"      | \n" +
							"  ____|_\n",

							"  ____  \n" +
							"  |   | \n" +
							"  O   | \n" +
							"      | \n" +
							"      | \n" +
							"  ____|_\n",

							"  ____  \n" +
							"  |   | \n" +
							"  O   | \n" +
							"  |   | \n" +
							"      | \n" +
							"  ____|_\n",

							"  ____  \n" +
							"  |   | \n" +
							"  O   | \n" +
							" -|   | \n" +
							"      | \n" +
							"  ____|_\n",

							"  ____  \n" +
							"  |   | \n" +
							"  O   | \n" +
							" -|-  | \n" +
							"      | \n" +
							"  ____|_\n",

							"  ____  \n" +
							"  |   | \n" +
							"  O   | \n" +
							" -|-  | \n" +
							" /    | \n" +
							"  ____|_\n",

							"  ____  \n" +
							"  |   | \n" +
							"  O   | \n" +
							" -|-  | \n" +
							" / \\  | \n" +
							"  ____|_\n"
						]

					// initialize game
						if (window.CONTEXT_LIBRARY.flow !== "play hangman") {
							// options
								var options = {
									responseType: "json",
									url: "http://random-word-api.herokuapp.com/word?number=100"
								}

							// proxy to server
								window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
									try {
										// get words between 6 and 12 letters long
											if (!Array.isArray(response)) {
												response = Array.from(response)
											}
											var words = response.filter(function(word) {
												return 5 < word.length && word.length < 13
											})

										// pick a random word
											var word = window.FUNCTION_LIBRARY.chooseRandom(words).toLowerCase().trim()
											var visibleLetters = []
											while (visibleLetters.length < word.length) {
												visibleLetters.push("_")
											}

										// start the flow
											window.CONTEXT_LIBRARY.flow = "play hangman"
											window.CONTEXT_LIBRARY["play hangman"] = {
												word: word,
												visibleLetters: visibleLetters,
												guessedLetters: [],
												wrongGuesses: 0,
											}

										// gameState
											var gameState = window.CONTEXT_LIBRARY["play hangman"]

										// message
											var message = "The word is " + gameState.word.length + " letters long. Guess a letter."
											var responseHTML = "<h2>" + gameState.visibleLetters.join(" ") + "</h2><pre>" + drawings[gameState.wrongGuesses] + "</pre>guesses: [" + gameState.guessedLetters.join(" ") + "]"

										// response
											callback({icon: icon, message: message, html: responseHTML})
									}
									catch (error) {
										window.CONTEXT_LIBRARY.flow = null
										delete window.CONTEXT_LIBRARY["play hangman"]
										callback({icon: icon, error: true, message: "I couldn't access the random word API.", html: "<h2>Error: unable to access random word API</h2>"})
									}
								})
						}

					// guess a letter
						else {
							// gameState
								var gameState = window.CONTEXT_LIBRARY["play hangman"]

							// identify letter
								var letter = null
								var phraseWords = remainder.split(/\s/gi)
								for (var i in phraseWords) {
									var temp = window.FUNCTION_LIBRARY.getLetters(phraseWords[i])
									if ((/^[a-z]{1}$/).test(temp)) {
										letter = temp
										break
									}
								}

							// no letter
								if (!letter) {
									callback({icon: icon, error: true, message: "I couldn't identify that letter.", html: "<h2>Error: invalid guess:</h2>" + remainder})
									return
								}

							// already guessed?
								else if (gameState.guessedLetters.includes(letter)) {
									callback({icon: icon, error: true, message: "You already guessed the letter '" + letter.toUpperCase() + "'.", html: "<h2>Error: duplicate guess:</h2>" + letter})
									return
								}

							// log guess
								gameState.guessedLetters.push(letter)

							// in word
								if (gameState.word.includes(letter)) {
									// update visible letters
										var count = 0
										var blanksCount = 0
										for (var i = 0; i < gameState.word.length; i++) {
											if (gameState.word[i] == letter) {
												count++
												gameState.visibleLetters[i] = letter
											}
											else if (gameState.visibleLetters[i] == "_") {
												blanksCount++
											}
										}

									// still more blanks?
										if (blanksCount) {
											// message
												var message = "The letter '" + letter.toUpperCase() + "' appears " + count + (count == 1 ? " time. " : "times. ") + "The word is now " + gameState.visibleLetters.map(function(l) { return l.replace("_", "blank").toUpperCase() }).join(", ")
												var responseHTML = "<h2>" + gameState.visibleLetters.join(" ") + "</h2><pre>" + drawings[gameState.wrongGuesses] + "</pre>guesses: [" + gameState.guessedLetters.join(" ") + "]"

											// response
												callback({icon: icon, message: message, html: responseHTML})
										}

									// game over (victory)
										else {
											// message
												gameState.visibleLetters = gameState.word.split("")
												var message = "You win. The word was " + gameState.word
												var responseHTML = "<h2>" + gameState.visibleLetters.join(" ") + "</h2><pre>" + drawings[gameState.wrongGuesses] + "</pre>guesses: [" + gameState.guessedLetters.join(" ") + "]"

											// response
												callback({icon: icon, message: message, html: responseHTML, word: gameState.word})

											// end flow
												window.CONTEXT_LIBRARY.flow = null
												delete window.CONTEXT_LIBRARY["play hangman"]
										}
								}

							// not in word
								else {
									// increment wrong guesses
										gameState.wrongGuesses++

									// game continues
										if (gameState.wrongGuesses < 8) {
											callback({icon: icon, message: "The word does not contain the letter '" + letter.toUpperCase() + "'.", html: "<h2>" + gameState.visibleLetters.join(" ") + "</h2><pre>" + drawings[gameState.wrongGuesses] + "</pre>guesses: [" + gameState.guessedLetters.join(" ") + "]"})
										}

									// game over (loss)
										else {
											// response
												gameState.visibleLetters = gameState.word.split("")
												var message = "You lose. The word was " + gameState.word
												var responseHTML = "<h2>" + gameState.visibleLetters.join(" ") + "</h2><pre>" + drawings[8] + "</pre>guesses: [" + gameState.guessedLetters.join(" ") + "]"
												callback({icon: icon, message: message, html: responseHTML, word: gameState.word})

											// end flow
												window.CONTEXT_LIBRARY.flow = null
												delete window.CONTEXT_LIBRARY["play hangman"]
										}
								}
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
	
		// IFTTT
			"trigger ifttt": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f916;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["ifttt key"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for ifttt key.", html: "<h2>Error: missing configuration:</h2><li>ifttt key</li>"})
							return
						}

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What action should I run?", html: "<h2>Error: invalid action</h2>"})
							return
						}

					// extract words
						var words = remainder.toLowerCase().split(/\s|_/gi)
						if (words[0] == "bluejay") {
							words.shift()
						}

					// build options
						var options = {
							method: "POST",
							responseType: "text",
							url: "https://maker.ifttt.com/trigger/bluejay_" + words.join("_") + "/with/key/" + window.CONFIGURATION_LIBRARY["ifttt key"]
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// no congratulations?
									if (!response.includes("Congratulations!")) {
										callback({icon: icon, error: true, message: "There was an issue triggering that IFTTT action.", html: "<h2>Error: IFTTT response:</h2>" + response})
										return
									}

								// specific or general?
									var the = ["all", "every", "each", "some"].includes(words[0]) ? "" : "the "

								// type
									if (words[words.length - 1] == "on") {
										var message = "I turned on " + the + words.slice(0,-1).join(" ")
									}
									else if (words[words.length - 1] == "off") {
										var message = "I turned off " + the + words.slice(0,-1).join(" ")
									}
									else if (words[words.length - 1] == "toggle") {
										var message = "I toggled " + the + words.slice(0,-1).join(" ")
									}

								// html
									var responseHTML = "<h2><a href='https://ifttt.com/home' target='_blank'>IFTTT</a> action: <b><code>" + words.join("_") + "</code></b></h2>"

								// response
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to trigger that IFTTT action.", html: "<h2>Error: unable to trigger IFTTT action:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"turn on ifttt device": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f916;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["ifttt key"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for ifttt key.", html: "<h2>Error: missing configuration:</h2><li>ifttt key</li>"})
							return
						}

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What action should I run?", html: "<h2>Error: invalid action</h2>"})
							return
						}

					// proxy to ifttt action
						window.ACTION_LIBRARY["trigger ifttt"](remainder.replace(/^the\s/i,"") + " on", callback)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"turn off ifttt device": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f916;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["ifttt key"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for ifttt key.", html: "<h2>Error: missing configuration:</h2><li>ifttt key</li>"})
							return
						}

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What action should I run?", html: "<h2>Error: invalid action</h2>"})
							return
						}

					// proxy to ifttt action
						window.ACTION_LIBRARY["trigger ifttt"](remainder.replace(/^the\s/i,"") + " off", callback)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"toggle ifttt device": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f916;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["ifttt key"]) {
							callback({icon: icon, error: true, message: "I'm not authorized to do that yet. Set a configuration for ifttt key.", html: "<h2>Error: missing configuration:</h2><li>ifttt key</li>"})
							return
						}

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What action should I run?", html: "<h2>Error: invalid action</h2>"})
							return
						}

					// proxy to ifttt action
						window.ACTION_LIBRARY["trigger ifttt"](remainder.replace(/^the\s/i,"") + " toggle", callback)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// SONOS
			"get sonos devices": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f3b6;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["api.sonos.com"] || !window.CONFIGURATION_LIBRARY["api.sonos.com"].access_token || !window.CONFIGURATION_LIBRARY["api.sonos.com"].expiration || window.CONFIGURATION_LIBRARY["api.sonos.com"].expiration < new Date().getTime()) {
							// attempt to reauthorize
								window.ACTION_LIBRARY["authorize platform"]("sonos", function(response) {
									callback(response)
									
									// now authorized? re-run this function
										if (window.CONFIGURATION_LIBRARY["api.sonos.com"] && window.CONFIGURATION_LIBRARY["api.sonos.com"].access_token && window.CONFIGURATION_LIBRARY["api.sonos.com"].expiration && window.CONFIGURATION_LIBRARY["api.sonos.com"].expiration >= new Date().getTime()) {
											window.ACTION_LIBRARY["get sonos devices"](remainder, callback)
										}
								})
								return
						}

					// build options
						var options = {
							responseType: "json",
							url: "https://api.ws.sonos.com/control/api/v1/households",
							Authorization: "Bearer " + window.CONFIGURATION_LIBRARY["api.sonos.com"].access_token
						}

					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// no households
									if (!response.households || !response.households.length) {
										callback({icon: icon, error: true, message: "I couldn't find any Sonos devices.", html: "<h2>Error: no devices found</h2>"})
										return
									}

								// devices
									window.CONFIGURATION_LIBRARY["api.sonos.com"].devices = window.CONFIGURATION_LIBRARY["api.sonos.com"].devices || {}

								// households
									var households = {}
									for (var i in response.households) {
										households[response.households[i].id] = {
											checked: false
										}
									}

								// get devices
									var devices = {}
									var householdKeys = Object.keys(households)
									for (var i in householdKeys) {
										// build options
											var options = {
												responseType: "json",
												url: "https://api.ws.sonos.com/control/api/v1/households/" + householdKeys[i] + "/groups",
												Authorization: "Bearer " + window.CONFIGURATION_LIBRARY["api.sonos.com"].access_token
											}

										// proxy
											window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
												try {
													// players
														for (var p in response.players) {
															var player = response.players[p]
																player.type = "player"
															devices[player.id] = player
														}

													// groups
														for (var g in response.groups) {
															var group = response.groups[g]
																group.type = "group"
															devices[group.id] = group
														}

													// check
														households[householdKeys[i]].checked = true

													// last one?
														if (!householdKeys.filter(function(key) { return !households[key].checked }).length) {
															//save devices to configuration library
																var value = window.CONFIGURATION_LIBRARY["api.sonos.com"]
																	value.devices = devices
																	value.households = households
																window.FUNCTION_LIBRARY.changeConfiguration({key: "api.sonos.com", value: value})

															// html
																var responseHTML = "<h2>Sonos devices</h2><ul>"
																for (var d in devices) {
																	responseHTML += "<li><b>" + devices[d].name + "</b> - [" + (devices[d].playbackState ? devices[d].playbackState.toLowerCase().replace("playback_state_", "") : "connected") + "]<br>" + devices[d].type + "</li>"
																}
																responseHTML += "</ul>"

															// response
																var message = "I found " + Object.keys(devices).length + " device" + (Object.keys(devices).length == 1 ? "" : "s") + " on Sonos."
																callback({icon: icon, message: message, html: responseHTML})
														}
												}
												catch (error) {
													callback({icon: icon, error: true, message: "I was unable to get some Sonos devices.", html: "<h2>Error: unable to get some Sonos devices:</h2>" + error})
												}
											})
									}
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get Sonos devices.", html: "<h2>Error: unable to get Sonos devices:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"set sonos devices": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f3b6;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["api.sonos.com"] || !window.CONFIGURATION_LIBRARY["api.sonos.com"].access_token || !window.CONFIGURATION_LIBRARY["api.sonos.com"].expiration || window.CONFIGURATION_LIBRARY["api.sonos.com"].expiration < new Date().getTime()) {
							// attempt to reauthorize
								window.ACTION_LIBRARY["authorize platform"]("sonos", function(response) {
									callback(response)
									
									// now authorized? re-run this function
										if (window.CONFIGURATION_LIBRARY["api.sonos.com"] && window.CONFIGURATION_LIBRARY["api.sonos.com"].access_token && window.CONFIGURATION_LIBRARY["api.sonos.com"].expiration && window.CONFIGURATION_LIBRARY["api.sonos.com"].expiration >= new Date().getTime()) {
											window.ACTION_LIBRARY["set sonos devices"](remainder, callback)
										}
								})
								return
						}

					// missing devices?
						else if (!window.CONFIGURATION_LIBRARY["api.sonos.com"].devices || !Object.keys(window.CONFIGURATION_LIBRARY["api.sonos.com"].devices).length) {
							// get devices first
								window.ACTION_LIBRARY["get sonos devices"](null, function(response) {
									callback(response)
									
									// devices set? re-run this function
										if (window.CONFIGURATION_LIBRARY["api.sonos.com"].devices && Object.keys(window.CONFIGURATION_LIBRARY["api.sonos.com"].devices).length) {
											window.ACTION_LIBRARY["set sonos devices"](remainder, callback)
										}
								})
								return
						}

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I adjust?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// split remainder
						var components = remainder.split(/ to | become | into | at /gi)
						var deviceName = components[0].trim().replace(/the /gi,"")
						var desiredState = window.FUNCTION_LIBRARY.getDigits(components[1].replace("percent","").trim())

					// replace number words with numbers
						deviceName = deviceName.split(/\s/gi)
						for (var word in deviceName) {
							deviceName[word] = window.FUNCTION_LIBRARY.getDigits(deviceName[word])
						}
						deviceName = deviceName.join(" ")

					// identify devices
						var deviceIds = []
						var groupIds = []
						if (["players", "speakers", "groups", "all players", "all speakers", "all groups", "all the players", "all the speakers", "all the groups", "all", "everything", "volume", "the volume"].includes(deviceName)) {
							var ids = Object.keys(window.CONFIGURATION_LIBRARY["api.sonos.com"].devices).filter(function(d) {
								return window.CONFIGURATION_LIBRARY["api.sonos.com"].devices[d].type == "group"
							}) || []
							for (var i in ids) {
								groupIds.push(ids[i])
							}
						}
						else {
							deviceNames = deviceName.split(" and ")
							for (var i in deviceNames) {
								var deviceId = Object.keys(window.CONFIGURATION_LIBRARY["api.sonos.com"].devices).find(function(d) {
									return window.CONFIGURATION_LIBRARY["api.sonos.com"].devices[d].name.toLowerCase() == deviceNames[i]
								}) || null
								if (deviceId) {
									if (window.CONFIGURATION_LIBRARY["api.sonos.com"].devices[deviceId].type == "group") {
										groupIds.push(deviceId)
									}
									else {
										deviceIds.push(deviceId)
									}
								}
							}
						}

					// no devices?
						if (!deviceIds.length && !groupIds.length) {
							callback({icon: icon, error: true, message: "I couldn't identify that device.", html: "<h2>Error: unable to identify device:</h2>" + deviceName})
							return
						}

					// identify state
						if (["on", "active", "powered", "unmuted", "unmute"].includes(desiredState)) {
							desiredState = {volumeDelta: 10}
						}
						else if (["off", "inactive", "unpowered", "muted", "mute"].includes(desiredState)) {
							desiredState = {volumeDelta: -100}
						}
						else if (["up", "more", "louder", "higher"].includes(desiredState)) {
							desiredState = {volumeDelta: 10}
						}
						else if (["down", "less", "quieter", "lower", "softer"].includes(desiredState)) {
							desiredState = {volumeDelta: -10}
						}
						else if (!isNaN(desiredState)) {
							desiredState = {volume: desiredState}
						}
						else if (["play", "playing"].includes(desiredState)) {
							desiredState = {playing: true}
						}
						else if (["paused", "pause", "stop"].includes(desiredState)) {
							desiredState = {playing: false}
						}
						else if (["next track", "next", "skip", "forward"].includes(desiredState)) {
							desiredState = {next: true}
						}
						else if (["previous track", "previous", "back"].includes(desiredState)) {
							desiredState = {previous: true}
						}
						else {
							callback({icon: icon, error: true, message: "I couldn't understand that desired state.", html: "<h2>Error: unable to set state:</h2>" + desiredState})
							return
						}

					// generate message & html
						var responseHTML = "<h2>Sonos devices updated</h2><ul>"
						for (var i in groupIds) {
							responseHTML += "<li>" + window.CONFIGURATION_LIBRARY["api.sonos.com"].devices[groupIds[i]].name + ": " + JSON.stringify(desiredState) + "</li>"
						}
						for (var i in deviceIds) {
							responseHTML += "<li>" + window.CONFIGURATION_LIBRARY["api.sonos.com"].devices[deviceIds[i]].name + ": " + JSON.stringify(desiredState) + "</li>"
						}
						responseHTML += "</ul>"
						var messageState = 	(desiredState.muted === true) ? "muted" :
											(desiredState.muted === false) ? "unmuted" :
											(desiredState.volume) ? (desiredState.volume + " percent") :
											(desiredState.volumeDelta) ? (Math.abs(desiredState.volumeDelta) + " percent " + (desiredState.volumeDelta > 0 ? " louder" : "quieter")) :
											(desiredState.playing === true) ? "playing" :
											(desiredState.playing === false) ? "paused" :
											(desiredState.next) ? "the next track" : 
											(desiredState.previous) ? "the previous track" : 
											"unknown"

					// response
						var message = "Okay, I set " + deviceName + " to " + messageState
						callback({icon: icon, message: message, html: responseHTML})

					// group ? --> attempt to set desiredState
						for (var i in groupIds) {
							// play / pause
								if (desiredState.playing === true) {
									var url = "https://api.ws.sonos.com/control/api/v1/groups/" + groupIds[i] + "/playback/play"
								}
								else if (desiredState.playing === false) {
									var url = "https://api.ws.sonos.com/control/api/v1/groups/" + groupIds[i] + "/playback/pause"
								}

							// next / previous
								else if (desiredState.next === true) {
									var url = "https://api.ws.sonos.com/control/api/v1/groups/" + groupIds[i] + "/playback/skipToNextTrack"
								}
								else if (desiredState.previous === true) {
									var url = "https://api.ws.sonos.com/control/api/v1/groups/" + groupIds[i] + "/playback/skipToPreviousTrack"
								}

							// volume (relative vs. absolute)
								else if (!isNaN(desiredState.volumeDelta)) {
									var url = "https://api.ws.sonos.com/control/api/v1/groups/" + groupIds[i] + "/groupVolume/relative"
								}
								else if (!isNaN(desiredState.volume)) {
									var url = "https://api.ws.sonos.com/control/api/v1/groups/" + groupIds[i] + "/groupVolume"
								}

							// build options
								var options = {
									method: "post",
									responseType: "json",
									url: url,
									Authorization: "Bearer " + window.CONFIGURATION_LIBRARY["api.sonos.com"].access_token,
									body: desiredState
								}

							// proxy
								window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
									try {
										if (response.errors && response.errors.length) {
											callback({icon: icon, error: true, message: "I was unable to update a device.", html: "<h2>Error: Sonos responded with these errors:</h2><li>" + response.errors.join("</li><li>") + "</li>"})
										}
									}
									catch (error) {
										callback({icon: icon, error: true, message: "I was unable to update a device.", html: "<h2>Error: Sonos responded with these errors:</h2><li>" + error + "</li>"})
									}
								}, true)
						}

					// actually attempt to set the desiredState for each device
						for (var i in deviceIds) {
							// volume (relative vs. absolute)
								if (!isNaN(desiredState.volumeDelta)) {
									var url = "https://api.ws.sonos.com/control/api/v1/players/" + deviceIds[i] + "/playerVolume/relative"
								}
								else if (!isNaN(desiredState.volume)) {
									var url = "https://api.ws.sonos.com/control/api/v1/players/" + deviceIds[i] + "/playerVolume"
								}

							// build options
								var options = {
									method: "post",
									responseType: "json",
									url: url,
									Authorization: "Bearer " + window.CONFIGURATION_LIBRARY["api.sonos.com"].access_token,
									body: desiredState
								}

							// proxy
								window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
									try {
										if (response.errors && response.errors.length) {
											callback({icon: icon, error: true, message: "I was unable to update a device.", html: "<h2>Error: Sonos responded with these errors:</h2><li>" + response.errors.join("</li><li>") + "</li>"})
										}
									}
									catch (error) {
										callback({icon: icon, error: true, message: "I was unable to update a device.", html: "<h2>Error: Sonos responded with these errors:</h2><li>" + error + "</li>"})
									}
								}, true)
						}
						
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"turn off sonos device": function(remainder, callback) {
				try {
					// proxy to set sonos devices
						window.ACTION_LIBRARY["set sonos devices"]((remainder.trim() || "all speakers") + " to off", callback)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"turn on sonos device": function(remainder, callback) {
				try {
					// proxy to set sonos devices
						window.ACTION_LIBRARY["set sonos devices"]((remainder.trim() || "all speakers") + " to on", callback)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"turn up sonos device": function(remainder, callback) {
				try {
					// proxy to set sonos devices
						window.ACTION_LIBRARY["set sonos devices"]((remainder.trim() || "all speakers") + " to up", callback)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"turn down sonos device": function(remainder, callback) {
				try {
					// proxy to set sonos devices
						window.ACTION_LIBRARY["set sonos devices"]((remainder.trim() || "all speakers") + " to down", callback)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"pause sonos device": function(remainder, callback) {
				try {
					// proxy to set sonos devices
						window.ACTION_LIBRARY["set sonos devices"]((remainder.trim() || "all speakers") + " to pause", callback)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"play sonos device": function(remainder, callback) {
				try {
					// proxy to set sonos devices
						window.ACTION_LIBRARY["set sonos devices"]((remainder.trim() || "all speakers") + " to play", callback)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"play next on sonos": function(remainder, callback) {
				try {
					// proxy to set sonos devices
						window.ACTION_LIBRARY["set sonos devices"]((remainder.trim() || "all speakers") + " to next", callback)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"play previous on sonos": function(remainder, callback) {
				try {
					// proxy to set sonos devices
						window.ACTION_LIBRARY["set sonos devices"]((remainder.trim() || "all speakers") + " to previous", callback)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get now playing on sonos": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f3b6;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["api.sonos.com"] || !window.CONFIGURATION_LIBRARY["api.sonos.com"].access_token || !window.CONFIGURATION_LIBRARY["api.sonos.com"].expiration || window.CONFIGURATION_LIBRARY["api.sonos.com"].expiration < new Date().getTime()) {
							// attempt to reauthorize
								window.ACTION_LIBRARY["authorize platform"]("sonos", function(response) {
									callback(response)
									
									// now authorized? re-run this function
										if (window.CONFIGURATION_LIBRARY["api.sonos.com"] && window.CONFIGURATION_LIBRARY["api.sonos.com"].access_token && window.CONFIGURATION_LIBRARY["api.sonos.com"].expiration && window.CONFIGURATION_LIBRARY["api.sonos.com"].expiration >= new Date().getTime()) {
											window.ACTION_LIBRARY["get now playing on sonos"](remainder, callback)
										}
								})
								return
						}

					// missing devices?
						else if (!window.CONFIGURATION_LIBRARY["api.sonos.com"].devices || !Object.keys(window.CONFIGURATION_LIBRARY["api.sonos.com"].devices).length) {
							// get devices first
								window.ACTION_LIBRARY["get sonos devices"](null, function(response) {
									callback(response)
									
									// devices set? re-run this function
										if (window.CONFIGURATION_LIBRARY["api.sonos.com"].devices && Object.keys(window.CONFIGURATION_LIBRARY["api.sonos.com"].devices).length) {
											window.ACTION_LIBRARY["get now playing on sonos"](remainder, callback)
										}
								})
								return
						}

					// identify groups
						var groups = []
						for (var i in window.CONFIGURATION_LIBRARY["api.sonos.com"].devices) {
							if (window.CONFIGURATION_LIBRARY["api.sonos.com"].devices[i].type == "group") {
								groups.push({
									checked: false,
									id: window.CONFIGURATION_LIBRARY["api.sonos.com"].devices[i].id,
									name: window.CONFIGURATION_LIBRARY["api.sonos.com"].devices[i].name,
									nowPlaying: null
								})
							}
						}

					// loop through groups
						for (var i in groups) {
							// build options
								var options = {
									responseType: "json",
									url: "https://api.ws.sonos.com/control/api/v1/groups/" + groups[i].id + "/playbackMetadata",
									Authorization: "Bearer " + window.CONFIGURATION_LIBRARY["api.sonos.com"].access_token
								}

							// proxy to server
								window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
									try {
										// save info
											groups[i].checked = true
											groups[i].nowPlaying = response

										// last one?
											if (!groups.filter(function(group) { return !group.checked }).length) {
												// build message & html
													var message = ""
													var responseHTML = ""
													for (var j in groups) {
														var track = groups[j].nowPlaying.currentItem ? groups[j].nowPlaying.currentItem.track || null : null
														var word = track.name

														message += word + (track.artist ? " by " + track.artist.name : "") + " is playing on " + groups[j].name + " ... "

														responseHTML += "<h2>" + groups[j].name + "</h2><table>" +
															"<tr><th rowspan='4'><img src='" + track.imageUrl + "'></th><td><h2>" + word + "</h2></a></td></tr>" + 
															"<tr>" + 								"<td>by <b>" + (track.artist ? track.artist.name : "???") + "</b></td></tr>" +
															"<tr>" + 								"<td>from <b>" + (track.album ? track.album.name : "???") + "</b></td></tr>" +
															"<tr>" + 								"<td>via <b>" + (track.service ? track.service.name : "???") + "</b></td></tr>" +
														"</table>"
													}

												// response
													callback({icon: icon, message: message, html: responseHTML, word: word})
											}
									}
									catch (error) {
										callback({icon: icon, error: true, message: "I was unable to get that Sonos group.", html: "<h2>Error: unable to get Sonos group:</h2>" + error})
									}
								})
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get favorites on sonos": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f3b6;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["api.sonos.com"] || !window.CONFIGURATION_LIBRARY["api.sonos.com"].access_token || !window.CONFIGURATION_LIBRARY["api.sonos.com"].expiration || window.CONFIGURATION_LIBRARY["api.sonos.com"].expiration < new Date().getTime()) {
							// attempt to reauthorize
								window.ACTION_LIBRARY["authorize platform"]("sonos", function(response) {
									callback(response)
									
									// now authorized? re-run this function
										if (window.CONFIGURATION_LIBRARY["api.sonos.com"] && window.CONFIGURATION_LIBRARY["api.sonos.com"].access_token && window.CONFIGURATION_LIBRARY["api.sonos.com"].expiration && window.CONFIGURATION_LIBRARY["api.sonos.com"].expiration >= new Date().getTime()) {
											window.ACTION_LIBRARY["get favorites on sonos"](remainder, callback)
										}
								})
								return
						}

					// missing households?
						else if (!window.CONFIGURATION_LIBRARY["api.sonos.com"].households || !Object.keys(window.CONFIGURATION_LIBRARY["api.sonos.com"].households).length) {
							// get households first
								window.ACTION_LIBRARY["get sonos devices"](null, function(response) {
									callback(response)
									
									// devices set? re-run this function
										if (window.CONFIGURATION_LIBRARY["api.sonos.com"].households && Object.keys(window.CONFIGURATION_LIBRARY["api.sonos.com"].households).length) {
											window.ACTION_LIBRARY["get favorites on sonos"](remainder, callback)
										}
								})
								return
						}

					// loop through households to uncheck
						var households = window.CONFIGURATION_LIBRARY["api.sonos.com"].households
						for (var i in households) {
							households[i].checked = false
						}

					// loop through households
						var favorites = []
						for (var i in households) {
							// build options
								var options = {
									responseType: "json",
									url: "https://api.ws.sonos.com/control/api/v1/households/" + i + "/favorites",
									Authorization: "Bearer " + window.CONFIGURATION_LIBRARY["api.sonos.com"].access_token
								}

							// proxy to server
								window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
									try {
										// save info
											households[i].checked = true

											if (response.items) {
												favorites = favorites.concat(response.items)
											}

										// last one?
											if (!Object.keys(households).filter(function(id) { return !households[id].checked }).length) {
												// sort favorites
													if (favorites && favorites.length > 1) {
														favorites = favorites.sort(function(a,b) {
															return Number(a.id) - Number(b.id)
														})
													}

												//save favorites to configuration library
													var value = window.CONFIGURATION_LIBRARY["api.sonos.com"]
														value.favorites = favorites
													window.FUNCTION_LIBRARY.changeConfiguration({key: "api.sonos.com", value: value})

												// build message & html
													var message = "I found " + favorites.length + " favorite item" + (favorites.length == 1 ? "" : "s") + " on Sonos."
													var responseHTML = "<h2>Sonos favorites</h2><ul>"
													for (var f in favorites) {															
														responseHTML += "<li><b>#" + favorites[f].id + ": </b>" + favorites[f].name + "<br><i>" + favorites[f].description + "</i></li>"
													}
													responseHTML += "</ul>"

												// response
													callback({icon: icon, message: message, html: responseHTML})
											}
									}
									catch (error) {
										callback({icon: icon, error: true, message: "I was unable to get that Sonos household.", html: "<h2>Error: unable to get Sonos household:</h2>" + error})
									}
								})
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"play favorite on sonos": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f3b6;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["api.sonos.com"] || !window.CONFIGURATION_LIBRARY["api.sonos.com"].access_token || !window.CONFIGURATION_LIBRARY["api.sonos.com"].expiration || window.CONFIGURATION_LIBRARY["api.sonos.com"].expiration < new Date().getTime()) {
							// attempt to reauthorize
								window.ACTION_LIBRARY["authorize platform"]("sonos", function(response) {
									callback(response)
									
									// now authorized? re-run this function
										if (window.CONFIGURATION_LIBRARY["api.sonos.com"] && window.CONFIGURATION_LIBRARY["api.sonos.com"].access_token && window.CONFIGURATION_LIBRARY["api.sonos.com"].expiration && window.CONFIGURATION_LIBRARY["api.sonos.com"].expiration >= new Date().getTime()) {
											window.ACTION_LIBRARY["play favorite on sonos"](remainder, callback)
										}
								})
								return
						}

					// missing devices?
						else if (!window.CONFIGURATION_LIBRARY["api.sonos.com"].devices || !Object.keys(window.CONFIGURATION_LIBRARY["api.sonos.com"].devices).length) {
							// get devices first
								window.ACTION_LIBRARY["get sonos devices"](null, function(response) {
									callback(response)
									
									// devices set? re-run this function
										if (window.CONFIGURATION_LIBRARY["api.sonos.com"].devices && Object.keys(window.CONFIGURATION_LIBRARY["api.sonos.com"].devices).length) {
											window.ACTION_LIBRARY["play favorite on sonos"](remainder, callback)
										}
								})
								return
						}

					// missing favorites?
						else if (!window.CONFIGURATION_LIBRARY["api.sonos.com"].favorites || !Object.keys(window.CONFIGURATION_LIBRARY["api.sonos.com"].favorites).length) {
							// get favorites first
								window.ACTION_LIBRARY["get favorites on sonos"](null, function(response) {
									callback(response)
									
									// devices set? re-run this function
										if (window.CONFIGURATION_LIBRARY["api.sonos.com"].favorites && Object.keys(window.CONFIGURATION_LIBRARY["api.sonos.com"].favorites).length) {
											window.ACTION_LIBRARY["play favorite on sonos"](remainder, callback)
										}
								})
								return
						}

					// remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I play?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// get numbers
						var words = remainder.toLowerCase().split(/\s/gi)
						for (var i in words) {
							words[i] = window.FUNCTION_LIBRARY.getDigits(words[i].trim())
						}
						words = words.join("").replace(/\s/gi,"")

					// get favorite id
						var favorite = null
						if (isNaN(words)) {
							favorite = window.CONFIGURATION_LIBRARY["api.sonos.com"].favorites.find(function(favorite) {
								return favorite.name.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().replace(/\s/gi,"") == words
							}) || null
						}
						else if (!isNaN(words)) {
							favorite = window.CONFIGURATION_LIBRARY["api.sonos.com"].favorites.find(function(favorite) {
								return favorite.id.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().replace(/\s/gi,"") == words
							}) || null
						}

					// not found?
						if (!favorite) {
							callback({icon: icon, error: true, message: "I couldn't find that favorite.", html: "<h2>Error: invalid favorite name or id:</h2>" + remainder})
							return
						}

					// groupIds
						var groupIds = []
						var ids = Object.keys(window.CONFIGURATION_LIBRARY["api.sonos.com"].devices).filter(function(d) {
							return window.CONFIGURATION_LIBRARY["api.sonos.com"].devices[d].type == "group"
						}) || []
						for (var i in ids) {
							groupIds.push(ids[i])
						}

					// no devices?
						if (!groupIds.length) {
							callback({icon: icon, error: true, message: "I couldn't find any groups.", html: "<h2>Error: unable to find groups.</h2>"})
							return
						}

					// respond
						var message = "Now playing " + favorite.name
						var responseHTML = "<h2>#" + favorite.id + ": " + favorite.name + "</h2>" + 
							favorite.description + 
							(favorite.imageUrl ? ("<br><img src='" + favorite.imageUrl + "'>") : "")
						callback({icon: icon, message: message, html: responseHTML})

					// loop through groups
						for (var i in groupIds) {
							// build options
								var options = {
									method: "post",
									responseType: "json",
									url: "https://api.ws.sonos.com/control/api/v1/groups/" + groupIds[i] + "/favorites",
									Authorization: "Bearer " + window.CONFIGURATION_LIBRARY["api.sonos.com"].access_token,
									body: {
										favoriteId: favorite.id,
										playOnCompletion: true,
										playModes: {
											shuffle: true
										}
									}
								}

							// proxyRequest
								window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
									try {
										if (response.errors && response.errors.length) {
											callback({icon: icon, error: true, message: "I was unable to update a device.", html: "<h2>Error: Sonos responded with these errors:</h2><li>" + response.errors.join("</li><li>") + "</li>"})
										}
									}
									catch (error) {
										callback({icon: icon, error: true, message: "I was unable to update a device.", html: "<h2>Error: Sonos responded with these errors:</h2><li>" + error + "</li>"})
									}
								}, true)
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// Wink
			"get wink devices": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4a1;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["api.wink.com"] || !window.CONFIGURATION_LIBRARY["api.wink.com"].access_token || !window.CONFIGURATION_LIBRARY["api.wink.com"].expiration || window.CONFIGURATION_LIBRARY["api.wink.com"].expiration < new Date().getTime()) {
							// attempt to reauthorize
								window.ACTION_LIBRARY["authorize platform"]("wink", function(response) {
									callback(response)
									
									// now authorized? re-run this function
										if (window.CONFIGURATION_LIBRARY["api.wink.com"] && window.CONFIGURATION_LIBRARY["api.wink.com"].access_token && window.CONFIGURATION_LIBRARY["api.wink.com"].expiration && window.CONFIGURATION_LIBRARY["api.wink.com"].expiration >= new Date().getTime()) {
											window.ACTION_LIBRARY["get wink devices"](remainder, callback)
										}
								})
								return
						}

					// build options
						var options = {
							responseType: "json",
							url: "https://api.wink.com/users/me/wink_devices?client_id=" + window.CONFIGURATION_LIBRARY["wink key"] + "&client_secret=" + window.CONFIGURATION_LIBRARY["wink secret"],
							Authorization: "Bearer " + window.CONFIGURATION_LIBRARY["api.wink.com"].access_token
						}
						
					// proxy
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// loop through response data to build out devices
									var devices = {}
									for (var i in response.data) {
										// get device info & save to device
											var device = {
												uuid: response.data[i].uuid,
												name: response.data[i].name,
												model_name: response.data[i].model_name,
												current_state: null,
												type: null
											}
											devices[device.uuid] = device

										// get device type & current state
											if (response.data[i].light_bulb_id) {
												device.type = "light_bulb"
												device.current_state = response.data[i].last_reading.connection ? (response.data[i].last_reading.powered ? "on" : "off") : "disconnected"
											}
											else if (response.data[i].smoke_detector_id) {
												device.type = "smoke_detector"
												device.current_state = response.data[i].last_reading.connection ? (response.data[i].last_reading.co_detected ? "CO!" : "no CO") + " & " + (response.data[i].last_reading.smoke_detected ? "smoke!" : "no smoke") : "disconnected"
											}
											else if (response.data[i].air_conditioner_id) {
												device.type = "air_conditioner"
												device.current_state = response.data[i].last_reading.connection ? (Math.round((response.data[i].last_reading.temperature * 9 / 5) + 32) + "F") : "disconnected"
											}
											else if (response.data[i].thermostat_id) {
												device.type = "thermostat"
												device.current_state = response.data[i].last_reading.connection ? (Math.round((response.data[i].last_reading.temperature * 9 / 5) + 32) + "F") : "disconnected"
											}
											else if (response.data[i].outlets) {
												device.type = "powerstrip"
												device.current_state = response.data[i].last_reading.connection ? "connected" : "disconnected"

												for (var j in response.data[i].outlets) {
													var subdevice = {
														uuid: response.data[i].outlets[j].uuid,
														name: response.data[i].outlets[j].name,
														model_name: device.model_name + " (outlet)",
														type: "outlet",
														current_state: response.data[i].last_reading.connection ? (response.data[i].outlets[j].last_reading.powered ? "on" : "off") : "disconnected"
													}
													devices[subdevice.uuid] = subdevice
												}
											}
											else {
												device.type = "hub"
												device.current_state = response.data[i].last_reading.connection ? "connected" : "disconnected"
											}
									}
								
								//save devices to configuration library
									var value = window.CONFIGURATION_LIBRARY["api.wink.com"]
										value.devices = devices
									window.FUNCTION_LIBRARY.changeConfiguration({key: "api.wink.com", value: value})

								// assume no lights, no temperature, no smoke
									var lightsOn = 0
									var temperature = 0
									var smoke = 0
									var responseHTML = "<h2>Wink devices</h2><ul>"

								// loop through devices
									for (var i in devices) {
										responseHTML += "<li><b>" + devices[i].name + "</b> - [" + (devices[i].current_state || "") + "]<br>" + devices[i].model_name + "</li>"

										// lights
											if (devices[i].type == "light_bulb" && devices[i].current_state == "on") {
												lightsOn++
											}

										// temperature
											else if (devices[i].type == "thermostat" && devices[i].current_state !== "disconnected") {
												temperature = devices[i].current_state.replace("F", "")
											}

										// smoke
											else if (devices[i].type == "smoke_detector" && devices[i].current_state !== "disconnected") {
												if (devices[i].current_state.includes("smoke!") || devices[i].current_state.includes("CO!")) {
													smoke = 1
												}
											}
									}
									responseHTML += "</ul>"

								// messages
									var message = (smoke ? "The smoke detector has detected a threat. " : "") +
										"I detected " + Object.keys(devices).length + " devices on Wink. " +
										"The temperature is " + temperature + " degrees. " +
										"There are " + lightsOn + " lights on."

								// response
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to get wink devices.", html: "<h2>Error: unable to get Wink devices:</h2>" + error})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"set wink devices": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4a1;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["api.wink.com"] || !window.CONFIGURATION_LIBRARY["api.wink.com"].access_token || !window.CONFIGURATION_LIBRARY["api.wink.com"].expiration || window.CONFIGURATION_LIBRARY["api.wink.com"].expiration < new Date().getTime()) {
							// attempt to reauthorize
								window.ACTION_LIBRARY["authorize platform"]("wink", function(response) {
									callback(response)
									
									// now authorized? re-run this function
										if (window.CONFIGURATION_LIBRARY["api.wink.com"] && window.CONFIGURATION_LIBRARY["api.wink.com"].access_token && window.CONFIGURATION_LIBRARY["api.wink.com"].expiration && window.CONFIGURATION_LIBRARY["api.wink.com"].expiration >= new Date().getTime()) {
											window.ACTION_LIBRARY["set wink devices"](remainder, callback)
										}
								})
								return
						}

					// missing devices?
						else if (!window.CONFIGURATION_LIBRARY["api.wink.com"].devices || !Object.keys(window.CONFIGURATION_LIBRARY["api.wink.com"].devices).length) {
							// get devices first
								window.ACTION_LIBRARY["get wink devices"](null, function(response) {
									callback(response)
									
									// devices set? re-run this function
										if (window.CONFIGURATION_LIBRARY["api.wink.com"].devices && Object.keys(window.CONFIGURATION_LIBRARY["api.wink.com"].devices).length) {
											window.ACTION_LIBRARY["set wink devices"](remainder, callback)
										}
								})
								return
						}

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I adjust?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// split remainder
						var components = remainder.split(/ to | become | into | at /gi)
						var deviceName = components[0].trim().replace(/the /gi,"")
						var desiredState = window.FUNCTION_LIBRARY.getDigits(components[1].trim())

					// replace number words with numbers
						deviceName = deviceName.split(/\s/gi)
						for (var word in deviceName) {
							deviceName[word] = window.FUNCTION_LIBRARY.getDigits(deviceName[word])
						}
						deviceName = deviceName.join(" ")

					// groups
						var group = null
						if (["all lights"].includes(deviceName)) {
							group = "lights"
						}
						else if (["temperature", "thermostat", "heat", "air conditioner", "air conditioning", "fan"].includes(deviceName)) {
							group = "temperature"
						}

					// identify devices
						var deviceIds = []
						if (group == "lights") {
							deviceIds = Object.keys(window.CONFIGURATION_LIBRARY["api.wink.com"].devices).filter(function(d) {
								return window.CONFIGURATION_LIBRARY["api.wink.com"].devices[d].type == "light_bulb"
							}) || []
						}
						else if (group == "temperature") {
							deviceIds = Object.keys(window.CONFIGURATION_LIBRARY["api.wink.com"].devices).filter(function(d) {
								return ["air_conditioner", "thermostat"].includes(window.CONFIGURATION_LIBRARY["api.wink.com"].devices[d].type)
							}) || []
						}
						else {
							deviceNames = deviceName.split(" and ")
							for (var i in deviceNames) {
								var deviceId = Object.keys(window.CONFIGURATION_LIBRARY["api.wink.com"].devices).find(function(d) {
									return window.CONFIGURATION_LIBRARY["api.wink.com"].devices[d].name.toLowerCase() == deviceNames[i]
								}) || null
								if (deviceId) {
									deviceIds.push(deviceId)
								}
							}
						}

					// no devices?
						if (!deviceIds.length) {
							callback({icon: icon, error: true, message: "I couldn't identify that device.", html: "<h2>Error: unable to identify device:</h2>" + deviceName})
							return
						}

					// identify state
						if (["on", "active", "powered"].includes(desiredState)) {
							desiredState = {powered: true}
						}
						else if (["off", "inactive", "unpowered"].includes(desiredState)) {
							desiredState = {powered: false}
						}
						else if (!isNaN(desiredState) && group == "temperature") {
							var farenheit = Number(desiredState) + " degrees"
							var celsius = (desiredState - 32) * 5 / 9
							desiredState = {max_set_point: celsius, min_set_point: celsius}
						}
						else {
							callback({icon: icon, error: true, message: "I couldn't understand that desired state.", html: "<h2>Error: unable to set state:</h2>" + desiredState})
							return
						}

					// generate message & html
						var responseHTML = "<h2>Wink devices updated</h2><ul>"
						for (var i in deviceIds) {
							responseHTML += "<li>" + window.CONFIGURATION_LIBRARY["api.wink.com"].devices[deviceIds[i]].name + ": " + JSON.stringify(desiredState) + "</li>"
						}
						responseHTML += "</ul>"
						var messageState = (desiredState.powered === true) ? "on" : (desiredState.powered === false) ? "off" : (desiredState.max_set_point || desiredState.min_set_point) ? farenheit : "unknown"

					// response
						var message = "Okay, I set " + deviceName + " to " + messageState
						callback({icon: icon, message: message, html: responseHTML})

					// actually attempt to set the desiredState for each device
						for (var i in deviceIds) {
							// build options
								var options = {
									method: "put",
									responseType: "json",
									url: "https://api.wink.com/" + window.CONFIGURATION_LIBRARY["api.wink.com"].devices[deviceIds[i]].type + "s/" + deviceIds[i] + "/desired_state?client_id=" + window.CONFIGURATION_LIBRARY["wink key"] + "&client_secret=" + window.CONFIGURATION_LIBRARY["wink secret"],
									Authorization: "Bearer " + window.CONFIGURATION_LIBRARY["api.wink.com"].access_token,
									body: {
										"desired_state": desiredState
									}
								}

							// proxy
								window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
									try {
										if (response.errors && response.errors.length) {
											callback({icon: icon, error: true, message: "I was unable to update a device.", html: "<h2>Error: Wink responded with these errors:</h2><li>" + response.errors.join("</li><li>") + "</li>"})
										}
									}
									catch (error) {
										callback({icon: icon, error: true, message: "I was unable to update a device.", html: "<h2>Error: Wink responded with these errors:</h2><li>" + error + "</li>"})
									}
								}, true)
						}
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"turn off wink device": function(remainder, callback) {
				try {
					// proxy to set wink devices
						window.ACTION_LIBRARY["set wink devices"](remainder + " to off", callback)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"turn on wink device": function(remainder, callback) {
				try {
					// proxy to set wink devices
						window.ACTION_LIBRARY["set wink devices"](remainder + " to on", callback)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// Reddit
			"get a reddit post": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f4bb;"

					// missing config?
						if (!window.CONFIGURATION_LIBRARY["www.reddit.com"] || !window.CONFIGURATION_LIBRARY["www.reddit.com"].access_token || !window.CONFIGURATION_LIBRARY["www.reddit.com"].expiration || window.CONFIGURATION_LIBRARY["www.reddit.com"].expiration < new Date().getTime()) {
							// attempt to reauthorize
								window.ACTION_LIBRARY["authorize platform"]("reddit", function(response) {
									callback(response)
									
									// now authorized? re-run this function
										if (window.CONFIGURATION_LIBRARY["www.reddit.com"] && window.CONFIGURATION_LIBRARY["www.reddit.com"].access_token && window.CONFIGURATION_LIBRARY["www.reddit.com"].expiration && window.CONFIGURATION_LIBRARY["www.reddit.com"].expiration >= new Date().getTime()) {
											window.ACTION_LIBRARY["get a reddit post"](remainder, callback)
										}
								})
								return
						}

					// subreddits
						var subreddits = ["askreddit", "showerthoughts", "writingprompts"]
						var selection = remainder.replace(/[?!,:;'"_\/\(\)\$\%]/gi,"").replace(/\s/gi,"").toLowerCase()

					// options
						var options = {
							responseType: "json",
							"User-Agent": "web:bluejay:v1 (by /u/quargy)",
							Authorization: "Bearer " + window.CONFIGURATION_LIBRARY["www.reddit.com"].access_token,
							url: "https://oauth.reddit.com/r/" + (subreddits.includes(selection) ? selection : "all")
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// shuffle results
									var posts = window.FUNCTION_LIBRARY.sortRandom(response.data.children)

								// all results
									var results = []
									for (var i in posts) {
										var message = posts[i].data.title
										var url = posts[i].data.url
										var responseHTML = "<a target='_blank' href='" + url + "'><h2>" + posts[i].data.title + "</h2></a>"
										results.push({icon: icon, message: message, html: responseHTML, url: url})
									}

								// send response
									var firstResult = results.shift()
										firstResult.results = results
									callback(firstResult)
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I can't access reddit.", html: "<h2>Error: unable to access reddit</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"ask reddit": function(remainder, callback) {
				try {
					// proxy to set get a reddit post
						window.ACTION_LIBRARY["get a reddit post"]("askreddit", callback)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get a reddit writing prompt": function(remainder, callback) {
				try {
					// proxy to set get a reddit post
						window.ACTION_LIBRARY["get a reddit post"]("writingprompts", callback)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"get a reddit shower thought": function(remainder, callback) {
				try {
					// proxy to set get a reddit post
						window.ACTION_LIBRARY["get a reddit post"]("showerthoughts", callback)
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},

		// custom APIs
			"convert": function(remainder, callback) {
				try {
					// icon
						var icon = "&#9878;"

					// no remainder
						remainder = " " + remainder.replace(/[?!,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I convert?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// parameters
						var toUnit = remainder.split(/ into | to /gi)
							toUnit = (toUnit[1] || toUnit[0]).split(/ from /gi)[0].trim()

						var fromUnit = remainder.split(/ from /gi)
							fromUnit = (fromUnit[1] || fromUnit[0]).split(/ into | to /gi)[0].trim()
						
						var words = fromUnit.split(/\s/gi)
							for (var i in words) {
								words[i] = window.FUNCTION_LIBRARY.getDigits(words[i].trim())
							}
							words = words.join(" ")
							fromUnit = words.replace(/[0-9\.]/gi,"").trim()
						
						var quantity = Number(words.replace(/[^0-9\.]/gi,"")) || 1

					// options
						var options = {
							responseType: "json",
							url: "https://us-central1-projects-3bd0e.cloudfunctions.net/unitconverter?quantity=" + quantity + "&from=" + fromUnit + "&to=" + toUnit
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// failure
									if (!response.success) {
										callback({icon: icon, error: true, message: "I was unable to convert from " + fromUnit + "to" + toUnit, html: "<h2>Error: unable to convert:</h2>" + response.message + "<br></br>" + quantity + " " + fromUnit + " = <b>???</b> " + toUnit})
										return
									}
								
								// get output
									var outputQuantity = Number(response.output).toLocaleString("fullwide", {useGrouping: true, maximumSignificantDigits: 21})
									var outputFromUnit = (response.parameters.from.prefix !== "_" ? response.parameters.from.prefix : "") + response.parameters.from.unit
									var outputToUnit   = (response.parameters.to.prefix   !== "_" ? response.parameters.to.prefix   : "") + response.parameters.to.unit

								// response
									var number = outputQuantity
									var message = outputQuantity + " " + outputToUnit
									var responseHTML = "<h2>" + response.parameters.quantity + " " + outputFromUnit + " = <b>" + outputQuantity + "</b> " + outputToUnit + "</h2>"
									callback({icon: icon, message: message, html: responseHTML, number: number})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to convert.", html: "<h2>Error: unable to access unitConverter</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"find factors": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x2a37;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I search for?", html: "<h2>Error: invalid search</h2>"})
							return
						}

					// parameters
						var input = window.FUNCTION_LIBRARY.getDigits(remainder)

					// that?
						if (input == "that" && window.CONTEXT_LIBRARY.lastResponseNumber) {
							input = Number(window.CONTEXT_LIBRARY.lastResponseNumber)
						}

					// not a number?
						if (!input || isNaN(input)) {
							callback({icon: icon, error: true, message: "I don't know that number", html: "<h2>Error: invalid search:</h2>" + remainder})
							return
						}

					// options
						var options = {
							responseType: "json",
							url: "https://us-central1-projects-3bd0e.cloudfunctions.net/factorfinder?number=" + input
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// failure
									if (!response.success) {
										callback({icon: icon, error: true, message: "I was unable to find the factors of " + remainder, html: "<h2>Error: unable to find factors:</h2>" + response.message})
										return
									}
								
								// generate message
									var message = response.qualities.map(function(q) {
										return q.replace("<li>","").replace("</li>","").replace(/\<\/?br\>/gi," ")
									}) || []
										message[0] = message[0].replace(/x/gi, "times")
										message = message.join("... ")
										message = "Here's what I found for " + input + ": " + message

								// response
									var responseHTML = "<h2>" + input + "</h2><ul>" + response.html + "</ul>"
									callback({icon: icon, message: message, html: responseHTML, number: input})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to fetch that number.", html: "<h2>Error: unable to access factorFinder</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"analyze chord": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f3b5;"

					// no remainder
						remainder = remainder.replace(/[?!.:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I analyze?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// parameters
						var input = remainder.replace(/and/gi,"")
							input = input.split(/,\s|,|\s/gi)
						for (var i in input) {
							input[i] = input[i].slice(0,1).toUpperCase() + input[i].slice(1,input[i].length)
						}
							input = input.join(",")

					// options
						var options = {
							responseType: "json",
							url: "https://us-central1-projects-3bd0e.cloudfunctions.net/chordanalyzer?notes=" + encodeURIComponent(input)
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// failure
									if (!response.success) {
										callback({icon: icon, error: true, message: "I was unable to do a chordal analysis of " + remainder, html: "<h2>Error: unable to analyze chord:</h2>" + response.message})
										return
									}
								
								// response
									var message = response.smallOutput.replace(/\#/gi," sharp").replace(/b/g, " flat")
									var responseHTML = response.chord.join(" - ") + "<h2>" + response.bigOutput + "</h2>" + response.smallOutput
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to analyze that chord.", html: "<h2>Error: unable to access chordAnalyzer</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"shuffle word": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f500;"

					// no remainder
						remainder = remainder.replace(/[?!.,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I shuffle?", html: "<h2>Error: invalid query</h2>"})
							return
						}
						var word = remainder

					// that?
						if (word == "that" && window.CONTEXT_LIBRARY.lastResponseWord) {
							word = window.CONTEXT_LIBRARY.lastResponseWord
						}

					// options
						var options = {
							responseType: "json",
							url: "https://us-central1-projects-3bd0e.cloudfunctions.net/wordshuffler?word=" + word
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// failure
									if (!response.success) {
										callback({icon: icon, error: true, message: "I was unable to shuffle the word " + remainder, html: "<h2>Error: unable to shuffle word:</h2>" + response.message})
										return
									}
							
								// get word list
									var wordList = []
									for (var i in response.results) {
										for (var j in response.results[i]) {
											wordList.push(response.results[i][j])
										}
									}

								// response
									var message = "I found " + wordList.length + " words within " + word + ": " + wordList.join(", ")
									var responseHTML = "<h2>" + word + "</h2>" + response.html
									callback({icon: icon, message: message, html: responseHTML, word: word})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to shuffle that word.", html: "<h2>Error: unable to access wordShuffler</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"convert base": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f500;"

					// no remainder
						remainder = " " + remainder.replace(/[?!,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I convert?", html: "<h2>Error: invalid query</h2>"})
							return
						}

					// parameters
						var newBase = remainder.split(/ into base | to base /gi)
							newBase = (newBase[1] || newBase[0]).split(/ from base /gi)[0].trim()
						var words = newBase.split(/\s/gi)
							for (var i in words) {
								words[i] = window.FUNCTION_LIBRARY.getDigits(words[i].trim())
							}
							newBase = Number(words.join("").replace(/[^0-9\.]/gi,"")) || 2

						var oldBase = remainder.split(/ from base /gi)
							oldBase = (oldBase[1] || oldBase[0]).split(/ into base | to base /gi)[0].trim()
						var words = oldBase.split(/\s/gi)
							for (var i in words) {
								words[i] = window.FUNCTION_LIBRARY.getDigits(words[i].trim())
							}
							oldBase = Number(words.join("").replace(/[^0-9\.]/gi,"")) || 2
						
						var numberString = remainder.split(/ into base | to base | from base /gi)[0]
							numberString = numberString.replace(/[^A-Za-z0-9]/gi,"") || 1

					// options
						var options = {
							responseType: "json",
							url: "https://us-central1-projects-3bd0e.cloudfunctions.net/baseconverter?numberString=" + numberString + "&oldBase=" + oldBase + "&newBase=" + newBase
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// failure
									if (!response.success) {
										callback({icon: icon, error: true, message: "I was unable to convert from " + oldBase + "to" + newBase, html: "<h2>Error: unable to convert:</h2>" + response.message + "<br></br>" + numberString + " in base " + oldBase + " = <b>???</b> in base " + newBase})
										return
									}
								
								// get output
									var outputNumberString = response.number

								// response
									var number = outputNumberString
									var message = numberString + " in base " + oldBase + " is " + outputNumberString + " in base " + newBase
									var responseHTML = "<h2>" + numberString + " in base " + oldBase + " = <b>" + outputNumberString + "</b> in base " + newBase + "</h2>"
									callback({icon: icon, message: message, html: responseHTML, number: number})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to convert.", html: "<h2>Error: unable to access baseConverter</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"encrypt message": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f510;"

					// no remainder
						remainder = " " + remainder.replace(/[?!,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I encrypt?", html: "<h2>Error: invalid request</h2>"})
							return
						}

					// parameters
						var keyword = remainder.split(/ with key | with keyword | using key | using keyword | with secret | using secret /gi)
							keyword = (keyword[1] || keyword[0]).split(/ a message | this message | secret message | this secret message /gi)[0].trim()

						var messageText = remainder.split(/ a message | this message | secret message | this secret message /gi)
							messageText = (messageText[1] || messageText[0]).split(/ with key | with keyword | using key | using keyword | with secret | using secret /gi)[0].trim()
						
					// options
						var options = {
							responseType: "json",
							url: "https://us-central1-projects-3bd0e.cloudfunctions.net/messageencrypter?action=encrypt&message=" + messageText.replace(/\s/gi, "") + "&keyword=" + keyword.replace(/\s/gi, "")
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// failure
									if (!response.success) {
										callback({icon: icon, error: true, message: "I was unable to encrypt your message.", html: "<h2>Error: unable to encrypt:</h2>" + response.message + "<br></br><li><b>message:</b> " + message + "</li></li><b>keyword:</b> " + keyword + "</li>"})
										return
									}

								// response
									var message = response.html
									var responseHTML = "<h2>" + response.html + "</h2>"
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to encrypt.", html: "<h2>Error: unable to access messageEncrypter</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			},
			"decrypt message": function(remainder, callback) {
				try {
					// icon
						var icon = "&#x1f513;"

					// no remainder
						remainder = " " + remainder.replace(/[?!,:;'"_\/\(\)\$\%]/gi,"").toLowerCase().trim()
						if (!remainder || !remainder.trim()) {
							callback({icon: icon, error: true, message: "What should I decrypt?", html: "<h2>Error: invalid request</h2>"})
							return
						}

					// parameters
						var keyword = remainder.split(/ with key | with keyword | using key | using keyword | with secret | using secret /gi)
							keyword = (keyword[1] || keyword[0]).split(/ a message | this message | secret message | this secret message /gi)[0].trim()

						var messageText = remainder.split(/ a message | this message | secret message | this secret message /gi)
							messageText = (messageText[1] || messageText[0]).split(/ with key | with keyword | using key | using keyword | with secret | using secret /gi)[0].trim()
						
					// options
						var options = {
							responseType: "json",
							url: "https://us-central1-projects-3bd0e.cloudfunctions.net/messageencrypter?action=decrypt&message=" + messageText.replace(/\s/gi, "") + "&keyword=" + keyword.replace(/\s/gi, "")
						}

					// proxy to server
						window.FUNCTION_LIBRARY.proxyRequest(options, function(response) {
							try {
								// failure
									if (!response.success) {
										callback({icon: icon, error: true, message: "I was unable to decrypt your message.", html: "<h2>Error: unable to decrypt:</h2>" + response.message + "<br></br><li><b>message:</b> " + message + "</li></li><b>keyword:</b> " + keyword + "</li>"})
										return
									}

								// response
									var message = response.html
									var responseHTML = "<h2>" + response.html + "</h2>"
									callback({icon: icon, message: message, html: responseHTML})
							}
							catch (error) {
								callback({icon: icon, error: true, message: "I was unable to decrypt.", html: "<h2>Error: unable to access messageEncrypter</h2>"})
							}
						})
				}
				catch (error) {
					callback({icon: icon, error: true, message: "I was unable to " + arguments.callee.name + ".", html: "<h2>Unknown error in <b>" + arguments.callee.name + "</b>:</h2>" + error})
				}
			}
	}
